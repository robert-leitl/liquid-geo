var t,e,n,i,s,r,o,a,l,c,u,h,p,d,f,m,v,_,g,b,y,w,x,C,T,A,S,k,E,P,M,O,D,I,V=Object.defineProperty,R=(t,e,n)=>(((t,e,n)=>{e in t?V(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n})(t,"symbol"!=typeof e?e+"":e,n),n),F=(t,e,n)=>{if(!e.has(t))throw TypeError("Cannot "+n)},L=(t,e,n)=>(F(t,e,"read from private field"),n?n.call(t):e.get(t)),N=(t,e,n)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,n)},B=(t,e,n,i)=>(F(t,e,"write to private field"),i?i.call(t,n):e.set(t,n),n),z=(t,e,n)=>(F(t,e,"access private method"),n);!function(){const t=document.createElement("link").relList;if(!(t&&t.supports&&t.supports("modulepreload"))){for(const t of document.querySelectorAll('link[rel="modulepreload"]'))e(t);new MutationObserver((t=>{for(const n of t)if("childList"===n.type)for(const t of n.addedNodes)"LINK"===t.tagName&&"modulepreload"===t.rel&&e(t)})).observe(document,{childList:!0,subtree:!0})}function e(t){if(t.ep)return;t.ep=!0;const e=function(t){const e={};return t.integrity&&(e.integrity=t.integrity),t.referrerpolicy&&(e.referrerPolicy=t.referrerpolicy),"use-credentials"===t.crossorigin?e.credentials="include":"anonymous"===t.crossorigin?e.credentials="omit":e.credentials="same-origin",e}(t);fetch(t.href,e)}}();var j=function(t,e){return(j=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)};function U(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}j(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}function q(t,e,n,i){var s,r=arguments.length,o=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,n,i);else for(var a=t.length-1;a>=0;a--)(s=t[a])&&(o=(r<3?s(o):r>3?s(e,n,o):s(e,n))||o);return r>3&&o&&Object.defineProperty(e,n,o),o}function W(t,e,n,i){return new(n||(n=Promise))((function(s,r){function o(t){try{l(i.next(t))}catch(e){r(e)}}function a(t){try{l(i.throw(t))}catch(e){r(e)}}function l(t){var e;t.done?s(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,a)}l((i=i.apply(t,e||[])).next())}))}function H(t,e){var n,i,s,r,o={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return r={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function a(a){return function(l){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;r&&(r=0,a[0]&&(o=0)),o;)try{if(n=1,i&&(s=2&a[0]?i.return:a[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,a[1])).done)return s;switch(i=0,s&&(a=[2&a[0],s.value]),a[0]){case 0:case 1:s=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,i=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(s=o.trys,(s=s.length>0&&s[s.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!s||a[1]>s[0]&&a[1]<s[3])){o.label=a[1];break}if(6===a[0]&&o.label<s[1]){o.label=s[1],s=a;break}if(s&&o.label<s[2]){o.label=s[2],o.ops.push(a);break}s[2]&&o.ops.pop(),o.trys.pop();continue}a=e.call(t,o)}catch(l){a=[6,l],i=0}finally{n=s=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,l])}}}function G(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],i=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function K(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var i,s,r=n.call(t),o=[];try{for(;(void 0===e||e-- >0)&&!(i=r.next()).done;)o.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(s)throw s.error}}return o}function Y(t,e,n){if(n||2===arguments.length)for(var i,s=0,r=e.length;s<r;s++)!i&&s in e||(i||(i=Array.prototype.slice.call(e,0,s)),i[s]=e[s]);return t.concat(i||Array.prototype.slice.call(e))}function X(t){return this instanceof X?(this.v=t,this):new X(t)}function $(t,e,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i,s=n.apply(t,e||[]),r=[];return i={},o("next"),o("throw"),o("return"),i[Symbol.asyncIterator]=function(){return this},i;function o(t){s[t]&&(i[t]=function(e){return new Promise((function(n,i){r.push([t,e,n,i])>1||a(t,e)}))})}function a(t,e){try{(n=s[t](e)).value instanceof X?Promise.resolve(n.value.v).then(l,c):u(r[0][2],n)}catch(i){u(r[0][3],i)}var n}function l(t){a("next",t)}function c(t){a("throw",t)}function u(t,e){t(e),r.shift(),r.length&&a(r[0][0],r[0][1])}}function Z(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e,n=t[Symbol.asyncIterator];return n?n.call(t):(t=G(t),e={},i("next"),i("throw"),i("return"),e[Symbol.asyncIterator]=function(){return this},e);function i(n){e[n]=t[n]&&function(e){return new Promise((function(i,s){(function(t,e,n,i){Promise.resolve(i).then((function(e){t({value:e,done:n})}),e)})(i,s,(e=t[n](e)).done,e.value)}))}}}function Q(t){return"function"==typeof t}var J,tt,et=(J=function(t){return function(e){t(this),this.message=e?e.length+" errors occurred during unsubscription:\n"+e.map((function(t,e){return e+1+") "+t.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=e}},(tt=J((function(t){Error.call(t),t.stack=(new Error).stack}))).prototype=Object.create(Error.prototype),tt.prototype.constructor=tt,tt);function nt(t,e){if(t){var n=t.indexOf(e);0<=n&&t.splice(n,1)}}var it=function(){function t(t){this.initialTeardown=t,this.closed=!1,this._parentage=null,this._finalizers=null}var e;return t.prototype.unsubscribe=function(){var t,e,n,i,s;if(!this.closed){this.closed=!0;var r=this._parentage;if(r)if(this._parentage=null,Array.isArray(r))try{for(var o=G(r),a=o.next();!a.done;a=o.next()){a.value.remove(this)}}catch(d){t={error:d}}finally{try{a&&!a.done&&(e=o.return)&&e.call(o)}finally{if(t)throw t.error}}else r.remove(this);var l=this.initialTeardown;if(Q(l))try{l()}catch(f){s=f instanceof et?f.errors:[f]}var c=this._finalizers;if(c){this._finalizers=null;try{for(var u=G(c),h=u.next();!h.done;h=u.next()){var p=h.value;try{rt(p)}catch(m){s=null!=s?s:[],m instanceof et?s=Y(Y([],K(s)),K(m.errors)):s.push(m)}}}catch(v){n={error:v}}finally{try{h&&!h.done&&(i=u.return)&&i.call(u)}finally{if(n)throw n.error}}}if(s)throw new et(s)}},t.prototype.add=function(e){var n;if(e&&e!==this)if(this.closed)rt(e);else{if(e instanceof t){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=null!==(n=this._finalizers)&&void 0!==n?n:[]).push(e)}},t.prototype._hasParent=function(t){var e=this._parentage;return e===t||Array.isArray(e)&&e.includes(t)},t.prototype._addParent=function(t){var e=this._parentage;this._parentage=Array.isArray(e)?(e.push(t),e):e?[e,t]:t},t.prototype._removeParent=function(t){var e=this._parentage;e===t?this._parentage=null:Array.isArray(e)&&nt(e,t)},t.prototype.remove=function(e){var n=this._finalizers;n&&nt(n,e),e instanceof t&&e._removeParent(this)},t.EMPTY=((e=new t).closed=!0,e),t}();function st(t){return t instanceof it||t&&"closed"in t&&Q(t.remove)&&Q(t.add)&&Q(t.unsubscribe)}function rt(t){Q(t)?t():t.unsubscribe()}it.EMPTY;var ot=void 0,at=!1,lt={setTimeout:function(t,e){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];var s=lt.delegate;return(null==s?void 0:s.setTimeout)?s.setTimeout.apply(s,Y([t,e],K(n))):setTimeout.apply(void 0,Y([t,e],K(n)))},clearTimeout:function(t){var e=lt.delegate;return((null==e?void 0:e.clearTimeout)||clearTimeout)(t)},delegate:void 0};function ct(t){lt.setTimeout((function(){throw t}))}function ut(){}var ht=function(t){function e(e){var n=t.call(this)||this;return n.isStopped=!1,e?(n.destination=e,st(e)&&e.add(n)):n.destination=_t,n}return U(e,t),e.create=function(t,e,n){return new mt(t,e,n)},e.prototype.next=function(t){this.isStopped||this._next(t)},e.prototype.error=function(t){this.isStopped||(this.isStopped=!0,this._error(t))},e.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,t.prototype.unsubscribe.call(this),this.destination=null)},e.prototype._next=function(t){this.destination.next(t)},e.prototype._error=function(t){try{this.destination.error(t)}finally{this.unsubscribe()}},e.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},e}(it),pt=Function.prototype.bind;function dt(t,e){return pt.call(t,e)}var ft=function(){function t(t){this.partialObserver=t}return t.prototype.next=function(t){var e=this.partialObserver;if(e.next)try{e.next(t)}catch(n){vt(n)}},t.prototype.error=function(t){var e=this.partialObserver;if(e.error)try{e.error(t)}catch(n){vt(n)}else vt(t)},t.prototype.complete=function(){var t=this.partialObserver;if(t.complete)try{t.complete()}catch(e){vt(e)}},t}(),mt=function(t){function e(e,n,i){var s,r,o=t.call(this)||this;Q(e)||!e?s={next:null!=e?e:void 0,error:null!=n?n:void 0,complete:null!=i?i:void 0}:o&&at?((r=Object.create(e)).unsubscribe=function(){return o.unsubscribe()},s={next:e.next&&dt(e.next,r),error:e.error&&dt(e.error,r),complete:e.complete&&dt(e.complete,r)}):s=e;return o.destination=new ft(s),o}return U(e,t),e}(ht);function vt(t){ct(t)}var _t={closed:!0,next:ut,error:function(t){throw t},complete:ut},gt="function"==typeof Symbol&&Symbol.observable||"@@observable";function bt(t){return t}function yt(t){return 0===t.length?bt:1===t.length?t[0]:function(e){return t.reduce((function(t,e){return e(t)}),e)}}var wt=function(){function t(t){t&&(this._subscribe=t)}return t.prototype.lift=function(e){var n=new t;return n.source=this,n.operator=e,n},t.prototype.subscribe=function(t,e,n){var i,s=this,r=(i=t)&&i instanceof ht||function(t){return t&&Q(t.next)&&Q(t.error)&&Q(t.complete)}(i)&&st(i)?t:new mt(t,e,n);return function(){var t=s,e=t.operator,n=t.source;r.add(e?e.call(r,n):n?s._subscribe(r):s._trySubscribe(r))}(),r},t.prototype._trySubscribe=function(t){try{return this._subscribe(t)}catch(e){t.error(e)}},t.prototype.forEach=function(t,e){var n=this;return new(e=xt(e))((function(e,i){var s=new mt({next:function(e){try{t(e)}catch(n){i(n),s.unsubscribe()}},error:i,complete:e});n.subscribe(s)}))},t.prototype._subscribe=function(t){var e;return null===(e=this.source)||void 0===e?void 0:e.subscribe(t)},t.prototype[gt]=function(){return this},t.prototype.pipe=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return yt(t)(this)},t.prototype.toPromise=function(t){var e=this;return new(t=xt(t))((function(t,n){var i;e.subscribe((function(t){return i=t}),(function(t){return n(t)}),(function(){return t(i)}))}))},t.create=function(e){return new t(e)},t}();function xt(t){var e;return null!==(e=null!=t?t:ot)&&void 0!==e?e:Promise}function Ct(t){return function(e){if(function(t){return Q(null==t?void 0:t.lift)}(e))return e.lift((function(e){try{return t(e,this)}catch(n){this.error(n)}}));throw new TypeError("Unable to lift unknown Observable type")}}function Tt(t,e,n,i,s){return new At(t,e,n,i,s)}var At=function(t){function e(e,n,i,s,r,o){var a=t.call(this,e)||this;return a.onFinalize=r,a.shouldUnsubscribe=o,a._next=n?function(t){try{n(t)}catch(i){e.error(i)}}:t.prototype._next,a._error=s?function(t){try{s(t)}catch(n){e.error(n)}finally{this.unsubscribe()}}:t.prototype._error,a._complete=i?function(){try{i()}catch(t){e.error(t)}finally{this.unsubscribe()}}:t.prototype._complete,a}return U(e,t),e.prototype.unsubscribe=function(){var e;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var n=this.closed;t.prototype.unsubscribe.call(this),!n&&(null===(e=this.onFinalize)||void 0===e||e.call(this))}},e}(ht),St={now:function(){return(St.delegate||Date).now()},delegate:void 0},kt=function(t){function e(e,n){return t.call(this)||this}return U(e,t),e.prototype.schedule=function(t,e){return this},e}(it),Et={setInterval:function(t,e){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];var s=Et.delegate;return(null==s?void 0:s.setInterval)?s.setInterval.apply(s,Y([t,e],K(n))):setInterval.apply(void 0,Y([t,e],K(n)))},clearInterval:function(t){var e=Et.delegate;return((null==e?void 0:e.clearInterval)||clearInterval)(t)},delegate:void 0},Pt=function(t){function e(e,n){var i=t.call(this,e,n)||this;return i.scheduler=e,i.work=n,i.pending=!1,i}return U(e,t),e.prototype.schedule=function(t,e){var n;if(void 0===e&&(e=0),this.closed)return this;this.state=t;var i=this.id,s=this.scheduler;return null!=i&&(this.id=this.recycleAsyncId(s,i,e)),this.pending=!0,this.delay=e,this.id=null!==(n=this.id)&&void 0!==n?n:this.requestAsyncId(s,this.id,e),this},e.prototype.requestAsyncId=function(t,e,n){return void 0===n&&(n=0),Et.setInterval(t.flush.bind(t,this),n)},e.prototype.recycleAsyncId=function(t,e,n){if(void 0===n&&(n=0),null!=n&&this.delay===n&&!1===this.pending)return e;null!=e&&Et.clearInterval(e)},e.prototype.execute=function(t,e){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var n=this._execute(t,e);if(n)return n;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},e.prototype._execute=function(t,e){var n,i=!1;try{this.work(t)}catch(s){i=!0,n=s||new Error("Scheduled action threw falsy error")}if(i)return this.unsubscribe(),n},e.prototype.unsubscribe=function(){if(!this.closed){var e=this.id,n=this.scheduler,i=n.actions;this.work=this.state=this.scheduler=null,this.pending=!1,nt(i,this),null!=e&&(this.id=this.recycleAsyncId(n,e,null)),this.delay=null,t.prototype.unsubscribe.call(this)}},e}(kt),Mt=function(){function t(e,n){void 0===n&&(n=t.now),this.schedulerActionCtor=e,this.now=n}return t.prototype.schedule=function(t,e,n){return void 0===e&&(e=0),new this.schedulerActionCtor(this,t).schedule(n,e)},t.now=St.now,t}(),Ot=new(function(t){function e(e,n){void 0===n&&(n=Mt.now);var i=t.call(this,e,n)||this;return i.actions=[],i._active=!1,i}return U(e,t),e.prototype.flush=function(t){var e=this.actions;if(this._active)e.push(t);else{var n;this._active=!0;do{if(n=t.execute(t.state,t.delay))break}while(t=e.shift());if(this._active=!1,n){for(;t=e.shift();)t.unsubscribe();throw n}}},e}(Mt))(Pt),Dt=new wt((function(t){return t.complete()}));function It(t){return t[t.length-1]}function Vt(t){return(e=It(t))&&Q(e.schedule)?t.pop():void 0;var e}function Rt(t,e){return"number"==typeof It(t)?t.pop():e}var Ft=function(t){return t&&"number"==typeof t.length&&"function"!=typeof t};function Lt(t){return Q(null==t?void 0:t.then)}function Nt(t){return Q(t[gt])}function Bt(t){return Symbol.asyncIterator&&Q(null==t?void 0:t[Symbol.asyncIterator])}function zt(t){return new TypeError("You provided "+(null!==t&&"object"==typeof t?"an invalid object":"'"+t+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}var jt="function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator";function Ut(t){return Q(null==t?void 0:t[jt])}function qt(t){return $(this,arguments,(function(){var e,n,i;return H(this,(function(s){switch(s.label){case 0:e=t.getReader(),s.label=1;case 1:s.trys.push([1,,9,10]),s.label=2;case 2:return[4,X(e.read())];case 3:return n=s.sent(),i=n.value,n.done?[4,X(void 0)]:[3,5];case 4:return[2,s.sent()];case 5:return[4,X(i)];case 6:return[4,s.sent()];case 7:return s.sent(),[3,2];case 8:return[3,10];case 9:return e.releaseLock(),[7];case 10:return[2]}}))}))}function Wt(t){return Q(null==t?void 0:t.getReader)}function Ht(t){if(t instanceof wt)return t;if(null!=t){if(Nt(t))return s=t,new wt((function(t){var e=s[gt]();if(Q(e.subscribe))return e.subscribe(t);throw new TypeError("Provided object does not correctly implement Symbol.observable")}));if(Ft(t))return i=t,new wt((function(t){for(var e=0;e<i.length&&!t.closed;e++)t.next(i[e]);t.complete()}));if(Lt(t))return n=t,new wt((function(t){n.then((function(e){t.closed||(t.next(e),t.complete())}),(function(e){return t.error(e)})).then(null,ct)}));if(Bt(t))return Gt(t);if(Ut(t))return e=t,new wt((function(t){var n,i;try{for(var s=G(e),r=s.next();!r.done;r=s.next()){var o=r.value;if(t.next(o),t.closed)return}}catch(a){n={error:a}}finally{try{r&&!r.done&&(i=s.return)&&i.call(s)}finally{if(n)throw n.error}}t.complete()}));if(Wt(t))return Gt(qt(t))}var e,n,i,s;throw zt(t)}function Gt(t){return new wt((function(e){(function(t,e){var n,i,s,r;return W(this,void 0,void 0,(function(){var o,a;return H(this,(function(l){switch(l.label){case 0:l.trys.push([0,5,6,11]),n=Z(t),l.label=1;case 1:return[4,n.next()];case 2:if((i=l.sent()).done)return[3,4];if(o=i.value,e.next(o),e.closed)return[2];l.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return a=l.sent(),s={error:a},[3,11];case 6:return l.trys.push([6,,9,10]),i&&!i.done&&(r=n.return)?[4,r.call(n)]:[3,8];case 7:l.sent(),l.label=8;case 8:return[3,10];case 9:if(s)throw s.error;return[7];case 10:return[7];case 11:return e.complete(),[2]}}))}))})(t,e).catch((function(t){return e.error(t)}))}))}function Kt(t,e,n,i,s){void 0===i&&(i=0),void 0===s&&(s=!1);var r=e.schedule((function(){n(),s?t.add(this.schedule(null,i)):this.unsubscribe()}),i);if(t.add(r),!s)return r}function Yt(t,e){return void 0===e&&(e=0),Ct((function(n,i){n.subscribe(Tt(i,(function(n){return Kt(i,t,(function(){return i.next(n)}),e)}),(function(){return Kt(i,t,(function(){return i.complete()}),e)}),(function(n){return Kt(i,t,(function(){return i.error(n)}),e)})))}))}function Xt(t,e){return void 0===e&&(e=0),Ct((function(n,i){i.add(t.schedule((function(){return n.subscribe(i)}),e))}))}function $t(t,e){if(!t)throw new Error("Iterable cannot be null");return new wt((function(n){Kt(n,e,(function(){var i=t[Symbol.asyncIterator]();Kt(n,e,(function(){i.next().then((function(t){t.done?n.complete():n.next(t.value)}))}),0,!0)}))}))}function Zt(t,e){if(null!=t){if(Nt(t))return function(t,e){return Ht(t).pipe(Xt(e),Yt(e))}(t,e);if(Ft(t))return function(t,e){return new wt((function(n){var i=0;return e.schedule((function(){i===t.length?n.complete():(n.next(t[i++]),n.closed||this.schedule())}))}))}(t,e);if(Lt(t))return function(t,e){return Ht(t).pipe(Xt(e),Yt(e))}(t,e);if(Bt(t))return $t(t,e);if(Ut(t))return function(t,e){return new wt((function(n){var i;return Kt(n,e,(function(){i=t[jt](),Kt(n,e,(function(){var t,e,s;try{e=(t=i.next()).value,s=t.done}catch(r){return void n.error(r)}s?n.complete():n.next(e)}),0,!0)})),function(){return Q(null==i?void 0:i.return)&&i.return()}}))}(t,e);if(Wt(t))return function(t,e){return $t(qt(t),e)}(t,e)}throw zt(t)}function Qt(t,e){return e?Zt(t,e):Ht(t)}function Jt(t,e){return Ct((function(n,i){var s=0;n.subscribe(Tt(i,(function(n){i.next(t.call(e,n,s++))})))}))}var te=Array.isArray;function ee(t){return Jt((function(e){return function(t,e){return te(e)?t.apply(void 0,Y([],K(e))):t(e)}(t,e)}))}function ne(t,e,n){return void 0===n&&(n=1/0),Q(e)?ne((function(n,i){return Jt((function(t,s){return e(n,t,i,s)}))(Ht(t(n,i)))}),n):("number"==typeof e&&(n=e),Ct((function(e,i){return function(t,e,n,i,s,r,o,a){var l=[],c=0,u=0,h=!1,p=function(){!h||l.length||c||e.complete()},d=function(t){return c<i?f(t):l.push(t)},f=function(t){r&&e.next(t),c++;var a=!1;Ht(n(t,u++)).subscribe(Tt(e,(function(t){null==s||s(t),r?d(t):e.next(t)}),(function(){a=!0}),void 0,(function(){if(a)try{c--;for(var t=function(){var t=l.shift();o?Kt(e,o,(function(){return f(t)})):f(t)};l.length&&c<i;)t();p()}catch(n){e.error(n)}})))};return t.subscribe(Tt(e,d,(function(){h=!0,p()}))),function(){null==a||a()}}(e,i,t,n)})))}function ie(t){return void 0===t&&(t=1/0),ne(bt,t)}var se=["addListener","removeListener"],re=["addEventListener","removeEventListener"],oe=["on","off"];function ae(t,e,n,i){if(Q(n)&&(i=n,n=void 0),i)return ae(t,e,n).pipe(ee(i));var s=K(function(t){return Q(t.addEventListener)&&Q(t.removeEventListener)}(t)?re.map((function(i){return function(s){return t[i](e,s,n)}})):function(t){return Q(t.addListener)&&Q(t.removeListener)}(t)?se.map(le(t,e)):function(t){return Q(t.on)&&Q(t.off)}(t)?oe.map(le(t,e)):[],2),r=s[0],o=s[1];if(!r&&Ft(t))return ne((function(t){return ae(t,e,n)}))(Ht(t));if(!r)throw new TypeError("Invalid event target");return new wt((function(t){var e=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return t.next(1<e.length?e:e[0])};return r(e),function(){return o(e)}}))}function le(t,e){return function(n){return function(i){return t[n](e,i)}}}var ce="undefined"!=typeof Float32Array?Float32Array:Array;function ue(){var t=new ce(16);return ce!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function he(t,e){var n=e[0],i=e[1],s=e[2],r=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8],h=e[9],p=e[10],d=e[11],f=e[12],m=e[13],v=e[14],_=e[15],g=n*a-i*o,b=n*l-s*o,y=n*c-r*o,w=i*l-s*a,x=i*c-r*a,C=s*c-r*l,T=u*m-h*f,A=u*v-p*f,S=u*_-d*f,k=h*v-p*m,E=h*_-d*m,P=p*_-d*v,M=g*P-b*E+y*k+w*S-x*A+C*T;return M?(M=1/M,t[0]=(a*P-l*E+c*k)*M,t[1]=(s*E-i*P-r*k)*M,t[2]=(m*C-v*x+_*w)*M,t[3]=(p*x-h*C-d*w)*M,t[4]=(l*S-o*P-c*A)*M,t[5]=(n*P-s*S+r*A)*M,t[6]=(v*y-f*C-_*b)*M,t[7]=(u*C-p*y+d*b)*M,t[8]=(o*E-a*S+c*T)*M,t[9]=(i*S-n*E-r*T)*M,t[10]=(f*x-m*y+_*g)*M,t[11]=(h*y-u*x-d*g)*M,t[12]=(a*A-o*k-l*T)*M,t[13]=(n*k-i*A+s*T)*M,t[14]=(m*b-f*w-v*g)*M,t[15]=(u*w-h*b+p*g)*M,t):null}function pe(t,e,n){var i=e[0],s=e[1],r=e[2],o=e[3],a=e[4],l=e[5],c=e[6],u=e[7],h=e[8],p=e[9],d=e[10],f=e[11],m=e[12],v=e[13],_=e[14],g=e[15],b=n[0],y=n[1],w=n[2],x=n[3];return t[0]=b*i+y*a+w*h+x*m,t[1]=b*s+y*l+w*p+x*v,t[2]=b*r+y*c+w*d+x*_,t[3]=b*o+y*u+w*f+x*g,b=n[4],y=n[5],w=n[6],x=n[7],t[4]=b*i+y*a+w*h+x*m,t[5]=b*s+y*l+w*p+x*v,t[6]=b*r+y*c+w*d+x*_,t[7]=b*o+y*u+w*f+x*g,b=n[8],y=n[9],w=n[10],x=n[11],t[8]=b*i+y*a+w*h+x*m,t[9]=b*s+y*l+w*p+x*v,t[10]=b*r+y*c+w*d+x*_,t[11]=b*o+y*u+w*f+x*g,b=n[12],y=n[13],w=n[14],x=n[15],t[12]=b*i+y*a+w*h+x*m,t[13]=b*s+y*l+w*p+x*v,t[14]=b*r+y*c+w*d+x*_,t[15]=b*o+y*u+w*f+x*g,t}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var de=function(t,e,n,i,s){var r,o=1/Math.tan(e/2);return t[0]=o/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=s&&s!==1/0?(r=1/(i-s),t[10]=(s+i)*r,t[14]=2*s*i*r):(t[10]=-1,t[14]=-2*i),t};var fe=function(t,e,n,i,s,r,o){var a=1/(e-n),l=1/(i-s),c=1/(r-o);return t[0]=-2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*l,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*c,t[11]=0,t[12]=(e+n)*a,t[13]=(s+i)*l,t[14]=(o+r)*c,t[15]=1,t};function me(t,e,n,i){var s=e[0],r=e[1],o=e[2],a=i[0],l=i[1],c=i[2],u=s-n[0],h=r-n[1],p=o-n[2],d=u*u+h*h+p*p;d>0&&(u*=d=1/Math.sqrt(d),h*=d,p*=d);var f=l*p-c*h,m=c*u-a*p,v=a*h-l*u;return(d=f*f+m*m+v*v)>0&&(f*=d=1/Math.sqrt(d),m*=d,v*=d),t[0]=f,t[1]=m,t[2]=v,t[3]=0,t[4]=h*v-p*m,t[5]=p*f-u*v,t[6]=u*m-h*f,t[7]=0,t[8]=u,t[9]=h,t[10]=p,t[11]=0,t[12]=s,t[13]=r,t[14]=o,t[15]=1,t}function ve(){var t=new ce(3);return ce!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function _e(t,e,n){var i=new ce(3);return i[0]=t,i[1]=e,i[2]=n,i}function ge(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function be(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function ye(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t}function we(t,e){var n=e[0],i=e[1],s=e[2],r=n*n+i*i+s*s;return r>0&&(r=1/Math.sqrt(r)),t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t}function xe(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function Ce(){var t=new ce(4);return ce!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function Te(t,e,n,i){var s=new ce(4);return s[0]=t,s[1]=e,s[2]=n,s[3]=i,s}function Ae(){var t=new ce(2);return ce!=Float32Array&&(t[0]=0,t[1]=0),t}function Se(t){var e=new ce(2);return e[0]=t[0],e[1]=t[1],e}function ke(t,e){var n=new ce(2);return n[0]=t,n[1]=e,n}function Ee(t,e){return t[0]=e[0],t[1]=e[1],t}function Pe(t,e,n){return t[0]=e,t[1]=n,t}ve(),function(){var t=Ce()}(),function(){var t=Ae()}();
/* @license twgl.js 5.2.0 Copyright (c) 2015, Gregg Tavares All Rights Reserved.
Available via the MIT license.
see: http://github.com/greggman/twgl.js for details */
const Me={};{const t=Me;t[5120]=Int8Array,t[5121]=Uint8Array,t[5122]=Int16Array,t[5123]=Uint16Array,t[5124]=Int32Array,t[5125]=Uint32Array,t[5126]=Float32Array,t[32819]=Uint16Array,t[32820]=Uint16Array,t[33635]=Uint16Array,t[5131]=Uint16Array,t[33640]=Uint32Array,t[35899]=Uint32Array,t[35902]=Uint32Array,t[36269]=Uint32Array,t[34042]=Uint32Array}function Oe(t){if(t instanceof Int8Array)return 5120;if(t instanceof Uint8Array)return 5121;if(t instanceof Uint8ClampedArray)return 5121;if(t instanceof Int16Array)return 5122;if(t instanceof Uint16Array)return 5123;if(t instanceof Int32Array)return 5124;if(t instanceof Uint32Array)return 5125;if(t instanceof Float32Array)return 5126;throw new Error("unsupported typed array type")}function De(t){if(t===Int8Array)return 5120;if(t===Uint8Array)return 5121;if(t===Uint8ClampedArray)return 5121;if(t===Int16Array)return 5122;if(t===Uint16Array)return 5123;if(t===Int32Array)return 5124;if(t===Uint32Array)return 5125;if(t===Float32Array)return 5126;throw new Error("unsupported typed array type")}function Ie(t){const e=Me[t];if(!e)throw new Error("unknown gl type");return e}const Ve="undefined"!=typeof SharedArrayBuffer?function(t){return t&&t.buffer&&(t.buffer instanceof ArrayBuffer||t.buffer instanceof SharedArrayBuffer)}:function(t){return t&&t.buffer&&t.buffer instanceof ArrayBuffer};function Re(...t){console.error(...t)}function Fe(...t){console.warn(...t)}const Le=new Map;function Ne(t,e){if(!t||"object"!=typeof t)return!1;let n=Le.get(e);n||(n=new WeakMap,Le.set(e,n));let i=n.get(t);if(void 0===i){const s=Object.prototype.toString.call(t);i=s.substring(8,s.length-1)===e,n.set(t,i)}return i}function Be(t,e){return"undefined"!=typeof WebGLRenderbuffer&&Ne(e,"WebGLRenderbuffer")}function ze(t,e){return"undefined"!=typeof WebGLTexture&&Ne(e,"WebGLTexture")}const je="";function Ue(t,e,n,i){if(s=e,"undefined"!=typeof WebGLBuffer&&Ne(s,"WebGLBuffer"))return e;var s;n=n||34962;const r=t.createBuffer();return function(t,e,n,i,s){t.bindBuffer(e,n),t.bufferData(e,i,s||35044)}(t,n,r,e,i),r}function qe(t){return"indices"===t}const We=/coord|texture/i,He=/color|colour/i;function Ge(t,e,n){return t.numComponents||t.size||function(t,e){let n;if(n=We.test(t)?2:He.test(t)?4:3,e%n>0)throw new Error(`Can not guess numComponents for attribute '${t}'. Tried ${n} but ${e} values is not evenly divisible by ${n}. You should specify it.`);return n}(e,n||function(t){return t.length?t:t.data}(t).length)}function Ke(t,e){if(Ve(t))return t;if(Ve(t.data))return t.data;Array.isArray(t)&&(t={data:t});let n=t.type?Ye(t.type):void 0;return n||(n=qe(e)?Uint16Array:Float32Array),new n(t.data)}function Ye(t){return"number"==typeof t?Ie(t):t||Float32Array}function Xe(t,e){return{buffer:e.buffer,numValues:24,type:(n=e.type,"number"==typeof n?n:n?De(n):5126),arrayType:Ye(e.type)};var n}function $e(t,e){const n=e.data||e,i=Ye(e.type),s=n*i.BYTES_PER_ELEMENT,r=t.createBuffer();return t.bindBuffer(34962,r),t.bufferData(34962,s,e.drawType||35044),{buffer:r,numValues:n,type:De(i),arrayType:i}}function Ze(t,e,n){const i=Ke(e,n);return{arrayType:i.constructor,buffer:Ue(t,i,void 0,e.drawType),type:Oe(i),numValues:0}}function Qe(t,e){const n={};return Object.keys(e).forEach((function(i){if(!qe(i)){const r=e[i],o=r.attrib||r.name||r.attribName||je+i;if(r.value){if(!Array.isArray(r.value)&&!Ve(r.value))throw new Error("array.value is not array or typedarray");n[o]={value:r.value}}else{let e;e=r.buffer&&r.buffer instanceof WebGLBuffer?Xe:"number"==typeof r||"number"==typeof r.data?$e:Ze;const{buffer:a,type:l,numValues:c,arrayType:u}=e(t,r,i),h=void 0!==r.normalize?r.normalize:(s=u)===Int8Array||s===Uint8Array,p=Ge(r,i,c);n[o]={buffer:a,numComponents:p,type:l,normalize:h,stride:r.stride||0,offset:r.offset||0,divisor:void 0===r.divisor?void 0:r.divisor,drawType:r.drawType}}}var s})),t.bindBuffer(34962,null),n}const Je=["position","positions","a_position"];function tn(t,e,n){const i=Qe(t,e),s=Object.assign({},n||{});s.attribs=Object.assign({},n?n.attribs:{},i);const r=e.indices;if(r){const e=Ke(r,"indices");s.indices=Ue(t,e,34963),s.numElements=e.length,s.elementType=Oe(e)}else s.numElements||(s.numElements=function(t,e){let n,i;for(i=0;i<Je.length&&(n=Je[i],!(n in e))&&(n=je+n,!(n in e));++i);i===Je.length&&(n=Object.keys(e)[0]);const s=e[n];if(!s.buffer)return 1;t.bindBuffer(34962,s.buffer);const r=t.getBufferParameter(34962,34660);var o;t.bindBuffer(34962,null);const a=r/(5120===(o=s.type)||5121===o?1:5122===o||5123===o?2:5124===o||5125===o||5126===o?4:0),l=s.numComponents||s.size,c=a/l;if(c%1!=0)throw new Error(`numComponents ${l} not correct for length ${length}`);return c}(t,s.attribs));return s}function en(t){return!!t.texStorage2D}const nn=function(){const t={},e={};return function(n,i){return function(n){const i=n.constructor.name;if(!t[i]){for(const t in n)if("number"==typeof n[t]){const i=e[n[t]];e[n[t]]=i?`${i} | ${t}`:t}t[i]=!0}}(n),e[i]||("number"==typeof i?`0x${i.toString(16)}`:i)}}(),sn={textureColor:new Uint8Array([128,192,255,255]),textureOptions:{},crossOrigin:void 0},rn=Ve,on=function(){let t;return function(){return t=t||("undefined"!=typeof document&&document.createElement?document.createElement("canvas").getContext("2d"):null),t}}(),an=6407,ln=33319;let cn;function un(t){if(!cn){const t={6406:{textureFormat:6406,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[1,2,2,4],type:[5121,5131,36193,5126]},6409:{textureFormat:6409,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[1,2,2,4],type:[5121,5131,36193,5126]},6410:{textureFormat:6410,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[2,4,4,8],type:[5121,5131,36193,5126]}};t[an]={textureFormat:an,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[3,6,6,12,2],type:[5121,5131,36193,5126,33635]},t[6408]={textureFormat:6408,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[4,8,8,16,2,2],type:[5121,5131,36193,5126,32819,32820]},t[6402]={textureFormat:6402,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[2,4],type:[5125,5123]},t[33321]={textureFormat:6403,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[1],type:[5121]},t[36756]={textureFormat:6403,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[1],type:[5120]},t[33325]={textureFormat:6403,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[4,2],type:[5126,5131]},t[33326]={textureFormat:6403,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[4],type:[5126]},t[33330]={textureFormat:36244,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[1],type:[5121]},t[33329]={textureFormat:36244,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[1],type:[5120]},t[33332]={textureFormat:36244,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[2],type:[5123]},t[33331]={textureFormat:36244,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[2],type:[5122]},t[33334]={textureFormat:36244,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[5125]},t[33333]={textureFormat:36244,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[5124]},t[33323]={textureFormat:ln,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[2],type:[5121]},t[36757]={textureFormat:ln,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[2],type:[5120]},t[33327]={textureFormat:ln,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[8,4],type:[5126,5131]},t[33328]={textureFormat:ln,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[8],type:[5126]},t[33336]={textureFormat:33320,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[2],type:[5121]},t[33335]={textureFormat:33320,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[2],type:[5120]},t[33338]={textureFormat:33320,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[5123]},t[33337]={textureFormat:33320,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[5122]},t[33340]={textureFormat:33320,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[8],type:[5125]},t[33339]={textureFormat:33320,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[8],type:[5124]},t[32849]={textureFormat:an,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[3],type:[5121]},t[35905]={textureFormat:an,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[3],type:[5121]},t[36194]={textureFormat:an,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[3,2],type:[5121,33635]},t[36758]={textureFormat:an,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[3],type:[5120]},t[35898]={textureFormat:an,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[12,6,4],type:[5126,5131,35899]},t[35901]={textureFormat:an,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[12,6,4],type:[5126,5131,35902]},t[34843]={textureFormat:an,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[12,6],type:[5126,5131]},t[34837]={textureFormat:an,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[12],type:[5126]},t[36221]={textureFormat:36248,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[3],type:[5121]},t[36239]={textureFormat:36248,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[3],type:[5120]},t[36215]={textureFormat:36248,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[6],type:[5123]},t[36233]={textureFormat:36248,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[6],type:[5122]},t[36209]={textureFormat:36248,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[12],type:[5125]},t[36227]={textureFormat:36248,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[12],type:[5124]},t[32856]={textureFormat:6408,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[4],type:[5121]},t[35907]={textureFormat:6408,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[4],type:[5121]},t[36759]={textureFormat:6408,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[4],type:[5120]},t[32855]={textureFormat:6408,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[4,2,4],type:[5121,32820,33640]},t[32854]={textureFormat:6408,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[4,2],type:[5121,32819]},t[32857]={textureFormat:6408,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[4],type:[33640]},t[34842]={textureFormat:6408,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[16,8],type:[5126,5131]},t[34836]={textureFormat:6408,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[16],type:[5126]},t[36220]={textureFormat:36249,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[5121]},t[36238]={textureFormat:36249,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[5120]},t[36975]={textureFormat:36249,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[33640]},t[36214]={textureFormat:36249,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[8],type:[5123]},t[36232]={textureFormat:36249,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[8],type:[5122]},t[36226]={textureFormat:36249,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[16],type:[5124]},t[36208]={textureFormat:36249,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[16],type:[5125]},t[33189]={textureFormat:6402,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[2,4],type:[5123,5125]},t[33190]={textureFormat:6402,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[5125]},t[36012]={textureFormat:6402,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[5126]},t[35056]={textureFormat:34041,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[34042]},t[36013]={textureFormat:34041,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[36269]},Object.keys(t).forEach((function(e){const n=t[e];n.bytesPerElementMap={},n.bytesPerElement.forEach((function(t,e){const i=n.type[e];n.bytesPerElementMap[i]=t}))})),cn=t}return cn[t]}function hn(t){const e=un(t);if(!e)throw"unknown internal format";return{format:e.textureFormat,type:e.type[0]}}function pn(t){return 0==(t&t-1)}function dn(t,e,n){return rn(e)?Oe(e):n||5121}function fn(t,e,n,i,s){if(s%1!=0)throw"can't guess dimensions";if(n||i){if(i){if(!n&&(n=s/i)%1)throw"can't guess dimensions"}else if((i=s/n)%1)throw"can't guess dimensions"}else{const t=Math.sqrt(s/(34067===e?6:1));t%1==0?(n=t,i=t):(n=s,i=1)}return{width:n,height:i}}function mn(t,e){void 0!==e.colorspaceConversion&&t.pixelStorei(37443,e.colorspaceConversion),void 0!==e.premultiplyAlpha&&t.pixelStorei(37441,e.premultiplyAlpha),void 0!==e.flipY&&t.pixelStorei(37440,e.flipY)}function vn(t){t.pixelStorei(3317,4),en(t)&&(t.pixelStorei(3314,0),t.pixelStorei(32878,0),t.pixelStorei(3316,0),t.pixelStorei(3315,0),t.pixelStorei(32877,0))}function _n(t,e,n,i){var s;i.minMag&&(n.call(t,e,10241,i.minMag),n.call(t,e,10240,i.minMag)),i.min&&n.call(t,e,10241,i.min),i.mag&&n.call(t,e,10240,i.mag),i.wrap&&(n.call(t,e,10242,i.wrap),n.call(t,e,10243,i.wrap),(32879===e||(s=e,"undefined"!=typeof WebGLSampler&&Ne(s,"WebGLSampler")))&&n.call(t,e,32882,i.wrap)),i.wrapR&&n.call(t,e,32882,i.wrapR),i.wrapS&&n.call(t,e,10242,i.wrapS),i.wrapT&&n.call(t,e,10243,i.wrapT),i.minLod&&n.call(t,e,33082,i.minLod),i.maxLod&&n.call(t,e,33083,i.maxLod),i.baseLevel&&n.call(t,e,33084,i.baseLevel),i.maxLevel&&n.call(t,e,33085,i.maxLevel)}function gn(t,e,n){const i=n.target||3553;t.bindTexture(i,e),_n(t,i,t.texParameteri,n)}function bn(t,e,n,i,s,r){r=r||6408;const o=(n=n||sn.textureOptions).target||3553;if(i=i||n.width,s=s||n.height,t.bindTexture(o,e),function(t,e,n,i){if(!en(t))return pn(e)&&pn(n);const s=un(i);if(!s)throw"unknown internal format";return s.colorRenderable&&s.textureFilterable}(t,i,s,r))t.generateMipmap(o);else{const e=function(t){const e=un(t);if(!e)throw"unknown internal format";return e.textureFilterable}(r)?9729:9728;t.texParameteri(o,10241,e),t.texParameteri(o,10240,e),t.texParameteri(o,10242,33071),t.texParameteri(o,10243,33071)}}function yn(t){return!0===t.auto||void 0===t.auto&&void 0===t.level}function wn(t,e){return(e=e||{}).cubeFaceOrder||[34069,34070,34071,34072,34073,34074]}function xn(t,e){const n=wn(0,e).map((function(t,e){return{face:t,ndx:e}}));return n.sort((function(t,e){return t.face-e.face})),n}function Cn(t,e,n,i){const s=(i=i||sn.textureOptions).target||3553,r=i.level||0;let o=n.width,a=n.height;const l=i.internalFormat||i.format||6408,c=hn(l),u=i.format||c.format,h=i.type||c.type;if(mn(t,i),t.bindTexture(s,e),34067===s){const c=n.width,p=n.height;let d,f;if(c/6===p)d=p,f=[0,0,1,0,2,0,3,0,4,0,5,0];else if(p/6===c)d=c,f=[0,0,0,1,0,2,0,3,0,4,0,5];else if(c/3==p/2)d=c/3,f=[0,0,1,0,2,0,0,1,1,1,2,1];else{if(c/2!=p/3)throw"can't figure out cube map from element: "+(n.src?n.src:n.nodeName);d=c/2,f=[0,0,1,0,0,1,1,1,0,2,1,2]}const m=on();m?(m.canvas.width=d,m.canvas.height=d,o=d,a=d,xn(0,i).forEach((function(e){const i=f[2*e.ndx+0]*d,s=f[2*e.ndx+1]*d;m.drawImage(n,i,s,d,d,0,0,d,d),t.texImage2D(e.face,r,l,u,h,m.canvas)})),m.canvas.width=1,m.canvas.height=1):"undefined"!=typeof createImageBitmap&&(o=d,a=d,xn(0,i).forEach((function(c){const p=f[2*c.ndx+0]*d,m=f[2*c.ndx+1]*d;t.texImage2D(c.face,r,l,d,d,0,u,h,null),createImageBitmap(n,p,m,d,d,{premultiplyAlpha:"none",colorSpaceConversion:"none"}).then((function(n){mn(t,i),t.bindTexture(s,e),t.texImage2D(c.face,r,l,u,h,n),yn(i)&&bn(t,e,i,o,a,l)}))})))}else if(32879===s||35866===s){const e=Math.min(n.width,n.height),i=Math.max(n.width,n.height),o=i/e;if(o%1!=0)throw"can not compute 3D dimensions of element";const a=n.width===i?1:0,c=n.height===i?1:0;t.pixelStorei(3317,1),t.pixelStorei(3314,n.width),t.pixelStorei(32878,0),t.pixelStorei(32877,0),t.texImage3D(s,r,l,e,e,e,0,u,h,null);for(let l=0;l<o;++l){const i=l*e*a,o=l*e*c;t.pixelStorei(3316,i),t.pixelStorei(3315,o),t.texSubImage3D(s,r,0,0,l,e,e,1,u,h,n)}vn(t)}else t.texImage2D(s,r,l,u,h,n);yn(i)&&bn(t,e,i,o,a,l),gn(t,e,i)}function Tn(){}function An(t,e){return void 0!==e||function(t){if("undefined"!=typeof document){const e=document.createElement("a");return e.href=t,e.hostname===location.hostname&&e.port===location.port&&e.protocol===location.protocol}{const e=new URL(location.href).origin;return new URL(t,location.href).origin===e}}(t)?e:"anonymous"}function Sn(t){return"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap||"undefined"!=typeof ImageData&&t instanceof ImageData||"undefined"!=typeof HTMLElement&&t instanceof HTMLElement}function kn(t,e,n){return Sn(t)?(setTimeout((function(){n(null,t)})),t):function(t,e,n){let i;if(n=n||Tn,e=An(t,e=void 0!==e?e:sn.crossOrigin),"undefined"!=typeof Image){i=new Image,void 0!==e&&(i.crossOrigin=e);const s=function(){i.removeEventListener("error",r),i.removeEventListener("load",o),i=null},r=function(){const e="couldn't load image: "+t;Re(e),n(e,i),s()},o=function(){n(null,i),s()};return i.addEventListener("error",r),i.addEventListener("load",o),i.src=t,i}if("undefined"!=typeof ImageBitmap){let s,r;const o=function(){n(s,r)},a={};e&&(a.mode="cors"),fetch(t,a).then((function(t){if(!t.ok)throw t;return t.blob()})).then((function(t){return createImageBitmap(t,{premultiplyAlpha:"none",colorSpaceConversion:"none"})})).then((function(t){r=t,setTimeout(o)})).catch((function(t){s=t,setTimeout(o)})),i=null}return i}(t,e,n)}function En(t,e,n){const i=(n=n||sn.textureOptions).target||3553;if(t.bindTexture(i,e),!1===n.color)return;const s=function(t){return rn(t=t||sn.textureColor)?t:new Uint8Array([255*t[0],255*t[1],255*t[2],255*t[3]])}(n.color);if(34067===i)for(let r=0;r<6;++r)t.texImage2D(34069+r,0,6408,1,1,0,6408,5121,s);else 32879===i||35866===i?t.texImage3D(i,0,6408,1,1,1,0,6408,5121,s):t.texImage2D(i,0,6408,1,1,0,6408,5121,s)}function Pn(t,e,n,i){i=i||Tn;const s=n.src;if(6!==s.length)throw"there must be 6 urls for a cubemap";const r=n.level||0,o=n.internalFormat||n.format||6408,a=hn(o),l=n.format||a.format,c=n.type||5121,u=n.target||3553;if(34067!==u)throw"target must be TEXTURE_CUBE_MAP";En(t,e,n),n=Object.assign({},n);let h=6;const p=[],d=wn(0,n);let f;f=s.map((function(s,a){return kn(s,n.crossOrigin,(m=d[a],function(s,a){--h,s?p.push(s):a.width!==a.height?p.push("cubemap face img is not a square: "+a.src):(mn(t,n),t.bindTexture(u,e),5===h?wn().forEach((function(e){t.texImage2D(e,r,o,l,c,a)})):t.texImage2D(m,r,o,l,c,a),yn(n)&&t.generateMipmap(u)),0===h&&i(p.length?p:void 0,e,f)}));var m}))}function Mn(t,e,n,i){i=i||Tn;const s=n.src,r=n.internalFormat||n.format||6408,o=hn(r),a=n.format||o.format,l=n.type||5121,c=n.target||35866;if(32879!==c&&35866!==c)throw"target must be TEXTURE_3D or TEXTURE_2D_ARRAY";En(t,e,n),n=Object.assign({},n);let u=s.length;const h=[];let p;const d=n.level||0;let f=n.width,m=n.height;const v=s.length;let _=!0;p=s.map((function(s,o){return kn(s,n.crossOrigin,(g=o,function(s,o){if(--u,s)h.push(s);else{if(mn(t,n),t.bindTexture(c,e),_){_=!1,f=n.width||o.width,m=n.height||o.height,t.texImage3D(c,d,r,f,m,v,0,a,l,null);for(let e=0;e<v;++e)t.texSubImage3D(c,d,0,0,e,f,m,1,a,l,o)}else{let e,n=o;o.width===f&&o.height===m||(e=on(),n=e.canvas,e.canvas.width=f,e.canvas.height=m,e.drawImage(o,0,0,f,m)),t.texSubImage3D(c,d,0,0,g,f,m,1,a,l,n),e&&n===e.canvas&&(e.canvas.width=0,e.canvas.height=0)}yn(n)&&t.generateMipmap(c)}0===u&&i(h.length?h:void 0,e,p)}));var g}))}function On(t,e,n,i){const s=(i=i||sn.textureOptions).target||3553;t.bindTexture(s,e);let r=i.width,o=i.height,a=i.depth;const l=i.level||0,c=i.internalFormat||i.format||6408,u=hn(c),h=i.format||u.format,p=i.type||dn(0,n,u.type);if(rn(n))n instanceof Uint8ClampedArray&&(n=new Uint8Array(n.buffer));else{const t=Ie(p);n=new t(n)}const d=function(t,e){const n=un(t);if(!n)throw"unknown internal format";const i=n.bytesPerElementMap[e];if(void 0===i)throw"unknown internal format";return i}(c,p),f=n.byteLength/d;if(f%1)throw"length wrong size for format: "+nn(t,h);let m;if(32879===s||35866===s)if(r||o||a)!r||o&&a?!o||r&&a?(m=fn(0,s,r,o,f/a),r=m.width,o=m.height):(m=fn(0,s,r,a,f/o),r=m.width,a=m.height):(m=fn(0,s,o,a,f/r),o=m.width,a=m.height);else{const t=Math.cbrt(f);if(t%1!=0)throw"can't guess cube size of array of numElements: "+f;r=t,o=t,a=t}else m=fn(0,s,r,o,f),r=m.width,o=m.height;if(vn(t),t.pixelStorei(3317,i.unpackAlignment||1),mn(t,i),34067===s){const e=f/6*(d/n.BYTES_PER_ELEMENT);xn(0,i).forEach((i=>{const s=e*i.ndx,a=n.subarray(s,s+e);t.texImage2D(i.face,l,c,r,o,0,h,p,a)}))}else 32879===s||35866===s?t.texImage3D(s,l,c,r,o,a,0,h,p,n):t.texImage2D(s,l,c,r,o,0,h,p,n);return{width:r,height:o,depth:a,type:p}}function Dn(t,e,n){n=n||Tn,e=e||sn.textureOptions;const i=t.createTexture(),s=e.target||3553;let r=e.width||1,o=e.height||1;const a=e.internalFormat||6408;t.bindTexture(s,i),34067===s&&(t.texParameteri(s,10242,33071),t.texParameteri(s,10243,33071));let l=e.src;if(l)if("function"==typeof l&&(l=l(t,e)),"string"==typeof l)!function(t,e,n,i){i=i||Tn,En(t,e,n=n||sn.textureOptions),kn((n=Object.assign({},n)).src,n.crossOrigin,(function(s,r){s?i(s,e,r):(Cn(t,e,r,n),i(null,e,r))}))}(t,i,e,n);else if(rn(l)||Array.isArray(l)&&("number"==typeof l[0]||Array.isArray(l[0])||rn(l[0]))){const n=On(t,i,l,e);r=n.width,o=n.height}else Array.isArray(l)&&("string"==typeof l[0]||Sn(l[0]))?34067===s?Pn(t,i,e,n):Mn(t,i,e,n):(Cn(t,i,l,e),r=l.width,o=l.height);else!function(t,e,n){const i=n.target||3553;t.bindTexture(i,e);const s=n.level||0,r=n.internalFormat||n.format||6408,o=hn(r),a=n.format||o.format,l=n.type||o.type;if(mn(t,n),34067===i)for(let c=0;c<6;++c)t.texImage2D(34069+c,s,r,n.width,n.height,0,a,l,null);else 32879===i||35866===i?t.texImage3D(i,s,r,n.width,n.height,n.depth,0,a,l,null):t.texImage2D(i,s,r,n.width,n.height,0,a,l,null)}(t,i,e);return yn(e)&&bn(t,i,e,r,o,a),gn(t,i,e),i}function In(t,e,n){n=n||Tn;let i=0;const s=[],r={},o={};function a(){0===i&&setTimeout((function(){n(s.length?s:void 0,r,o)}),0)}return Object.keys(e).forEach((function(n){const l=e[n];let c;var u;("string"==typeof(u=l.src)||Array.isArray(u)&&"string"==typeof u[0])&&(c=function(t,e,r){o[n]=r,--i,t&&s.push(t),a()},++i),r[n]=Dn(t,l,c)})),a(),r}const Vn=Re,Rn=Fe;function Fn(t){return"undefined"!=typeof document&&document.getElementById?document.getElementById(t):null}const Ln={};function Nn(t,e){return Ln[e].bindPoint}function Bn(t,e){return function(n){t.uniform1i(e,n)}}function zn(t,e){return function(n){t.uniform1iv(e,n)}}function jn(t,e){return function(n){t.uniform2iv(e,n)}}function Un(t,e){return function(n){t.uniform3iv(e,n)}}function qn(t,e){return function(n){t.uniform4iv(e,n)}}function Wn(t,e,n,i){const s=Nn(0,e);return en(t)?function(e){let r,o;ze(0,e)?(r=e,o=null):(r=e.texture,o=e.sampler),t.uniform1i(i,n),t.activeTexture(33984+n),t.bindTexture(s,r),t.bindSampler(n,o)}:function(e){t.uniform1i(i,n),t.activeTexture(33984+n),t.bindTexture(s,e)}}function Hn(t,e,n,i,s){const r=Nn(0,e),o=new Int32Array(s);for(let a=0;a<s;++a)o[a]=n+a;return en(t)?function(e){t.uniform1iv(i,o),e.forEach((function(e,i){let s,a;t.activeTexture(33984+o[i]),ze(0,e)?(s=e,a=null):(s=e.texture,a=e.sampler),t.bindSampler(n,a),t.bindTexture(r,s)}))}:function(e){t.uniform1iv(i,o),e.forEach((function(e,n){t.activeTexture(33984+o[n]),t.bindTexture(r,e)}))}}function Gn(t,e){return function(n){if(n.value)switch(t.disableVertexAttribArray(e),n.value.length){case 4:t.vertexAttrib4fv(e,n.value);break;case 3:t.vertexAttrib3fv(e,n.value);break;case 2:t.vertexAttrib2fv(e,n.value);break;case 1:t.vertexAttrib1fv(e,n.value);break;default:throw new Error("the length of a float constant value must be between 1 and 4!")}else t.bindBuffer(34962,n.buffer),t.enableVertexAttribArray(e),t.vertexAttribPointer(e,n.numComponents||n.size,n.type||5126,n.normalize||!1,n.stride||0,n.offset||0),t.vertexAttribDivisor&&t.vertexAttribDivisor(e,n.divisor||0)}}function Kn(t,e){return function(n){if(n.value){if(t.disableVertexAttribArray(e),4!==n.value.length)throw new Error("The length of an integer constant value must be 4!");t.vertexAttrib4iv(e,n.value)}else t.bindBuffer(34962,n.buffer),t.enableVertexAttribArray(e),t.vertexAttribIPointer(e,n.numComponents||n.size,n.type||5124,n.stride||0,n.offset||0),t.vertexAttribDivisor&&t.vertexAttribDivisor(e,n.divisor||0)}}function Yn(t,e){return function(n){if(n.value){if(t.disableVertexAttribArray(e),4!==n.value.length)throw new Error("The length of an unsigned integer constant value must be 4!");t.vertexAttrib4uiv(e,n.value)}else t.bindBuffer(34962,n.buffer),t.enableVertexAttribArray(e),t.vertexAttribIPointer(e,n.numComponents||n.size,n.type||5125,n.stride||0,n.offset||0),t.vertexAttribDivisor&&t.vertexAttribDivisor(e,n.divisor||0)}}function Xn(t,e,n){const i=n.size,s=n.count;return function(n){t.bindBuffer(34962,n.buffer);const r=n.size||n.numComponents||i,o=r/s,a=n.type||5126,l=Ln[a].size*r,c=n.normalize||!1,u=n.offset||0,h=l/s;for(let i=0;i<s;++i)t.enableVertexAttribArray(e+i),t.vertexAttribPointer(e+i,o,a,c,l,u+h*i),t.vertexAttribDivisor&&t.vertexAttribDivisor(e+i,n.divisor||0)}}Ln[5126]={Type:Float32Array,size:4,setter:function(t,e){return function(n){t.uniform1f(e,n)}},arraySetter:function(t,e){return function(n){t.uniform1fv(e,n)}}},Ln[35664]={Type:Float32Array,size:8,setter:function(t,e){return function(n){t.uniform2fv(e,n)}},cols:2},Ln[35665]={Type:Float32Array,size:12,setter:function(t,e){return function(n){t.uniform3fv(e,n)}},cols:3},Ln[35666]={Type:Float32Array,size:16,setter:function(t,e){return function(n){t.uniform4fv(e,n)}},cols:4},Ln[5124]={Type:Int32Array,size:4,setter:Bn,arraySetter:zn},Ln[35667]={Type:Int32Array,size:8,setter:jn,cols:2},Ln[35668]={Type:Int32Array,size:12,setter:Un,cols:3},Ln[35669]={Type:Int32Array,size:16,setter:qn,cols:4},Ln[5125]={Type:Uint32Array,size:4,setter:function(t,e){return function(n){t.uniform1ui(e,n)}},arraySetter:function(t,e){return function(n){t.uniform1uiv(e,n)}}},Ln[36294]={Type:Uint32Array,size:8,setter:function(t,e){return function(n){t.uniform2uiv(e,n)}},cols:2},Ln[36295]={Type:Uint32Array,size:12,setter:function(t,e){return function(n){t.uniform3uiv(e,n)}},cols:3},Ln[36296]={Type:Uint32Array,size:16,setter:function(t,e){return function(n){t.uniform4uiv(e,n)}},cols:4},Ln[35670]={Type:Uint32Array,size:4,setter:Bn,arraySetter:zn},Ln[35671]={Type:Uint32Array,size:8,setter:jn,cols:2},Ln[35672]={Type:Uint32Array,size:12,setter:Un,cols:3},Ln[35673]={Type:Uint32Array,size:16,setter:qn,cols:4},Ln[35674]={Type:Float32Array,size:32,setter:function(t,e){return function(n){t.uniformMatrix2fv(e,!1,n)}},rows:2,cols:2},Ln[35675]={Type:Float32Array,size:48,setter:function(t,e){return function(n){t.uniformMatrix3fv(e,!1,n)}},rows:3,cols:3},Ln[35676]={Type:Float32Array,size:64,setter:function(t,e){return function(n){t.uniformMatrix4fv(e,!1,n)}},rows:4,cols:4},Ln[35685]={Type:Float32Array,size:32,setter:function(t,e){return function(n){t.uniformMatrix2x3fv(e,!1,n)}},rows:2,cols:3},Ln[35686]={Type:Float32Array,size:32,setter:function(t,e){return function(n){t.uniformMatrix2x4fv(e,!1,n)}},rows:2,cols:4},Ln[35687]={Type:Float32Array,size:48,setter:function(t,e){return function(n){t.uniformMatrix3x2fv(e,!1,n)}},rows:3,cols:2},Ln[35688]={Type:Float32Array,size:48,setter:function(t,e){return function(n){t.uniformMatrix3x4fv(e,!1,n)}},rows:3,cols:4},Ln[35689]={Type:Float32Array,size:64,setter:function(t,e){return function(n){t.uniformMatrix4x2fv(e,!1,n)}},rows:4,cols:2},Ln[35690]={Type:Float32Array,size:64,setter:function(t,e){return function(n){t.uniformMatrix4x3fv(e,!1,n)}},rows:4,cols:3},Ln[35678]={Type:null,size:0,setter:Wn,arraySetter:Hn,bindPoint:3553},Ln[35680]={Type:null,size:0,setter:Wn,arraySetter:Hn,bindPoint:34067},Ln[35679]={Type:null,size:0,setter:Wn,arraySetter:Hn,bindPoint:32879},Ln[35682]={Type:null,size:0,setter:Wn,arraySetter:Hn,bindPoint:3553},Ln[36289]={Type:null,size:0,setter:Wn,arraySetter:Hn,bindPoint:35866},Ln[36292]={Type:null,size:0,setter:Wn,arraySetter:Hn,bindPoint:35866},Ln[36293]={Type:null,size:0,setter:Wn,arraySetter:Hn,bindPoint:34067},Ln[36298]={Type:null,size:0,setter:Wn,arraySetter:Hn,bindPoint:3553},Ln[36299]={Type:null,size:0,setter:Wn,arraySetter:Hn,bindPoint:32879},Ln[36300]={Type:null,size:0,setter:Wn,arraySetter:Hn,bindPoint:34067},Ln[36303]={Type:null,size:0,setter:Wn,arraySetter:Hn,bindPoint:35866},Ln[36306]={Type:null,size:0,setter:Wn,arraySetter:Hn,bindPoint:3553},Ln[36307]={Type:null,size:0,setter:Wn,arraySetter:Hn,bindPoint:32879},Ln[36308]={Type:null,size:0,setter:Wn,arraySetter:Hn,bindPoint:34067},Ln[36311]={Type:null,size:0,setter:Wn,arraySetter:Hn,bindPoint:35866};const $n={};$n[5126]={size:4,setter:Gn},$n[35664]={size:8,setter:Gn},$n[35665]={size:12,setter:Gn},$n[35666]={size:16,setter:Gn},$n[5124]={size:4,setter:Kn},$n[35667]={size:8,setter:Kn},$n[35668]={size:12,setter:Kn},$n[35669]={size:16,setter:Kn},$n[5125]={size:4,setter:Yn},$n[36294]={size:8,setter:Yn},$n[36295]={size:12,setter:Yn},$n[36296]={size:16,setter:Yn},$n[35670]={size:4,setter:Kn},$n[35671]={size:8,setter:Kn},$n[35672]={size:12,setter:Kn},$n[35673]={size:16,setter:Kn},$n[35674]={size:4,setter:Xn,count:2},$n[35675]={size:9,setter:Xn,count:3},$n[35676]={size:16,setter:Xn,count:4};const Zn=/ERROR:\s*\d+:(\d+)/gi;const Qn=/^[ \t]*\n/;function Jn(t){let e=0;return Qn.test(t)&&(e=1,t=t.replace(Qn,"")),{lineOffset:e,shaderSource:t}}function ti(t,e,n,i){i=i||Vn;if(!t.getShaderParameter(n,35713)){const s=t.getShaderInfoLog(n),{lineOffset:r,shaderSource:o}=Jn(t.getShaderSource(n)),a=`${function(t,e="",n=0){const i=[...e.matchAll(Zn)],s=new Map(i.map(((t,n)=>{const s=parseInt(t[1]),r=i[n+1],o=r?r.index:e.length;return[s-1,e.substring(t.index,o)]})));return t.split("\n").map(((t,e)=>{const i=s.get(e);return`${e+1+n}: ${t}${i?`\n\n^^^ ${i}`:""}`})).join("\n")}(o,s,r)}\nError compiling ${nn(t,e)}: ${s}`;return i(a),a}return""}function ei(t,e,n){let i,s,r;if("function"==typeof e&&(n=e,e=void 0),"function"==typeof t)n=t,t=void 0;else if(t&&!Array.isArray(t)){const e=t;n=e.errorCallback,t=e.attribLocations,i=e.transformFeedbackVaryings,s=e.transformFeedbackMode,r=e.callback}const o=n||Vn,a=[],l={errorCallback(t,...e){a.push(t),o(t,...e)},transformFeedbackVaryings:i,transformFeedbackMode:s,callback:r,errors:a};{let n={};Array.isArray(t)?t.forEach((function(t,i){n[t]=e?e[i]:i})):n=t||{},l.attribLocations=n}return l}const ni=["VERTEX_SHADER","FRAGMENT_SHADER"];const ii=(t=0)=>new Promise((e=>setTimeout(e,t)));function si(t,e,n,i,s){const r=ei(n,i,s),o=new Set(e),a=function(t,e,n){const i=t.createProgram(),{attribLocations:s,transformFeedbackVaryings:r,transformFeedbackMode:o}=ei(n);for(let l=0;l<e.length;++l){let n=e[l];if("string"==typeof n){const e=Fn(n),s=e?e.text:n;let r=t[ni[l]];e&&e.type&&(r=((a=e.type).indexOf("frag")>=0?35632:a.indexOf("vert")>=0?35633:void 0)||r),n=t.createShader(r),t.shaderSource(n,Jn(s).shaderSource),t.compileShader(n),t.attachShader(i,n)}}var a;Object.entries(s).forEach((([e,n])=>t.bindAttribLocation(i,n,e)));{let e=r;e&&(e.attribs&&(e=e.attribs),Array.isArray(e)||(e=Object.keys(e)),t.transformFeedbackVaryings(i,e,o||35981))}return t.linkProgram(i),i}(t,e,r);function l(t,e){const n=function(t,e,n){n=n||Vn;if(!t.getProgramParameter(e,35714)){const i=t.getProgramInfoLog(e);n(`Error in program linking: ${i}`);return`${i}\n${t.getAttachedShaders(e).map((e=>ti(t,t.getShaderParameter(e,t.SHADER_TYPE),e,n))).filter((t=>t)).join("\n")}`}return}(t,e,r.errorCallback);return n&&function(t,e,n){const i=t.getAttachedShaders(e);for(const s of i)n.has(s)&&t.deleteShader(s);t.deleteProgram(e)}(t,e,o),n}if(!r.callback)return l(t,a)?void 0:a;(async function(t,e){const n=t.getExtension("KHR_parallel_shader_compile"),i=n?(t,e)=>t.getProgramParameter(e,n.COMPLETION_STATUS_KHR):()=>!0;let s=0;do{await ii(s),s=1e3/60}while(!i(t,e))})(t,a).then((()=>{const e=l(t,a);r.callback(e,e?void 0:a)}))}function ri(t){const e=t.name;return e.startsWith("gl_")||e.startsWith("webgl_")}const oi=/(\.|\[|]|\w+)/g;function ai(t,e,n,i){const s=t.split(oi).filter((t=>""!==t));let r=0,o="";for(;;){const t=s[r++];o+=t;const l=(a=t[0])>="0"&&a<="9",c=l?parseInt(t):t;l&&(o+=s[r++]);if(r===s.length){n[c]=e;break}{const t=s[r++],e="["===t,a=n[c]||(e?[]:{});n[c]=a,n=a,i[o]=i[o]||function(t){return function(e){di(t,e)}}(a),o+=t}}var a}const li=/\[\d+\]\.$/;function ci(t,e,n){return function(t,e,n,i){const s=n.blockSpecs,r=n.uniformData,o=s[i];if(!o)return Rn("no uniform block object named:",i),{name:i,uniforms:{}};const a=new ArrayBuffer(o.size),l=t.createBuffer(),c=o.index;t.bindBuffer(35345,l),t.uniformBlockBinding(e,o.index,c);let u=i+".";li.test(u)&&(u=u.replace(li,"."));const h={},p={},d={};return o.uniformIndices.forEach((function(t){const e=r[t];let n=e.name;n.startsWith(u)&&(n=n.substr(u.length));const i=n.endsWith("[0]");i&&(n=n.substr(0,n.length-3));const s=Ln[e.type],o=s.Type,l=i?((s.size+((c=16)-1))/c|0)*c*e.size:s.size*e.size;var c;const f=new o(a,e.offset,l/o.BYTES_PER_ELEMENT);h[n]=f;const m=function(t,e,n,i){if(e||n){i=i||1;const e=t.length/4;return function(n){let s=0,r=0;for(let o=0;o<e;++o){for(let e=0;e<i;++e)t[s++]=n[r++];s+=4-i}}}return function(e){e.length?t.set(e):t[0]=e}}(f,i,s.rows,s.cols);p[n]=m,ai(n,m,d,p)})),{name:i,array:a,asFloat:new Float32Array(a),buffer:l,uniforms:h,setters:p}}(t,e.program,e.uniformBlockSpec,n)}function ui(t,e,n){const i=(e.uniformBlockSpec||e).blockSpecs[n.name];if(i){const e=i.index;return t.bindBufferRange(35345,e,n.buffer,n.offset||0,n.array.byteLength),!0}return!1}function hi(t,e,n){ui(t,e,n)&&t.bufferData(35345,n.array,35048)}function pi(t,e){const n=t.setters;for(const i in e){const t=n[i];if(t){t(e[i])}}}function di(t,e){for(const n in e){const i=t[n];"function"==typeof i?i(e[n]):di(t[n],e[n])}}function fi(t,...e){const n=t.uniformSetters||t,i=e.length;for(let s=0;s<i;++s){const t=e[s];if(Array.isArray(t)){const e=t.length;for(let i=0;i<e;++i)fi(n,t[i])}else for(const e in t){const i=n[e];i&&i(t[e])}}}function mi(t,e){const n=function(t,e){let n=0;function i(e,i,s){const r=i.name.endsWith("[0]"),o=i.type,a=Ln[o];if(!a)throw new Error(`unknown type: 0x${o.toString(16)}`);let l;if(a.bindPoint){const e=n;n+=i.size,l=r?a.arraySetter(t,o,e,s,i.size):a.setter(t,o,e,s,i.size)}else l=a.arraySetter&&r?a.arraySetter(t,s):a.setter(t,s);return l.location=s,l}const s={},r={},o=t.getProgramParameter(e,35718);for(let a=0;a<o;++a){const n=t.getActiveUniform(e,a);if(ri(n))continue;let o=n.name;o.endsWith("[0]")&&(o=o.substr(0,o.length-3));const l=t.getUniformLocation(e,n.name);if(l){const t=i(0,n,l);s[o]=t,ai(o,t,r,s)}}return s}(t,e),i=function(t,e){const n={},i=t.getProgramParameter(e,35721);for(let s=0;s<i;++s){const i=t.getActiveAttrib(e,s);if(ri(i))continue;const r=t.getAttribLocation(e,i.name),o=$n[i.type],a=o.setter(t,r,o);a.location=r,n[i.name]=a}return n}(t,e),s={program:e,uniformSetters:n,attribSetters:i};return en(t)&&(s.uniformBlockSpec=function(t,e){const n=t.getProgramParameter(e,35718),i=[],s=[];for(let a=0;a<n;++a){s.push(a),i.push({});const n=t.getActiveUniform(e,a);i[a].name=n.name}[["UNIFORM_TYPE","type"],["UNIFORM_SIZE","size"],["UNIFORM_BLOCK_INDEX","blockNdx"],["UNIFORM_OFFSET","offset"]].forEach((function(n){const r=n[0],o=n[1];t.getActiveUniforms(e,s,t[r]).forEach((function(t,e){i[e][o]=t}))}));const r={},o=t.getProgramParameter(e,35382);for(let a=0;a<o;++a){const n=t.getActiveUniformBlockName(e,a),i={index:t.getUniformBlockIndex(e,n),usedByVertexShader:t.getActiveUniformBlockParameter(e,a,35396),usedByFragmentShader:t.getActiveUniformBlockParameter(e,a,35398),size:t.getActiveUniformBlockParameter(e,a,35392),uniformIndices:t.getActiveUniformBlockParameter(e,a,35395)};i.used=i.usedByVertexShader||i.usedByFragmentShader,r[n]=i}return{blockSpecs:r,uniformData:i}}(t,e),s.transformFeedbackInfo=function(t,e){const n={},i=t.getProgramParameter(e,35971);for(let s=0;s<i;++s){const i=t.getTransformFeedbackVarying(e,s);n[i.name]={index:s,type:i.type,size:i.size}}return n}(t,e)),s}const vi=/\s|{|}|;/;function _i(t,e,n,i,s){const r=ei(n,i,s),o=[];if(e=e.map((function(t){if(!vi.test(t)){const e=Fn(t);if(e)t=e.text;else{const e=`no element with id: ${t}`;r.errorCallback(e),o.push(e)}}return t})),o.length)return function(t,e){return t.errorCallback(e),t.callback&&setTimeout((()=>{t.callback(`${e}\n${t.errors.join("\n")}`)})),null}(r,"");const a=r.callback;a&&(r.callback=(e,n)=>{a(e,e?void 0:mi(t,n))});const l=function(t,e,n,i,s){return si(t,e,n,i,s)}(t,e,r);return l?mi(t,l):null}function gi(t,e,n,i,s,r){n=void 0===n?4:n;const o=e.indices,a=e.elementType,l=void 0===i?e.numElements:i;s=void 0===s?0:s,a||o?void 0!==r?t.drawElementsInstanced(n,l,void 0===a?5123:e.elementType,s,r):t.drawElements(n,l,void 0===a?5123:e.elementType,s):void 0!==r?t.drawArraysInstanced(n,s,l,r):t.drawArrays(n,s,l)}const bi=[{format:6408,type:5121,min:9729,wrap:33071},{format:34041}],yi={};yi[34041]=33306,yi[6401]=36128,yi[36168]=36128,yi[6402]=36096,yi[33189]=36096,yi[33190]=36096,yi[36012]=36096,yi[35056]=33306,yi[36013]=33306;const wi={};wi[32854]=!0,wi[32855]=!0,wi[36194]=!0,wi[34041]=!0,wi[33189]=!0,wi[6401]=!0,wi[36168]=!0;function xi(t,e,n,i){const s=36160,r=t.createFramebuffer();t.bindFramebuffer(s,r),n=n||t.drawingBufferWidth,i=i||t.drawingBufferHeight;const o=[],a={framebuffer:r,attachments:[],width:n,height:i};return(e=e||bi).forEach((function(e,r){let l=e.attachment;const c=e.samples,u=e.format;let h=e.attachmentPoint||function(t,e){return yi[t]||yi[e]}(u,e.internalFormat);if(h||(h=36064+r),function(t){return t>=36064&&t<36096}(h)&&o.push(h),!l)if(void 0!==c||function(t){return wi[t]}(u))l=t.createRenderbuffer(),t.bindRenderbuffer(36161,l),c>1?t.renderbufferStorageMultisample(36161,c,u,n,i):t.renderbufferStorage(36161,u,n,i);else{const s=Object.assign({},e);s.width=n,s.height=i,void 0===s.auto&&(s.auto=!1,s.min=s.min||s.minMag||9729,s.mag=s.mag||s.minMag||9729,s.wrapS=s.wrapS||s.wrap||33071,s.wrapT=s.wrapT||s.wrap||33071),l=Dn(t,s)}if(Be(0,l))t.framebufferRenderbuffer(s,h,36161,l);else{if(!ze(0,l))throw new Error("unknown attachment type");void 0!==e.layer?t.framebufferTextureLayer(s,h,l,e.level||0,e.layer):t.framebufferTexture2D(s,h,e.target||3553,l,e.level||0)}a.attachments.push(l)})),t.drawBuffers&&t.drawBuffers(o),a}function Ci(t,e,n,i,s){i=i||t.drawingBufferWidth,s=s||t.drawingBufferHeight,e.width=i,e.height=s,(n=n||bi).forEach((function(n,r){const o=e.attachments[r],a=n.format,l=n.samples;if(void 0!==l||Be(0,o))t.bindRenderbuffer(36161,o),l>1?t.renderbufferStorageMultisample(36161,l,a,i,s):t.renderbufferStorage(36161,a,i,s);else{if(!ze(0,o))throw new Error("unknown attachment type");!function(t,e,n,i,s,r){i=i||n.width,s=s||n.height,r=r||n.depth;const o=n.target||3553;t.bindTexture(o,e);const a=n.level||0,l=n.internalFormat||n.format||6408,c=hn(l),u=n.format||c.format;let h;const p=n.src;if(h=p&&(rn(p)||Array.isArray(p)&&"number"==typeof p[0])?n.type||dn(0,p,c.type):n.type||c.type,34067===o)for(let d=0;d<6;++d)t.texImage2D(34069+d,a,l,i,s,0,u,h,null);else 32879===o||35866===o?t.texImage3D(o,a,l,i,s,r,0,u,h,null):t.texImage2D(o,a,l,i,s,0,u,h,null)}(t,o,n,i,s)}}))}function Ti(t,e,n){n=n||36160,e?(t.bindFramebuffer(n,e.framebuffer),t.viewport(0,0,e.width,e.height)):(t.bindFramebuffer(n,null),t.viewport(0,0,t.drawingBufferWidth,t.drawingBufferHeight))}function Ai(t,e,n,i){const s=t.createVertexArray();return t.bindVertexArray(s),function(t,e){for(const n in e){const i=t[n];i&&i(e[n])}}(e,n),i&&t.bindBuffer(34963,i),t.bindVertexArray(null),s}const Si=/^(.*?)_/;function ki(t,e){nn(t,0);const n=t.getExtension(e);if(n){const i={},s=Si.exec(e)[1],r="_"+s;for(const e in n){const o=n[e],a="function"==typeof o,l=a?s:r;let c=e;e.endsWith(l)&&(c=e.substring(0,e.length-l.length)),void 0!==t[c]?a||t[c]===o||Fe(c,t[c],o,e):a?t[c]=function(t){return function(){return t.apply(n,arguments)}}(o):(t[c]=o,i[c]=o)}i.constructor={name:n.constructor.name},nn(i,0)}return n}const Ei=["ANGLE_instanced_arrays","EXT_blend_minmax","EXT_color_buffer_float","EXT_color_buffer_half_float","EXT_disjoint_timer_query","EXT_disjoint_timer_query_webgl2","EXT_frag_depth","EXT_sRGB","EXT_shader_texture_lod","EXT_texture_filter_anisotropic","OES_element_index_uint","OES_standard_derivatives","OES_texture_float","OES_texture_float_linear","OES_texture_half_float","OES_texture_half_float_linear","OES_vertex_array_object","WEBGL_color_buffer_float","WEBGL_compressed_texture_atc","WEBGL_compressed_texture_etc1","WEBGL_compressed_texture_pvrtc","WEBGL_compressed_texture_s3tc","WEBGL_compressed_texture_s3tc_srgb","WEBGL_depth_texture","WEBGL_draw_buffers"];function Pi(t,e){if(!t)throw new Error(e||"loader assertion failed.")}const Mi=Boolean("object"!=typeof process||"[object process]"!==String(process)||process.browser),Oi="undefined"!=typeof process&&process.version&&/v([0-9]*)/.exec(process.version);Oi&&parseFloat(Oi[1]);function Di(t,e){if(!t)throw new Error(e||"loaders.gl assertion failed.")}const Ii="object"!=typeof process||"[object process]"!==String(process)||process.browser,Vi="undefined"!=typeof window&&void 0!==window.orientation,Ri="undefined"!=typeof process&&process.version&&/v([0-9]*)/.exec(process.version);function Fi(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}Ri&&parseFloat(Ri[1]);class Li{constructor(t,e){Fi(this,"name",void 0),Fi(this,"workerThread",void 0),Fi(this,"isRunning",!0),Fi(this,"result",void 0),Fi(this,"_resolve",(()=>{})),Fi(this,"_reject",(()=>{})),this.name=t,this.workerThread=e,this.result=new Promise(((t,e)=>{this._resolve=t,this._reject=e}))}postMessage(t,e){this.workerThread.postMessage({source:"loaders.gl",type:t,payload:e})}done(t){Di(this.isRunning),this.isRunning=!1,this._resolve(t)}error(t){Di(this.isRunning),this.isRunning=!1,this._reject(t)}}class Ni{}const Bi=new Map;function zi(t){Di(t.source&&!t.url||!t.source&&t.url);let e=Bi.get(t.source||t.url);return e||(t.url&&(e=function(t){if(!t.startsWith("http"))return t;return ji((e=t,"try {\n  importScripts('".concat(e,"');\n} catch (error) {\n  console.error(error);\n  throw error;\n}")));var e}(t.url),Bi.set(t.url,e)),t.source&&(e=ji(t.source),Bi.set(t.source,e))),Di(e),e}function ji(t){const e=new Blob([t],{type:"application/javascript"});return URL.createObjectURL(e)}function Ui(t,e=!0,n){const i=n||new Set;if(t){if(qi(t))i.add(t);else if(qi(t.buffer))i.add(t.buffer);else if(ArrayBuffer.isView(t));else if(e&&"object"==typeof t)for(const s in t)Ui(t[s],e,i)}else;return void 0===n?Array.from(i):[]}function qi(t){return!!t&&(t instanceof ArrayBuffer||("undefined"!=typeof MessagePort&&t instanceof MessagePort||("undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap||"undefined"!=typeof OffscreenCanvas&&t instanceof OffscreenCanvas)))}const Wi=()=>{};class Hi{static isSupported(){return"undefined"!=typeof Worker&&Ii||void 0!==Ni&&!Ii}constructor(t){Fi(this,"name",void 0),Fi(this,"source",void 0),Fi(this,"url",void 0),Fi(this,"terminated",!1),Fi(this,"worker",void 0),Fi(this,"onMessage",void 0),Fi(this,"onError",void 0),Fi(this,"_loadableURL","");const{name:e,source:n,url:i}=t;Di(n||i),this.name=e,this.source=n,this.url=i,this.onMessage=Wi,this.onError=t=>console.log(t),this.worker=Ii?this._createBrowserWorker():this._createNodeWorker()}destroy(){this.onMessage=Wi,this.onError=Wi,this.worker.terminate(),this.terminated=!0}get isRunning(){return Boolean(this.onMessage)}postMessage(t,e){e=e||Ui(t),this.worker.postMessage(t,e)}_getErrorFromErrorEvent(t){let e="Failed to load ";return e+="worker ".concat(this.name," from ").concat(this.url,". "),t.message&&(e+="".concat(t.message," in ")),t.lineno&&(e+=":".concat(t.lineno,":").concat(t.colno)),new Error(e)}_createBrowserWorker(){this._loadableURL=zi({source:this.source,url:this.url});const t=new Worker(this._loadableURL,{name:this.name});return t.onmessage=t=>{t.data?this.onMessage(t.data):this.onError(new Error("No data received"))},t.onerror=t=>{this.onError(this._getErrorFromErrorEvent(t)),this.terminated=!0},t.onmessageerror=t=>console.error(t),t}_createNodeWorker(){let t;if(this.url){const e=this.url.includes(":/")||this.url.startsWith("/")?this.url:"./".concat(this.url);t=new Ni(e,{eval:!1})}else{if(!this.source)throw new Error("no worker");t=new Ni(this.source,{eval:!0})}return t.on("message",(t=>{this.onMessage(t)})),t.on("error",(t=>{this.onError(t)})),t.on("exit",(t=>{})),t}}class Gi{static isSupported(){return Hi.isSupported()}constructor(t){Fi(this,"name","unnamed"),Fi(this,"source",void 0),Fi(this,"url",void 0),Fi(this,"maxConcurrency",1),Fi(this,"maxMobileConcurrency",1),Fi(this,"onDebug",(()=>{})),Fi(this,"reuseWorkers",!0),Fi(this,"props",{}),Fi(this,"jobQueue",[]),Fi(this,"idleQueue",[]),Fi(this,"count",0),Fi(this,"isDestroyed",!1),this.source=t.source,this.url=t.url,this.setProps(t)}destroy(){this.idleQueue.forEach((t=>t.destroy())),this.isDestroyed=!0}setProps(t){this.props={...this.props,...t},void 0!==t.name&&(this.name=t.name),void 0!==t.maxConcurrency&&(this.maxConcurrency=t.maxConcurrency),void 0!==t.maxMobileConcurrency&&(this.maxMobileConcurrency=t.maxMobileConcurrency),void 0!==t.reuseWorkers&&(this.reuseWorkers=t.reuseWorkers),void 0!==t.onDebug&&(this.onDebug=t.onDebug)}async startJob(t,e=((t,e,n)=>t.done(n)),n=((t,e)=>t.error(e))){const i=new Promise((i=>(this.jobQueue.push({name:t,onMessage:e,onError:n,onStart:i}),this)));return this._startQueuedJob(),await i}async _startQueuedJob(){if(!this.jobQueue.length)return;const t=this._getAvailableWorker();if(!t)return;const e=this.jobQueue.shift();if(e){this.onDebug({message:"Starting job",name:e.name,workerThread:t,backlog:this.jobQueue.length});const n=new Li(e.name,t);t.onMessage=t=>e.onMessage(n,t.type,t.payload),t.onError=t=>e.onError(n,t),e.onStart(n);try{await n.result}finally{this.returnWorkerToQueue(t)}}}returnWorkerToQueue(t){this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(t.destroy(),this.count--):this.idleQueue.push(t),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const t="".concat(this.name.toLowerCase()," (#").concat(this.count," of ").concat(this.maxConcurrency,")");return new Hi({name:t,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return Vi?this.maxMobileConcurrency:this.maxConcurrency}}const Ki={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}};class Yi{static isSupported(){return Hi.isSupported()}static getWorkerFarm(t={}){return Yi._workerFarm=Yi._workerFarm||new Yi({}),Yi._workerFarm.setProps(t),Yi._workerFarm}constructor(t){Fi(this,"props",void 0),Fi(this,"workerPools",new Map),this.props={...Ki},this.setProps(t),this.workerPools=new Map}destroy(){for(const t of this.workerPools.values())t.destroy();this.workerPools=new Map}setProps(t){this.props={...this.props,...t};for(const e of this.workerPools.values())e.setProps(this._getWorkerPoolProps())}getWorkerPool(t){const{name:e,source:n,url:i}=t;let s=this.workerPools.get(e);return s||(s=new Gi({name:e,source:n,url:i}),s.setProps(this._getWorkerPoolProps()),this.workerPools.set(e,s)),s}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}Fi(Yi,"_workerFarm",void 0);async function Xi(t,e,n,i,s){const r=t.id,o=function(t,e={}){const n=e[t.id]||{},i="".concat(t.id,"-worker.js");let s=n.workerUrl;if(s||"compression"!==t.id||(s=e.workerUrl),"test"===e._workerType&&(s="modules/".concat(t.module,"/dist/").concat(i)),!s){let e=t.version;"latest"===e&&(e="latest");const n=e?"@".concat(e):"";s="https://unpkg.com/@loaders.gl/".concat(t.module).concat(n,"/dist/").concat(i)}return Di(s),s}(t,n),a=Yi.getWorkerFarm(n).getWorkerPool({name:r,url:o});n=JSON.parse(JSON.stringify(n)),i=JSON.parse(JSON.stringify(i||{}));const l=await a.startJob("process-on-worker",$i.bind(null,s));l.postMessage("process",{input:e,options:n,context:i});const c=await l.result;return await c.result}async function $i(t,e,n,i){switch(n){case"done":e.done(i);break;case"error":e.error(new Error(i.error));break;case"process":const{id:r,input:o,options:a}=i;try{const n=await t(o,a);e.postMessage("done",{id:r,result:n})}catch(s){const t=s instanceof Error?s.message:"unknown error";e.postMessage("error",{id:r,error:t})}break;default:console.warn("parse-with-worker unknown message ".concat(n))}}function Zi(t){return t&&"object"==typeof t&&t.isBuffer}function Qi(t){if(Zi(t))return function(t){if(Zi(t))return new Uint8Array(t.buffer,t.byteOffset,t.length).slice().buffer;return t}(t);if(t instanceof ArrayBuffer)return t;if(ArrayBuffer.isView(t))return 0===t.byteOffset&&t.byteLength===t.buffer.byteLength?t.buffer:t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength);if("string"==typeof t){const e=t;return(new TextEncoder).encode(e).buffer}if(t&&"object"==typeof t&&t._toArrayBuffer)return t._toArrayBuffer();throw new Error("toArrayBuffer")}function Ji(t,e){return Pi(t>=0),Pi(e>0),t+(e-1)&~(e-1)}async function ts(t){const e=[];for await(const n of t)e.push(n);return function(...t){const e=t.map((t=>t instanceof ArrayBuffer?new Uint8Array(t):t)),n=e.reduce(((t,e)=>t+e.byteLength),0),i=new Uint8Array(n);let s=0;for(const r of e)i.set(r,s),s+=r.byteLength;return i.buffer}(...e)}const es={};const ns=t=>"function"==typeof t,is=t=>null!==t&&"object"==typeof t,ss=t=>is(t)&&t.constructor==={}.constructor,rs=t=>"undefined"!=typeof Response&&t instanceof Response||t&&t.arrayBuffer&&t.text&&t.json,os=t=>"undefined"!=typeof Blob&&t instanceof Blob,as=t=>(t=>"undefined"!=typeof ReadableStream&&t instanceof ReadableStream||is(t)&&ns(t.tee)&&ns(t.cancel)&&ns(t.getReader))(t)||(t=>is(t)&&ns(t.read)&&ns(t.pipe)&&(t=>"boolean"==typeof t)(t.readable))(t),ls=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,cs=/^([-\w.]+\/[-\w.+]+)/;function us(t){const e=cs.exec(t);return e?e[1]:t}function hs(t){const e=ls.exec(t);return e?e[1]:""}const ps=/\?.*/;function ds(t){if(rs(t)){const e=fs(t.url||"");return{url:e,type:us(t.headers.get("content-type")||"")||hs(e)}}return os(t)?{url:fs(t.name||""),type:t.type||""}:"string"==typeof t?{url:fs(t),type:hs(t)}:{url:"",type:""}}function fs(t){return t.replace(ps,"")}async function ms(t){if(rs(t))return t;const e={},n=function(t){return rs(t)?t.headers["content-length"]||-1:os(t)?t.size:"string"==typeof t?t.length:t instanceof ArrayBuffer||ArrayBuffer.isView(t)?t.byteLength:-1}(t);n>=0&&(e["content-length"]=String(n));const{url:i,type:s}=ds(t);s&&(e["content-type"]=s);const r=await async function(t){const e=5;if("string"==typeof t)return"data:,".concat(t.slice(0,e));if(t instanceof Blob){const e=t.slice(0,5);return await new Promise((t=>{const n=new FileReader;n.onload=e=>{var n;return t(null==e||null===(n=e.target)||void 0===n?void 0:n.result)},n.readAsDataURL(e)}))}if(t instanceof ArrayBuffer){const n=function(t){let e="";const n=new Uint8Array(t);for(let i=0;i<n.byteLength;i++)e+=String.fromCharCode(n[i]);return btoa(e)}(t.slice(0,e));return"data:base64,".concat(n)}return null}(t);r&&(e["x-first-bytes"]=r),"string"==typeof t&&(t=(new TextEncoder).encode(t));const o=new Response(t,{headers:e});return Object.defineProperty(o,"url",{value:i}),o}async function vs(t,e){if("string"==typeof t){t=function(t){for(const e in es)if(t.startsWith(e)){const n=es[e];t=t.replace(e,n)}return t.startsWith("http://")||t.startsWith("https://")||(t="".concat("").concat(t)),t}(t);let n=e;return null!=e&&e.fetch&&"function"!=typeof(null==e?void 0:e.fetch)&&(n=e.fetch),await fetch(t,n)}return await ms(t)}function _s(){return!("object"==typeof process&&"[object process]"===String(process)&&!process.browser)||function(t){if("undefined"!=typeof window&&"object"==typeof window.process&&"renderer"===window.process.type)return!0;if("undefined"!=typeof process&&"object"==typeof process.versions&&Boolean(process.versions.electron))return!0;const e="object"==typeof navigator&&"string"==typeof navigator.userAgent&&navigator.userAgent,n=t||e;return!!(n&&n.indexOf("Electron")>=0)}()}const gs={self:"undefined"!=typeof self&&self,window:"undefined"!=typeof window&&window,global:"undefined"!=typeof global&&global,document:"undefined"!=typeof document&&document,process:"object"==typeof process&&process},bs=gs.window||gs.self||gs.global,ys=gs.process||{},ws="undefined"!=typeof __VERSION__?__VERSION__:"untranspiled source";_s();class xs{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"sessionStorage";Fi(this,"storage",void 0),Fi(this,"id",void 0),Fi(this,"config",{}),this.storage=function(t){try{const e=window[t],n="__storage_test__";return e.setItem(n,n),e.removeItem(n),e}catch(e){return null}}(n),this.id=t,this.config={},Object.assign(this.config,e),this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(t){return this.config={},this.updateConfiguration(t)}updateConfiguration(t){if(Object.assign(this.config,t),this.storage){const t=JSON.stringify(this.config);this.storage.setItem(this.id,t)}return this}_loadConfiguration(){let t={};if(this.storage){const e=this.storage.getItem(this.id);t=e?JSON.parse(e):{}}return Object.assign(this.config,t),this}}function Cs(t,e,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:600;const s=t.src.replace(/\(/g,"%28").replace(/\)/g,"%29");t.width>i&&(n=Math.min(n,i/t.width));const r=t.width*n,o=t.height*n,a=["font-size:1px;","padding:".concat(Math.floor(o/2),"px ").concat(Math.floor(r/2),"px;"),"line-height:".concat(o,"px;"),"background:url(".concat(s,");"),"background-size:".concat(r,"px ").concat(o,"px;"),"color:transparent;"].join("");return["".concat(e," %c+"),a]}let Ts;var As;function Ss(t){return"string"==typeof t?Ts[t.toUpperCase()]||Ts.WHITE:t}function ks(t,e){if(!t)throw new Error(e||"Assertion failed")}function Es(){let t;var e,n;if(_s&&"performance"in bs)t=null==bs||null===(e=bs.performance)||void 0===e||null===(n=e.now)||void 0===n?void 0:n.call(e);else if("hrtime"in ys){var i;const e=null==ys||null===(i=ys.hrtime)||void 0===i?void 0:i.call(ys);t=1e3*e[0]+e[1]/1e6}else t=Date.now();return t}(As=Ts||(Ts={}))[As.BLACK=30]="BLACK",As[As.RED=31]="RED",As[As.GREEN=32]="GREEN",As[As.YELLOW=33]="YELLOW",As[As.BLUE=34]="BLUE",As[As.MAGENTA=35]="MAGENTA",As[As.CYAN=36]="CYAN",As[As.WHITE=37]="WHITE",As[As.BRIGHT_BLACK=90]="BRIGHT_BLACK",As[As.BRIGHT_RED=91]="BRIGHT_RED",As[As.BRIGHT_GREEN=92]="BRIGHT_GREEN",As[As.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",As[As.BRIGHT_BLUE=94]="BRIGHT_BLUE",As[As.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",As[As.BRIGHT_CYAN=96]="BRIGHT_CYAN",As[As.BRIGHT_WHITE=97]="BRIGHT_WHITE";const Ps={debug:_s&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},Ms={enabled:!0,level:0};function Os(){}const Ds={},Is={once:!0};class Vs{constructor(){let{id:t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{id:""};Fi(this,"id",void 0),Fi(this,"VERSION",ws),Fi(this,"_startTs",Es()),Fi(this,"_deltaTs",Es()),Fi(this,"_storage",void 0),Fi(this,"userData",{}),Fi(this,"LOG_THROTTLE_TIMEOUT",0),this.id=t,this._storage=new xs("__probe-".concat(this.id,"__"),Ms),this.userData={},this.timeStamp("".concat(this.id," started")),function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:["constructor"];const n=Object.getPrototypeOf(t),i=Object.getOwnPropertyNames(n);for(const s of i)"function"==typeof t[s]&&(e.find((t=>s===t))||(t[s]=t[s].bind(t)))}(this),Object.seal(this)}set level(t){this.setLevel(t)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((Es()-this._startTs).toPrecision(10))}getDelta(){return Number((Es()-this._deltaTs).toPrecision(10))}set priority(t){this.level=t}get priority(){return this.level}getPriority(){return this.level}enable(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._storage.updateConfiguration({enabled:t}),this}setLevel(t){return this._storage.updateConfiguration({level:t}),this}get(t){return this._storage.config[t]}set(t,e){this._storage.updateConfiguration({[t]:e})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(t,e){ks(t,e)}warn(t){return this._getLogFunction(0,t,Ps.warn,arguments,Is)}error(t){return this._getLogFunction(0,t,Ps.error,arguments)}deprecated(t,e){return this.warn("`".concat(t,"` is deprecated and will be removed in a later version. Use `").concat(e,"` instead"))}removed(t,e){return this.error("`".concat(t,"` has been removed. Use `").concat(e,"` instead"))}probe(t,e){return this._getLogFunction(t,e,Ps.log,arguments,{time:!0,once:!0})}log(t,e){return this._getLogFunction(t,e,Ps.debug,arguments)}info(t,e){return this._getLogFunction(t,e,console.info,arguments)}once(t,e){for(var n=arguments.length,i=new Array(n>2?n-2:0),s=2;s<n;s++)i[s-2]=arguments[s];return this._getLogFunction(t,e,Ps.debug||Ps.info,arguments,Is)}table(t,e,n){return e?this._getLogFunction(t,e,console.table||Os,n&&[n],{tag:Ls(e)}):Os}image(t){let{logLevel:e,priority:n,image:i,message:s="",scale:r=1}=t;return this._shouldLog(e||n)?_s?function(t){let{image:e,message:n="",scale:i=1}=t;if("string"==typeof e){const t=new Image;return t.onload=()=>{const e=Cs(t,n,i);console.log(...e)},t.src=e,Os}const s=e.nodeName||"";if("img"===s.toLowerCase())return console.log(...Cs(e,n,i)),Os;if("canvas"===s.toLowerCase()){const t=new Image;return t.onload=()=>console.log(...Cs(t,n,i)),t.src=e.toDataURL(),Os}return Os}({image:i,message:s,scale:r}):function(t){let{image:e,message:n="",scale:i=1}=t;return(void 0)({image:e,message:n,scale:i}),Os}({image:i,message:s,scale:r}):Os}time(t,e){return this._getLogFunction(t,e,console.time?console.time:console.info)}timeEnd(t,e){return this._getLogFunction(t,e,console.timeEnd?console.timeEnd:console.info)}timeStamp(t,e){return this._getLogFunction(t,e,console.timeStamp||Os)}group(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{collapsed:!1};const i=Fs({logLevel:t,message:e,opts:n}),{collapsed:s}=n;return i.method=(s?console.groupCollapsed:console.group)||console.info,this._getLogFunction(i)}groupCollapsed(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.group(t,e,Object.assign({},n,{collapsed:!0}))}groupEnd(t){return this._getLogFunction(t,"",console.groupEnd||Os)}withGroup(t,e,n){this.group(t,e)();try{n()}finally{this.groupEnd(t)()}}trace(){console.trace&&console.trace()}_shouldLog(t){return this.isEnabled()&&this.getLevel()>=Rs(t)}_getLogFunction(t,e,n,i,s){if(this._shouldLog(t)){s=Fs({logLevel:t,message:e,args:i,opts:s}),ks(n=n||s.method),s.total=this.getTotal(),s.delta=this.getDelta(),this._deltaTs=Es();const r=s.tag||s.message;if(s.once){if(Ds[r])return Os;Ds[r]=Es()}return e=function(t,e,n){if("string"==typeof e){const o=n.time?function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:8;const n=Math.max(e-t.length,0);return"".concat(" ".repeat(n)).concat(t)}(function(t){let e;return e=t<10?"".concat(t.toFixed(2),"ms"):t<100?"".concat(t.toFixed(1),"ms"):t<1e3?"".concat(t.toFixed(0),"ms"):"".concat((t/1e3).toFixed(2),"s"),e}(n.total)):"";e=n.time?"".concat(t,": ").concat(o,"  ").concat(e):"".concat(t,": ").concat(e),i=e,s=n.color,r=n.background,_s||"string"!=typeof i||(s&&(s=Ss(s),i="[".concat(s,"m").concat(i,"[39m")),r&&(s=Ss(r),i="[".concat(r+10,"m").concat(i,"[49m"))),e=i}var i,s,r;return e}(this.id,s.message,s),n.bind(console,e,...s.args)}return Os}}function Rs(t){if(!t)return 0;let e;switch(typeof t){case"number":e=t;break;case"object":e=t.logLevel||t.priority||0;break;default:return 0}return ks(Number.isFinite(e)&&e>=0),e}function Fs(t){const{logLevel:e,message:n}=t;t.logLevel=Rs(e);const i=t.args?Array.from(t.args):[];for(;i.length&&i.shift()!==n;);switch(typeof e){case"string":case"function":void 0!==n&&i.unshift(n),t.message=e;break;case"object":Object.assign(t,e)}"function"==typeof t.message&&(t.message=t.message());const s=typeof t.message;return ks("string"===s||"object"===s),Object.assign(t,{args:i},t.opts)}function Ls(t){for(const e in t)for(const n in t[e])return n||"untitled";return"empty"}Fi(Vs,"VERSION",ws);const Ns=new Vs({id:"loaders.gl"});class Bs{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}const zs={fetch:null,mimeType:void 0,nothrow:!1,log:new class{constructor(){Fi(this,"console",void 0),this.console=console}log(...t){return this.console.log.bind(this.console,...t)}info(...t){return this.console.info.bind(this.console,...t)}warn(...t){return this.console.warn.bind(this.console,...t)}error(...t){return this.console.error.bind(this.console,...t)}},CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:Mi,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},js={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function Us(){globalThis.loaders=globalThis.loaders||{};const{loaders:t}=globalThis;return t._state=t._state||{},t._state}const qs=()=>{const t=Us();return t.globalOptions=t.globalOptions||{...zs},t.globalOptions};function Ws(t,e,n,i){return n=n||[],function(t,e){Gs(t,null,zs,js,e);for(const n of e){const i=t&&t[n.id]||{},s=n.options&&n.options[n.id]||{},r=n.deprecatedOptions&&n.deprecatedOptions[n.id]||{};Gs(i,n.id,s,r,e)}}(t,n=Array.isArray(n)?n:[n]),function(t,e,n){const i={...t.options||{}};(function(t,e){e&&!("baseUri"in t)&&(t.baseUri=e)})(i,n),null===i.log&&(i.log=new Bs);return Ys(i,qs()),Ys(i,e),i}(e,t,i)}function Hs(t,e){const n=qs(),i=t||n;return"function"==typeof i.fetch?i.fetch:is(i.fetch)?t=>vs(t,i):null!=e&&e.fetch?null==e?void 0:e.fetch:vs}function Gs(t,e,n,i,s){const r=e||"Top level",o=e?"".concat(e,"."):"";for(const a in t){const l=!e&&is(t[a]),c="baseUri"===a&&!e,u="workerUrl"===a&&e;if(!(a in n)&&!c&&!u)if(a in i)Ns.warn("".concat(r," loader option '").concat(o).concat(a,"' no longer supported, use '").concat(i[a],"'"))();else if(!l){const t=Ks(a,s);Ns.warn("".concat(r," loader option '").concat(o).concat(a,"' not recognized. ").concat(t))()}}}function Ks(t,e){const n=t.toLowerCase();let i="";for(const s of e)for(const e in s.options){if(t===e)return"Did you mean '".concat(s.id,".").concat(e,"'?");const r=e.toLowerCase();(n.startsWith(r)||r.startsWith(n))&&(i=i||"Did you mean '".concat(s.id,".").concat(e,"'?"))}return i}function Ys(t,e){for(const n in e)if(n in e){const i=e[n];ss(i)&&ss(t[n])?t[n]={...t[n],...e[n]}:t[n]=e[n]}}function Xs(t){var e;if(!t)return!1;Array.isArray(t)&&(t=t[0]);return Array.isArray(null===(e=t)||void 0===e?void 0:e.extensions)}function $s(t){var e,n;let i;return Pi(t,"null loader"),Pi(Xs(t),"invalid loader"),Array.isArray(t)&&(i=t[1],t=t[0],t={...t,options:{...t.options,...i}}),(null!==(e=t)&&void 0!==e&&e.parseTextSync||null!==(n=t)&&void 0!==n&&n.parseText)&&(t.text=!0),t.text||(t.binary=!0),t}function Zs(){return(()=>{const t=Us();return t.loaderRegistry=t.loaderRegistry||[],t.loaderRegistry})()}const Qs=new Vs({id:"loaders.gl"}),Js=/\.([^.]+)$/;function tr(t,e=[],n,i){if(!er(t))return null;if(e&&!Array.isArray(e))return $s(e);let s=[];e&&(s=s.concat(e)),null!=n&&n.ignoreRegisteredLoaders||s.push(...Zs()),function(t){for(const e of t)$s(e)}(s);const r=function(t,e,n,i){const{url:s,type:r}=ds(t),o=s||(null==i?void 0:i.url);let a=null,l="";null!=n&&n.mimeType&&(a=ir(e,null==n?void 0:n.mimeType),l="match forced by supplied MIME type ".concat(null==n?void 0:n.mimeType));var c;a=a||function(t,e){const n=e&&Js.exec(e),i=n&&n[1];return i?function(t,e){e=e.toLowerCase();for(const n of t)for(const t of n.extensions)if(t.toLowerCase()===e)return n;return null}(t,i):null}(e,o),l=l||(a?"matched url ".concat(o):""),a=a||ir(e,r),l=l||(a?"matched MIME type ".concat(r):""),a=a||function(t,e){if(!e)return null;for(const n of t)if("string"==typeof e){if(sr(e,n))return n}else if(ArrayBuffer.isView(e)){if(rr(e.buffer,e.byteOffset,n))return n}else if(e instanceof ArrayBuffer){if(rr(e,0,n))return n}return null}(e,t),l=l||(a?"matched initial data ".concat(or(t)):""),a=a||ir(e,null==n?void 0:n.fallbackMimeType),l=l||(a?"matched fallback MIME type ".concat(r):""),l&&Qs.log(1,"selectLoader selected ".concat(null===(c=a)||void 0===c?void 0:c.name,": ").concat(l,"."));return a}(t,s,n,i);if(!(r||null!=n&&n.nothrow))throw new Error(nr(t));return r}function er(t){return!(t instanceof Response&&204===t.status)}function nr(t){const{url:e,type:n}=ds(t);let i="No valid loader found (";i+=e?"".concat(function(t){const e=t&&t.lastIndexOf("/");return e>=0?t.substr(e+1):""}(e),", "):"no url provided, ",i+="MIME type: ".concat(n?'"'.concat(n,'"'):"not provided",", ");const s=t?or(t):"";return i+=s?' first bytes: "'.concat(s,'"'):"first bytes: not available",i+=")",i}function ir(t,e){for(const n of t){if(n.mimeTypes&&n.mimeTypes.includes(e))return n;if(e==="application/x.".concat(n.id))return n}return null}function sr(t,e){if(e.testText)return e.testText(t);return(Array.isArray(e.tests)?e.tests:[e.tests]).some((e=>t.startsWith(e)))}function rr(t,e,n){return(Array.isArray(n.tests)?n.tests:[n.tests]).some((i=>function(t,e,n,i){if(i instanceof ArrayBuffer)return function(t,e,n){if(n=n||t.byteLength,t.byteLength<n||e.byteLength<n)return!1;const i=new Uint8Array(t),s=new Uint8Array(e);for(let r=0;r<i.length;++r)if(i[r]!==s[r])return!1;return!0}(i,t,i.byteLength);switch(typeof i){case"function":return i(t,n);case"string":return i===ar(t,e,i.length);default:return!1}}(t,e,n,i)))}function or(t,e=5){if("string"==typeof t)return t.slice(0,e);if(ArrayBuffer.isView(t))return ar(t.buffer,t.byteOffset,e);if(t instanceof ArrayBuffer){return ar(t,0,e)}return""}function ar(t,e,n){if(t.byteLength<e+n)return"";const i=new DataView(t);let s="";for(let r=0;r<n;r++)s+=String.fromCharCode(i.getUint8(e+r));return s}const lr=262144;function cr(t,e){return Mi?async function*(t,e){const n=t.getReader();let i;try{for(;;){const t=i||n.read();null!=e&&e._streamReadAhead&&(i=n.read());const{done:s,value:r}=await t;if(s)return;yield Qi(r)}}catch(s){n.releaseLock()}}(t,e):async function*(t,e){for await(const n of t)yield Qi(n)}(t)}function ur(t,e){if("string"==typeof t)return function*(t,e){const n=(null==e?void 0:e.chunkSize)||262144;let i=0;const s=new TextEncoder;for(;i<t.length;){const e=Math.min(t.length-i,n),r=t.slice(i,i+e);i+=e,yield s.encode(r)}}(t,e);if(t instanceof ArrayBuffer)return function*(t,e={}){const{chunkSize:n=lr}=e;let i=0;for(;i<t.byteLength;){const e=Math.min(t.byteLength-i,n),s=new ArrayBuffer(e),r=new Uint8Array(t,i,e);new Uint8Array(s).set(r),i+=e,yield s}}(t,e);if(os(t))return async function*(t,e){const n=(null==e?void 0:e.chunkSize)||1048576;let i=0;for(;i<t.size;){const e=i+n,s=await t.slice(i,e).arrayBuffer();i=e,yield s}}(t,e);if(as(t))return cr(t,e);if(rs(t)){return cr(t.body,e)}throw new Error("makeIterator")}const hr="Cannot convert supplied data type";async function pr(t,e,n){const i=t instanceof ArrayBuffer||ArrayBuffer.isView(t);if("string"==typeof t||i)return function(t,e,n){if(e.text&&"string"==typeof t)return t;var i;if((i=t)&&"object"==typeof i&&i.isBuffer&&(t=t.buffer),t instanceof ArrayBuffer){const n=t;return e.text&&!e.binary?new TextDecoder("utf8").decode(n):n}if(ArrayBuffer.isView(t)){if(e.text&&!e.binary)return new TextDecoder("utf8").decode(t);let n=t.buffer;const i=t.byteLength||t.length;return 0===t.byteOffset&&i===n.byteLength||(n=n.slice(t.byteOffset,t.byteOffset+i)),n}throw new Error(hr)}(t,e);if(os(t)&&(t=await ms(t)),rs(t)){const n=t;return await async function(t){if(!t.ok){const e=await async function(t){let e="Failed to fetch resource ".concat(t.url," (").concat(t.status,"): ");try{const n=t.headers.get("Content-Type");let i=t.statusText;n.includes("application/json")&&(i+=" ".concat(await t.text())),e+=i,e=e.length>60?"".concat(e.slice(0,60),"..."):e}catch(n){}return e}(t);throw new Error(e)}}(n),e.binary?await n.arrayBuffer():await n.text()}if(as(t)&&(t=ur(t,n)),(s=t)&&"function"==typeof s[Symbol.iterator]||(t=>t&&"function"==typeof t[Symbol.asyncIterator])(t))return ts(t);var s;throw new Error(hr)}async function dr(t,e,n,i){Di(!i||"object"==typeof i),!e||Array.isArray(e)||Xs(e)||(i=void 0,n=e,e=void 0),t=await t,n=n||{};const{url:s}=ds(t),r=function(t,e){if(!e&&t&&!Array.isArray(t))return t;let n;if(t&&(n=Array.isArray(t)?t:[t]),e&&e.loaders){const t=Array.isArray(e.loaders)?e.loaders:[e.loaders];n=n?[...n,...t]:t}return n&&n.length?n:null}(e,i),o=await async function(t,e=[],n,i){if(!er(t))return null;let s=tr(t,e,{...n,nothrow:!0},i);if(s)return s;if(os(t)&&(s=tr(t=await t.slice(0,10).arrayBuffer(),e,n,i)),!(s||null!=n&&n.nothrow))throw new Error(nr(t));return s}(t,r,n);return o?(i=function(t,e,n=null){if(n)return n;const i={fetch:Hs(e,t),...t};return Array.isArray(i.loaders)||(i.loaders=null),i}({url:s,parse:dr,loaders:r},n=Ws(n,o,r,s),i),await async function(t,e,n,i){if(function(t,e="3.2.11"){Di(t,"no worker provided");const n=t.version}(t),rs(e)){const t=e,{ok:n,redirected:s,status:r,statusText:o,type:a,url:l}=t,c=Object.fromEntries(t.headers.entries());i.response={headers:c,ok:n,redirected:s,status:r,statusText:o,type:a,url:l}}if(e=await pr(e,t,n),t.parseTextSync&&"string"==typeof e)return n.dataType="text",t.parseTextSync(e,n,i,t);if(function(t,e){return!!Yi.isSupported()&&!!(Ii||null!=e&&e._nodeWorkers)&&t.worker&&(null==e?void 0:e.worker)}(t,n))return await Xi(t,e,n,i,dr);if(t.parseText&&"string"==typeof e)return await t.parseText(e,n,i,t);if(t.parse)return await t.parse(e,n,i,t);throw Di(!t.parseSync),new Error("".concat(t.id," loader - no parser found and worker is disabled"))}(o,t,n,i)):null}const fr=!0;function mr(t,e,n=0,i={}){const s=new DataView(e),r=function(t,e=0){return"".concat(String.fromCharCode(t.getUint8(e+0))).concat(String.fromCharCode(t.getUint8(e+1))).concat(String.fromCharCode(t.getUint8(e+2))).concat(String.fromCharCode(t.getUint8(e+3)))}(s,n+0),o=s.getUint32(n+4,fr),a=s.getUint32(n+8,fr);switch(Object.assign(t,{header:{byteOffset:n,byteLength:a,hasBinChunk:!1},type:r,version:o,json:{},binChunks:[]}),n+=12,t.version){case 1:return function(t,e,n){Pi(t.header.byteLength>20);const i=e.getUint32(n+0,fr),s=e.getUint32(n+4,fr);return n+=8,Pi(0===s),vr(t,e,n,i),n+=i,n+=_r(t,e,n,t.header.byteLength)}(t,s,n);case 2:return function(t,e,n,i){return Pi(t.header.byteLength>20),function(t,e,n,i){for(;n+8<=t.header.byteLength;){const s=e.getUint32(n+0,fr),r=e.getUint32(n+4,fr);switch(n+=8,r){case 1313821514:vr(t,e,n,s);break;case 5130562:_r(t,e,n,s);break;case 0:i.strict||vr(t,e,n,s);break;case 1:i.strict||_r(t,e,n,s)}n+=Ji(s,4)}}(t,e,n,i),n+t.header.byteLength}(t,s,n,{});default:throw new Error("Invalid GLB version ".concat(t.version,". Only supports v1 and v2."))}}function vr(t,e,n,i){const s=new Uint8Array(e.buffer,n,i),r=new TextDecoder("utf8").decode(s);return t.json=JSON.parse(r),Ji(i,4)}function _r(t,e,n,i){return t.header.hasBinChunk=!0,t.binChunks.push({byteOffset:n,byteLength:i,arrayBuffer:e.buffer}),Ji(i,4)}const gr={name:"GLB",id:"glb",module:"gltf",version:"3.2.11",extensions:["glb"],mimeTypes:["model/gltf-binary"],binary:!0,parse:async function(t,e){return br(t,e)},parseSync:br,options:{glb:{strict:!1}}};function br(t,e){const{byteOffset:n=0}=e||{},i={};return mr(i,t,n,null==e?void 0:e.glb),i}class yr{constructor(t){this.gl=t}async load(t){this.glb=await async function(t,e,n,i){Array.isArray(e)||Xs(e)||(n=e,e=void 0);const s=Hs(n);let r=t;return"string"==typeof t&&(r=await s(t)),os(t)&&(r=await s(t)),await dr(r,e,n)}(fetch(t),gr),this.primitives=[];for(let e of this.glb.json.meshes)for(let t of e.primitives){const n=await this.loadPrimitive(this.glb,e.name,t);n&&this.primitives.push(n)}return this.primitives}getPrimitiveDataByMeshName(t){return this.primitives.find((e=>e.meshName==t))}async loadPrimitive(t,e,n){const i=this.gl,s=yr.getAccessorData(t,n.indices),r=yr.getAccessorData(t,n.attributes.POSITION),o=yr.getAccessorData(t,n.attributes.NORMAL);if(!s||!r||!o)return null;const a=i.createBuffer();i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,a),i.bufferData(i.ELEMENT_ARRAY_BUFFER,s,i.STATIC_DRAW);const l=i.createBuffer();i.bindBuffer(i.ARRAY_BUFFER,l),i.bufferData(i.ARRAY_BUFFER,r,i.STATIC_DRAW);const c=i.createBuffer();i.bindBuffer(i.ARRAY_BUFFER,c),i.bufferData(i.ARRAY_BUFFER,o,i.STATIC_DRAW);return{meshName:e,buffers:{indices:{data:s,webglBuffer:a,length:s.length,dataType:yr.getAccessorDataType(i,t,n.indices),numberOfComponents:yr.getAccessorNumberOfComponents(t,n.indices)},vertices:{data:r,webglBuffer:l,length:r.length,dataType:yr.getAccessorDataType(i,t,n.attributes.POSITION),numberOfComponents:yr.getAccessorNumberOfComponents(t,n.attributes.POSITION),stride:t.json.bufferViews[t.json.accessors[n.attributes.POSITION].bufferView].byteStride||0},normals:{data:o,webglBuffer:c,length:o.length,dataType:yr.getAccessorDataType(i,t,n.attributes.NORMAL),numberOfComponents:yr.getAccessorNumberOfComponents(t,n.attributes.NORMAL),stride:t.json.bufferViews[t.json.accessors[n.attributes.NORMAL].bufferView].byteStride||0}}}}static getAccessorData(t,e){const n=t.json.accessors[e];if(n){const i=t.binChunks[0],s=t.json.bufferViews[n.bufferView],r=n.componentType,o=n.count,a=i.byteOffset+(n.byteOffset||0)+s.byteOffset;let l=yr.getAccessorNumberOfComponents(t,e);switch(r){case 5120:return new Int8Array(i.arrayBuffer,a,o*l);case 5121:return new Uint8Array(i.arrayBuffer,a,o*l);case 5122:return new Int16Array(i.arrayBuffer,a,o*l);case 5123:return new Uint16Array(i.arrayBuffer,a,o*l);case 5125:return new Uint32Array(i.arrayBuffer,a,o*l);case 5126:return new Float32Array(i.arrayBuffer,a,o*l)}}return null}static getAccessorNumberOfComponents(t,e){switch(t.json.accessors[e].type){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}return null}static getAccessorDataType(t,e,n){switch(e.json.accessors[n].componentType){case 5120:return t.BYTE;case 5121:return t.UNSIGNED_BYTE;case 5122:return t.SHORT;case 5123:return t.UNSIGNED_SHORT;case 5125:return t.UNSIGNED_INT;case 5126:return t.FLOAT}}}var wr="#version 300 es\n\nuniform sampler2D u_positionTexture;\nuniform sampler2D u_velocityTexture;\nuniform sampler2D u_spectrumTexture;\nuniform vec3 u_cameraPosition;\nuniform mat4 u_worldMatrix;\nuniform mat4 u_viewMatrix;\nuniform mat4 u_projectionMatrix;\nuniform mat4 u_lightViewProjectionMatrix;\nuniform float u_time;\n\nin vec3 a_position;\nin vec3 a_normal;\nin mat4 a_instanceMatrix;\n\nout vec3 v_position;\nout vec4 v_lightSpacePosition;\nout vec3 v_normal;\nout vec3 v_surfaceToView;\nout float v_emission;\nflat out int v_instanceId;\n\nivec2 ndx2tex(ivec2 dimensions, int index) {\n    int y = index / dimensions.x;\n    int x = index % dimensions.x;\n    return ivec2(x, y);\n}\n\nint tex2ndx(ivec2 dimensions, ivec2 tex) {\n    return tex.x + tex.y * dimensions.x;\n}\n\nfloat sphericalDistance(vec3 pi, vec3 pj) {\n    return (acos(dot(pj, pi)));\n}\n\nfloat sqrParticleDist(vec3 pi, vec3 pj) {\n    vec3 pij = pj - pi;\n    return dot(pij, pij);\n}\n\nivec2 pos2CellIndex(vec2 p, ivec2 cellTexSize, vec2 domainScale, float cellSize) {\n    vec2 pi = p * 0.5 + 0.5;\n    pi = clamp(pi, vec2(0.001), vec2(.999));\n    pi *= domainScale;\n    return ivec2(pi / cellSize);\n}\n\nint pos2CellId(vec2 p, ivec2 cellTexSize, vec2 domainScale, float cellSize) {\n    ivec2 cellIndex = pos2CellIndex(p, cellTexSize, domainScale, cellSize);\n    return tex2ndx(cellTexSize, cellIndex);\n}\n\nint getFlatCellIndex(ivec2 cellIndex, int numGridCells) {\n    int p1 = 73856093; \n    int p2 = 19349663;\n    int n = p1 * cellIndex.x ^ p2 * cellIndex.y;\n    n %= numGridCells;\n    return n;\n}\n\nfloat mod289(float x){return x - floor(x * (1.0 / 289.0)) * 289.0;}\nvec4 mod289(vec4 x){return x - floor(x * (1.0 / 289.0)) * 289.0;}\nvec4 perm(vec4 x){return mod289(((x * 34.0) + 1.0) * x);}\n\nfloat noise(vec3 p){\n    vec3 a = floor(p);\n    vec3 d = p - a;\n    d = d * d * (3.0 - 2.0 * d);\n\n    vec4 b = a.xxyy + vec4(0.0, 1.0, 0.0, 1.0);\n    vec4 k1 = perm(b.xyxy);\n    vec4 k2 = perm(k1.xyxy + b.zzww);\n\n    vec4 c = k2 + a.zzzz;\n    vec4 k3 = perm(c);\n    vec4 k4 = perm(c + 1.0);\n\n    vec4 o1 = fract(k3 * (1.0 / 41.0));\n    vec4 o2 = fract(k4 * (1.0 / 41.0));\n\n    vec4 o3 = o2 * d.z + o1 * (1.0 - d.z);\n    vec2 o4 = o3.yw * d.x + o3.xz * (1.0 - d.x);\n\n    return o4.y * d.y + o4.x * (1.0 - d.y);\n}\n\nvec3 snoiseVec3( vec3 x ){\n  float s  = noise(vec3( x ));\n  float s1 = noise(vec3( x.y - 19.1 , x.z + 33.4 , x.x + 47.2 ));\n  float s2 = noise(vec3( x.z + 74.2 , x.x - 124.5 , x.y + 99.4 ));\n  vec3 c = vec3( s , s1 , s2 );\n  return c;\n}\n\nvec3 curlNoise( vec3 p ){\n  const float e = .1;\n  vec3 dx = vec3( e   , 0.0 , 0.0 );\n  vec3 dy = vec3( 0.0 , e   , 0.0 );\n  vec3 dz = vec3( 0.0 , 0.0 , e   );\n\n  vec3 p_x0 = snoiseVec3( p - dx );\n  vec3 p_x1 = snoiseVec3( p + dx );\n  vec3 p_y0 = snoiseVec3( p - dy );\n  vec3 p_y1 = snoiseVec3( p + dy );\n  vec3 p_z0 = snoiseVec3( p - dz );\n  vec3 p_z1 = snoiseVec3( p + dz );\n\n  float x = p_y1.z - p_y0.z - p_z1.y + p_z0.y;\n  float y = p_z1.x - p_z0.x - p_x1.z + p_x0.z;\n  float z = p_x1.y - p_x0.y - p_y1.x + p_y0.x;\n\n  const float divisor = 1.0 / ( 2.0 * e );\n  return normalize( vec3( x , y , z ) * divisor );\n}\n\n#define PI 3.1415926535\n\nmat3 calcLookAtMatrix(vec3 origin, vec3 target, float roll) {\n  vec3 rr = vec3(sin(roll), cos(roll), 0.0);\n  vec3 ww = normalize(target - origin);\n  vec3 uu = normalize(cross(ww, rr));\n  vec3 vv = normalize(cross(uu, ww));\n\n  return mat3(uu, vv, ww);\n}\n\nfloat rand(float n){return fract(sin(n) * 43758.5453123);}\n\nvoid main() {\n    ivec2 poisitionTexDimensions = textureSize(u_positionTexture, 0);\n    ivec2 spectrumTexSize = textureSize(u_spectrumTexture, 0);\n    ivec2 pi_tex = ndx2tex(poisitionTexDimensions, gl_InstanceID);\n    vec4 pi = texelFetch(u_positionTexture, pi_tex, 0);\n    vec4 vi = texelFetch(u_velocityTexture, pi_tex, 0);\n\n    \n    \n    float f = max(0., dot(vec3(0., 0., 1.), normalize(pi.xyz))) + .75;\n    float freq = (1. - f);\n    int bucketCount = spectrumTexSize.x * spectrumTexSize.y;\n    int bucketNdx = int(floor(freq * float(bucketCount)));\n    ivec2 bucketTex = ndx2tex(spectrumTexSize, bucketNdx);\n    vec2 bucketUv = vec2(bucketTex) / vec2(spectrumTexSize);\n    float audioOffset = texture(u_spectrumTexture, bucketUv).r;\n    float offset = audioOffset * smoothstep(0.3, 1., noise((pi.xyz + u_time * 0.0005) * 3.)); \n    offset *= mix(1., 0., step(0., -pi.z));\n\n    \n    float maxOffset = .3;\n    pi *= (rand(float(gl_InstanceID)) * 0.01 + 0.98 + (offset * maxOffset));\n\n    \n    float scale = 0.075;\n    vec4 pos = vec4(a_position * scale, 1.);\n\n    \n    vec3 up = vec3(1., 0., 0.);\n    vec3 axis = vec3(0., pi.z, pi.y);\n    float angle = acos(dot(up, pi.xyz));\n    mat3 lookAtMatrix = calcLookAtMatrix(vec3(0., 0., 0.), pi.xyz, 0.);\n    pos = vec4(lookAtMatrix * pos.xyz, 1.);\n\n    \n    \n    float flipFactor = mix(1., -0.97, step(0., -pi.z));\n    pos += pi * flipFactor;\n\n    \n    v_emission = smoothstep(0.1, 1., (length(vi) * 0.2)) ;\n\n    vec4 worldPosition = u_worldMatrix * pos;\n    v_position = worldPosition.xyz;\n    v_lightSpacePosition = u_lightViewProjectionMatrix * worldPosition;\n    v_normal = lookAtMatrix * -a_normal;\n    v_instanceId = gl_InstanceID;\n    v_surfaceToView = u_cameraPosition - worldPosition.xyz;\n    gl_Position = u_projectionMatrix * u_viewMatrix * worldPosition;\n}";t=new WeakMap,e=new WeakMap,n=new WeakMap,i=new WeakMap,s=new WeakSet,r=async function(){this.gl=this.canvas.getContext("webgl2",{antialias:!1,alpha:!1}),this.touchevents=Modernizr.touchevents;const t=this.gl;!function(t){for(let e=0;e<Ei.length;++e)ki(t,Ei[e])}(t),this.viewportSize=ke(this.canvas.clientWidth,this.canvas.clientHeight),z(this,u,h).call(this),z(this,v,_).call(this),await z(this,p,d).call(this),this.drawPrg=_i(t,["#version 300 es\n\nuniform mat4 u_worldMatrix;\nuniform mat4 u_viewMatrix;\nuniform mat4 u_projectionMatrix;\nuniform sampler2D u_positionTexture;\nuniform sampler2D u_velocityTexture;\nuniform vec2 u_resolution;\nuniform vec2 u_domainScale;\nuniform ivec2 u_cellTexSize;\nuniform float u_cellSize;\n\nout float v_velocity;\nflat out vec4 v_color;\n\nivec2 ndx2tex(ivec2 dimensions, int index) {\n    int y = index / dimensions.x;\n    int x = index % dimensions.x;\n    return ivec2(x, y);\n}\n\nint tex2ndx(ivec2 dimensions, ivec2 tex) {\n    return tex.x + tex.y * dimensions.x;\n}\n\nfloat sphericalDistance(vec3 pi, vec3 pj) {\n    return (acos(dot(pj, pi)));\n}\n\nfloat sqrParticleDist(vec3 pi, vec3 pj) {\n    vec3 pij = pj - pi;\n    return dot(pij, pij);\n}\n\nivec2 pos2CellIndex(vec2 p, ivec2 cellTexSize, vec2 domainScale, float cellSize) {\n    vec2 pi = p * 0.5 + 0.5;\n    pi = clamp(pi, vec2(0.001), vec2(.999));\n    pi *= domainScale;\n    return ivec2(pi / cellSize);\n}\n\nint pos2CellId(vec2 p, ivec2 cellTexSize, vec2 domainScale, float cellSize) {\n    ivec2 cellIndex = pos2CellIndex(p, cellTexSize, domainScale, cellSize);\n    return tex2ndx(cellTexSize, cellIndex);\n}\n\nint getFlatCellIndex(ivec2 cellIndex, int numGridCells) {\n    int p1 = 73856093; \n    int p2 = 19349663;\n    int n = p1 * cellIndex.x ^ p2 * cellIndex.y;\n    n %= numGridCells;\n    return n;\n}\n\nfloat mod289(float x){return x - floor(x * (1.0 / 289.0)) * 289.0;}\nvec4 mod289(vec4 x){return x - floor(x * (1.0 / 289.0)) * 289.0;}\nvec4 perm(vec4 x){return mod289(((x * 34.0) + 1.0) * x);}\n\nfloat noise(vec3 p){\n    vec3 a = floor(p);\n    vec3 d = p - a;\n    d = d * d * (3.0 - 2.0 * d);\n\n    vec4 b = a.xxyy + vec4(0.0, 1.0, 0.0, 1.0);\n    vec4 k1 = perm(b.xyxy);\n    vec4 k2 = perm(k1.xyxy + b.zzww);\n\n    vec4 c = k2 + a.zzzz;\n    vec4 k3 = perm(c);\n    vec4 k4 = perm(c + 1.0);\n\n    vec4 o1 = fract(k3 * (1.0 / 41.0));\n    vec4 o2 = fract(k4 * (1.0 / 41.0));\n\n    vec4 o3 = o2 * d.z + o1 * (1.0 - d.z);\n    vec2 o4 = o3.yw * d.x + o3.xz * (1.0 - d.x);\n\n    return o4.y * d.y + o4.x * (1.0 - d.y);\n}\n\nvec3 snoiseVec3( vec3 x ){\n  float s  = noise(vec3( x ));\n  float s1 = noise(vec3( x.y - 19.1 , x.z + 33.4 , x.x + 47.2 ));\n  float s2 = noise(vec3( x.z + 74.2 , x.x - 124.5 , x.y + 99.4 ));\n  vec3 c = vec3( s , s1 , s2 );\n  return c;\n}\n\nvec3 curlNoise( vec3 p ){\n  const float e = .1;\n  vec3 dx = vec3( e   , 0.0 , 0.0 );\n  vec3 dy = vec3( 0.0 , e   , 0.0 );\n  vec3 dz = vec3( 0.0 , 0.0 , e   );\n\n  vec3 p_x0 = snoiseVec3( p - dx );\n  vec3 p_x1 = snoiseVec3( p + dx );\n  vec3 p_y0 = snoiseVec3( p - dy );\n  vec3 p_y1 = snoiseVec3( p + dy );\n  vec3 p_z0 = snoiseVec3( p - dz );\n  vec3 p_z1 = snoiseVec3( p + dz );\n\n  float x = p_y1.z - p_y0.z - p_z1.y + p_z0.y;\n  float y = p_z1.x - p_z0.x - p_x1.z + p_x0.z;\n  float z = p_x1.y - p_x0.y - p_y1.x + p_y0.x;\n\n  const float divisor = 1.0 / ( 2.0 * e );\n  return normalize( vec3( x , y , z ) * divisor );\n}\n\nvec3 hsv2rgb(vec3 c) {\n    vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\n    vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\n    return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\n}\n\nvec3 palette( in float t, in vec3 a, in vec3 b, in vec3 c, in vec3 d ) {\n    return a + b*cos( 6.28318*(c*t+d) );\n}\n\nvoid main() {\n    ivec2 poisitionTexDimensions = textureSize(u_positionTexture, 0);\n\n    ivec2 pi_tex = ndx2tex(poisitionTexDimensions, gl_VertexID);\n    vec4 pi = texelFetch(u_positionTexture, pi_tex, 0);\n    vec4 vi = texelFetch(u_velocityTexture, pi_tex, 0);\n    v_velocity = length(vi);\n    float pointSize = max(u_resolution.x, u_resolution.y) * 0.01;\n\n    gl_PointSize = pointSize * (pi.z * 0.5 + 1.)* (pi.z * 0.5 + 1.);\n    vec4 worldPosition = u_worldMatrix * vec4(pi.xyz, 1.);\n    gl_Position = u_projectionMatrix * u_viewMatrix * worldPosition;\n\n    vec3 a = vec3(0.5, 0.5, 0.5);\t\t\n    vec3 b = vec3(0.5, 0.5, 0.5);\t\n    vec3 c = vec3(2.0, 1.0, 0.0);\t\n    vec3 d = vec3(0.50, 0.20, 0.25);\n\n    float t = length(vi) * 0.1;\n\n    v_color = vec4(palette(t, a, b, c, d) * 1.2, 1.);\n    \n}","#version 300 es\n\nprecision highp float;\n\nin float v_velocity;\nflat in vec4 v_color;\n\nout vec4 outColor;\n\nvoid main() {\n    vec2 c = gl_PointCoord * 2. - 1.;\n    float mask = 1. - smoothstep(0.7, 0.9, length(c));\n    outColor = vec4(0.4 * v_velocity, 0.9, 1., 1.) * mask;\n    outColor = v_color * mask;\n}"]),this.integratePrg=_i(t,["#version 300 es\n\nin vec2 a_position;\n\nout vec2 v_uv;\n\nvoid main() {\n    v_uv = 0.5 * a_position + 0.5;\n    gl_Position = vec4(a_position, 0., 1.);\n}","#version 300 es\n\nprecision highp float;\n\nuniform sampler2D u_forceTexture;\nuniform sampler2D u_positionTexture;\nuniform sampler2D u_velocityTexture;\nuniform sampler2D u_densityPressureTexture;\nuniform float u_dt;\nuniform float u_time;\nuniform vec4 u_domainScale;\n\nlayout(std140) uniform u_PointerParams {\n    vec3 pointerPos;\n    vec3 pointerVelocity;\n    float pointerRadius;\n    float pointerStrength;\n};\n\nin vec2 v_uv;\n\nlayout(location = 0) out vec4 outPosition;\nlayout(location = 1) out vec4 outVelocity;\n\nivec2 ndx2tex(ivec2 dimensions, int index) {\n    int y = index / dimensions.x;\n    int x = index % dimensions.x;\n    return ivec2(x, y);\n}\n\nint tex2ndx(ivec2 dimensions, ivec2 tex) {\n    return tex.x + tex.y * dimensions.x;\n}\n\nfloat sphericalDistance(vec3 pi, vec3 pj) {\n    return (acos(dot(pj, pi)));\n}\n\nfloat sqrParticleDist(vec3 pi, vec3 pj) {\n    vec3 pij = pj - pi;\n    return dot(pij, pij);\n}\n\nivec2 pos2CellIndex(vec2 p, ivec2 cellTexSize, vec2 domainScale, float cellSize) {\n    vec2 pi = p * 0.5 + 0.5;\n    pi = clamp(pi, vec2(0.001), vec2(.999));\n    pi *= domainScale;\n    return ivec2(pi / cellSize);\n}\n\nint pos2CellId(vec2 p, ivec2 cellTexSize, vec2 domainScale, float cellSize) {\n    ivec2 cellIndex = pos2CellIndex(p, cellTexSize, domainScale, cellSize);\n    return tex2ndx(cellTexSize, cellIndex);\n}\n\nint getFlatCellIndex(ivec2 cellIndex, int numGridCells) {\n    int p1 = 73856093; \n    int p2 = 19349663;\n    int n = p1 * cellIndex.x ^ p2 * cellIndex.y;\n    n %= numGridCells;\n    return n;\n}\n\nfloat mod289(float x){return x - floor(x * (1.0 / 289.0)) * 289.0;}\nvec4 mod289(vec4 x){return x - floor(x * (1.0 / 289.0)) * 289.0;}\nvec4 perm(vec4 x){return mod289(((x * 34.0) + 1.0) * x);}\n\nfloat noise(vec3 p){\n    vec3 a = floor(p);\n    vec3 d = p - a;\n    d = d * d * (3.0 - 2.0 * d);\n\n    vec4 b = a.xxyy + vec4(0.0, 1.0, 0.0, 1.0);\n    vec4 k1 = perm(b.xyxy);\n    vec4 k2 = perm(k1.xyxy + b.zzww);\n\n    vec4 c = k2 + a.zzzz;\n    vec4 k3 = perm(c);\n    vec4 k4 = perm(c + 1.0);\n\n    vec4 o1 = fract(k3 * (1.0 / 41.0));\n    vec4 o2 = fract(k4 * (1.0 / 41.0));\n\n    vec4 o3 = o2 * d.z + o1 * (1.0 - d.z);\n    vec2 o4 = o3.yw * d.x + o3.xz * (1.0 - d.x);\n\n    return o4.y * d.y + o4.x * (1.0 - d.y);\n}\n\nvec3 snoiseVec3( vec3 x ){\n  float s  = noise(vec3( x ));\n  float s1 = noise(vec3( x.y - 19.1 , x.z + 33.4 , x.x + 47.2 ));\n  float s2 = noise(vec3( x.z + 74.2 , x.x - 124.5 , x.y + 99.4 ));\n  vec3 c = vec3( s , s1 , s2 );\n  return c;\n}\n\nvec3 curlNoise( vec3 p ){\n  const float e = .1;\n  vec3 dx = vec3( e   , 0.0 , 0.0 );\n  vec3 dy = vec3( 0.0 , e   , 0.0 );\n  vec3 dz = vec3( 0.0 , 0.0 , e   );\n\n  vec3 p_x0 = snoiseVec3( p - dx );\n  vec3 p_x1 = snoiseVec3( p + dx );\n  vec3 p_y0 = snoiseVec3( p - dy );\n  vec3 p_y1 = snoiseVec3( p + dy );\n  vec3 p_z0 = snoiseVec3( p - dz );\n  vec3 p_z1 = snoiseVec3( p + dz );\n\n  float x = p_y1.z - p_y0.z - p_z1.y + p_z0.y;\n  float y = p_z1.x - p_z0.x - p_x1.z + p_x0.z;\n  float z = p_x1.y - p_x0.y - p_y1.x + p_y0.x;\n\n  const float divisor = 1.0 / ( 2.0 * e );\n  return normalize( vec3( x , y , z ) * divisor );\n}\n\nvoid main() {\n    ivec2 particleTexDimensions = textureSize(u_positionTexture, 0);\n    vec4 domainScale = u_domainScale;\n\n    vec4 pi = texture(u_positionTexture, v_uv);\n    vec4 vi = texture(u_velocityTexture, v_uv);\n    vec4 fi = texture(u_forceTexture, v_uv);\n    vec4 ri = texture(u_densityPressureTexture, v_uv);\n\n    \n    float dt = (u_dt * 0.001);\n    float rho = ri.x + 0.000000001;\n    vec4 ai = fi / rho;\n    vi += ai * dt;\n\n    \n    vec4 pointerPos = vec4(pointerPos, 0.);\n    float prFront = length(pointerPos * domainScale - pi * domainScale);\n    float prBack = length(pointerPos * domainScale + pi * domainScale);\n    if (prFront < pointerRadius) {\n        vi += vec4(pointerVelocity, 0.) * pointerStrength * (1. - prFront / pointerRadius);\n    } else if (prBack < pointerRadius) {\n        \n        \n        vi -= vec4(pointerVelocity, 0.) * pointerStrength * 0.8 * (1. - prBack / pointerRadius);\n    }\n\n    \n    pi += (vi + 0.5 * ai * dt) * dt;\n    pi = normalize(pi);\n\n    \n    vi *= 0.99;\n\n    \n    vec3 n = curlNoise(pi.xyz * 2.5 + sin(u_time * 0.0001) * 2.) * 2. - 1.;\n    vi.xyz += n * 0.008;\n    \n    outPosition = pi;\n    outVelocity = vi;\n}"]),this.pressurePrg=_i(t,["#version 300 es\n\nin vec2 a_position;\n\nout vec2 v_uv;\n\nvoid main() {\n    v_uv = 0.5 * a_position + 0.5;\n    gl_Position = vec4(a_position, 0., 1.);\n}","#version 300 es\n\nprecision highp float;\nprecision highp int;\nprecision highp usampler2D;\n\nuniform sampler2D u_positionTexture;\n\nlayout(std140) uniform u_SimulationParams {\n    float H;\n    float HSQ;\n    float MASS;\n    float REST_DENS;\n    float GAS_CONST;\n    float VISC;\n    float POLY6;\n    float SPIKY_GRAD;\n    float VISC_LAP;\n    float POINTER_RADIUS;\n    float POINTER_STRENGTH;\n    int PARTICLE_COUNT;\n    vec4 DOMAIN_SCALE;\n};\n\nin vec2 v_uv;\n\nout vec2 outDensityPressure;\n\nivec2 ndx2tex(ivec2 dimensions, int index) {\n    int y = index / dimensions.x;\n    int x = index % dimensions.x;\n    return ivec2(x, y);\n}\n\nint tex2ndx(ivec2 dimensions, ivec2 tex) {\n    return tex.x + tex.y * dimensions.x;\n}\n\nfloat sphericalDistance(vec3 pi, vec3 pj) {\n    return (acos(dot(pj, pi)));\n}\n\nfloat sqrParticleDist(vec3 pi, vec3 pj) {\n    vec3 pij = pj - pi;\n    return dot(pij, pij);\n}\n\nivec2 pos2CellIndex(vec2 p, ivec2 cellTexSize, vec2 domainScale, float cellSize) {\n    vec2 pi = p * 0.5 + 0.5;\n    pi = clamp(pi, vec2(0.001), vec2(.999));\n    pi *= domainScale;\n    return ivec2(pi / cellSize);\n}\n\nint pos2CellId(vec2 p, ivec2 cellTexSize, vec2 domainScale, float cellSize) {\n    ivec2 cellIndex = pos2CellIndex(p, cellTexSize, domainScale, cellSize);\n    return tex2ndx(cellTexSize, cellIndex);\n}\n\nint getFlatCellIndex(ivec2 cellIndex, int numGridCells) {\n    int p1 = 73856093; \n    int p2 = 19349663;\n    int n = p1 * cellIndex.x ^ p2 * cellIndex.y;\n    n %= numGridCells;\n    return n;\n}\n\nfloat mod289(float x){return x - floor(x * (1.0 / 289.0)) * 289.0;}\nvec4 mod289(vec4 x){return x - floor(x * (1.0 / 289.0)) * 289.0;}\nvec4 perm(vec4 x){return mod289(((x * 34.0) + 1.0) * x);}\n\nfloat noise(vec3 p){\n    vec3 a = floor(p);\n    vec3 d = p - a;\n    d = d * d * (3.0 - 2.0 * d);\n\n    vec4 b = a.xxyy + vec4(0.0, 1.0, 0.0, 1.0);\n    vec4 k1 = perm(b.xyxy);\n    vec4 k2 = perm(k1.xyxy + b.zzww);\n\n    vec4 c = k2 + a.zzzz;\n    vec4 k3 = perm(c);\n    vec4 k4 = perm(c + 1.0);\n\n    vec4 o1 = fract(k3 * (1.0 / 41.0));\n    vec4 o2 = fract(k4 * (1.0 / 41.0));\n\n    vec4 o3 = o2 * d.z + o1 * (1.0 - d.z);\n    vec2 o4 = o3.yw * d.x + o3.xz * (1.0 - d.x);\n\n    return o4.y * d.y + o4.x * (1.0 - d.y);\n}\n\nvec3 snoiseVec3( vec3 x ){\n  float s  = noise(vec3( x ));\n  float s1 = noise(vec3( x.y - 19.1 , x.z + 33.4 , x.x + 47.2 ));\n  float s2 = noise(vec3( x.z + 74.2 , x.x - 124.5 , x.y + 99.4 ));\n  vec3 c = vec3( s , s1 , s2 );\n  return c;\n}\n\nvec3 curlNoise( vec3 p ){\n  const float e = .1;\n  vec3 dx = vec3( e   , 0.0 , 0.0 );\n  vec3 dy = vec3( 0.0 , e   , 0.0 );\n  vec3 dz = vec3( 0.0 , 0.0 , e   );\n\n  vec3 p_x0 = snoiseVec3( p - dx );\n  vec3 p_x1 = snoiseVec3( p + dx );\n  vec3 p_y0 = snoiseVec3( p - dy );\n  vec3 p_y1 = snoiseVec3( p + dy );\n  vec3 p_z0 = snoiseVec3( p - dz );\n  vec3 p_z1 = snoiseVec3( p + dz );\n\n  float x = p_y1.z - p_y0.z - p_z1.y + p_z0.y;\n  float y = p_z1.x - p_z0.x - p_x1.z + p_x0.z;\n  float z = p_x1.y - p_x0.y - p_y1.x + p_y0.x;\n\n  const float divisor = 1.0 / ( 2.0 * e );\n  return normalize( vec3( x , y , z ) * divisor );\n}\n\nfloat poly6Weight(float r2) {\n    float temp = max(0., HSQ - r2);\n    return POLY6 * temp * temp * temp;\n}\n\nvoid main() {\n    ivec2 particleTexDimensions = textureSize(u_positionTexture, 0);\n    vec4 domainScale = DOMAIN_SCALE;\n\n    vec4 p = texture(u_positionTexture, v_uv);\n    vec4 pi = p * domainScale;\n    float rho = MASS * poly6Weight(0.);\n\n    \n    for(int i=0; i<PARTICLE_COUNT; i++) {\n        vec4 pj = texelFetch(u_positionTexture, ndx2tex(particleTexDimensions, i), 0) * domainScale;\n\n        float sr = sphericalDistance(pi.xyz, pj.xyz);\n        float r2 = sr * sr;\n        if (r2 < HSQ) {\n            float t = MASS * poly6Weight(r2);\n            rho += t;\n        }\n    }\n\n    float pressure = max(GAS_CONST * (rho - REST_DENS), 0.);\n\n    outDensityPressure = vec2(rho, pressure);\n}"]),this.forcePrg=_i(t,["#version 300 es\n\nin vec2 a_position;\n\nout vec2 v_uv;\n\nvoid main() {\n    v_uv = 0.5 * a_position + 0.5;\n    gl_Position = vec4(a_position, 0., 1.);\n}","#version 300 es\n\nprecision highp float;\nprecision highp int;\nprecision highp usampler2D;\n\nuniform sampler2D u_positionTexture;\nuniform sampler2D u_velocityTexture;\nuniform sampler2D u_densityPressureTexture;\nuniform int u_particleCount;\nuniform vec2 u_domainScale;\n\nlayout(std140) uniform u_SimulationParams {\n    float H;\n    float HSQ;\n    float MASS;\n    float REST_DENS;\n    float GAS_CONST;\n    float VISC;\n    float POLY6;\n    float SPIKY_GRAD;\n    float VISC_LAP;\n    float POINTER_RADIUS;\n    float POINTER_STRENGTH;\n    int PARTICLE_COUNT;\n    vec4 DOMAIN_SCALE;\n};\n\nin vec2 v_uv;\n\nout vec4 outForce;\n\nivec2 ndx2tex(ivec2 dimensions, int index) {\n    int y = index / dimensions.x;\n    int x = index % dimensions.x;\n    return ivec2(x, y);\n}\n\nint tex2ndx(ivec2 dimensions, ivec2 tex) {\n    return tex.x + tex.y * dimensions.x;\n}\n\nfloat sphericalDistance(vec3 pi, vec3 pj) {\n    return (acos(dot(pj, pi)));\n}\n\nfloat sqrParticleDist(vec3 pi, vec3 pj) {\n    vec3 pij = pj - pi;\n    return dot(pij, pij);\n}\n\nivec2 pos2CellIndex(vec2 p, ivec2 cellTexSize, vec2 domainScale, float cellSize) {\n    vec2 pi = p * 0.5 + 0.5;\n    pi = clamp(pi, vec2(0.001), vec2(.999));\n    pi *= domainScale;\n    return ivec2(pi / cellSize);\n}\n\nint pos2CellId(vec2 p, ivec2 cellTexSize, vec2 domainScale, float cellSize) {\n    ivec2 cellIndex = pos2CellIndex(p, cellTexSize, domainScale, cellSize);\n    return tex2ndx(cellTexSize, cellIndex);\n}\n\nint getFlatCellIndex(ivec2 cellIndex, int numGridCells) {\n    int p1 = 73856093; \n    int p2 = 19349663;\n    int n = p1 * cellIndex.x ^ p2 * cellIndex.y;\n    n %= numGridCells;\n    return n;\n}\n\nfloat mod289(float x){return x - floor(x * (1.0 / 289.0)) * 289.0;}\nvec4 mod289(vec4 x){return x - floor(x * (1.0 / 289.0)) * 289.0;}\nvec4 perm(vec4 x){return mod289(((x * 34.0) + 1.0) * x);}\n\nfloat noise(vec3 p){\n    vec3 a = floor(p);\n    vec3 d = p - a;\n    d = d * d * (3.0 - 2.0 * d);\n\n    vec4 b = a.xxyy + vec4(0.0, 1.0, 0.0, 1.0);\n    vec4 k1 = perm(b.xyxy);\n    vec4 k2 = perm(k1.xyxy + b.zzww);\n\n    vec4 c = k2 + a.zzzz;\n    vec4 k3 = perm(c);\n    vec4 k4 = perm(c + 1.0);\n\n    vec4 o1 = fract(k3 * (1.0 / 41.0));\n    vec4 o2 = fract(k4 * (1.0 / 41.0));\n\n    vec4 o3 = o2 * d.z + o1 * (1.0 - d.z);\n    vec2 o4 = o3.yw * d.x + o3.xz * (1.0 - d.x);\n\n    return o4.y * d.y + o4.x * (1.0 - d.y);\n}\n\nvec3 snoiseVec3( vec3 x ){\n  float s  = noise(vec3( x ));\n  float s1 = noise(vec3( x.y - 19.1 , x.z + 33.4 , x.x + 47.2 ));\n  float s2 = noise(vec3( x.z + 74.2 , x.x - 124.5 , x.y + 99.4 ));\n  vec3 c = vec3( s , s1 , s2 );\n  return c;\n}\n\nvec3 curlNoise( vec3 p ){\n  const float e = .1;\n  vec3 dx = vec3( e   , 0.0 , 0.0 );\n  vec3 dy = vec3( 0.0 , e   , 0.0 );\n  vec3 dz = vec3( 0.0 , 0.0 , e   );\n\n  vec3 p_x0 = snoiseVec3( p - dx );\n  vec3 p_x1 = snoiseVec3( p + dx );\n  vec3 p_y0 = snoiseVec3( p - dy );\n  vec3 p_y1 = snoiseVec3( p + dy );\n  vec3 p_z0 = snoiseVec3( p - dz );\n  vec3 p_z1 = snoiseVec3( p + dz );\n\n  float x = p_y1.z - p_y0.z - p_z1.y + p_z0.y;\n  float y = p_z1.x - p_z0.x - p_x1.z + p_x0.z;\n  float z = p_x1.y - p_x0.y - p_y1.x + p_y0.x;\n\n  const float divisor = 1.0 / ( 2.0 * e );\n  return normalize( vec3( x , y , z ) * divisor );\n}\n\nfloat spiky_grad2Weight(float r) {\n    float temp = max(0., H - r);\n    return (SPIKY_GRAD * temp * temp) / r;\n}\n\nfloat visc_laplWeight(float r) {\n    return VISC_LAP * (1. - r / H);\n}\n\nvoid main() {\n    ivec2 particleTexDimensions = textureSize(u_positionTexture, 0);\n    vec4 domainScale = DOMAIN_SCALE;\n\n    vec4 p = texture(u_positionTexture, v_uv);\n    vec4 pi = p * domainScale;\n    vec4 vi = texture(u_velocityTexture, v_uv);\n    vec2 ri = texture(u_densityPressureTexture, v_uv).xy;\n    float pi_rho = ri.x;\n    float pi_pressure = ri.y;\n    vec4 force = vec4(0.);\n\n    \n    for(int i=0; i<PARTICLE_COUNT; i++) {\n        ivec2 pj_tex = ndx2tex(particleTexDimensions, i);\n        vec4 pj = texelFetch(u_positionTexture, pj_tex, 0) * domainScale;\n        vec4 pij = pj - pi;\n\n        vec3 b = cross(pj.xyz, pi.xyz);\n        vec3 t = cross(pi.xyz, b);\n\n        float sr = sphericalDistance(pi.xyz, pj.xyz);\n\n        if (sr < H) {\n            float r = sr;\n\n            if (r <= 0.0001) continue;\n\n            vec4 pressureForce = vec4(t, 0.);\n            vec4 viscosityForce = vec4(0.);\n\n            vec2 rj = texelFetch(u_densityPressureTexture, pj_tex, 0).xy;\n            float pj_rho = rj.x;\n            float pj_pressure = rj.y;\n            vec4 vj = texelFetch(u_velocityTexture, pj_tex, 0);\n\n            \n            float pF = MASS * ((pi_pressure + pj_pressure) / (2. * pj_rho)) * spiky_grad2Weight(r);\n            pressureForce *= pF;\n\n            \n            viscosityForce = (vj - vi) * (VISC * MASS * visc_laplWeight(r) / pj_rho);\n\n            force += pressureForce + viscosityForce;\n        }\n    }\n\n    outForce = vec4(force);\n}"]),this.beadPrg=_i(t,[wr,"#version 300 es\n\nprecision highp float;\n\nuniform sampler2D u_spectrumTexture;\nuniform sampler2D u_lightDepthTexture;\nuniform sampler2D u_envMapTexture;\n\nout vec4 outColor;\n\nin vec3 v_position;\nin vec4 v_lightSpacePosition;\nin vec3 v_normal;\nin vec3 v_surfaceToView;\nin float v_emission;\nflat in int v_instanceId;\n\n#define BOXBLUR2D_KERNELSIZE 7\n#define PI 3.1415926535\n\nivec2 ndx2tex(ivec2 dimensions, int index) {\n    int y = index / dimensions.x;\n    int x = index % dimensions.x;\n    return ivec2(x, y);\n}\n\nfloat shadow(vec2 lightSpacePos, float depth) {\n    float projectedDepth = texture(u_lightDepthTexture, lightSpacePos.xy).r;\n    return (depth <= projectedDepth) ? 1. : 0.;\n}\n\nfloat blurShadow(in vec2 st, in float depth, in vec2 offset) {\n    float color = 0.;\n    float accumWeight = 0.;\n    float f_kernelSize = float(BOXBLUR2D_KERNELSIZE);\n    float kernelSize2 = f_kernelSize * f_kernelSize;\n    float weight = 1. / kernelSize2;\n\n    for (int j = 0; j < BOXBLUR2D_KERNELSIZE; j++) {\n        float y = -.5 * (f_kernelSize - 1.) + float(j);\n        for (int i = 0; i < BOXBLUR2D_KERNELSIZE; i++) {\n            float x = -.5 * (f_kernelSize - 1.) + float(i);\n            color += shadow(st + vec2(x, y) * offset, depth) * weight;\n        }\n    }\n    return color;\n}\n\nfloat powFast(float a, float b) {\n  return a / ((1. - b) * a + b);\n}\n\nvec3 palette( in float t, in vec3 a, in vec3 b, in vec3 c, in vec3 d ) {\n    return a + b*cos( 6.28318*(c*t+d) );\n}\n\nvoid main() {\n    vec3 color = vec3(0.);\n\n    vec3 N = normalize(v_normal);\n    vec3 V = normalize(v_surfaceToView);\n    vec3 R = reflect(N, V);\n\n    \n    \n    vec3 lightSpacePosition = v_lightSpacePosition.xyz / v_lightSpacePosition.w;\n    vec2 shadowMapRes = vec2(textureSize(u_lightDepthTexture, 0));\n    vec2 offset = 1. / shadowMapRes;\n    lightSpacePosition = lightSpacePosition * 0.5 + 0.5;\n    float currentDepth = lightSpacePosition.z - 0.009;\n    float shadow = blurShadow(lightSpacePosition.xy, currentDepth, offset * 2.);\n    float shadowFactor = 1.;\n    shadow = (shadow * shadowFactor + (1. - shadowFactor));\n\n    \n    float fresnel = 1. - max(0., dot(V, N));\n\n    \n    float specularValue = powFast(max(0.0, dot(R, -V)), 50.);\n    vec3 specular = specularValue * vec3(1., 0.95, 0.95);\n\n    \n    float phi   = atan(-N.z, N.x) - 0.35;\n    float theta = acos(N.y);\n    vec2 equiPos = vec2(-phi / (2. * PI), theta / PI);\n    vec3 ambient = texture(u_envMapTexture, equiPos).rgb;\n    color += ambient * .9;\n\n    \n    color *= shadow;\n\n    \n    \n    vec3 a = vec3(0.5, 0.5, 0.5);\n    vec3 b = vec3(0.5, 0.5, 0.5);\n    vec3 c = vec3(1.1, 0.75, 0.2); \t\n    vec3 d = vec3(0.00, 0.05, 0.20);\n    vec3 emission = palette( v_emission * 0.53 + 0.4, a, b, c, d) * v_emission;\n    \n    color += emission;\n\n    \n    color += fresnel * 0.1;\n    \n    outColor = vec4(color, 1.);\n}"]),this.testPrg=_i(t,["#version 300 es\n\nin vec2 a_position;\n\nout vec2 v_uv;\n\nvoid main() {\n    v_uv = 0.5 * a_position + 0.5;\n    gl_Position = vec4(a_position, 0., 1.);\n}","#version 300 es\n\nprecision highp float;\n\nuniform sampler2D u_texture;\n\nout vec4 outColor;\n\nin vec2 v_uv;\n\nvoid main() {\n    outColor = vec4(texture(u_texture, v_uv));\n}"]),this.lightDepthPrg=_i(t,[wr,"#version 300 es\nprecision highp float;\n\nout vec4 outColor;\n\nvoid main() {\n  outColor = vec4(0.);\n}"]),this.compositePrg=_i(t,["#version 300 es\n\nin vec2 a_position;\n\nout vec2 v_uv;\n\nvoid main() {\n    v_uv = 0.5 * a_position + 0.5;\n    gl_Position = vec4(a_position, 0., 1.);\n}","#version 300 es\n\nprecision highp float;\n\nuniform sampler2D u_colorTexture;\n\nout vec4 outColor;\n\nin vec2 v_uv;\n\nvoid main() {\n    outColor = vec4(texture(u_colorTexture, v_uv));\n}"]),this.simulationParamsUBO=ci(t,this.pressurePrg,"u_SimulationParams"),this.pointerParamsUBO=ci(t,this.integratePrg,"u_PointerParams"),this.simulationParamsNeedUpdate=!0,this.quadBufferInfo=tn(t,{a_position:{numComponents:2,data:[-1,-1,3,-1,-1,3]}}),this.quadVAO=Ai(t,this.pressurePrg.attribSetters,this.quadBufferInfo.attribs,this.quadBufferInfo.indices),this.glbBuilder=new yr(t),await this.glbBuilder.load(new URL("/liquid-geo/dist/assets/bead.glb",self.location)),this.beadPrimitive=this.glbBuilder.getPrimitiveDataByMeshName("bead"),this.beadBuffers=this.beadPrimitive.buffers,this.beadBufferInfo=tn(t,{a_position:{...this.beadBuffers.vertices,numComponents:this.beadBuffers.vertices.numberOfComponents},a_normal:{...this.beadBuffers.normals,numComponents:this.beadBuffers.normals.numberOfComponents},indices:{...this.beadBuffers.indices,numComponents:this.beadBuffers.indices.numberOfComponents}}),this.beadVAO=Ai(t,this.beadPrg.attribSetters,this.beadBufferInfo.attribs,this.beadBufferInfo.indices),this.pressureFBO=xi(t,[{attachment:this.textures.densityPressure}],this.textureSize,this.textureSize),this.forceFBO=xi(t,[{attachment:this.textures.force}],this.textureSize,this.textureSize),this.inFBO=xi(t,[{attachment:this.textures.position1},{attachment:this.textures.velocity1}],this.textureSize,this.textureSize),this.outFBO=xi(t,[{attachment:this.textures.position2},{attachment:this.textures.velocity2}],this.textureSize,this.textureSize),this.lightDepthFBO=xi(t,[{attachmentPoint:t.DEPTH_ATTACHMENT,attachment:this.lightDepthTexture}],this.light.textureSize,this.light.textureSize),this.drawFBOAttachements=[{format:t.RGBA,internalFormat:t.RGBA32F},{attachmentPoint:t.DEPTH_ATTACHMENT,format:t.DEPTH_COMPONENT,internalFormat:t.DEPTH_COMPONENT32F}],this.drawFBO=xi(t,this.drawFBOAttachements,this.viewportSize[0],this.viewportSize[1]),this.colorTexture=this.drawFBO.attachments[0],this.highpassFBO=xi(t,[{attachment:this.highpassTexture}]),this.worldMatrix=ue(),z(this,o,a).call(this),z(this,l,c).call(this),z(this,f,m).call(this),z(this,S,k).call(this),z(this,E,P).call(this,t),this.resize()},o=new WeakSet,a=function(){this.isPointerDown=!1,this.pointerLeft=!0,this.pointer=Ae(),this.pointerLerp=Ae(),this.pointerLerpPrev=Ae(),this.pointerLerpDelta=Ae(),this.arcPointer=ve(),this.arcPointerPrev=ve(),this.arcPointerDelta=ve(),ae(this.canvas,"pointerdown").subscribe((t=>{this.isPointerDown=!0,this.pointerLeft=!1,this.pointer=ke(t.clientX,t.clientY),Ee(this.pointerLerp,this.pointer),Ee(this.pointerLerpPrev,this.pointerLerp)})),function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=Vt(t),i=Rt(t,1/0),s=t;return s.length?1===s.length?Ht(s[0]):ie(i)(Qt(s,n)):Dt}(ae(this.canvas,"pointerup"),ae(this.canvas,"pointerleave")).subscribe((()=>{this.isPointerDown=!1,this.leftSphere=!0,this.pointerLeft=!0})),ae(this.canvas,"pointermove").subscribe((t=>{this.pointer=ke(t.clientX,t.clientY),this.pointerLeft&&(this.pointerLerp=Se(this.pointer),this.pointerLerpPrev=Se(this.pointer)),this.pointerLeft=!1})),ae(window.document,"keyup").subscribe((()=>this.debugKey=!0))},l=new WeakSet,c=function(){const t=this.simulationParams;t.HSQ=t.H*t.H,t.POLY6=315/(64*Math.PI*Math.pow(t.H,9)),t.SPIKY_GRAD=-45/(Math.PI*Math.pow(t.H,6)),t.VISC_LAP=45/(Math.PI*Math.pow(t.H,5)),this.simulationParamsNeedUpdate=!0},u=new WeakSet,h=function(){const t=this.gl;this.textureSize=2**Math.ceil(Math.log2(Math.sqrt(this.NUM_PARTICLES))),this.NUM_PARTICLES=this.textureSize*this.textureSize,this.simulationParams.PARTICLE_COUNT=this.NUM_PARTICLES,this.simulationParamsNeedUpdate=!0,console.log("number of particles:",this.NUM_PARTICLES),this.spectrumTextureSize=Math.sqrt(this.audioRepeater.bufferLength);const e=new Float32Array(4*this.NUM_PARTICLES),n=new Float32Array(4*this.NUM_PARTICLES),i=new Float32Array(4*this.NUM_PARTICLES);for(let o=0;o<this.NUM_PARTICLES;++o){e[4*o+0]=0,e[4*o+1]=0;let t=_e(2*Math.random()-1,2*Math.random()-1,2*Math.random()-1);t=we(t,t),i[4*o+0]=t[0],i[4*o+1]=t[1],i[4*o+2]=t[2],i[4*o+3]=0}const s={width:this.textureSize,height:this.textureSize,min:t.NEAREST,mag:t.NEAREST,wrap:t.REPEAT},r={...s,format:t.RGBA,internalFormat:t.RGBA32F};this.textures=In(t,{densityPressure:{...s,format:t.RG,internalFormat:t.RG32F,src:new Float32Array(2*this.NUM_PARTICLES)},force:{...r,src:[...n]},position1:{...r,src:[...i]},position2:{...r,src:[...i]},velocity1:{...r,src:[...e]},velocity2:{...r,src:[...e]}}),this.currentPositionTexture=this.textures.position2,this.currentVelocityTexture=this.textures.velocity2,this.spectrumTexture=Dn(t,{width:this.spectrumTextureSize,height:this.spectrumTextureSize,format:t.RED,internalFormat:t.R32F,type:t.FLOAT,minMag:t.LINEAR}),this.lightDepthTexture=Dn(t,{width:this.light.textureSize,height:this.light.textureSize,format:t.DEPTH_COMPONENT,internalFormat:t.DEPTH_COMPONENT32F,minMag:t.NEAREST}),this.highpassTexture=Dn(t,{width:this.viewportSize[0]*this.HIGHPASS_SCALE,height:this.viewportSize[1]*this.HIGHPASS_SCALE})},p=new WeakSet,d=function(){const t=this.gl;return new Promise((e=>{this.envMapTexture=Dn(t,{src:new URL("data:image/jpeg;base64,/9j/7gAhQWRvYmUAZEAAAAABAwAQAwIDBgAAAAAAAAAAAAAAAP/bAIQAAgICAgICAgICAgMCAgIDBAMCAgMEBQQEBAQEBQYFBQUFBQUGBgcHCAcHBgkJCgoJCQwMDAwMDAwMDAwMDAwMDAEDAwMFBAUJBgYJDQoJCg0PDg4ODg8PDAwMDAwPDwwMDAwMDA8MDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwM/8IAEQgAZgDNAwERAAIRAQMRAf/EAKUAAAEEAwEBAQAAAAAAAAAAAAMBAgQFAAYHCAkKAQEBAQEBAQAAAAAAAAAAAAAAAQIDBAUQAAICAgAEBgEEAwEAAAAAAAABEQIDBBASBQYgISITFAcIMEAxFVBgFjIRAAIBAgUBBwMEAwAAAAAAAAABAhExECFBAwQSIFFhcbEyE4HBIpGh0RQwUgUSAQACAgMAAAAAAAAAAAAAABEAAUBwEGAh/9oADAMBAQIRAxEAAAD4wZ7FUwWUg9VEBg0FYEEgwYNGDBDDLHDx8pB5VkkkKckKeUgIj2AQBGSMRrI6BAowaYZY8LKUkKU1pl6qFL1rp/PrvvPXOOuObb50rIhoyxg0aYGJI6UNkdGGDhxCGGEpfQXHv9yvj79YZx4O6b+J/wBnlyHfEBgUnLOlcWjVzNWKvIaVNzTMhAWQ02SdNSvOOHPoD4vT+nHx47t9bj5F+L3/AC7fVvlf0ecZNXcZvYZuGkJL5q6m5sryLZWs61rmwtJopvee+h648w1xip6e4ej9Cfxr627Y8A8un5/vt44r04Wk11PPbap1pbjXrzjl7NWk3MHKFK65oLiKly1dze056303zrXDk2/PczXpjz9+5cL539E86+jzxTr+PRumeusXGra5UlyxLKamrIVwIiM1lzGSyatpqxm9mnTZ8Ukl7ibjhbZlLq6Z0U2rG1dV1nWbzpLiruYwQkBFUagCOjyetlNXc3bzewze0Yuz4l7iSYhaUGrq3RrGpr9zU3FZcwUj2CRohgpgQMS1mS3E6TZZ7VhLNWTD4HUWoNlezXpEuYRGuQAkYNEFHWEDynWQTZsqy4OplIKNBgUjpFoSCSKCsYjRpgqKOCLIDhZtVJBAgphg0GDoZiNQYIGNEFRLFHhAyulcuGGKophgghiYYYNTBoghiZSiiiyqf//aAAgBAgABBQD/ADNrpHv1K3T/AG+W/KsmZ2fJlRhztOlpX6Ekkkk+GfBtv06STs6qNhJZNf8A88ZJ/UkkT456cyatis92zWOjvbHXlXBsn9eYFYkZkxKx8dGPGq8JHb9l/BztDyseRnuMWRiys5mxfsmOo6HIchyCqKv7WCDlII/2D//aAAgBAwABBQDxR+hPCeEkk8ZJ4SSSSSSSSSSSSSSSSSSSSSSSSSSSSSSLzFQ5B1GSSSST4IIII8M+HGh2OdCZkUeGCCBI5TlOU5R1IIIIHXiin8X4UMvFIVTlI4IS8DHwg5TlktjGo4Y2WrJ7ZVGR8EpK4zlgY+C8LHwXBMiS+MdSqYmQNjTFSSmOD+BsfBcJJJJG+K4JifB1II4QcqOXg2Nj8Ekkkk+FCE+MEEcW+LRBBBBBBBBBBHBcEySfBJI+D4RwgjjBBHBLwySSSSST4oI8Uf5j/9oACAEBAAEFAK2q1XlKqosaYsNWLBU+PUeCo8NR0SLJIs6od0h5ajz1HsJD2UPZqfJqfJqfKqLZQtlCzoWarPdqU3EV3Kld2qK79CvUKFd1M+X5W3Ui2/Qtv0ZbdqX3EX3EW3C24W2x7g9w+Wz5bPlsW4LcK7hXcPmeXzWmt9o/sbGPevd6Ncue3QOx+r9XL/TfclcPXe0ep9Je57mF33rVf9jYe/Zj3bMe1ZjzWZz2YlexXBksV1MjHpZC+tkQ6Xqc1ke5ZC2LI+VaHzJyyWa79f1N2pfufrP0X+Mehk6bsfjV0d6f5D/jZq6Oh390i3Rep5rTaWSytbWMWjkuLp1klo+ev0xWWDpNSnSqQ+l0jL0mpn6UkZtBVa6fJl6bdL4eXm6h0C+J59e+G3mYZ5/xD1NTN3T9PaehTolsOHk/IfT6fboP5E4MGLu26c+ZramTPbp/QbNV6XTFXNhrUriXNp4VGPEimJDxIyYkbGJRs4VzYcanHp0yL+mpGXpePZXXO1rJbnT8utfE+W/0b3q+1uv/AEH9/wDTdnpWf7m6PXT/ACU+/dD+s+0OvvrnWbKbaHS821fova7rW2hj16baSNhS8eP1a1IWNCjhkgzVlbWKXjo09UTXx9PNWXqa+3i7j7SrY2u3tjDl6Rq7mrk7D+ze5O3Fk/Ifum+r33353B3Hbqejt7GTQ7cz5svb/a1MNcmLBrU3syb2rpmVpujSeLNVFM6FsD2S2dGTPWM11YUTr2SfMvaw5nW+lt2RhWLbqu0dHbto/Xmg3p/X3T6r/hNHl3ewNCy3/r7Qrb/l9LTezemut3aszZy2Zns2ZOYmydctkVz2Qtmx8lj2LF81h3synNOFtCvb2aVh69oWrsuhp9UdDV6+6LF3O0n3S4zdzWstvrrubnU+c2s/MbHms9JMmKS+AtgHhHiPbPbPbPaYsJXAY8J7a9teRitBiywY85Tbsiu/dH9hYtvWZk2rMyZzJkdjLaSykyULULYx4x4z2z2z2xYyuMrRIrU5PSUsVuVyMWZoWc+Qx7BbM2WuXuXtPC9ZLUHUdUch7Z7ZyCqKpWpSpyqBOBXgWQWU909090eUeQdp4tFqSPGPGe2ch7Z7YsYsZXGKseHzPM9R6j1Hmefh8hweg9BFD0Hpn0i5Ty4//9oACAECAgY/AOpMKiQuOPbx5kNQI3DZH//aAAgBAwIGPwDQxsz/2gAIAQEBBj8AWSMqGhZZlkWX6Fl+hZFkWLZmhoi+GhoXRoaGhdGmKzR7jNly6Fnh9y5cuXLly5cuXLl2XLnuLly5cuXLsSTIpVdSP9fjTn1apM+R8HcpSvtZKPI489vp70xp1VBqrNTXC/YsyxZljNPHN4M1wj4nD4kNtzW5NKWXicPe3+DGUpQi23EcV/z9uvT/AKo5nJ43CjCUIykmo+By+JuR6XtTkqfUbxolVlWjNFhfiKsT2o9qH+I2kP8AEyRVJnTQk4wao8iko0pqepHzOG+RR0lGlfM4fxqNfjj6DyVKHP64wr8cvQ/6i2KdPySt5jwSjHJ6kZSj9TOI6IWQshURbCw8h5CVClB7nSsml+tSVI1rUlKMMvIkpRdEyPgzg8n5OiCnHqf1OFDc5kE+iKacvAe4uXt16a+5HO2NnlxlKUJJJSOby5S6vk3JNP6joq1I0i2m7EZS2/2KKKVCVBiYsPTDxGh4IllqvRlGzpkk6k57cK+Q6bbv3EJRjJOLujbjs7+4oxpRVeh8X9jcq40uzc/s725KMq5OpKUoybbuLq23myE9yFKZuqOmKSoMl44VEXL4XRfFDXivuPwYszp3EnUTcF+Qm4IVIxRSi8h1jEb6EVUI1R07eVB5jVRj78bly5c1eKJeaX7Mb72xCaYqsX55nuPcNKVx/lcefkNt54VLfQthWhY9p7T2lixYQ1TVffFCoxZnuZ7mUq2XL9uxbGxbtoyeFy5fDNlz1wrp/j9Cmvf49i5cuX7dTI/nIt2bYfc763fayNTU17f8GbNC5cuXwyp2P//Z",self.location).toString()},(()=>e()))}))},f=new WeakSet,m=function(){if(!this.pane)return;const t=this.pane.addFolder({title:"Simulation"});t.addInput(this.simulationParams,"MASS",{min:.01,max:5}),t.addInput(this.simulationParams,"REST_DENS",{min:.1,max:5}),t.addInput(this.simulationParams,"GAS_CONST",{min:10,max:500}),t.addInput(this.simulationParams,"VISC",{min:1,max:20}),t.addInput(this.simulationParams,"STEPS",{min:0,max:6,step:1});const e=this.pane.addFolder({title:"Pointer"});e.addInput(this.pointerParams,"RADIUS",{min:.1,max:5}),e.addInput(this.pointerParams,"STRENGTH",{min:1,max:35}),t.on("change",(()=>z(this,l,c).call(this))),e.on("change",(()=>this.pointerParamsNeedUpdate=!0))},v=new WeakSet,_=function(){me(this.light.matrix,this.light.position,[0,0,0],this.light.up),he(this.light.matrices.view,this.light.matrix),fe(this.light.matrices.projection,-this.light.size/2,this.light.size/2,-this.light.size/2,this.light.size/2,this.light.near,this.light.far),pe(this.light.matrices.viewProjection,this.light.matrices.projection,this.light.matrices.view)},g=new WeakSet,b=function(){this.pointerLerp[0]+=(this.pointer[0]-this.pointerLerp[0])/5,this.pointerLerp[1]+=(this.pointer[1]-this.pointerLerp[1])/5;let t=null;var e,n,i;this.touchevents&&!this.isPointerDown||(t=z(this,M,O).call(this,this.pointerLerp)),null!==t?(this.arcPointer=t,this.leftSphere&&(ge(this.arcPointerPrev,this.arcPointer),this.leftSphere=!1)):this.leftSphere=!0,this.arcPointerDelta=be(this.arcPointerDelta,this.arcPointer,this.arcPointerPrev),ge(this.arcPointerPrev,this.arcPointer),e=this.pointerLerpDelta,n=this.pointerLerp,i=this.pointerLerpPrev,e[0]=n[0]-i[0],e[1]=n[1]-i[1],Ee(this.pointerLerpPrev,this.pointerLerp)},y=new WeakSet,w=function(e){const n=this.gl;this.simulationParamsNeedUpdate?(pi(this.simulationParamsUBO,{...this.simulationParams}),hi(n,this.pressurePrg,this.simulationParamsUBO),this.simulationParamsNeedUpdate=!1):ui(n,this.pressurePrg,this.simulationParamsUBO),n.useProgram(this.pressurePrg.program),Ti(n,this.pressureFBO),n.bindVertexArray(this.quadVAO),fi(this.pressurePrg,{u_positionTexture:this.inFBO.attachments[0]}),gi(n,this.quadBufferInfo),n.useProgram(this.forcePrg.program),Ti(n,this.forceFBO),fi(this.forcePrg,{u_densityPressureTexture:this.pressureFBO.attachments[0],u_positionTexture:this.inFBO.attachments[0],u_velocityTexture:this.inFBO.attachments[1]}),gi(n,this.quadBufferInfo),n.useProgram(this.integratePrg.program),Ti(n,this.outFBO),n.clear(n.COLOR_BUFFER_BIT|n.DEPTH_BUFFER_BIT),fi(this.integratePrg,{u_positionTexture:this.inFBO.attachments[0],u_velocityTexture:this.inFBO.attachments[1],u_forceTexture:this.forceFBO.attachments[0],u_densityPressureTexture:this.pressureFBO.attachments[0],u_dt:e,u_time:L(this,t),u_domainScale:this.simulationParams.DOMAIN_SCALE}),pi(this.pointerParamsUBO,{pointerRadius:this.pointerParams.RADIUS,pointerStrength:this.pointerParams.STRENGTH,pointerPos:this.arcPointer,pointerVelocity:this.arcPointerDelta}),hi(n,this.integratePrg,this.pointerParamsUBO),gi(n,this.quadBufferInfo),this.currentPositionTexture=this.outFBO.attachments[0],this.currentVelocityTexture=this.outFBO.attachments[1];const i=this.inFBO;this.inFBO=this.outFBO,this.outFBO=i},x=new WeakSet,C=function(t){const e=this.gl;z(this,g,b).call(this),t=16*L(this,i),z(this,y,w).call(this,t),Pe(this.pointerLerpDelta,0,0);for(let n=0;n<this.simulationParams.STEPS;++n)z(this,y,w).call(this,t);this.audioRepeater.getSpectrum(),On(e,this.spectrumTexture,this.audioRepeater.smoothedBuffer2,{width:this.spectrumTextureSize,height:this.spectrumTextureSize,format:e.RED,internalFormat:e.R32F,type:e.FLOAT,minMag:e.LINEAR})},T=new WeakSet,A=function(){const e=this.gl;Ti(e,this.lightDepthFBO),e.enable(e.CULL_FACE),e.enable(e.DEPTH_TEST),this.gl.clearColor(0,0,0,1),this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT),this.gl.useProgram(this.lightDepthPrg.program),fi(this.lightDepthPrg,{u_worldMatrix:this.worldMatrix,u_viewMatrix:this.light.matrices.view,u_projectionMatrix:this.light.matrices.projection,u_positionTexture:this.currentPositionTexture,u_velocityTexture:this.currentVelocityTexture,u_spectrumTexture:this.spectrumTexture,u_time:L(this,t)}),e.bindVertexArray(this.beadVAO),e.drawElementsInstanced(e.TRIANGLES,this.beadBufferInfo.numElements,e.UNSIGNED_SHORT,0,this.NUM_PARTICLES),Ti(e,this.drawFBO),e.enable(e.CULL_FACE),e.enable(e.DEPTH_TEST),e.clearColor(0,0,0,1),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),e.useProgram(this.beadPrg.program),fi(this.beadPrg,{u_worldMatrix:this.worldMatrix,u_viewMatrix:this.camera.matrices.view,u_projectionMatrix:this.camera.matrices.projection,u_positionTexture:this.currentPositionTexture,u_velocityTexture:this.currentVelocityTexture,u_spectrumTexture:this.spectrumTexture,u_envMapTexture:this.envMapTexture,u_time:L(this,t),u_lightDepthTexture:this.lightDepthTexture,u_lightViewProjectionMatrix:this.light.matrices.viewProjection,u_cameraPosition:this.camera.position}),e.bindVertexArray(this.beadVAO),e.drawElementsInstanced(e.TRIANGLES,this.beadBufferInfo.numElements,e.UNSIGNED_SHORT,0,this.NUM_PARTICLES),Ti(e,null),e.viewport(0,0,this.viewportSize[0],this.viewportSize[1]),e.bindVertexArray(this.quadVAO),e.useProgram(this.compositePrg.program),fi(this.compositePrg,{u_colorTexture:this.colorTexture}),gi(e,this.quadBufferInfo),this.isDev},S=new WeakSet,k=function(){me(this.camera.matrix,this.camera.position,[0,0,0],this.camera.up),he(this.camera.matrices.view,this.camera.matrix)},E=new WeakSet,P=function(t){this.camera.aspect=t.canvas.clientWidth/t.canvas.clientHeight;const e=this.camera.position[2];this.camera.aspect>1?this.camera.fov=2*Math.atan(1.3/e):this.camera.fov=2*Math.atan(1.3/this.camera.aspect/e),de(this.camera.matrices.projection,this.camera.fov,this.camera.aspect,this.camera.near,this.camera.far),he(this.camera.matrices.inversProjection,this.camera.matrices.projection),pe(this.camera.matrices.inversViewProjection,this.camera.matrix,this.camera.matrices.inversProjection)},M=new WeakSet,O=function(t){const e=t[0]/this.viewportSize[0]*2-1,n=2*(1-t[1]/this.viewportSize[1])-1,i=z(this,D,I).call(this,e,n,0),s=be(ve(),i,this.camera.position);we(s,s);const r=xe(i,i)-1.1025,o=2*xe(s,i),a=o*o-4*r;if(a<0)return null;{const t=Math.sqrt(a),e=(-o+t)/2,n=(-o-t)/2;ye(s,s,Math.min(e,n));const r=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t}(ve(),i,s);return r}},D=new WeakSet,I=function(t,e,n){const i=_e(t,e,n),s=function(t,e,n){var i=e[0],s=e[1],r=e[2],o=e[3];return t[0]=n[0]*i+n[4]*s+n[8]*r+n[12]*o,t[1]=n[1]*i+n[5]*s+n[9]*r+n[13]*o,t[2]=n[2]*i+n[6]*s+n[10]*r+n[14]*o,t[3]=n[3]*i+n[7]*s+n[11]*r+n[15]*o,t}(Ce(),Te(i[0],i[1],i[2],1),this.camera.matrices.inversViewProjection);var r,o,a;return 0!==s[3]&&(r=s,o=s,a=1/s[3],r[0]=o[0]*a,r[1]=o[1]*a,r[2]=o[2]*a,r[3]=o[3]*a),s};"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;var xr={exports:{}};!function(t){class e{constructor(t){const[e,n]=t.split("-"),i=e.split(".");this.major=parseInt(i[0],10),this.minor=parseInt(i[1],10),this.patch=parseInt(i[2],10),this.prerelease=null!=n?n:null}toString(){const t=[this.major,this.minor,this.patch].join(".");return null!==this.prerelease?[t,this.prerelease].join("-"):t}}class n{constructor(t){this.controller_=t}get element(){return this.controller_.view.element}get disabled(){return this.controller_.viewProps.get("disabled")}set disabled(t){this.controller_.viewProps.set("disabled",t)}get hidden(){return this.controller_.viewProps.get("hidden")}set hidden(t){this.controller_.viewProps.set("hidden",t)}dispose(){this.controller_.viewProps.set("disposed",!0)}}class i{constructor(t){this.target=t}}class s extends i{constructor(t,e,n,i){super(t),this.value=e,this.presetKey=n,this.last=null==i||i}}class r extends i{constructor(t,e,n){super(t),this.value=e,this.presetKey=n}}class o extends i{constructor(t,e){super(t),this.expanded=e}}class a extends i{constructor(t,e){super(t),this.index=e}}function l(t){return t}function c(t){return null==t}function u(t,e){if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}const h={alreadydisposed:()=>"View has been already disposed",invalidparams:t=>`Invalid parameters for '${t.name}'`,nomatchingcontroller:t=>`No matching controller for '${t.key}'`,nomatchingview:t=>`No matching view for '${JSON.stringify(t.params)}'`,notbindable:()=>"Value is not bindable",propertynotfound:t=>`Property '${t.name}' not found`,shouldneverhappen:()=>"This error should never happen"};class p{constructor(t){var e;this.message=null!==(e=h[t.type](l(t.context)))&&void 0!==e?e:"Unexpected error",this.name=this.constructor.name,this.stack=new Error(this.message).stack,this.type=t.type}static alreadyDisposed(){return new p({type:"alreadydisposed"})}static notBindable(){return new p({type:"notbindable"})}static propertyNotFound(t){return new p({type:"propertynotfound",context:{name:t}})}static shouldNeverHappen(){return new p({type:"shouldneverhappen"})}}class d{constructor(t,e,n){this.obj_=t,this.key_=e,this.presetKey_=null!=n?n:e}static isBindable(t){return null!==t&&"object"==typeof t}get key(){return this.key_}get presetKey(){return this.presetKey_}read(){return this.obj_[this.key_]}write(t){this.obj_[this.key_]=t}writeProperty(t,e){const n=this.read();if(!d.isBindable(n))throw p.notBindable();if(!(t in n))throw p.propertyNotFound(t);n[t]=e}}class f extends n{get label(){return this.controller_.props.get("label")}set label(t){this.controller_.props.set("label",t)}get title(){var t;return null!==(t=this.controller_.valueController.props.get("title"))&&void 0!==t?t:""}set title(t){this.controller_.valueController.props.set("title",t)}on(t,e){const n=e.bind(this);return this.controller_.valueController.emitter.on(t,(()=>{n(new i(this))})),this}}class m{constructor(){this.observers_={}}on(t,e){let n=this.observers_[t];return n||(n=this.observers_[t]=[]),n.push({handler:e}),this}off(t,e){const n=this.observers_[t];return n&&(this.observers_[t]=n.filter((t=>t.handler!==e))),this}emit(t,e){const n=this.observers_[t];n&&n.forEach((t=>{t.handler(e)}))}}const v="tp";function _(t){return(e,n)=>[v,"-",t,"v",e?`_${e}`:"",n?`-${n}`:""].join("")}function g(t,e){return n=>e(t(n))}function b(t){return t.rawValue}function y(t,e){t.emitter.on("change",g(b,e)),e(t.rawValue)}function w(t,e,n){y(t.value(e),n)}function x(t,e,n){n?t.classList.add(e):t.classList.remove(e)}function C(t,e){return n=>{x(t,e,n)}}function T(t,e){y(t,(t=>{e.textContent=null!=t?t:""}))}const A=_("btn");class S{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(A()),e.viewProps.bindClassModifiers(this.element);const n=t.createElement("button");n.classList.add(A("b")),e.viewProps.bindDisabled(n),this.element.appendChild(n),this.buttonElement=n;const i=t.createElement("div");i.classList.add(A("t")),T(e.props.value("title"),i),this.buttonElement.appendChild(i)}}class k{constructor(t,e){this.emitter=new m,this.onClick_=this.onClick_.bind(this),this.props=e.props,this.viewProps=e.viewProps,this.view=new S(t,{props:this.props,viewProps:this.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}onClick_(){this.emitter.emit("click",{sender:this})}}class E{constructor(t,e){var n;this.constraint_=null==e?void 0:e.constraint,this.equals_=null!==(n=null==e?void 0:e.equals)&&void 0!==n?n:(t,e)=>t===e,this.emitter=new m,this.rawValue_=t}get constraint(){return this.constraint_}get rawValue(){return this.rawValue_}set rawValue(t){this.setRawValue(t,{forceEmit:!1,last:!0})}setRawValue(t,e){const n=null!=e?e:{forceEmit:!1,last:!0},i=this.constraint_?this.constraint_.constrain(t):t;(!this.equals_(this.rawValue_,i)||n.forceEmit)&&(this.emitter.emit("beforechange",{sender:this}),this.rawValue_=i,this.emitter.emit("change",{options:n,rawValue:i,sender:this}))}}class P{constructor(t){this.emitter=new m,this.value_=t}get rawValue(){return this.value_}set rawValue(t){this.setRawValue(t,{forceEmit:!1,last:!0})}setRawValue(t,e){const n=null!=e?e:{forceEmit:!1,last:!0};(this.value_!==t||n.forceEmit)&&(this.emitter.emit("beforechange",{sender:this}),this.value_=t,this.emitter.emit("change",{options:n,rawValue:this.value_,sender:this}))}}function M(t,e){const n=null==e?void 0:e.constraint,i=null==e?void 0:e.equals;return n||i?new E(t,e):new P(t)}class O{constructor(t){this.emitter=new m,this.valMap_=t;for(const e in this.valMap_)this.valMap_[e].emitter.on("change",(()=>{this.emitter.emit("change",{key:e,sender:this})}))}static createCore(t){return Object.keys(t).reduce(((e,n)=>Object.assign(e,{[n]:M(t[n])})),{})}static fromObject(t){const e=this.createCore(t);return new O(e)}get(t){return this.valMap_[t].rawValue}set(t,e){this.valMap_[t].rawValue=e}value(t){return this.valMap_[t]}}function D(t,e){return l(Object.keys(e).reduce(((n,i)=>{if(void 0===n)return;const s=(0,e[i])(t[i]);return s.succeeded?Object.assign(Object.assign({},n),{[i]:s.value}):void 0}),{}))}function I(t,e){return t.reduce(((t,n)=>{if(void 0===t)return;const i=e(n);return i.succeeded&&void 0!==i.value?[...t,i.value]:void 0}),[])}function V(t){return null!==t&&"object"==typeof t}function R(t){return e=>n=>{if(!e&&void 0===n)return{succeeded:!1,value:void 0};if(e&&void 0===n)return{succeeded:!0,value:void 0};const i=t(n);return void 0!==i?{succeeded:!0,value:i}:{succeeded:!1,value:void 0}}}function F(t){return{custom:e=>R(e)(t),boolean:R((t=>"boolean"==typeof t?t:void 0))(t),number:R((t=>"number"==typeof t?t:void 0))(t),string:R((t=>"string"==typeof t?t:void 0))(t),function:R((t=>"function"==typeof t?t:void 0))(t),constant:e=>R((t=>t===e?e:void 0))(t),raw:R((t=>t))(t),object:e=>R((t=>{if(V(t))return D(t,e)}))(t),array:e=>R((t=>{if(Array.isArray(t))return I(t,e)}))(t)}}const L={optional:F(!0),required:F(!1)};function N(t,e){const n=L.required.object(e)(t);return n.succeeded?n.value:void 0}function B(t){return t&&t.parentElement&&t.parentElement.removeChild(t),null}function z(){return["veryfirst","first","last","verylast"]}const j=_(""),U={veryfirst:"vfst",first:"fst",last:"lst",verylast:"vlst"};class q{constructor(t){this.parent_=null,this.blade=t.blade,this.view=t.view,this.viewProps=t.viewProps;const e=this.view.element;this.blade.value("positions").emitter.on("change",(()=>{z().forEach((t=>{e.classList.remove(j(void 0,U[t]))})),this.blade.get("positions").forEach((t=>{e.classList.add(j(void 0,U[t]))}))})),this.viewProps.handleDispose((()=>{B(e)}))}get parent(){return this.parent_}}const W="http://www.w3.org/2000/svg";function H(t){t.offsetHeight}function G(t,e){const n=t.style.transition;t.style.transition="none",e(),t.style.transition=n}function K(t){return void 0!==t.ontouchstart}function Y(){return new Function("return this")()}function X(){return l(Y()).document}function $(t){const e=t.ownerDocument.defaultView;return e&&"document"in e?t.getContext("2d"):null}const Z={check:'<path d="M2 8l4 4l8 -8"/>',dropdown:'<path d="M5 7h6l-3 3 z"/>',p2dpad:'<path d="M8 4v8"/><path d="M4 8h8"/><circle cx="12" cy="12" r="1.2"/>'};function Q(t,e){const n=t.createElementNS(W,"svg");return n.innerHTML=Z[e],n}function J(t,e,n){t.insertBefore(e,t.children[n])}function tt(t){t.parentElement&&t.parentElement.removeChild(t)}function et(t){for(;t.children.length>0;)t.removeChild(t.children[0])}function nt(t){for(;t.childNodes.length>0;)t.removeChild(t.childNodes[0])}function it(t){return t.relatedTarget?l(t.relatedTarget):"explicitOriginalTarget"in t?t.explicitOriginalTarget:null}const st=_("lbl");function rt(t,e){const n=t.createDocumentFragment();return e.split("\n").map((e=>t.createTextNode(e))).forEach(((e,i)=>{i>0&&n.appendChild(t.createElement("br")),n.appendChild(e)})),n}class ot{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(st()),e.viewProps.bindClassModifiers(this.element);const n=t.createElement("div");n.classList.add(st("l")),w(e.props,"label",(e=>{c(e)?this.element.classList.add(st(void 0,"nol")):(this.element.classList.remove(st(void 0,"nol")),nt(n),n.appendChild(rt(t,e)))})),this.element.appendChild(n),this.labelElement=n;const i=t.createElement("div");i.classList.add(st("v")),this.element.appendChild(i),this.valueElement=i}}class at extends q{constructor(t,e){const n=e.valueController.viewProps;super(Object.assign(Object.assign({},e),{view:new ot(t,{props:e.props,viewProps:n}),viewProps:n})),this.props=e.props,this.valueController=e.valueController,this.view.valueElement.appendChild(this.valueController.view.element)}}const lt={id:"button",type:"blade",accept(t){const e=L,n=N(t,{title:e.required.string,view:e.required.constant("button"),label:e.optional.string});return n?{params:n}:null},controller:t=>new at(t.document,{blade:t.blade,props:O.fromObject({label:t.params.label}),valueController:new k(t.document,{props:O.fromObject({title:t.params.title}),viewProps:t.viewProps})}),api:t=>t.controller instanceof at&&t.controller.valueController instanceof k?new f(t.controller):null};class ct extends q{constructor(t){super(t),this.value=t.value}}function ut(){return new O({positions:M([],{equals:u})})}class ht extends O{constructor(t){super(t)}static create(t){const e={completed:!0,expanded:t,expandedHeight:null,shouldFixHeight:!1,temporaryExpanded:null},n=O.createCore(e);return new ht(n)}get styleExpanded(){var t;return null!==(t=this.get("temporaryExpanded"))&&void 0!==t?t:this.get("expanded")}get styleHeight(){if(!this.styleExpanded)return"0";const t=this.get("expandedHeight");return this.get("shouldFixHeight")&&!c(t)?`${t}px`:"auto"}bindExpandedClass(t,e){const n=()=>{this.styleExpanded?t.classList.add(e):t.classList.remove(e)};w(this,"expanded",n),w(this,"temporaryExpanded",n)}cleanUpTransition(){this.set("shouldFixHeight",!1),this.set("expandedHeight",null),this.set("completed",!0)}}function pt(t,e){let n=0;return G(e,(()=>{t.set("expandedHeight",null),t.set("temporaryExpanded",!0),H(e),n=e.clientHeight,t.set("temporaryExpanded",null),H(e)})),n}function dt(t,e){e.style.height=t.styleHeight}function ft(t,e){t.value("expanded").emitter.on("beforechange",(()=>{t.set("completed",!1),c(t.get("expandedHeight"))&&t.set("expandedHeight",pt(t,e)),t.set("shouldFixHeight",!0),H(e)})),t.emitter.on("change",(()=>{dt(t,e)})),dt(t,e),e.addEventListener("transitionend",(e=>{"height"===e.propertyName&&t.cleanUpTransition()}))}class mt extends n{constructor(t,e){super(t),this.rackApi_=e}}function vt(t,e){return t.addBlade(Object.assign(Object.assign({},e),{view:"button"}))}function _t(t,e){return t.addBlade(Object.assign(Object.assign({},e),{view:"folder"}))}function gt(t,e){const n=null!=e?e:{};return t.addBlade(Object.assign(Object.assign({},n),{view:"separator"}))}function bt(t,e){return t.addBlade(Object.assign(Object.assign({},e),{view:"tab"}))}class yt{constructor(t){this.emitter=new m,this.items_=[],this.cache_=new Set,this.onSubListAdd_=this.onSubListAdd_.bind(this),this.onSubListRemove_=this.onSubListRemove_.bind(this),this.extract_=t}get items(){return this.items_}allItems(){return Array.from(this.cache_)}find(t){for(const e of this.allItems())if(t(e))return e;return null}includes(t){return this.cache_.has(t)}add(t,e){if(this.includes(t))throw p.shouldNeverHappen();const n=void 0!==e?e:this.items_.length;this.items_.splice(n,0,t),this.cache_.add(t);const i=this.extract_(t);i&&(i.emitter.on("add",this.onSubListAdd_),i.emitter.on("remove",this.onSubListRemove_),i.allItems().forEach((t=>{this.cache_.add(t)}))),this.emitter.emit("add",{index:n,item:t,root:this,target:this})}remove(t){const e=this.items_.indexOf(t);if(e<0)return;this.items_.splice(e,1),this.cache_.delete(t);const n=this.extract_(t);n&&(n.emitter.off("add",this.onSubListAdd_),n.emitter.off("remove",this.onSubListRemove_)),this.emitter.emit("remove",{index:e,item:t,root:this,target:this})}onSubListAdd_(t){this.cache_.add(t.item),this.emitter.emit("add",{index:t.index,item:t.item,root:this,target:t.target})}onSubListRemove_(t){this.cache_.delete(t.item),this.emitter.emit("remove",{index:t.index,item:t.item,root:this,target:t.target})}}class wt extends n{constructor(t){super(t),this.onBindingChange_=this.onBindingChange_.bind(this),this.emitter_=new m,this.controller_.binding.emitter.on("change",this.onBindingChange_)}get label(){return this.controller_.props.get("label")}set label(t){this.controller_.props.set("label",t)}on(t,e){const n=e.bind(this);return this.emitter_.on(t,(t=>{n(t.event)})),this}refresh(){this.controller_.binding.read()}onBindingChange_(t){const e=t.sender.target.read();this.emitter_.emit("change",{event:new s(this,l(e),this.controller_.binding.target.presetKey,t.options.last)})}}class xt extends at{constructor(t,e){super(t,e),this.binding=e.binding}}class Ct extends n{constructor(t){super(t),this.onBindingUpdate_=this.onBindingUpdate_.bind(this),this.emitter_=new m,this.controller_.binding.emitter.on("update",this.onBindingUpdate_)}get label(){return this.controller_.props.get("label")}set label(t){this.controller_.props.set("label",t)}on(t,e){const n=e.bind(this);return this.emitter_.on(t,(t=>{n(t.event)})),this}refresh(){this.controller_.binding.read()}onBindingUpdate_(t){const e=t.sender.target.read();this.emitter_.emit("update",{event:new r(this,l(e),this.controller_.binding.target.presetKey)})}}class Tt extends at{constructor(t,e){super(t,e),this.binding=e.binding,this.viewProps.bindDisabled(this.binding.ticker),this.viewProps.handleDispose((()=>{this.binding.dispose()}))}}function At(t){return t instanceof Et?t.apiSet_:t instanceof mt?t.rackApi_.apiSet_:null}function St(t,e){const n=t.find((t=>t.controller_===e));if(!n)throw p.shouldNeverHappen();return n}function kt(t,e,n){if(!d.isBindable(t))throw p.notBindable();return new d(t,e,n)}class Et extends n{constructor(t,e){super(t),this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this),this.onRackInputChange_=this.onRackInputChange_.bind(this),this.onRackMonitorUpdate_=this.onRackMonitorUpdate_.bind(this),this.emitter_=new m,this.apiSet_=new yt(At),this.pool_=e;const n=this.controller_.rack;n.emitter.on("add",this.onRackAdd_),n.emitter.on("remove",this.onRackRemove_),n.emitter.on("inputchange",this.onRackInputChange_),n.emitter.on("monitorupdate",this.onRackMonitorUpdate_),n.children.forEach((t=>{this.setUpApi_(t)}))}get children(){return this.controller_.rack.children.map((t=>St(this.apiSet_,t)))}addInput(t,e,n){const i=null!=n?n:{},s=this.controller_.view.element.ownerDocument,r=this.pool_.createInput(s,kt(t,e,i.presetKey),i),o=new wt(r);return this.add(o,i.index)}addMonitor(t,e,n){const i=null!=n?n:{},s=this.controller_.view.element.ownerDocument,r=this.pool_.createMonitor(s,kt(t,e),i),o=new Ct(r);return l(this.add(o,i.index))}addFolder(t){return _t(this,t)}addButton(t){return vt(this,t)}addSeparator(t){return gt(this,t)}addTab(t){return bt(this,t)}add(t,e){this.controller_.rack.add(t.controller_,e);const n=this.apiSet_.find((e=>e.controller_===t.controller_));return n&&this.apiSet_.remove(n),this.apiSet_.add(t),t}remove(t){this.controller_.rack.remove(t.controller_)}addBlade(t){const e=this.controller_.view.element.ownerDocument,n=this.pool_.createBlade(e,t),i=this.pool_.createBladeApi(n);return this.add(i,t.index)}on(t,e){const n=e.bind(this);return this.emitter_.on(t,(t=>{n(t.event)})),this}setUpApi_(t){this.apiSet_.find((e=>e.controller_===t))||this.apiSet_.add(this.pool_.createBladeApi(t))}onRackAdd_(t){this.setUpApi_(t.bladeController)}onRackRemove_(t){if(t.isRoot){const e=St(this.apiSet_,t.bladeController);this.apiSet_.remove(e)}}onRackInputChange_(t){const e=t.bladeController;if(e instanceof xt){const n=St(this.apiSet_,e),i=e.binding;this.emitter_.emit("change",{event:new s(n,l(i.target.read()),i.target.presetKey,t.options.last)})}else if(e instanceof ct){const n=St(this.apiSet_,e);this.emitter_.emit("change",{event:new s(n,e.value.rawValue,void 0,t.options.last)})}}onRackMonitorUpdate_(t){if(!(t.bladeController instanceof Tt))throw p.shouldNeverHappen();const e=St(this.apiSet_,t.bladeController),n=t.bladeController.binding;this.emitter_.emit("update",{event:new r(e,l(n.target.read()),n.target.presetKey)})}}class Pt extends mt{constructor(t,e){super(t,new Et(t.rackController,e)),this.emitter_=new m,this.controller_.foldable.value("expanded").emitter.on("change",(t=>{this.emitter_.emit("fold",{event:new o(this,t.sender.rawValue)})})),this.rackApi_.on("change",(t=>{this.emitter_.emit("change",{event:t})})),this.rackApi_.on("update",(t=>{this.emitter_.emit("update",{event:t})}))}get expanded(){return this.controller_.foldable.get("expanded")}set expanded(t){this.controller_.foldable.set("expanded",t)}get title(){return this.controller_.props.get("title")}set title(t){this.controller_.props.set("title",t)}get children(){return this.rackApi_.children}addInput(t,e,n){return this.rackApi_.addInput(t,e,n)}addMonitor(t,e,n){return this.rackApi_.addMonitor(t,e,n)}addFolder(t){return this.rackApi_.addFolder(t)}addButton(t){return this.rackApi_.addButton(t)}addSeparator(t){return this.rackApi_.addSeparator(t)}addTab(t){return this.rackApi_.addTab(t)}add(t,e){return this.rackApi_.add(t,e)}remove(t){this.rackApi_.remove(t)}addBlade(t){return this.rackApi_.addBlade(t)}on(t,e){const n=e.bind(this);return this.emitter_.on(t,(t=>{n(t.event)})),this}}class Mt extends q{constructor(t){super({blade:t.blade,view:t.view,viewProps:t.rackController.viewProps}),this.rackController=t.rackController}}class Ot{constructor(t,e){const n=_(e.viewName);this.element=t.createElement("div"),this.element.classList.add(n()),e.viewProps.bindClassModifiers(this.element)}}function Dt(t,e){for(let n=0;n<t.length;n++){const i=t[n];if(i instanceof xt&&i.binding===e)return i}return null}function It(t,e){for(let n=0;n<t.length;n++){const i=t[n];if(i instanceof Tt&&i.binding===e)return i}return null}function Vt(t,e){for(let n=0;n<t.length;n++){const i=t[n];if(i instanceof ct&&i.value===e)return i}return null}function Rt(t){return t instanceof Nt?t.rack:t instanceof Mt?t.rackController.rack:null}function Ft(t){const e=Rt(t);return e?e.bcSet_:null}class Lt{constructor(t){var e;this.onBladePositionsChange_=this.onBladePositionsChange_.bind(this),this.onSetAdd_=this.onSetAdd_.bind(this),this.onSetRemove_=this.onSetRemove_.bind(this),this.onChildDispose_=this.onChildDispose_.bind(this),this.onChildPositionsChange_=this.onChildPositionsChange_.bind(this),this.onChildInputChange_=this.onChildInputChange_.bind(this),this.onChildMonitorUpdate_=this.onChildMonitorUpdate_.bind(this),this.onChildValueChange_=this.onChildValueChange_.bind(this),this.onChildViewPropsChange_=this.onChildViewPropsChange_.bind(this),this.onDescendantLayout_=this.onDescendantLayout_.bind(this),this.onDescendantInputChange_=this.onDescendantInputChange_.bind(this),this.onDescendantMonitorUpdate_=this.onDescendantMonitorUpdate_.bind(this),this.emitter=new m,this.blade_=null!=t?t:null,null===(e=this.blade_)||void 0===e||e.value("positions").emitter.on("change",this.onBladePositionsChange_),this.bcSet_=new yt(Ft),this.bcSet_.emitter.on("add",this.onSetAdd_),this.bcSet_.emitter.on("remove",this.onSetRemove_)}get children(){return this.bcSet_.items}add(t,e){t.parent&&t.parent.remove(t),t.parent_=this,this.bcSet_.add(t,e)}remove(t){t.parent_=null,this.bcSet_.remove(t)}find(t){return l(this.bcSet_.allItems().filter((e=>e instanceof t)))}onSetAdd_(t){this.updatePositions_();const e=t.target===t.root;if(this.emitter.emit("add",{bladeController:t.item,index:t.index,isRoot:e,sender:this}),!e)return;const n=t.item;if(n.viewProps.emitter.on("change",this.onChildViewPropsChange_),n.blade.value("positions").emitter.on("change",this.onChildPositionsChange_),n.viewProps.handleDispose(this.onChildDispose_),n instanceof xt)n.binding.emitter.on("change",this.onChildInputChange_);else if(n instanceof Tt)n.binding.emitter.on("update",this.onChildMonitorUpdate_);else if(n instanceof ct)n.value.emitter.on("change",this.onChildValueChange_);else{const t=Rt(n);if(t){const e=t.emitter;e.on("layout",this.onDescendantLayout_),e.on("inputchange",this.onDescendantInputChange_),e.on("monitorupdate",this.onDescendantMonitorUpdate_)}}}onSetRemove_(t){this.updatePositions_();const e=t.target===t.root;if(this.emitter.emit("remove",{bladeController:t.item,isRoot:e,sender:this}),!e)return;const n=t.item;if(n instanceof xt)n.binding.emitter.off("change",this.onChildInputChange_);else if(n instanceof Tt)n.binding.emitter.off("update",this.onChildMonitorUpdate_);else if(n instanceof ct)n.value.emitter.off("change",this.onChildValueChange_);else{const t=Rt(n);if(t){const e=t.emitter;e.off("layout",this.onDescendantLayout_),e.off("inputchange",this.onDescendantInputChange_),e.off("monitorupdate",this.onDescendantMonitorUpdate_)}}}updatePositions_(){const t=this.bcSet_.items.filter((t=>!t.viewProps.get("hidden"))),e=t[0],n=t[t.length-1];this.bcSet_.items.forEach((t=>{const i=[];t===e&&(i.push("first"),this.blade_&&!this.blade_.get("positions").includes("veryfirst")||i.push("veryfirst")),t===n&&(i.push("last"),this.blade_&&!this.blade_.get("positions").includes("verylast")||i.push("verylast")),t.blade.set("positions",i)}))}onChildPositionsChange_(){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildViewPropsChange_(t){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildDispose_(){this.bcSet_.items.filter((t=>t.viewProps.get("disposed"))).forEach((t=>{this.bcSet_.remove(t)}))}onChildInputChange_(t){const e=Dt(this.find(xt),t.sender);if(!e)throw p.shouldNeverHappen();this.emitter.emit("inputchange",{bladeController:e,options:t.options,sender:this})}onChildMonitorUpdate_(t){const e=It(this.find(Tt),t.sender);if(!e)throw p.shouldNeverHappen();this.emitter.emit("monitorupdate",{bladeController:e,sender:this})}onChildValueChange_(t){const e=Vt(this.find(ct),t.sender);if(!e)throw p.shouldNeverHappen();this.emitter.emit("inputchange",{bladeController:e,options:t.options,sender:this})}onDescendantLayout_(t){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onDescendantInputChange_(t){this.emitter.emit("inputchange",{bladeController:t.bladeController,options:t.options,sender:this})}onDescendantMonitorUpdate_(t){this.emitter.emit("monitorupdate",{bladeController:t.bladeController,sender:this})}onBladePositionsChange_(){this.updatePositions_()}}class Nt extends q{constructor(t,e){super(Object.assign(Object.assign({},e),{view:new Ot(t,{viewName:"brk",viewProps:e.viewProps})})),this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this);const n=new Lt(e.root?void 0:e.blade);n.emitter.on("add",this.onRackAdd_),n.emitter.on("remove",this.onRackRemove_),this.rack=n,this.viewProps.handleDispose((()=>{for(let t=this.rack.children.length-1;t>=0;t--)this.rack.children[t].viewProps.set("disposed",!0)}))}onRackAdd_(t){t.isRoot&&J(this.view.element,t.bladeController.view.element,t.index)}onRackRemove_(t){t.isRoot&&tt(t.bladeController.view.element)}}const Bt=_("cnt");class zt{constructor(t,e){var n;this.className_=_(null!==(n=e.viewName)&&void 0!==n?n:"fld"),this.element=t.createElement("div"),this.element.classList.add(this.className_(),Bt()),e.viewProps.bindClassModifiers(this.element),this.foldable_=e.foldable,this.foldable_.bindExpandedClass(this.element,this.className_(void 0,"expanded")),w(this.foldable_,"completed",C(this.element,this.className_(void 0,"cpl")));const i=t.createElement("button");i.classList.add(this.className_("b")),w(e.props,"title",(t=>{c(t)?this.element.classList.add(this.className_(void 0,"not")):this.element.classList.remove(this.className_(void 0,"not"))})),e.viewProps.bindDisabled(i),this.element.appendChild(i),this.buttonElement=i;const s=t.createElement("div");s.classList.add(this.className_("t")),T(e.props.value("title"),s),this.buttonElement.appendChild(s),this.titleElement=s;const r=t.createElement("div");r.classList.add(this.className_("m")),this.buttonElement.appendChild(r);const o=e.containerElement;o.classList.add(this.className_("c")),this.element.appendChild(o),this.containerElement=o}}class jt extends Mt{constructor(t,e){var n;const i=ht.create(null===(n=e.expanded)||void 0===n||n),s=new Nt(t,{blade:e.blade,root:e.root,viewProps:e.viewProps});super(Object.assign(Object.assign({},e),{rackController:s,view:new zt(t,{containerElement:s.view.element,foldable:i,props:e.props,viewName:e.root?"rot":void 0,viewProps:e.viewProps})})),this.onTitleClick_=this.onTitleClick_.bind(this),this.props=e.props,this.foldable=i,ft(this.foldable,this.view.containerElement),this.rackController.rack.emitter.on("add",(()=>{this.foldable.cleanUpTransition()})),this.rackController.rack.emitter.on("remove",(()=>{this.foldable.cleanUpTransition()})),this.view.buttonElement.addEventListener("click",this.onTitleClick_)}get document(){return this.view.element.ownerDocument}onTitleClick_(){this.foldable.set("expanded",!this.foldable.get("expanded"))}}const Ut={id:"folder",type:"blade",accept(t){const e=L,n=N(t,{title:e.required.string,view:e.required.constant("folder"),expanded:e.optional.boolean});return n?{params:n}:null},controller:t=>new jt(t.document,{blade:t.blade,expanded:t.params.expanded,props:O.fromObject({title:t.params.title}),viewProps:t.viewProps}),api:t=>t.controller instanceof jt?new Pt(t.controller,t.pool):null};class qt extends ct{constructor(t,e){const n=e.valueController.viewProps;super(Object.assign(Object.assign({},e),{value:e.valueController.value,view:new ot(t,{props:e.props,viewProps:n}),viewProps:n})),this.props=e.props,this.valueController=e.valueController,this.view.valueElement.appendChild(this.valueController.view.element)}}class Wt extends n{}const Ht=_("spr");class Gt{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(Ht()),e.viewProps.bindClassModifiers(this.element);const n=t.createElement("hr");n.classList.add(Ht("r")),this.element.appendChild(n)}}class Kt extends q{constructor(t,e){super(Object.assign(Object.assign({},e),{view:new Gt(t,{viewProps:e.viewProps})}))}}const Yt={id:"separator",type:"blade",accept(t){const e=N(t,{view:L.required.constant("separator")});return e?{params:e}:null},controller:t=>new Kt(t.document,{blade:t.blade,viewProps:t.viewProps}),api:t=>t.controller instanceof Kt?new Wt(t.controller):null},Xt=_("");function $t(t,e){return C(t,Xt(void 0,e))}class Zt extends O{constructor(t){super(t)}static create(t){var e,n;const i=null!=t?t:{},s={disabled:null!==(e=i.disabled)&&void 0!==e&&e,disposed:!1,hidden:null!==(n=i.hidden)&&void 0!==n&&n},r=O.createCore(s);return new Zt(r)}bindClassModifiers(t){w(this,"disabled",$t(t,"disabled")),w(this,"hidden",$t(t,"hidden"))}bindDisabled(t){w(this,"disabled",(e=>{t.disabled=e}))}bindTabIndex(t){w(this,"disabled",(e=>{t.tabIndex=e?-1:0}))}handleDispose(t){this.value("disposed").emitter.on("change",(e=>{e&&t()}))}}const Qt=_("tbi");class Jt{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(Qt()),e.viewProps.bindClassModifiers(this.element),w(e.props,"selected",(t=>{t?this.element.classList.add(Qt(void 0,"sel")):this.element.classList.remove(Qt(void 0,"sel"))}));const n=t.createElement("button");n.classList.add(Qt("b")),e.viewProps.bindDisabled(n),this.element.appendChild(n),this.buttonElement=n;const i=t.createElement("div");i.classList.add(Qt("t")),T(e.props.value("title"),i),this.buttonElement.appendChild(i),this.titleElement=i}}class te{constructor(t,e){this.emitter=new m,this.onClick_=this.onClick_.bind(this),this.props=e.props,this.viewProps=e.viewProps,this.view=new Jt(t,{props:e.props,viewProps:e.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}onClick_(){this.emitter.emit("click",{sender:this})}}class ee{constructor(t,e){this.onItemClick_=this.onItemClick_.bind(this),this.ic_=new te(t,{props:e.itemProps,viewProps:Zt.create()}),this.ic_.emitter.on("click",this.onItemClick_),this.cc_=new Nt(t,{blade:ut(),viewProps:Zt.create()}),this.props=e.props,w(this.props,"selected",(t=>{this.itemController.props.set("selected",t),this.contentController.viewProps.set("hidden",!t)}))}get itemController(){return this.ic_}get contentController(){return this.cc_}onItemClick_(){this.props.set("selected",!0)}}class ne{constructor(t,e){this.controller_=t,this.rackApi_=e}get title(){var t;return null!==(t=this.controller_.itemController.props.get("title"))&&void 0!==t?t:""}set title(t){this.controller_.itemController.props.set("title",t)}get selected(){return this.controller_.props.get("selected")}set selected(t){this.controller_.props.set("selected",t)}get children(){return this.rackApi_.children}addButton(t){return this.rackApi_.addButton(t)}addFolder(t){return this.rackApi_.addFolder(t)}addSeparator(t){return this.rackApi_.addSeparator(t)}addTab(t){return this.rackApi_.addTab(t)}add(t,e){this.rackApi_.add(t,e)}remove(t){this.rackApi_.remove(t)}addInput(t,e,n){return this.rackApi_.addInput(t,e,n)}addMonitor(t,e,n){return this.rackApi_.addMonitor(t,e,n)}addBlade(t){return this.rackApi_.addBlade(t)}}class ie extends mt{constructor(t,e){super(t,new Et(t.rackController,e)),this.onPageAdd_=this.onPageAdd_.bind(this),this.onPageRemove_=this.onPageRemove_.bind(this),this.onSelect_=this.onSelect_.bind(this),this.emitter_=new m,this.pageApiMap_=new Map,this.rackApi_.on("change",(t=>{this.emitter_.emit("change",{event:t})})),this.rackApi_.on("update",(t=>{this.emitter_.emit("update",{event:t})})),this.controller_.tab.selectedIndex.emitter.on("change",this.onSelect_),this.controller_.pageSet.emitter.on("add",this.onPageAdd_),this.controller_.pageSet.emitter.on("remove",this.onPageRemove_),this.controller_.pageSet.items.forEach((t=>{this.setUpPageApi_(t)}))}get pages(){return this.controller_.pageSet.items.map((t=>{const e=this.pageApiMap_.get(t);if(!e)throw p.shouldNeverHappen();return e}))}addPage(t){const e=this.controller_.view.element.ownerDocument,n=new ee(e,{itemProps:O.fromObject({selected:!1,title:t.title}),props:O.fromObject({selected:!1})});this.controller_.add(n,t.index);const i=this.pageApiMap_.get(n);if(!i)throw p.shouldNeverHappen();return i}removePage(t){this.controller_.remove(t)}on(t,e){const n=e.bind(this);return this.emitter_.on(t,(t=>{n(t.event)})),this}setUpPageApi_(t){const e=this.rackApi_.apiSet_.find((e=>e.controller_===t.contentController));if(!e)throw p.shouldNeverHappen();const n=new ne(t,e);this.pageApiMap_.set(t,n)}onPageAdd_(t){this.setUpPageApi_(t.item)}onPageRemove_(t){if(!this.pageApiMap_.get(t.item))throw p.shouldNeverHappen();this.pageApiMap_.delete(t.item)}onSelect_(t){this.emitter_.emit("select",{event:new a(this,t.rawValue)})}}const se=-1;class re{constructor(){this.onItemSelectedChange_=this.onItemSelectedChange_.bind(this),this.empty=M(!0),this.selectedIndex=M(se),this.items_=[]}add(t,e){const n=null!=e?e:this.items_.length;this.items_.splice(n,0,t),t.emitter.on("change",this.onItemSelectedChange_),this.keepSelection_()}remove(t){const e=this.items_.indexOf(t);e<0||(this.items_.splice(e,1),t.emitter.off("change",this.onItemSelectedChange_),this.keepSelection_())}keepSelection_(){if(0===this.items_.length)return this.selectedIndex.rawValue=se,void(this.empty.rawValue=!0);const t=this.items_.findIndex((t=>t.rawValue));t<0?(this.items_.forEach(((t,e)=>{t.rawValue=0===e})),this.selectedIndex.rawValue=0):(this.items_.forEach(((e,n)=>{e.rawValue=n===t})),this.selectedIndex.rawValue=t),this.empty.rawValue=!1}onItemSelectedChange_(t){if(t.rawValue){const e=this.items_.findIndex((e=>e===t.sender));this.items_.forEach(((t,n)=>{t.rawValue=n===e})),this.selectedIndex.rawValue=e}else this.keepSelection_()}}const oe=_("tab");class ae{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(oe(),Bt()),e.viewProps.bindClassModifiers(this.element),y(e.empty,C(this.element,oe(void 0,"nop")));const n=t.createElement("div");n.classList.add(oe("i")),this.element.appendChild(n),this.itemsElement=n;const i=e.contentsElement;i.classList.add(oe("c")),this.element.appendChild(i),this.contentsElement=i}}class le extends Mt{constructor(t,e){const n=new Nt(t,{blade:e.blade,viewProps:e.viewProps}),i=new re;super({blade:e.blade,rackController:n,view:new ae(t,{contentsElement:n.view.element,empty:i.empty,viewProps:e.viewProps})}),this.onPageAdd_=this.onPageAdd_.bind(this),this.onPageRemove_=this.onPageRemove_.bind(this),this.pageSet_=new yt((()=>null)),this.pageSet_.emitter.on("add",this.onPageAdd_),this.pageSet_.emitter.on("remove",this.onPageRemove_),this.tab=i}get pageSet(){return this.pageSet_}add(t,e){this.pageSet_.add(t,e)}remove(t){this.pageSet_.remove(this.pageSet_.items[t])}onPageAdd_(t){const e=t.item;J(this.view.itemsElement,e.itemController.view.element,t.index),this.rackController.rack.add(e.contentController,t.index),this.tab.add(e.props.value("selected"))}onPageRemove_(t){const e=t.item;tt(e.itemController.view.element),this.rackController.rack.remove(e.contentController),this.tab.remove(e.props.value("selected"))}}const ce={id:"tab",type:"blade",accept(t){const e=L,n=N(t,{pages:e.required.array(e.required.object({title:e.required.string})),view:e.required.constant("tab")});return n&&0!==n.pages.length?{params:n}:null},controller(t){const e=new le(t.document,{blade:t.blade,viewProps:t.viewProps});return t.params.pages.forEach((n=>{const i=new ee(t.document,{itemProps:O.fromObject({selected:!1,title:n.title}),props:O.fromObject({selected:!1})});e.add(i)})),e},api:t=>t.controller instanceof le?new ie(t.controller,t.pool):null};function ue(t,e){const n=t.accept(e.params);if(!n)return null;const i=L.optional.boolean(e.params.disabled).value,s=L.optional.boolean(e.params.hidden).value;return t.controller({blade:ut(),document:e.document,params:l(Object.assign(Object.assign({},n.params),{disabled:i,hidden:s})),viewProps:Zt.create({disabled:i,hidden:s})})}class he{constructor(){this.disabled=!1,this.emitter=new m}dispose(){}tick(){this.disabled||this.emitter.emit("tick",{sender:this})}}class pe{constructor(t,e){this.disabled_=!1,this.timerId_=null,this.onTick_=this.onTick_.bind(this),this.doc_=t,this.emitter=new m,this.interval_=e,this.setTimer_()}get disabled(){return this.disabled_}set disabled(t){this.disabled_=t,this.disabled_?this.clearTimer_():this.setTimer_()}dispose(){this.clearTimer_()}clearTimer_(){if(null===this.timerId_)return;const t=this.doc_.defaultView;t&&t.clearInterval(this.timerId_),this.timerId_=null}setTimer_(){if(this.clearTimer_(),this.interval_<=0)return;const t=this.doc_.defaultView;t&&(this.timerId_=t.setInterval(this.onTick_,this.interval_))}onTick_(){this.disabled_||this.emitter.emit("tick",{sender:this})}}class de{constructor(t){this.constraints=t}constrain(t){return this.constraints.reduce(((t,e)=>e.constrain(t)),t)}}function fe(t,e){if(t instanceof e)return t;if(t instanceof de){const n=t.constraints.reduce(((t,n)=>t||(n instanceof e?n:null)),null);if(n)return n}return null}class me{constructor(t){this.options=t}constrain(t){const e=this.options;return 0===e.length||e.filter((e=>e.value===t)).length>0?t:e[0].value}}class ve{constructor(t){this.maxValue=t.max,this.minValue=t.min}constrain(t){let e=t;return c(this.minValue)||(e=Math.max(e,this.minValue)),c(this.maxValue)||(e=Math.min(e,this.maxValue)),e}}class _e{constructor(t,e=0){this.step=t,this.origin=e}constrain(t){const e=this.origin%this.step;return e+Math.round((t-e)/this.step)*this.step}}const ge=_("lst");class be{constructor(t,e){this.onValueChange_=this.onValueChange_.bind(this),this.props_=e.props,this.element=t.createElement("div"),this.element.classList.add(ge()),e.viewProps.bindClassModifiers(this.element);const n=t.createElement("select");n.classList.add(ge("s")),w(this.props_,"options",(e=>{et(n),e.forEach(((e,i)=>{const s=t.createElement("option");s.dataset.index=String(i),s.textContent=e.text,s.value=String(e.value),n.appendChild(s)}))})),e.viewProps.bindDisabled(n),this.element.appendChild(n),this.selectElement=n;const i=t.createElement("div");i.classList.add(ge("m")),i.appendChild(Q(t,"dropdown")),this.element.appendChild(i),e.value.emitter.on("change",this.onValueChange_),this.value_=e.value,this.update_()}update_(){this.selectElement.value=String(this.value_.rawValue)}onValueChange_(){this.update_()}}class ye{constructor(t,e){this.onSelectChange_=this.onSelectChange_.bind(this),this.props=e.props,this.value=e.value,this.viewProps=e.viewProps,this.view=new be(t,{props:this.props,value:this.value,viewProps:this.viewProps}),this.view.selectElement.addEventListener("change",this.onSelectChange_)}onSelectChange_(t){const e=l(t.currentTarget).selectedOptions.item(0);if(!e)return;const n=Number(e.dataset.index);this.value.rawValue=this.props.get("options")[n].value}}const we=_("pop");class xe{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(we()),e.viewProps.bindClassModifiers(this.element),y(e.shows,C(this.element,we(void 0,"v")))}}class Ce{constructor(t,e){this.shows=M(!1),this.viewProps=e.viewProps,this.view=new xe(t,{shows:this.shows,viewProps:this.viewProps})}}const Te=_("txt");class Ae{constructor(t,e){this.onChange_=this.onChange_.bind(this),this.element=t.createElement("div"),this.element.classList.add(Te()),e.viewProps.bindClassModifiers(this.element),this.props_=e.props,this.props_.emitter.on("change",this.onChange_);const n=t.createElement("input");n.classList.add(Te("i")),n.type="text",e.viewProps.bindDisabled(n),this.element.appendChild(n),this.inputElement=n,e.value.emitter.on("change",this.onChange_),this.value_=e.value,this.refresh()}refresh(){const t=this.props_.get("formatter");this.inputElement.value=t(this.value_.rawValue)}onChange_(){this.refresh()}}class Se{constructor(t,e){this.onInputChange_=this.onInputChange_.bind(this),this.parser_=e.parser,this.props=e.props,this.value=e.value,this.viewProps=e.viewProps,this.view=new Ae(t,{props:e.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(t){const e=l(t.currentTarget).value,n=this.parser_(e);c(n)||(this.value.rawValue=n),this.view.refresh()}}function ke(t){return String(t)}function Ee(t){return"false"!==t&&!!t}function Pe(t){return ke(t)}class Me{constructor(t){this.text=t}evaluate(){return Number(this.text)}toString(){return this.text}}const Oe={"**":(t,e)=>Math.pow(t,e),"*":(t,e)=>t*e,"/":(t,e)=>t/e,"%":(t,e)=>t%e,"+":(t,e)=>t+e,"-":(t,e)=>t-e,"<<":(t,e)=>t<<e,">>":(t,e)=>t>>e,">>>":(t,e)=>t>>>e,"&":(t,e)=>t&e,"^":(t,e)=>t^e,"|":(t,e)=>t|e};class De{constructor(t,e,n){this.left=e,this.operator=t,this.right=n}evaluate(){const t=Oe[this.operator];if(!t)throw new Error(`unexpected binary operator: '${this.operator}`);return t(this.left.evaluate(),this.right.evaluate())}toString(){return["b(",this.left.toString(),this.operator,this.right.toString(),")"].join(" ")}}const Ie={"+":t=>t,"-":t=>-t,"~":t=>~t};class Ve{constructor(t,e){this.operator=t,this.expression=e}evaluate(){const t=Ie[this.operator];if(!t)throw new Error(`unexpected unary operator: '${this.operator}`);return t(this.expression.evaluate())}toString(){return["u(",this.operator,this.expression.toString(),")"].join(" ")}}function Re(t){return(e,n)=>{for(let i=0;i<t.length;i++){const s=t[i](e,n);if(""!==s)return s}return""}}function Fe(t,e){var n;const i=t.substr(e).match(/^\s+/);return null!==(n=i&&i[0])&&void 0!==n?n:""}function Le(t,e){const n=t.substr(e,1);return n.match(/^[1-9]$/)?n:""}function Ne(t,e){var n;const i=t.substr(e).match(/^[0-9]+/);return null!==(n=i&&i[0])&&void 0!==n?n:""}function Be(t,e){const n=Ne(t,e);if(""!==n)return n;const i=t.substr(e,1);if("-"!==i&&"+"!==i)return"";const s=Ne(t,e+=1);return""===s?"":i+s}function ze(t,e){const n=t.substr(e,1);if(e+=1,"e"!==n.toLowerCase())return"";const i=Be(t,e);return""===i?"":n+i}function je(t,e){const n=t.substr(e,1);if("0"===n)return n;const i=Le(t,e);return e+=i.length,""===i?"":i+Ne(t,e)}function Ue(t,e){const n=je(t,e);if(e+=n.length,""===n)return"";const i=t.substr(e,1);if(e+=i.length,"."!==i)return"";const s=Ne(t,e);return n+i+s+ze(t,e+=s.length)}function qe(t,e){const n=t.substr(e,1);if(e+=n.length,"."!==n)return"";const i=Ne(t,e);return e+=i.length,""===i?"":n+i+ze(t,e)}function We(t,e){const n=je(t,e);return e+=n.length,""===n?"":n+ze(t,e)}const He=Re([Ue,qe,We]);function Ge(t,e){var n;const i=t.substr(e).match(/^[01]+/);return null!==(n=i&&i[0])&&void 0!==n?n:""}function Ke(t,e){const n=t.substr(e,2);if(e+=n.length,"0b"!==n.toLowerCase())return"";const i=Ge(t,e);return""===i?"":n+i}function Ye(t,e){var n;const i=t.substr(e).match(/^[0-7]+/);return null!==(n=i&&i[0])&&void 0!==n?n:""}function Xe(t,e){const n=t.substr(e,2);if(e+=n.length,"0o"!==n.toLowerCase())return"";const i=Ye(t,e);return""===i?"":n+i}function $e(t,e){var n;const i=t.substr(e).match(/^[0-9a-f]+/i);return null!==(n=i&&i[0])&&void 0!==n?n:""}function Ze(t,e){const n=t.substr(e,2);if(e+=n.length,"0x"!==n.toLowerCase())return"";const i=$e(t,e);return""===i?"":n+i}const Qe=Re([Ke,Xe,Ze]),Je=Re([Qe,He]);function tn(t,e){const n=Je(t,e);return e+=n.length,""===n?null:{evaluable:new Me(n),cursor:e}}function en(t,e){const n=t.substr(e,1);if(e+=n.length,"("!==n)return null;const i=ln(t,e);if(!i)return null;e=i.cursor,e+=Fe(t,e).length;const s=t.substr(e,1);return e+=s.length,")"!==s?null:{evaluable:i.evaluable,cursor:e}}function nn(t,e){var n;return null!==(n=tn(t,e))&&void 0!==n?n:en(t,e)}function sn(t,e){const n=nn(t,e);if(n)return n;const i=t.substr(e,1);if(e+=i.length,"+"!==i&&"-"!==i&&"~"!==i)return null;const s=sn(t,e);return s?{cursor:e=s.cursor,evaluable:new Ve(i,s.evaluable)}:null}function rn(t,e,n){n+=Fe(e,n).length;const i=t.filter((t=>e.startsWith(t,n)))[0];return i?(n+=i.length,{cursor:n+=Fe(e,n).length,operator:i}):null}function on(t,e){return(n,i)=>{const s=t(n,i);if(!s)return null;i=s.cursor;let r=s.evaluable;for(;;){const s=rn(e,n,i);if(!s)break;i=s.cursor;const o=t(n,i);if(!o)return null;i=o.cursor,r=new De(s.operator,r,o.evaluable)}return r?{cursor:i,evaluable:r}:null}}const an=[["**"],["*","/","%"],["+","-"],["<<",">>>",">>"],["&"],["^"],["|"]].reduce(((t,e)=>on(t,e)),sn);function ln(t,e){return e+=Fe(t,e).length,an(t,e)}function cn(t){const e=ln(t,0);return e?e.cursor+Fe(t,e.cursor).length!==t.length?null:e.evaluable:null}function un(t){var e;const n=cn(t);return null!==(e=null==n?void 0:n.evaluate())&&void 0!==e?e:null}function hn(t){if("number"==typeof t)return t;if("string"==typeof t){const e=un(t);if(!c(e))return e}return 0}function pn(t){return String(t)}function dn(t){return e=>e.toFixed(Math.max(Math.min(t,20),0))}const fn=dn(0);function mn(t){return fn(t)+"%"}function vn(t){return String(t)}function _n(t){return t}function gn(t,e){for(;t.length<e;)t.push(void 0)}function bn(t){const e=[];return gn(e,t),M(e)}function yn(t){const e=t.indexOf(void 0);return l(e<0?t:t.slice(0,e))}function wn(t,e){const n=[...yn(t),e];return n.length>t.length?n.splice(0,n.length-t.length):gn(n,t.length),n}function xn({primary:t,secondary:e,forward:n,backward:i}){let s=!1;function r(t){s||(s=!0,t(),s=!1)}t.emitter.on("change",(i=>{r((()=>{e.setRawValue(n(t,e),i.options)}))})),e.emitter.on("change",(s=>{r((()=>{t.setRawValue(i(t,e),s.options)})),r((()=>{e.setRawValue(n(t,e),s.options)}))})),r((()=>{e.setRawValue(n(t,e),{forceEmit:!1,last:!0})}))}function Cn(t,e){const n=t*(e.altKey?.1:1)*(e.shiftKey?10:1);return e.upKey?+n:e.downKey?-n:0}function Tn(t){return{altKey:t.altKey,downKey:"ArrowDown"===t.key,shiftKey:t.shiftKey,upKey:"ArrowUp"===t.key}}function An(t){return{altKey:t.altKey,downKey:"ArrowLeft"===t.key,shiftKey:t.shiftKey,upKey:"ArrowRight"===t.key}}function Sn(t){return"ArrowUp"===t||"ArrowDown"===t}function kn(t){return Sn(t)||"ArrowLeft"===t||"ArrowRight"===t}function En(t,e){var n,i;const s=e.ownerDocument.defaultView,r=e.getBoundingClientRect();return{x:t.pageX-((null!==(n=s&&s.scrollX)&&void 0!==n?n:0)+r.left),y:t.pageY-((null!==(i=s&&s.scrollY)&&void 0!==i?i:0)+r.top)}}class Pn{constructor(t){this.lastTouch_=null,this.onDocumentMouseMove_=this.onDocumentMouseMove_.bind(this),this.onDocumentMouseUp_=this.onDocumentMouseUp_.bind(this),this.onMouseDown_=this.onMouseDown_.bind(this),this.onTouchEnd_=this.onTouchEnd_.bind(this),this.onTouchMove_=this.onTouchMove_.bind(this),this.onTouchStart_=this.onTouchStart_.bind(this),this.elem_=t,this.emitter=new m,t.addEventListener("touchstart",this.onTouchStart_,{passive:!1}),t.addEventListener("touchmove",this.onTouchMove_,{passive:!0}),t.addEventListener("touchend",this.onTouchEnd_),t.addEventListener("mousedown",this.onMouseDown_)}computePosition_(t){const e=this.elem_.getBoundingClientRect();return{bounds:{width:e.width,height:e.height},point:t?{x:t.x,y:t.y}:null}}onMouseDown_(t){var e;t.preventDefault(),null===(e=t.currentTarget)||void 0===e||e.focus();const n=this.elem_.ownerDocument;n.addEventListener("mousemove",this.onDocumentMouseMove_),n.addEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("down",{altKey:t.altKey,data:this.computePosition_(En(t,this.elem_)),sender:this,shiftKey:t.shiftKey})}onDocumentMouseMove_(t){this.emitter.emit("move",{altKey:t.altKey,data:this.computePosition_(En(t,this.elem_)),sender:this,shiftKey:t.shiftKey})}onDocumentMouseUp_(t){const e=this.elem_.ownerDocument;e.removeEventListener("mousemove",this.onDocumentMouseMove_),e.removeEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("up",{altKey:t.altKey,data:this.computePosition_(En(t,this.elem_)),sender:this,shiftKey:t.shiftKey})}onTouchStart_(t){t.preventDefault();const e=t.targetTouches.item(0),n=this.elem_.getBoundingClientRect();this.emitter.emit("down",{altKey:t.altKey,data:this.computePosition_(e?{x:e.clientX-n.left,y:e.clientY-n.top}:void 0),sender:this,shiftKey:t.shiftKey}),this.lastTouch_=e}onTouchMove_(t){const e=t.targetTouches.item(0),n=this.elem_.getBoundingClientRect();this.emitter.emit("move",{altKey:t.altKey,data:this.computePosition_(e?{x:e.clientX-n.left,y:e.clientY-n.top}:void 0),sender:this,shiftKey:t.shiftKey}),this.lastTouch_=e}onTouchEnd_(t){var e;const n=null!==(e=t.targetTouches.item(0))&&void 0!==e?e:this.lastTouch_,i=this.elem_.getBoundingClientRect();this.emitter.emit("up",{altKey:t.altKey,data:this.computePosition_(n?{x:n.clientX-i.left,y:n.clientY-i.top}:void 0),sender:this,shiftKey:t.shiftKey})}}function Mn(t,e,n,i,s){return i+(t-e)/(n-e)*(s-i)}function On(t){return String(t.toFixed(10)).split(".")[1].replace(/0+$/,"").length}function Dn(t,e,n){return Math.min(Math.max(t,e),n)}function In(t,e){return(t%e+e)%e}const Vn=_("txt");class Rn{constructor(t,e){this.onChange_=this.onChange_.bind(this),this.props_=e.props,this.props_.emitter.on("change",this.onChange_),this.element=t.createElement("div"),this.element.classList.add(Vn(),Vn(void 0,"num")),e.arrayPosition&&this.element.classList.add(Vn(void 0,e.arrayPosition)),e.viewProps.bindClassModifiers(this.element);const n=t.createElement("input");n.classList.add(Vn("i")),n.type="text",e.viewProps.bindDisabled(n),this.element.appendChild(n),this.inputElement=n,this.onDraggingChange_=this.onDraggingChange_.bind(this),this.dragging_=e.dragging,this.dragging_.emitter.on("change",this.onDraggingChange_),this.element.classList.add(Vn()),this.inputElement.classList.add(Vn("i"));const i=t.createElement("div");i.classList.add(Vn("k")),this.element.appendChild(i),this.knobElement=i;const s=t.createElementNS(W,"svg");s.classList.add(Vn("g")),this.knobElement.appendChild(s);const r=t.createElementNS(W,"path");r.classList.add(Vn("gb")),s.appendChild(r),this.guideBodyElem_=r;const o=t.createElementNS(W,"path");o.classList.add(Vn("gh")),s.appendChild(o),this.guideHeadElem_=o;const a=t.createElement("div");a.classList.add(_("tt")()),this.knobElement.appendChild(a),this.tooltipElem_=a,e.value.emitter.on("change",this.onChange_),this.value=e.value,this.refresh()}onDraggingChange_(t){if(null===t.rawValue)return void this.element.classList.remove(Vn(void 0,"drg"));this.element.classList.add(Vn(void 0,"drg"));const e=t.rawValue/this.props_.get("draggingScale"),n=e+(e>0?-1:e<0?1:0),i=Dn(-n,-4,4);this.guideHeadElem_.setAttributeNS(null,"d",[`M ${n+i},0 L${n},4 L${n+i},8`,`M ${e},-1 L${e},9`].join(" ")),this.guideBodyElem_.setAttributeNS(null,"d",`M 0,4 L${e},4`);const s=this.props_.get("formatter");this.tooltipElem_.textContent=s(this.value.rawValue),this.tooltipElem_.style.left=`${e}px`}refresh(){const t=this.props_.get("formatter");this.inputElement.value=t(this.value.rawValue)}onChange_(){this.refresh()}}class Fn{constructor(t,e){var n;this.originRawValue_=0,this.onInputChange_=this.onInputChange_.bind(this),this.onInputKeyDown_=this.onInputKeyDown_.bind(this),this.onInputKeyUp_=this.onInputKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.baseStep_=e.baseStep,this.parser_=e.parser,this.props=e.props,this.sliderProps_=null!==(n=e.sliderProps)&&void 0!==n?n:null,this.value=e.value,this.viewProps=e.viewProps,this.dragging_=M(null),this.view=new Rn(t,{arrayPosition:e.arrayPosition,dragging:this.dragging_,props:this.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_),this.view.inputElement.addEventListener("keydown",this.onInputKeyDown_),this.view.inputElement.addEventListener("keyup",this.onInputKeyUp_);const i=new Pn(this.view.knobElement);i.emitter.on("down",this.onPointerDown_),i.emitter.on("move",this.onPointerMove_),i.emitter.on("up",this.onPointerUp_)}constrainValue_(t){var e,n;const i=null===(e=this.sliderProps_)||void 0===e?void 0:e.get("minValue"),s=null===(n=this.sliderProps_)||void 0===n?void 0:n.get("maxValue");let r=t;return void 0!==i&&(r=Math.max(r,i)),void 0!==s&&(r=Math.min(r,s)),r}onInputChange_(t){const e=l(t.currentTarget).value,n=this.parser_(e);c(n)||(this.value.rawValue=this.constrainValue_(n)),this.view.refresh()}onInputKeyDown_(t){const e=Cn(this.baseStep_,Tn(t));0!==e&&this.value.setRawValue(this.constrainValue_(this.value.rawValue+e),{forceEmit:!1,last:!1})}onInputKeyUp_(t){0!==Cn(this.baseStep_,Tn(t))&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}onPointerDown_(){this.originRawValue_=this.value.rawValue,this.dragging_.rawValue=0}computeDraggingValue_(t){if(!t.point)return null;const e=t.point.x-t.bounds.width/2;return this.constrainValue_(this.originRawValue_+e*this.props.get("draggingScale"))}onPointerMove_(t){const e=this.computeDraggingValue_(t.data);null!==e&&(this.value.setRawValue(e,{forceEmit:!1,last:!1}),this.dragging_.rawValue=this.value.rawValue-this.originRawValue_)}onPointerUp_(t){const e=this.computeDraggingValue_(t.data);null!==e&&(this.value.setRawValue(e,{forceEmit:!0,last:!0}),this.dragging_.rawValue=null)}}const Ln=_("sld");class Nn{constructor(t,e){this.onChange_=this.onChange_.bind(this),this.props_=e.props,this.props_.emitter.on("change",this.onChange_),this.element=t.createElement("div"),this.element.classList.add(Ln()),e.viewProps.bindClassModifiers(this.element);const n=t.createElement("div");n.classList.add(Ln("t")),e.viewProps.bindTabIndex(n),this.element.appendChild(n),this.trackElement=n;const i=t.createElement("div");i.classList.add(Ln("k")),this.trackElement.appendChild(i),this.knobElement=i,e.value.emitter.on("change",this.onChange_),this.value=e.value,this.update_()}update_(){const t=Dn(Mn(this.value.rawValue,this.props_.get("minValue"),this.props_.get("maxValue"),0,100),0,100);this.knobElement.style.width=`${t}%`}onChange_(){this.update_()}}class Bn{constructor(t,e){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDownOrMove_=this.onPointerDownOrMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.baseStep_=e.baseStep,this.value=e.value,this.viewProps=e.viewProps,this.props=e.props,this.view=new Nn(t,{props:this.props,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Pn(this.view.trackElement),this.ptHandler_.emitter.on("down",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("move",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.trackElement.addEventListener("keydown",this.onKeyDown_),this.view.trackElement.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(t,e){t.point&&this.value.setRawValue(Mn(Dn(t.point.x,0,t.bounds.width),0,t.bounds.width,this.props.get("minValue"),this.props.get("maxValue")),e)}onPointerDownOrMove_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerUp_(t){this.handlePointerEvent_(t.data,{forceEmit:!0,last:!0})}onKeyDown_(t){const e=Cn(this.baseStep_,An(t));0!==e&&this.value.setRawValue(this.value.rawValue+e,{forceEmit:!1,last:!1})}onKeyUp_(t){0!==Cn(this.baseStep_,An(t))&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const zn=_("sldtxt");class jn{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(zn());const n=t.createElement("div");n.classList.add(zn("s")),this.sliderView_=e.sliderView,n.appendChild(this.sliderView_.element),this.element.appendChild(n);const i=t.createElement("div");i.classList.add(zn("t")),this.textView_=e.textView,i.appendChild(this.textView_.element),this.element.appendChild(i)}}class Un{constructor(t,e){this.value=e.value,this.viewProps=e.viewProps,this.sliderC_=new Bn(t,{baseStep:e.baseStep,props:e.sliderProps,value:e.value,viewProps:this.viewProps}),this.textC_=new Fn(t,{baseStep:e.baseStep,parser:e.parser,props:e.textProps,sliderProps:e.sliderProps,value:e.value,viewProps:e.viewProps}),this.view=new jn(t,{sliderView:this.sliderC_.view,textView:this.textC_.view})}get sliderController(){return this.sliderC_}get textController(){return this.textC_}}function qn(t,e){t.write(e)}function Wn(t){const e=L;return Array.isArray(t)?e.required.array(e.required.object({text:e.required.string,value:e.required.raw}))(t).value:"object"==typeof t?e.required.raw(t).value:void 0}function Hn(t){if("inline"===t||"popup"===t)return t}function Gn(t){const e=L;return e.required.object({max:e.optional.number,min:e.optional.number,step:e.optional.number})(t).value}function Kn(t){if(Array.isArray(t))return t;const e=[];return Object.keys(t).forEach((n=>{e.push({text:n,value:t[n]})})),e}function Yn(t){return c(t)?null:new me(Kn(l(t)))}function Xn(t){const e=t?fe(t,me):null;return e?e.options:null}function $n(t){const e=t?fe(t,_e):null;return e?e.step:null}function Zn(t,e){const n=t&&fe(t,_e);return n?On(n.step):Math.max(On(e),2)}function Qn(t){const e=$n(t);return null!=e?e:1}function Jn(t,e){var n;const i=t&&fe(t,_e),s=Math.abs(null!==(n=null==i?void 0:i.step)&&void 0!==n?n:e);return 0===s?.1:Math.pow(10,Math.floor(Math.log10(s))-1)}const ti=_("ckb");class ei{constructor(t,e){this.onValueChange_=this.onValueChange_.bind(this),this.element=t.createElement("div"),this.element.classList.add(ti()),e.viewProps.bindClassModifiers(this.element);const n=t.createElement("label");n.classList.add(ti("l")),this.element.appendChild(n);const i=t.createElement("input");i.classList.add(ti("i")),i.type="checkbox",n.appendChild(i),this.inputElement=i,e.viewProps.bindDisabled(this.inputElement);const s=t.createElement("div");s.classList.add(ti("w")),n.appendChild(s);const r=Q(t,"check");s.appendChild(r),e.value.emitter.on("change",this.onValueChange_),this.value=e.value,this.update_()}update_(){this.inputElement.checked=this.value.rawValue}onValueChange_(){this.update_()}}class ni{constructor(t,e){this.onInputChange_=this.onInputChange_.bind(this),this.value=e.value,this.viewProps=e.viewProps,this.view=new ei(t,{value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(t){const e=l(t.currentTarget);this.value.rawValue=e.checked}}function ii(t){const e=[],n=Yn(t.options);return n&&e.push(n),new de(e)}const si={id:"input-bool",type:"input",accept:(t,e)=>{if("boolean"!=typeof t)return null;const n=N(e,{options:L.optional.custom(Wn)});return n?{initialValue:t,params:n}:null},binding:{reader:t=>Ee,constraint:t=>ii(t.params),writer:t=>qn},controller:t=>{var e;const n=t.document,i=t.value,s=t.constraint;return s&&fe(s,me)?new ye(n,{props:O.fromObject({options:null!==(e=Xn(s))&&void 0!==e?e:[]}),value:i,viewProps:t.viewProps}):new ni(n,{value:i,viewProps:t.viewProps})}},ri=_("col");class oi{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(ri()),e.foldable.bindExpandedClass(this.element,ri(void 0,"expanded")),w(e.foldable,"completed",C(this.element,ri(void 0,"cpl")));const n=t.createElement("div");n.classList.add(ri("h")),this.element.appendChild(n);const i=t.createElement("div");i.classList.add(ri("s")),n.appendChild(i),this.swatchElement=i;const s=t.createElement("div");if(s.classList.add(ri("t")),n.appendChild(s),this.textElement=s,"inline"===e.pickerLayout){const e=t.createElement("div");e.classList.add(ri("p")),this.element.appendChild(e),this.pickerElement=e}else this.pickerElement=null}}function ai(t,e,n){const i=Dn(t/255,0,1),s=Dn(e/255,0,1),r=Dn(n/255,0,1),o=Math.max(i,s,r),a=Math.min(i,s,r),l=o-a;let c=0,u=0;const h=(a+o)/2;return 0!==l&&(u=l/(1-Math.abs(o+a-1)),c=i===o?(s-r)/l:s===o?2+(r-i)/l:4+(i-s)/l,c=c/6+(c<0?1:0)),[360*c,100*u,100*h]}function li(t,e,n){const i=(t%360+360)%360,s=Dn(e/100,0,1),r=Dn(n/100,0,1),o=(1-Math.abs(2*r-1))*s,a=o*(1-Math.abs(i/60%2-1)),l=r-o/2;let c,u,h;return[c,u,h]=i>=0&&i<60?[o,a,0]:i>=60&&i<120?[a,o,0]:i>=120&&i<180?[0,o,a]:i>=180&&i<240?[0,a,o]:i>=240&&i<300?[a,0,o]:[o,0,a],[255*(c+l),255*(u+l),255*(h+l)]}function ci(t,e,n){const i=Dn(t/255,0,1),s=Dn(e/255,0,1),r=Dn(n/255,0,1),o=Math.max(i,s,r),a=o-Math.min(i,s,r);let l;return l=0===a?0:o===i?((s-r)/a%6+6)%6*60:o===s?60*((r-i)/a+2):60*((i-s)/a+4),[l,100*(0===o?0:a/o),100*o]}function ui(t,e,n){const i=In(t,360),s=Dn(e/100,0,1),r=Dn(n/100,0,1),o=r*s,a=o*(1-Math.abs(i/60%2-1)),l=r-o;let c,u,h;return[c,u,h]=i>=0&&i<60?[o,a,0]:i>=60&&i<120?[a,o,0]:i>=120&&i<180?[0,o,a]:i>=180&&i<240?[0,a,o]:i>=240&&i<300?[a,0,o]:[o,0,a],[255*(c+l),255*(u+l),255*(h+l)]}function hi(t,e,n){const i=n+e*(100-Math.abs(2*n-100))/200;return[t,0!==i?e*(100-Math.abs(2*n-100))/i:0,n+e*(100-Math.abs(2*n-100))/200]}function pi(t,e,n){const i=100-Math.abs(n*(200-e)/100-100);return[t,0!==i?e*n/i:0,n*(200-e)/200]}function di(t){return[t[0],t[1],t[2]]}function fi(t,e){return[t[0],t[1],t[2],e]}const mi={hsl:{hsl:(t,e,n)=>[t,e,n],hsv:hi,rgb:li},hsv:{hsl:pi,hsv:(t,e,n)=>[t,e,n],rgb:ui},rgb:{hsl:ai,hsv:ci,rgb:(t,e,n)=>[t,e,n]}};function vi(t,e){return["float"===e?1:"rgb"===t?255:360,"float"===e?1:"rgb"===t?255:100,"float"===e?1:"rgb"===t?255:100]}function _i(t,e,n){var i;const s=vi(e,n);return["rgb"===e?Dn(t[0],0,s[0]):In(t[0],s[0]),Dn(t[1],0,s[1]),Dn(t[2],0,s[2]),Dn(null!==(i=t[3])&&void 0!==i?i:1,0,1)]}function gi(t,e,n,i){const s=vi(e,n),r=vi(e,i);return t.map(((t,e)=>t/s[e]*r[e]))}function bi(t,e,n){const i=gi(t,e.mode,e.type,"int");return gi(mi[e.mode][n.mode](...i),n.mode,"int",n.type)}function yi(t,e){return"object"==typeof t&&!c(t)&&e in t&&"number"==typeof t[e]}class wi{constructor(t,e,n="int"){this.mode=e,this.type=n,this.comps_=_i(t,e,n)}static black(t="int"){return new wi([0,0,0],"rgb",t)}static fromObject(t,e="int"){const n="a"in t?[t.r,t.g,t.b,t.a]:[t.r,t.g,t.b];return new wi(n,"rgb",e)}static toRgbaObject(t,e="int"){return t.toRgbaObject(e)}static isRgbColorObject(t){return yi(t,"r")&&yi(t,"g")&&yi(t,"b")}static isRgbaColorObject(t){return this.isRgbColorObject(t)&&yi(t,"a")}static isColorObject(t){return this.isRgbColorObject(t)}static equals(t,e){if(t.mode!==e.mode)return!1;const n=t.comps_,i=e.comps_;for(let s=0;s<n.length;s++)if(n[s]!==i[s])return!1;return!0}getComponents(t,e="int"){return fi(bi(di(this.comps_),{mode:this.mode,type:this.type},{mode:null!=t?t:this.mode,type:e}),this.comps_[3])}toRgbaObject(t="int"){const e=this.getComponents("rgb",t);return{r:e[0],g:e[1],b:e[2],a:e[3]}}}const xi=_("colp");class Ci{constructor(t,e){this.alphaViews_=null,this.element=t.createElement("div"),this.element.classList.add(xi());const n=t.createElement("div");n.classList.add(xi("hsv"));const i=t.createElement("div");i.classList.add(xi("sv")),this.svPaletteView_=e.svPaletteView,i.appendChild(this.svPaletteView_.element),n.appendChild(i);const s=t.createElement("div");s.classList.add(xi("h")),this.hPaletteView_=e.hPaletteView,s.appendChild(this.hPaletteView_.element),n.appendChild(s),this.element.appendChild(n);const r=t.createElement("div");if(r.classList.add(xi("rgb")),this.textView_=e.textView,r.appendChild(this.textView_.element),this.element.appendChild(r),e.alphaViews){this.alphaViews_={palette:e.alphaViews.palette,text:e.alphaViews.text};const n=t.createElement("div");n.classList.add(xi("a"));const i=t.createElement("div");i.classList.add(xi("ap")),i.appendChild(this.alphaViews_.palette.element),n.appendChild(i);const s=t.createElement("div");s.classList.add(xi("at")),s.appendChild(this.alphaViews_.text.element),n.appendChild(s),this.element.appendChild(n)}}get allFocusableElements(){const t=[this.svPaletteView_.element,this.hPaletteView_.element,this.textView_.modeSelectElement,...this.textView_.textViews.map((t=>t.inputElement))];return this.alphaViews_&&t.push(this.alphaViews_.palette.element,this.alphaViews_.text.inputElement),t}}function Ti(t){return"int"===t?"int":"float"===t?"float":void 0}function Ai(t){const e=L;return N(t,{alpha:e.optional.boolean,color:e.optional.object({alpha:e.optional.boolean,type:e.optional.custom(Ti)}),expanded:e.optional.boolean,picker:e.optional.custom(Hn)})}function Si(t){return t?.1:1}function ki(t){var e;return null===(e=t.color)||void 0===e?void 0:e.type}function Ei(t,e){return t.alpha===e.alpha&&t.mode===e.mode&&t.notation===e.notation&&t.type===e.type}function Pi(t,e){const n=t.match(/^(.+)%$/);return n?Math.min(.01*parseFloat(n[1])*e,e):Math.min(parseFloat(t),e)}const Mi={deg:t=>t,grad:t=>360*t/400,rad:t=>360*t/(2*Math.PI),turn:t=>360*t};function Oi(t){const e=t.match(/^([0-9.]+?)(deg|grad|rad|turn)$/);if(!e)return parseFloat(t);const n=parseFloat(e[1]),i=e[2];return Mi[i](n)}function Di(t){const e=t.match(/^rgb\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const n=[Pi(e[1],255),Pi(e[2],255),Pi(e[3],255)];return isNaN(n[0])||isNaN(n[1])||isNaN(n[2])?null:n}function Ii(t){return e=>{const n=Di(e);return n?new wi(n,"rgb",t):null}}function Vi(t){const e=t.match(/^rgba\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const n=[Pi(e[1],255),Pi(e[2],255),Pi(e[3],255),Pi(e[4],1)];return isNaN(n[0])||isNaN(n[1])||isNaN(n[2])||isNaN(n[3])?null:n}function Ri(t){return e=>{const n=Vi(e);return n?new wi(n,"rgb",t):null}}function Fi(t){const e=t.match(/^hsl\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const n=[Oi(e[1]),Pi(e[2],100),Pi(e[3],100)];return isNaN(n[0])||isNaN(n[1])||isNaN(n[2])?null:n}function Li(t){return e=>{const n=Fi(e);return n?new wi(n,"hsl",t):null}}function Ni(t){const e=t.match(/^hsla\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const n=[Oi(e[1]),Pi(e[2],100),Pi(e[3],100),Pi(e[4],1)];return isNaN(n[0])||isNaN(n[1])||isNaN(n[2])||isNaN(n[3])?null:n}function Bi(t){return e=>{const n=Ni(e);return n?new wi(n,"hsl",t):null}}function zi(t){const e=t.match(/^#([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(e)return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16)];const n=t.match(/^(?:#|0x)([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return n?[parseInt(n[1],16),parseInt(n[2],16),parseInt(n[3],16)]:null}function ji(t){const e=zi(t);return e?new wi(e,"rgb","int"):null}function Ui(t){const e=t.match(/^#?([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(e)return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16),Mn(parseInt(e[4]+e[4],16),0,255,0,1)];const n=t.match(/^(?:#|0x)?([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return n?[parseInt(n[1],16),parseInt(n[2],16),parseInt(n[3],16),Mn(parseInt(n[4],16),0,255,0,1)]:null}function qi(t){const e=Ui(t);return e?new wi(e,"rgb","int"):null}function Wi(t){const e=t.match(/^\{\s*r\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*g\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*b\s*:\s*([0-9A-Fa-f.]+%?)\s*\}$/);if(!e)return null;const n=[parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3])];return isNaN(n[0])||isNaN(n[1])||isNaN(n[2])?null:n}function Hi(t){return e=>{const n=Wi(e);return n?new wi(n,"rgb",t):null}}function Gi(t){const e=t.match(/^\{\s*r\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*g\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*b\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*a\s*:\s*([0-9A-Fa-f.]+%?)\s*\}$/);if(!e)return null;const n=[parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3]),parseFloat(e[4])];return isNaN(n[0])||isNaN(n[1])||isNaN(n[2])||isNaN(n[3])?null:n}function Ki(t){return e=>{const n=Gi(e);return n?new wi(n,"rgb",t):null}}const Yi=[{parser:zi,result:{alpha:!1,mode:"rgb",notation:"hex"}},{parser:Ui,result:{alpha:!0,mode:"rgb",notation:"hex"}},{parser:Di,result:{alpha:!1,mode:"rgb",notation:"func"}},{parser:Vi,result:{alpha:!0,mode:"rgb",notation:"func"}},{parser:Fi,result:{alpha:!1,mode:"hsl",notation:"func"}},{parser:Ni,result:{alpha:!0,mode:"hsl",notation:"func"}},{parser:Wi,result:{alpha:!1,mode:"rgb",notation:"object"}},{parser:Gi,result:{alpha:!0,mode:"rgb",notation:"object"}}];function Xi(t){return Yi.reduce(((e,{parser:n,result:i})=>e||(n(t)?i:null)),null)}function $i(t,e="int"){const n=Xi(t);return n?"hex"===n.notation&&"float"!==e?Object.assign(Object.assign({},n),{type:"int"}):"func"===n.notation?Object.assign(Object.assign({},n),{type:e}):null:null}const Zi={int:[ji,qi,Ii("int"),Ri("int"),Li("int"),Bi("int"),Hi("int"),Ki("int")],float:[Ii("float"),Ri("float"),Li("float"),Bi("float"),Hi("float"),Ki("float")]};function Qi(t){const e=Zi[t];return n=>{if("string"!=typeof n)return wi.black(t);const i=e.reduce(((t,e)=>t||e(n)),null);return null!=i?i:wi.black(t)}}function Ji(t){const e=Zi[t];return t=>e.reduce(((e,n)=>e||n(t)),null)}function ts(t){const e=Dn(Math.floor(t),0,255).toString(16);return 1===e.length?`0${e}`:e}function es(t,e="#"){return`${e}${di(t.getComponents("rgb")).map(ts).join("")}`}function ns(t,e="#"){const n=t.getComponents("rgb");return`${e}${[n[0],n[1],n[2],255*n[3]].map(ts).join("")}`}function is(t,e){const n=dn("float"===e?2:0);return`rgb(${di(t.getComponents("rgb",e)).map((t=>n(t))).join(", ")})`}function ss(t){return e=>is(e,t)}function rs(t,e){const n=dn(2),i=dn("float"===e?2:0);return`rgba(${t.getComponents("rgb",e).map(((t,e)=>(3===e?n:i)(t))).join(", ")})`}function os(t){return e=>rs(e,t)}function as(t){const e=[dn(0),mn,mn];return`hsl(${di(t.getComponents("hsl")).map(((t,n)=>e[n](t))).join(", ")})`}function ls(t){const e=[dn(0),mn,mn,dn(2)];return`hsla(${t.getComponents("hsl").map(((t,n)=>e[n](t))).join(", ")})`}function cs(t,e){const n=dn("float"===e?2:0),i=["r","g","b"];return`{${di(t.getComponents("rgb",e)).map(((t,e)=>`${i[e]}: ${n(t)}`)).join(", ")}}`}function us(t){return e=>cs(e,t)}function hs(t,e){const n=dn(2),i=dn("float"===e?2:0),s=["r","g","b","a"];return`{${t.getComponents("rgb",e).map(((t,e)=>{const r=3===e?n:i;return`${s[e]}: ${r(t)}`})).join(", ")}}`}function ps(t){return e=>hs(e,t)}const ds=[{format:{alpha:!1,mode:"rgb",notation:"hex",type:"int"},stringifier:es},{format:{alpha:!0,mode:"rgb",notation:"hex",type:"int"},stringifier:ns},{format:{alpha:!1,mode:"hsl",notation:"func",type:"int"},stringifier:as},{format:{alpha:!0,mode:"hsl",notation:"func",type:"int"},stringifier:ls},...["int","float"].reduce(((t,e)=>[...t,{format:{alpha:!1,mode:"rgb",notation:"func",type:e},stringifier:ss(e)},{format:{alpha:!0,mode:"rgb",notation:"func",type:e},stringifier:os(e)},{format:{alpha:!1,mode:"rgb",notation:"object",type:e},stringifier:us(e)},{format:{alpha:!0,mode:"rgb",notation:"object",type:e},stringifier:ps(e)}]),[])];function fs(t){return ds.reduce(((e,n)=>e||(Ei(n.format,t)?n.stringifier:null)),null)}const ms=_("apl");class vs{constructor(t,e){this.onValueChange_=this.onValueChange_.bind(this),this.value=e.value,this.value.emitter.on("change",this.onValueChange_),this.element=t.createElement("div"),this.element.classList.add(ms()),e.viewProps.bindTabIndex(this.element);const n=t.createElement("div");n.classList.add(ms("b")),this.element.appendChild(n);const i=t.createElement("div");i.classList.add(ms("c")),n.appendChild(i),this.colorElem_=i;const s=t.createElement("div");s.classList.add(ms("m")),this.element.appendChild(s),this.markerElem_=s;const r=t.createElement("div");r.classList.add(ms("p")),this.markerElem_.appendChild(r),this.previewElem_=r,this.update_()}update_(){const t=this.value.rawValue,e=t.getComponents("rgb"),n=new wi([e[0],e[1],e[2],0],"rgb"),i=new wi([e[0],e[1],e[2],255],"rgb"),s=["to right",rs(n),rs(i)];this.colorElem_.style.background=`linear-gradient(${s.join(",")})`,this.previewElem_.style.backgroundColor=rs(t);const r=Mn(e[3],0,1,0,100);this.markerElem_.style.left=`${r}%`}onValueChange_(){this.update_()}}class _s{constructor(t,e){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=e.value,this.viewProps=e.viewProps,this.view=new vs(t,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Pn(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(t,e){if(!t.point)return;const n=t.point.x/t.bounds.width,i=this.value.rawValue,[s,r,o]=i.getComponents("hsv");this.value.setRawValue(new wi([s,r,o,n],"hsv"),e)}onPointerDown_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerMove_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerUp_(t){this.handlePointerEvent_(t.data,{forceEmit:!0,last:!0})}onKeyDown_(t){const e=Cn(Si(!0),An(t));if(0===e)return;const n=this.value.rawValue,[i,s,r,o]=n.getComponents("hsv");this.value.setRawValue(new wi([i,s,r,o+e],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(t){0!==Cn(Si(!0),An(t))&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const gs=_("coltxt");function bs(t){const e=t.createElement("select"),n=[{text:"RGB",value:"rgb"},{text:"HSL",value:"hsl"},{text:"HSV",value:"hsv"}];return e.appendChild(n.reduce(((e,n)=>{const i=t.createElement("option");return i.textContent=n.text,i.value=n.value,e.appendChild(i),e}),t.createDocumentFragment())),e}class ys{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(gs());const n=t.createElement("div");n.classList.add(gs("m")),this.modeElem_=bs(t),this.modeElem_.classList.add(gs("ms")),n.appendChild(this.modeSelectElement);const i=t.createElement("div");i.classList.add(gs("mm")),i.appendChild(Q(t,"dropdown")),n.appendChild(i),this.element.appendChild(n);const s=t.createElement("div");s.classList.add(gs("w")),this.element.appendChild(s),this.textsElem_=s,this.textViews_=e.textViews,this.applyTextViews_(),y(e.colorMode,(t=>{this.modeElem_.value=t}))}get modeSelectElement(){return this.modeElem_}get textViews(){return this.textViews_}set textViews(t){this.textViews_=t,this.applyTextViews_()}applyTextViews_(){et(this.textsElem_);const t=this.element.ownerDocument;this.textViews_.forEach((e=>{const n=t.createElement("div");n.classList.add(gs("c")),n.appendChild(e.element),this.textsElem_.appendChild(n)}))}}function ws(t){return dn("float"===t?2:0)}function xs(t,e,n){const i=vi(t,e)[n];return new ve({min:0,max:i})}function Cs(t,e,n){return new Fn(t,{arrayPosition:0===n?"fst":2===n?"lst":"mid",baseStep:Si(!1),parser:e.parser,props:O.fromObject({draggingScale:"float"===e.colorType?.01:1,formatter:ws(e.colorType)}),value:M(0,{constraint:xs(e.colorMode,e.colorType,n)}),viewProps:e.viewProps})}class Ts{constructor(t,e){this.onModeSelectChange_=this.onModeSelectChange_.bind(this),this.colorType_=e.colorType,this.parser_=e.parser,this.value=e.value,this.viewProps=e.viewProps,this.colorMode=M(this.value.rawValue.mode),this.ccs_=this.createComponentControllers_(t),this.view=new ys(t,{colorMode:this.colorMode,textViews:[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view]}),this.view.modeSelectElement.addEventListener("change",this.onModeSelectChange_)}createComponentControllers_(t){const e={colorMode:this.colorMode.rawValue,colorType:this.colorType_,parser:this.parser_,viewProps:this.viewProps},n=[Cs(t,e,0),Cs(t,e,1),Cs(t,e,2)];return n.forEach(((t,e)=>{xn({primary:this.value,secondary:t.value,forward:t=>t.rawValue.getComponents(this.colorMode.rawValue,this.colorType_)[e],backward:(t,n)=>{const i=this.colorMode.rawValue,s=t.rawValue.getComponents(i,this.colorType_);return s[e]=n.rawValue,new wi(fi(di(s),s[3]),i,this.colorType_)}})})),n}onModeSelectChange_(t){const e=t.currentTarget;this.colorMode.rawValue=e.value,this.ccs_=this.createComponentControllers_(this.view.element.ownerDocument),this.view.textViews=[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view]}}const As=_("hpl");class Ss{constructor(t,e){this.onValueChange_=this.onValueChange_.bind(this),this.value=e.value,this.value.emitter.on("change",this.onValueChange_),this.element=t.createElement("div"),this.element.classList.add(As()),e.viewProps.bindTabIndex(this.element);const n=t.createElement("div");n.classList.add(As("c")),this.element.appendChild(n);const i=t.createElement("div");i.classList.add(As("m")),this.element.appendChild(i),this.markerElem_=i,this.update_()}update_(){const t=this.value.rawValue,[e]=t.getComponents("hsv");this.markerElem_.style.backgroundColor=is(new wi([e,100,100],"hsv"));const n=Mn(e,0,360,0,100);this.markerElem_.style.left=`${n}%`}onValueChange_(){this.update_()}}class ks{constructor(t,e){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=e.value,this.viewProps=e.viewProps,this.view=new Ss(t,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Pn(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(t,e){if(!t.point)return;const n=Mn(Dn(t.point.x,0,t.bounds.width),0,t.bounds.width,0,359),i=this.value.rawValue,[,s,r,o]=i.getComponents("hsv");this.value.setRawValue(new wi([n,s,r,o],"hsv"),e)}onPointerDown_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerMove_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerUp_(t){this.handlePointerEvent_(t.data,{forceEmit:!0,last:!0})}onKeyDown_(t){const e=Cn(Si(!1),An(t));if(0===e)return;const n=this.value.rawValue,[i,s,r,o]=n.getComponents("hsv");this.value.setRawValue(new wi([i+e,s,r,o],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(t){0!==Cn(Si(!1),An(t))&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const Es=_("svp"),Ps=64;class Ms{constructor(t,e){this.onValueChange_=this.onValueChange_.bind(this),this.value=e.value,this.value.emitter.on("change",this.onValueChange_),this.element=t.createElement("div"),this.element.classList.add(Es()),e.viewProps.bindTabIndex(this.element);const n=t.createElement("canvas");n.height=Ps,n.width=Ps,n.classList.add(Es("c")),this.element.appendChild(n),this.canvasElement=n;const i=t.createElement("div");i.classList.add(Es("m")),this.element.appendChild(i),this.markerElem_=i,this.update_()}update_(){const t=$(this.canvasElement);if(!t)return;const e=this.value.rawValue.getComponents("hsv"),n=this.canvasElement.width,i=this.canvasElement.height,s=t.getImageData(0,0,n,i),r=s.data;for(let l=0;l<i;l++)for(let t=0;t<n;t++){const s=Mn(t,0,n,0,100),o=Mn(l,0,i,100,0),a=ui(e[0],s,o),c=4*(l*n+t);r[c]=a[0],r[c+1]=a[1],r[c+2]=a[2],r[c+3]=255}t.putImageData(s,0,0);const o=Mn(e[1],0,100,0,100);this.markerElem_.style.left=`${o}%`;const a=Mn(e[2],0,100,100,0);this.markerElem_.style.top=`${a}%`}onValueChange_(){this.update_()}}class Os{constructor(t,e){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=e.value,this.viewProps=e.viewProps,this.view=new Ms(t,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Pn(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(t,e){if(!t.point)return;const n=Mn(t.point.x,0,t.bounds.width,0,100),i=Mn(t.point.y,0,t.bounds.height,100,0),[s,,,r]=this.value.rawValue.getComponents("hsv");this.value.setRawValue(new wi([s,n,i,r],"hsv"),e)}onPointerDown_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerMove_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerUp_(t){this.handlePointerEvent_(t.data,{forceEmit:!0,last:!0})}onKeyDown_(t){kn(t.key)&&t.preventDefault();const[e,n,i,s]=this.value.rawValue.getComponents("hsv"),r=Si(!1),o=Cn(r,An(t)),a=Cn(r,Tn(t));0===o&&0===a||this.value.setRawValue(new wi([e,n+o,i+a,s],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(t){const e=Si(!1),n=Cn(e,An(t)),i=Cn(e,Tn(t));0===n&&0===i||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class Ds{constructor(t,e){this.value=e.value,this.viewProps=e.viewProps,this.hPaletteC_=new ks(t,{value:this.value,viewProps:this.viewProps}),this.svPaletteC_=new Os(t,{value:this.value,viewProps:this.viewProps}),this.alphaIcs_=e.supportsAlpha?{palette:new _s(t,{value:this.value,viewProps:this.viewProps}),text:new Fn(t,{parser:un,baseStep:.1,props:O.fromObject({draggingScale:.01,formatter:dn(2)}),value:M(0,{constraint:new ve({min:0,max:1})}),viewProps:this.viewProps})}:null,this.alphaIcs_&&xn({primary:this.value,secondary:this.alphaIcs_.text.value,forward:t=>t.rawValue.getComponents()[3],backward:(t,e)=>{const n=t.rawValue.getComponents();return n[3]=e.rawValue,new wi(n,t.rawValue.mode)}}),this.textC_=new Ts(t,{colorType:e.colorType,parser:un,value:this.value,viewProps:this.viewProps}),this.view=new Ci(t,{alphaViews:this.alphaIcs_?{palette:this.alphaIcs_.palette.view,text:this.alphaIcs_.text.view}:null,hPaletteView:this.hPaletteC_.view,supportsAlpha:e.supportsAlpha,svPaletteView:this.svPaletteC_.view,textView:this.textC_.view})}get textController(){return this.textC_}}const Is=_("colsw");class Vs{constructor(t,e){this.onValueChange_=this.onValueChange_.bind(this),e.value.emitter.on("change",this.onValueChange_),this.value=e.value,this.element=t.createElement("div"),this.element.classList.add(Is()),e.viewProps.bindClassModifiers(this.element);const n=t.createElement("div");n.classList.add(Is("sw")),this.element.appendChild(n),this.swatchElem_=n;const i=t.createElement("button");i.classList.add(Is("b")),e.viewProps.bindDisabled(i),this.element.appendChild(i),this.buttonElement=i,this.update_()}update_(){const t=this.value.rawValue;this.swatchElem_.style.backgroundColor=ns(t)}onValueChange_(){this.update_()}}class Rs{constructor(t,e){this.value=e.value,this.viewProps=e.viewProps,this.view=new Vs(t,{value:this.value,viewProps:this.viewProps})}}class Fs{constructor(t,e){this.onButtonBlur_=this.onButtonBlur_.bind(this),this.onButtonClick_=this.onButtonClick_.bind(this),this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.value=e.value,this.viewProps=e.viewProps,this.foldable_=ht.create(e.expanded),this.swatchC_=new Rs(t,{value:this.value,viewProps:this.viewProps});const n=this.swatchC_.view.buttonElement;n.addEventListener("blur",this.onButtonBlur_),n.addEventListener("click",this.onButtonClick_),this.textC_=new Se(t,{parser:e.parser,props:O.fromObject({formatter:e.formatter}),value:this.value,viewProps:this.viewProps}),this.view=new oi(t,{foldable:this.foldable_,pickerLayout:e.pickerLayout}),this.view.swatchElement.appendChild(this.swatchC_.view.element),this.view.textElement.appendChild(this.textC_.view.element),this.popC_="popup"===e.pickerLayout?new Ce(t,{viewProps:this.viewProps}):null;const i=new Ds(t,{colorType:e.colorType,supportsAlpha:e.supportsAlpha,value:this.value,viewProps:this.viewProps});i.view.allFocusableElements.forEach((t=>{t.addEventListener("blur",this.onPopupChildBlur_),t.addEventListener("keydown",this.onPopupChildKeydown_)})),this.pickerC_=i,this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(i.view.element),xn({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:t=>t.rawValue,backward:(t,e)=>e.rawValue})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),ft(this.foldable_,this.view.pickerElement))}get textController(){return this.textC_}onButtonBlur_(t){if(!this.popC_)return;const e=this.view.element,n=l(t.relatedTarget);n&&e.contains(n)||(this.popC_.shows.rawValue=!1)}onButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(t){if(!this.popC_)return;const e=this.popC_.view.element,n=it(t);n&&e.contains(n)||n&&n===this.swatchC_.view.buttonElement&&!K(e.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(t){this.popC_?"Escape"===t.key&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&"Escape"===t.key&&this.swatchC_.view.buttonElement.focus()}}function Ls(t,e){return wi.isColorObject(t)?wi.fromObject(t,e):wi.black(e)}function Ns(t){return di(t.getComponents("rgb")).reduce(((t,e)=>t<<8|255&Math.floor(e)),0)}function Bs(t){return t.getComponents("rgb").reduce(((t,e,n)=>t<<8|255&Math.floor(3===n?255*e:e)),0)>>>0}function zs(t){return new wi([t>>16&255,t>>8&255,255&t],"rgb")}function js(t){return new wi([t>>24&255,t>>16&255,t>>8&255,Mn(255&t,0,255,0,1)],"rgb")}function Us(t){return"number"!=typeof t?wi.black():zs(t)}function qs(t){return"number"!=typeof t?wi.black():js(t)}function Ws(t){const e=fs(t);return e?(t,n)=>{qn(t,e(n))}:null}function Hs(t){const e=t?Bs:Ns;return(t,n)=>{qn(t,e(n))}}function Gs(t,e,n){const i=e.toRgbaObject(n);t.writeProperty("r",i.r),t.writeProperty("g",i.g),t.writeProperty("b",i.b),t.writeProperty("a",i.a)}function Ks(t,e,n){const i=e.toRgbaObject(n);t.writeProperty("r",i.r),t.writeProperty("g",i.g),t.writeProperty("b",i.b)}function Ys(t,e){return(n,i)=>{t?Gs(n,i,e):Ks(n,i,e)}}function Xs(t){var e;return!(!(null==t?void 0:t.alpha)&&!(null===(e=null==t?void 0:t.color)||void 0===e?void 0:e.alpha))}function $s(t){return t?t=>ns(t,"0x"):t=>es(t,"0x")}function Zs(t){return"color"in t||"view"in t&&"color"===t.view}const Qs={id:"input-color-number",type:"input",accept:(t,e)=>{if("number"!=typeof t)return null;if(!Zs(e))return null;const n=Ai(e);return n?{initialValue:t,params:n}:null},binding:{reader:t=>Xs(t.params)?qs:Us,equals:wi.equals,writer:t=>Hs(Xs(t.params))},controller:t=>{const e=Xs(t.params),n="expanded"in t.params?t.params.expanded:void 0,i="picker"in t.params?t.params.picker:void 0;return new Fs(t.document,{colorType:"int",expanded:null!=n&&n,formatter:$s(e),parser:Ji("int"),pickerLayout:null!=i?i:"popup",supportsAlpha:e,value:t.value,viewProps:t.viewProps})}};function Js(t){return wi.isRgbaColorObject(t)}function tr(t){return e=>Ls(e,t)}function er(t,e){return n=>t?hs(n,e):cs(n,e)}const nr={id:"input-color-object",type:"input",accept:(t,e)=>{if(!wi.isColorObject(t))return null;const n=Ai(e);return n?{initialValue:t,params:n}:null},binding:{reader:t=>tr(ki(t.params)),equals:wi.equals,writer:t=>Ys(Js(t.initialValue),ki(t.params))},controller:t=>{var e;const n=wi.isRgbaColorObject(t.initialValue),i="expanded"in t.params?t.params.expanded:void 0,s="picker"in t.params?t.params.picker:void 0,r=null!==(e=ki(t.params))&&void 0!==e?e:"int";return new Fs(t.document,{colorType:r,expanded:null!=i&&i,formatter:er(n,r),parser:Ji(r),pickerLayout:null!=s?s:"popup",supportsAlpha:n,value:t.value,viewProps:t.viewProps})}},ir={id:"input-color-string",type:"input",accept:(t,e)=>{if("string"!=typeof t)return null;if("view"in e&&"text"===e.view)return null;const n=$i(t,ki(e));if(!n)return null;if(!fs(n))return null;const i=Ai(e);return i?{initialValue:t,params:i}:null},binding:{reader:t=>{var e;return Qi(null!==(e=ki(t.params))&&void 0!==e?e:"int")},equals:wi.equals,writer:t=>{const e=$i(t.initialValue,ki(t.params));if(!e)throw p.shouldNeverHappen();const n=Ws(e);if(!n)throw p.notBindable();return n}},controller:t=>{const e=$i(t.initialValue,ki(t.params));if(!e)throw p.shouldNeverHappen();const n=fs(e);if(!n)throw p.shouldNeverHappen();const i="expanded"in t.params?t.params.expanded:void 0,s="picker"in t.params?t.params.picker:void 0;return new Fs(t.document,{colorType:e.type,expanded:null!=i&&i,formatter:n,parser:Ji(e.type),pickerLayout:null!=s?s:"popup",supportsAlpha:e.alpha,value:t.value,viewProps:t.viewProps})}};class sr{constructor(t){this.components=t.components,this.asm_=t.assembly}constrain(t){const e=this.asm_.toComponents(t).map(((t,e)=>{var n,i;return null!==(i=null===(n=this.components[e])||void 0===n?void 0:n.constrain(t))&&void 0!==i?i:t}));return this.asm_.fromComponents(e)}}const rr=_("pndtxt");class or{constructor(t,e){this.textViews=e.textViews,this.element=t.createElement("div"),this.element.classList.add(rr()),this.textViews.forEach((e=>{const n=t.createElement("div");n.classList.add(rr("a")),n.appendChild(e.element),this.element.appendChild(n)}))}}function ar(t,e,n){return new Fn(t,{arrayPosition:0===n?"fst":n===e.axes.length-1?"lst":"mid",baseStep:e.axes[n].baseStep,parser:e.parser,props:e.axes[n].textProps,value:M(0,{constraint:e.axes[n].constraint}),viewProps:e.viewProps})}class lr{constructor(t,e){this.value=e.value,this.viewProps=e.viewProps,this.acs_=e.axes.map(((n,i)=>ar(t,e,i))),this.acs_.forEach(((t,n)=>{xn({primary:this.value,secondary:t.value,forward:t=>e.assembly.toComponents(t.rawValue)[n],backward:(t,i)=>{const s=e.assembly.toComponents(t.rawValue);return s[n]=i.rawValue,e.assembly.fromComponents(s)}})})),this.view=new or(t,{textViews:this.acs_.map((t=>t.view))})}}function cr(t,e){return"step"in t&&!c(t.step)?new _e(t.step,e):null}function ur(t){return"max"in t&&!c(t.max)||"min"in t&&!c(t.min)?new ve({max:t.max,min:t.min}):null}function hr(t,e){const n=[],i=cr(t,e);i&&n.push(i);const s=ur(t);s&&n.push(s);const r=Yn(t.options);return r&&n.push(r),new de(n)}function pr(t){const e=t?fe(t,ve):null;return e?[e.minValue,e.maxValue]:[void 0,void 0]}function dr(t){const[e,n]=pr(t);return[null!=e?e:0,null!=n?n:100]}const fr={id:"input-number",type:"input",accept:(t,e)=>{if("number"!=typeof t)return null;const n=L,i=N(e,{format:n.optional.function,max:n.optional.number,min:n.optional.number,options:n.optional.custom(Wn),step:n.optional.number});return i?{initialValue:t,params:i}:null},binding:{reader:t=>hn,constraint:t=>hr(t.params,t.initialValue),writer:t=>qn},controller:t=>{var e,n;const i=t.value,s=t.constraint;if(s&&fe(s,me))return new ye(t.document,{props:O.fromObject({options:null!==(e=Xn(s))&&void 0!==e?e:[]}),value:i,viewProps:t.viewProps});const r=null!==(n="format"in t.params?t.params.format:void 0)&&void 0!==n?n:dn(Zn(s,i.rawValue));if(s&&fe(s,ve)){const[e,n]=dr(s);return new Un(t.document,{baseStep:Qn(s),parser:un,sliderProps:O.fromObject({maxValue:n,minValue:e}),textProps:O.fromObject({draggingScale:Jn(s,i.rawValue),formatter:r}),value:i,viewProps:t.viewProps})}return new Fn(t.document,{baseStep:Qn(s),parser:un,props:O.fromObject({draggingScale:Jn(s,i.rawValue),formatter:r}),value:i,viewProps:t.viewProps})}};class mr{constructor(t=0,e=0){this.x=t,this.y=e}getComponents(){return[this.x,this.y]}static isObject(t){if(c(t))return!1;const e=t.x,n=t.y;return"number"==typeof e&&"number"==typeof n}static equals(t,e){return t.x===e.x&&t.y===e.y}toObject(){return{x:this.x,y:this.y}}}const vr={toComponents:t=>t.getComponents(),fromComponents:t=>new mr(...t)},_r=_("p2d");class gr{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(_r()),e.viewProps.bindClassModifiers(this.element),y(e.expanded,C(this.element,_r(void 0,"expanded")));const n=t.createElement("div");n.classList.add(_r("h")),this.element.appendChild(n);const i=t.createElement("button");i.classList.add(_r("b")),i.appendChild(Q(t,"p2dpad")),e.viewProps.bindDisabled(i),n.appendChild(i),this.buttonElement=i;const s=t.createElement("div");if(s.classList.add(_r("t")),n.appendChild(s),this.textElement=s,"inline"===e.pickerLayout){const e=t.createElement("div");e.classList.add(_r("p")),this.element.appendChild(e),this.pickerElement=e}else this.pickerElement=null}}const br=_("p2dp");class yr{constructor(t,e){this.onFoldableChange_=this.onFoldableChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.invertsY_=e.invertsY,this.maxValue_=e.maxValue,this.element=t.createElement("div"),this.element.classList.add(br()),"popup"===e.layout&&this.element.classList.add(br(void 0,"p"));const n=t.createElement("div");n.classList.add(br("p")),e.viewProps.bindTabIndex(n),this.element.appendChild(n),this.padElement=n;const i=t.createElementNS(W,"svg");i.classList.add(br("g")),this.padElement.appendChild(i),this.svgElem_=i;const s=t.createElementNS(W,"line");s.classList.add(br("ax")),s.setAttributeNS(null,"x1","0"),s.setAttributeNS(null,"y1","50%"),s.setAttributeNS(null,"x2","100%"),s.setAttributeNS(null,"y2","50%"),this.svgElem_.appendChild(s);const r=t.createElementNS(W,"line");r.classList.add(br("ax")),r.setAttributeNS(null,"x1","50%"),r.setAttributeNS(null,"y1","0"),r.setAttributeNS(null,"x2","50%"),r.setAttributeNS(null,"y2","100%"),this.svgElem_.appendChild(r);const o=t.createElementNS(W,"line");o.classList.add(br("l")),o.setAttributeNS(null,"x1","50%"),o.setAttributeNS(null,"y1","50%"),this.svgElem_.appendChild(o),this.lineElem_=o;const a=t.createElement("div");a.classList.add(br("m")),this.padElement.appendChild(a),this.markerElem_=a,e.value.emitter.on("change",this.onValueChange_),this.value=e.value,this.update_()}get allFocusableElements(){return[this.padElement]}update_(){const[t,e]=this.value.rawValue.getComponents(),n=this.maxValue_,i=Mn(t,-n,+n,0,100),s=Mn(e,-n,+n,0,100),r=this.invertsY_?100-s:s;this.lineElem_.setAttributeNS(null,"x2",`${i}%`),this.lineElem_.setAttributeNS(null,"y2",`${r}%`),this.markerElem_.style.left=`${i}%`,this.markerElem_.style.top=`${r}%`}onValueChange_(){this.update_()}onFoldableChange_(){this.update_()}}function wr(t,e,n){return[Cn(e[0],An(t)),Cn(e[1],Tn(t))*(n?1:-1)]}class xr{constructor(t,e){this.onPadKeyDown_=this.onPadKeyDown_.bind(this),this.onPadKeyUp_=this.onPadKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=e.value,this.viewProps=e.viewProps,this.baseSteps_=e.baseSteps,this.maxValue_=e.maxValue,this.invertsY_=e.invertsY,this.view=new yr(t,{invertsY:this.invertsY_,layout:e.layout,maxValue:this.maxValue_,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Pn(this.view.padElement),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.padElement.addEventListener("keydown",this.onPadKeyDown_),this.view.padElement.addEventListener("keyup",this.onPadKeyUp_)}handlePointerEvent_(t,e){if(!t.point)return;const n=this.maxValue_,i=Mn(t.point.x,0,t.bounds.width,-n,+n),s=Mn(this.invertsY_?t.bounds.height-t.point.y:t.point.y,0,t.bounds.height,-n,+n);this.value.setRawValue(new mr(i,s),e)}onPointerDown_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerMove_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerUp_(t){this.handlePointerEvent_(t.data,{forceEmit:!0,last:!0})}onPadKeyDown_(t){kn(t.key)&&t.preventDefault();const[e,n]=wr(t,this.baseSteps_,this.invertsY_);0===e&&0===n||this.value.setRawValue(new mr(this.value.rawValue.x+e,this.value.rawValue.y+n),{forceEmit:!1,last:!1})}onPadKeyUp_(t){const[e,n]=wr(t,this.baseSteps_,this.invertsY_);0===e&&0===n||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class Cr{constructor(t,e){var n,i;this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.onPadButtonBlur_=this.onPadButtonBlur_.bind(this),this.onPadButtonClick_=this.onPadButtonClick_.bind(this),this.value=e.value,this.viewProps=e.viewProps,this.foldable_=ht.create(e.expanded),this.popC_="popup"===e.pickerLayout?new Ce(t,{viewProps:this.viewProps}):null;const s=new xr(t,{baseSteps:[e.axes[0].baseStep,e.axes[1].baseStep],invertsY:e.invertsY,layout:e.pickerLayout,maxValue:e.maxValue,value:this.value,viewProps:this.viewProps});s.view.allFocusableElements.forEach((t=>{t.addEventListener("blur",this.onPopupChildBlur_),t.addEventListener("keydown",this.onPopupChildKeydown_)})),this.pickerC_=s,this.textC_=new lr(t,{assembly:vr,axes:e.axes,parser:e.parser,value:this.value,viewProps:this.viewProps}),this.view=new gr(t,{expanded:this.foldable_.value("expanded"),pickerLayout:e.pickerLayout,viewProps:this.viewProps}),this.view.textElement.appendChild(this.textC_.view.element),null===(n=this.view.buttonElement)||void 0===n||n.addEventListener("blur",this.onPadButtonBlur_),null===(i=this.view.buttonElement)||void 0===i||i.addEventListener("click",this.onPadButtonClick_),this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(this.pickerC_.view.element),xn({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:t=>t.rawValue,backward:(t,e)=>e.rawValue})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),ft(this.foldable_,this.view.pickerElement))}onPadButtonBlur_(t){if(!this.popC_)return;const e=this.view.element,n=l(t.relatedTarget);n&&e.contains(n)||(this.popC_.shows.rawValue=!1)}onPadButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(t){if(!this.popC_)return;const e=this.popC_.view.element,n=it(t);n&&e.contains(n)||n&&n===this.view.buttonElement&&!K(e.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(t){this.popC_?"Escape"===t.key&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&"Escape"===t.key&&this.view.buttonElement.focus()}}function Tr(t){return mr.isObject(t)?new mr(t.x,t.y):new mr}function Ar(t,e){t.writeProperty("x",e.x),t.writeProperty("y",e.y)}function Sr(t,e){if(!t)return;const n=[],i=cr(t,e);i&&n.push(i);const s=ur(t);return s&&n.push(s),new de(n)}function kr(t,e){return new sr({assembly:vr,components:[Sr("x"in t?t.x:void 0,e.x),Sr("y"in t?t.y:void 0,e.y)]})}function Er(t,e){var n,i;const s=t&&fe(t,ve);if(s)return Math.max(Math.abs(null!==(n=s.minValue)&&void 0!==n?n:0),Math.abs(null!==(i=s.maxValue)&&void 0!==i?i:0));const r=Qn(t);return Math.max(10*Math.abs(r),10*Math.abs(e))}function Pr(t,e){const n=e instanceof sr?e.components[0]:void 0,i=e instanceof sr?e.components[1]:void 0,s=Er(n,t.x),r=Er(i,t.y);return Math.max(s,r)}function Mr(t,e){return{baseStep:Qn(e),constraint:e,textProps:O.fromObject({draggingScale:Jn(e,t),formatter:dn(Zn(e,t))})}}function Or(t){if(!("y"in t))return!1;const e=t.y;return!!e&&"inverted"in e&&!!e.inverted}const Dr={id:"input-point2d",type:"input",accept:(t,e)=>{if(!mr.isObject(t))return null;const n=L,i=N(e,{expanded:n.optional.boolean,picker:n.optional.custom(Hn),x:n.optional.custom(Gn),y:n.optional.object({inverted:n.optional.boolean,max:n.optional.number,min:n.optional.number,step:n.optional.number})});return i?{initialValue:t,params:i}:null},binding:{reader:t=>Tr,constraint:t=>kr(t.params,t.initialValue),equals:mr.equals,writer:t=>Ar},controller:t=>{const e=t.document,n=t.value,i=t.constraint;if(!(i instanceof sr))throw p.shouldNeverHappen();const s="expanded"in t.params?t.params.expanded:void 0,r="picker"in t.params?t.params.picker:void 0;return new Cr(e,{axes:[Mr(n.rawValue.x,i.components[0]),Mr(n.rawValue.y,i.components[1])],expanded:null!=s&&s,invertsY:Or(t.params),maxValue:Pr(n.rawValue,i),parser:un,pickerLayout:null!=r?r:"popup",value:n,viewProps:t.viewProps})}};class Ir{constructor(t=0,e=0,n=0){this.x=t,this.y=e,this.z=n}getComponents(){return[this.x,this.y,this.z]}static isObject(t){if(c(t))return!1;const e=t.x,n=t.y,i=t.z;return"number"==typeof e&&"number"==typeof n&&"number"==typeof i}static equals(t,e){return t.x===e.x&&t.y===e.y&&t.z===e.z}toObject(){return{x:this.x,y:this.y,z:this.z}}}const Vr={toComponents:t=>t.getComponents(),fromComponents:t=>new Ir(...t)};function Rr(t){return Ir.isObject(t)?new Ir(t.x,t.y,t.z):new Ir}function Fr(t,e){t.writeProperty("x",e.x),t.writeProperty("y",e.y),t.writeProperty("z",e.z)}function Lr(t,e){return new sr({assembly:Vr,components:[Sr("x"in t?t.x:void 0,e.x),Sr("y"in t?t.y:void 0,e.y),Sr("z"in t?t.z:void 0,e.z)]})}function Nr(t,e){return{baseStep:Qn(e),constraint:e,textProps:O.fromObject({draggingScale:Jn(e,t),formatter:dn(Zn(e,t))})}}const Br={id:"input-point3d",type:"input",accept:(t,e)=>{if(!Ir.isObject(t))return null;const n=L,i=N(e,{x:n.optional.custom(Gn),y:n.optional.custom(Gn),z:n.optional.custom(Gn)});return i?{initialValue:t,params:i}:null},binding:{reader:t=>Rr,constraint:t=>Lr(t.params,t.initialValue),equals:Ir.equals,writer:t=>Fr},controller:t=>{const e=t.value,n=t.constraint;if(!(n instanceof sr))throw p.shouldNeverHappen();return new lr(t.document,{assembly:Vr,axes:[Nr(e.rawValue.x,n.components[0]),Nr(e.rawValue.y,n.components[1]),Nr(e.rawValue.z,n.components[2])],parser:un,value:e,viewProps:t.viewProps})}};class zr{constructor(t=0,e=0,n=0,i=0){this.x=t,this.y=e,this.z=n,this.w=i}getComponents(){return[this.x,this.y,this.z,this.w]}static isObject(t){if(c(t))return!1;const e=t.x,n=t.y,i=t.z,s=t.w;return"number"==typeof e&&"number"==typeof n&&"number"==typeof i&&"number"==typeof s}static equals(t,e){return t.x===e.x&&t.y===e.y&&t.z===e.z&&t.w===e.w}toObject(){return{x:this.x,y:this.y,z:this.z,w:this.w}}}const jr={toComponents:t=>t.getComponents(),fromComponents:t=>new zr(...t)};function Ur(t){return zr.isObject(t)?new zr(t.x,t.y,t.z,t.w):new zr}function qr(t,e){t.writeProperty("x",e.x),t.writeProperty("y",e.y),t.writeProperty("z",e.z),t.writeProperty("w",e.w)}function Wr(t,e){return new sr({assembly:jr,components:[Sr("x"in t?t.x:void 0,e.x),Sr("y"in t?t.y:void 0,e.y),Sr("z"in t?t.z:void 0,e.z),Sr("w"in t?t.w:void 0,e.w)]})}function Hr(t,e){return{baseStep:Qn(e),constraint:e,textProps:O.fromObject({draggingScale:Jn(e,t),formatter:dn(Zn(e,t))})}}const Gr={id:"input-point4d",type:"input",accept:(t,e)=>{if(!zr.isObject(t))return null;const n=L,i=N(e,{x:n.optional.custom(Gn),y:n.optional.custom(Gn),z:n.optional.custom(Gn),w:n.optional.custom(Gn)});return i?{initialValue:t,params:i}:null},binding:{reader:t=>Ur,constraint:t=>Wr(t.params,t.initialValue),equals:zr.equals,writer:t=>qr},controller:t=>{const e=t.value,n=t.constraint;if(!(n instanceof sr))throw p.shouldNeverHappen();return new lr(t.document,{assembly:jr,axes:e.rawValue.getComponents().map(((t,e)=>Hr(t,n.components[e]))),parser:un,value:e,viewProps:t.viewProps})}};function Kr(t){const e=[],n=Yn(t.options);return n&&e.push(n),new de(e)}const Yr={id:"input-string",type:"input",accept:(t,e)=>{if("string"!=typeof t)return null;const n=N(e,{options:L.optional.custom(Wn)});return n?{initialValue:t,params:n}:null},binding:{reader:t=>vn,constraint:t=>Kr(t.params),writer:t=>qn},controller:t=>{var e;const n=t.document,i=t.value,s=t.constraint;return s&&fe(s,me)?new ye(n,{props:O.fromObject({options:null!==(e=Xn(s))&&void 0!==e?e:[]}),value:i,viewProps:t.viewProps}):new Se(n,{parser:t=>t,props:O.fromObject({formatter:_n}),value:i,viewProps:t.viewProps})}},Xr={monitor:{defaultInterval:200,defaultLineCount:3}},$r=_("mll");class Zr{constructor(t,e){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=e.formatter,this.element=t.createElement("div"),this.element.classList.add($r()),e.viewProps.bindClassModifiers(this.element);const n=t.createElement("textarea");n.classList.add($r("i")),n.style.height=`calc(var(--bld-us) * ${e.lineCount})`,n.readOnly=!0,e.viewProps.bindDisabled(n),this.element.appendChild(n),this.textareaElem_=n,e.value.emitter.on("change",this.onValueUpdate_),this.value=e.value,this.update_()}update_(){const t=this.textareaElem_,e=t.scrollTop===t.scrollHeight-t.clientHeight,n=[];this.value.rawValue.forEach((t=>{void 0!==t&&n.push(this.formatter_(t))})),t.textContent=n.join("\n"),e&&(t.scrollTop=t.scrollHeight)}onValueUpdate_(){this.update_()}}class Qr{constructor(t,e){this.value=e.value,this.viewProps=e.viewProps,this.view=new Zr(t,{formatter:e.formatter,lineCount:e.lineCount,value:this.value,viewProps:this.viewProps})}}const Jr=_("sgl");class to{constructor(t,e){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=e.formatter,this.element=t.createElement("div"),this.element.classList.add(Jr()),e.viewProps.bindClassModifiers(this.element);const n=t.createElement("input");n.classList.add(Jr("i")),n.readOnly=!0,n.type="text",e.viewProps.bindDisabled(n),this.element.appendChild(n),this.inputElement=n,e.value.emitter.on("change",this.onValueUpdate_),this.value=e.value,this.update_()}update_(){const t=this.value.rawValue,e=t[t.length-1];this.inputElement.value=void 0!==e?this.formatter_(e):""}onValueUpdate_(){this.update_()}}class eo{constructor(t,e){this.value=e.value,this.viewProps=e.viewProps,this.view=new to(t,{formatter:e.formatter,value:this.value,viewProps:this.viewProps})}}const no={id:"monitor-bool",type:"monitor",accept:(t,e)=>{if("boolean"!=typeof t)return null;const n=N(e,{lineCount:L.optional.number});return n?{initialValue:t,params:n}:null},binding:{reader:t=>Ee},controller:t=>{var e;return 1===t.value.rawValue.length?new eo(t.document,{formatter:Pe,value:t.value,viewProps:t.viewProps}):new Qr(t.document,{formatter:Pe,lineCount:null!==(e=t.params.lineCount)&&void 0!==e?e:Xr.monitor.defaultLineCount,value:t.value,viewProps:t.viewProps})}},io=_("grl");class so{constructor(t,e){this.onCursorChange_=this.onCursorChange_.bind(this),this.onValueUpdate_=this.onValueUpdate_.bind(this),this.element=t.createElement("div"),this.element.classList.add(io()),e.viewProps.bindClassModifiers(this.element),this.formatter_=e.formatter,this.props_=e.props,this.cursor_=e.cursor,this.cursor_.emitter.on("change",this.onCursorChange_);const n=t.createElementNS(W,"svg");n.classList.add(io("g")),n.style.height=`calc(var(--bld-us) * ${e.lineCount})`,this.element.appendChild(n),this.svgElem_=n;const i=t.createElementNS(W,"polyline");this.svgElem_.appendChild(i),this.lineElem_=i;const s=t.createElement("div");s.classList.add(io("t"),_("tt")()),this.element.appendChild(s),this.tooltipElem_=s,e.value.emitter.on("change",this.onValueUpdate_),this.value=e.value,this.update_()}get graphElement(){return this.svgElem_}update_(){const t=this.svgElem_.getBoundingClientRect(),e=this.value.rawValue.length-1,n=this.props_.get("minValue"),i=this.props_.get("maxValue"),s=[];this.value.rawValue.forEach(((r,o)=>{if(void 0===r)return;const a=Mn(o,0,e,0,t.width),l=Mn(r,n,i,t.height,0);s.push([a,l].join(","))})),this.lineElem_.setAttributeNS(null,"points",s.join(" "));const r=this.tooltipElem_,o=this.value.rawValue[this.cursor_.rawValue];if(void 0===o)return void r.classList.remove(io("t","a"));const a=Mn(this.cursor_.rawValue,0,e,0,t.width),l=Mn(o,n,i,t.height,0);r.style.left=`${a}px`,r.style.top=`${l}px`,r.textContent=`${this.formatter_(o)}`,r.classList.contains(io("t","a"))||(r.classList.add(io("t","a"),io("t","in")),H(r),r.classList.remove(io("t","in")))}onValueUpdate_(){this.update_()}onCursorChange_(){this.update_()}}class ro{constructor(t,e){if(this.onGraphMouseMove_=this.onGraphMouseMove_.bind(this),this.onGraphMouseLeave_=this.onGraphMouseLeave_.bind(this),this.onGraphPointerDown_=this.onGraphPointerDown_.bind(this),this.onGraphPointerMove_=this.onGraphPointerMove_.bind(this),this.onGraphPointerUp_=this.onGraphPointerUp_.bind(this),this.props_=e.props,this.value=e.value,this.viewProps=e.viewProps,this.cursor_=M(-1),this.view=new so(t,{cursor:this.cursor_,formatter:e.formatter,lineCount:e.lineCount,props:this.props_,value:this.value,viewProps:this.viewProps}),K(t)){const t=new Pn(this.view.element);t.emitter.on("down",this.onGraphPointerDown_),t.emitter.on("move",this.onGraphPointerMove_),t.emitter.on("up",this.onGraphPointerUp_)}else this.view.element.addEventListener("mousemove",this.onGraphMouseMove_),this.view.element.addEventListener("mouseleave",this.onGraphMouseLeave_)}onGraphMouseLeave_(){this.cursor_.rawValue=-1}onGraphMouseMove_(t){const e=this.view.element.getBoundingClientRect();this.cursor_.rawValue=Math.floor(Mn(t.offsetX,0,e.width,0,this.value.rawValue.length))}onGraphPointerDown_(t){this.onGraphPointerMove_(t)}onGraphPointerMove_(t){t.data.point?this.cursor_.rawValue=Math.floor(Mn(t.data.point.x,0,t.data.bounds.width,0,this.value.rawValue.length)):this.cursor_.rawValue=-1}onGraphPointerUp_(){this.cursor_.rawValue=-1}}function oo(t){return"format"in t&&!c(t.format)?t.format:dn(2)}function ao(t){var e;return 1===t.value.rawValue.length?new eo(t.document,{formatter:oo(t.params),value:t.value,viewProps:t.viewProps}):new Qr(t.document,{formatter:oo(t.params),lineCount:null!==(e=t.params.lineCount)&&void 0!==e?e:Xr.monitor.defaultLineCount,value:t.value,viewProps:t.viewProps})}function lo(t){var e,n,i;return new ro(t.document,{formatter:oo(t.params),lineCount:null!==(e=t.params.lineCount)&&void 0!==e?e:Xr.monitor.defaultLineCount,props:O.fromObject({maxValue:null!==(n="max"in t.params?t.params.max:null)&&void 0!==n?n:100,minValue:null!==(i="min"in t.params?t.params.min:null)&&void 0!==i?i:0}),value:t.value,viewProps:t.viewProps})}function co(t){return"view"in t&&"graph"===t.view}const uo={id:"monitor-number",type:"monitor",accept:(t,e)=>{if("number"!=typeof t)return null;const n=L,i=N(e,{format:n.optional.function,lineCount:n.optional.number,max:n.optional.number,min:n.optional.number,view:n.optional.string});return i?{initialValue:t,params:i}:null},binding:{defaultBufferSize:t=>co(t)?64:1,reader:t=>hn},controller:t=>co(t.params)?lo(t):ao(t)},ho={id:"monitor-string",type:"monitor",accept:(t,e)=>{if("string"!=typeof t)return null;const n=L,i=N(e,{lineCount:n.optional.number,multiline:n.optional.boolean});return i?{initialValue:t,params:i}:null},binding:{reader:t=>vn},controller:t=>{var e;const n=t.value;return n.rawValue.length>1||"multiline"in t.params&&t.params.multiline?new Qr(t.document,{formatter:_n,lineCount:null!==(e=t.params.lineCount)&&void 0!==e?e:Xr.monitor.defaultLineCount,value:n,viewProps:t.viewProps}):new eo(t.document,{formatter:_n,value:n,viewProps:t.viewProps})}};class po{constructor(t){this.onValueChange_=this.onValueChange_.bind(this),this.reader=t.reader,this.writer=t.writer,this.emitter=new m,this.value=t.value,this.value.emitter.on("change",this.onValueChange_),this.target=t.target,this.read()}read(){const t=this.target.read();void 0!==t&&(this.value.rawValue=this.reader(t))}write_(t){this.writer(this.target,t)}onValueChange_(t){this.write_(t.rawValue),this.emitter.emit("change",{options:t.options,rawValue:t.rawValue,sender:this})}}function fo(t,e){const n=t.accept(e.target.read(),e.params);if(c(n))return null;const i=L,s={target:e.target,initialValue:n.initialValue,params:n.params},r=t.binding.reader(s),o=t.binding.constraint?t.binding.constraint(s):void 0,a=M(r(n.initialValue),{constraint:o,equals:t.binding.equals}),l=new po({reader:r,target:e.target,value:a,writer:t.binding.writer(s)}),u=i.optional.boolean(e.params.disabled).value,h=i.optional.boolean(e.params.hidden).value,p=t.controller({constraint:o,document:e.document,initialValue:n.initialValue,params:n.params,value:l.value,viewProps:Zt.create({disabled:u,hidden:h})}),d=i.optional.string(e.params.label).value;return new xt(e.document,{binding:l,blade:ut(),props:O.fromObject({label:null!=d?d:e.target.key}),valueController:p})}class mo{constructor(t){this.onTick_=this.onTick_.bind(this),this.reader_=t.reader,this.target=t.target,this.emitter=new m,this.value=t.value,this.ticker=t.ticker,this.ticker.emitter.on("tick",this.onTick_),this.read()}dispose(){this.ticker.dispose()}read(){const t=this.target.read();if(void 0===t)return;const e=this.value.rawValue,n=this.reader_(t);this.value.rawValue=wn(e,n),this.emitter.emit("update",{rawValue:n,sender:this})}onTick_(t){this.read()}}function vo(t,e){return 0===e?new he:new pe(t,null!=e?e:Xr.monitor.defaultInterval)}function _o(t,e){var n,i,s;const r=L,o=t.accept(e.target.read(),e.params);if(c(o))return null;const a={target:e.target,initialValue:o.initialValue,params:o.params},l=t.binding.reader(a),u=null!==(i=null!==(n=r.optional.number(e.params.bufferSize).value)&&void 0!==n?n:t.binding.defaultBufferSize&&t.binding.defaultBufferSize(o.params))&&void 0!==i?i:1,h=r.optional.number(e.params.interval).value,p=new mo({reader:l,target:e.target,ticker:vo(e.document,h),value:bn(u)}),d=r.optional.boolean(e.params.disabled).value,f=r.optional.boolean(e.params.hidden).value,m=t.controller({document:e.document,params:o.params,value:p.value,viewProps:Zt.create({disabled:d,hidden:f})}),v=null!==(s=r.optional.string(e.params.label).value)&&void 0!==s?s:e.target.key;return new Tt(e.document,{binding:p,blade:ut(),props:O.fromObject({label:v}),valueController:m})}class go{constructor(){this.pluginsMap_={blades:[],inputs:[],monitors:[]}}getAll(){return[...this.pluginsMap_.blades,...this.pluginsMap_.inputs,...this.pluginsMap_.monitors]}register(t){"blade"===t.type?this.pluginsMap_.blades.unshift(t):"input"===t.type?this.pluginsMap_.inputs.unshift(t):"monitor"===t.type&&this.pluginsMap_.monitors.unshift(t)}createInput(t,e,n){if(c(e.read()))throw new p({context:{key:e.key},type:"nomatchingcontroller"});const i=this.pluginsMap_.inputs.reduce(((i,s)=>null!=i?i:fo(s,{document:t,target:e,params:n})),null);if(i)return i;throw new p({context:{key:e.key},type:"nomatchingcontroller"})}createMonitor(t,e,n){const i=this.pluginsMap_.monitors.reduce(((i,s)=>null!=i?i:_o(s,{document:t,params:n,target:e})),null);if(i)return i;throw new p({context:{key:e.key},type:"nomatchingcontroller"})}createBlade(t,e){const n=this.pluginsMap_.blades.reduce(((n,i)=>null!=n?n:ue(i,{document:t,params:e})),null);if(!n)throw new p({type:"nomatchingview",context:{params:e}});return n}createBladeApi(t){if(t instanceof xt)return new wt(t);if(t instanceof Tt)return new Ct(t);if(t instanceof Nt)return new Et(t,this);const e=this.pluginsMap_.blades.reduce(((e,n)=>null!=e?e:n.api({controller:t,pool:this})),null);if(!e)throw p.shouldNeverHappen();return e}}function bo(){const t=new go;return[Dr,Br,Gr,Yr,fr,ir,nr,Qs,si,no,ho,uo,lt,Ut,Yt,ce].forEach((e=>{t.register(e)})),t}class yo extends n{constructor(t){super(t),this.emitter_=new m,this.controller_.valueController.value.emitter.on("change",(t=>{this.emitter_.emit("change",{event:new s(this,t.rawValue)})}))}get label(){return this.controller_.props.get("label")}set label(t){this.controller_.props.set("label",t)}get options(){return this.controller_.valueController.props.get("options")}set options(t){this.controller_.valueController.props.set("options",t)}get value(){return this.controller_.valueController.value.rawValue}set value(t){this.controller_.valueController.value.rawValue=t}on(t,e){const n=e.bind(this);return this.emitter_.on(t,(t=>{n(t.event)})),this}}class wo extends n{constructor(t){super(t),this.emitter_=new m,this.controller_.valueController.value.emitter.on("change",(t=>{this.emitter_.emit("change",{event:new s(this,t.rawValue)})}))}get label(){return this.controller_.props.get("label")}set label(t){this.controller_.props.set("label",t)}get maxValue(){return this.controller_.valueController.sliderController.props.get("maxValue")}set maxValue(t){this.controller_.valueController.sliderController.props.set("maxValue",t)}get minValue(){return this.controller_.valueController.sliderController.props.get("minValue")}set minValue(t){this.controller_.valueController.sliderController.props.set("minValue",t)}get value(){return this.controller_.valueController.value.rawValue}set value(t){this.controller_.valueController.value.rawValue=t}on(t,e){const n=e.bind(this);return this.emitter_.on(t,(t=>{n(t.event)})),this}}class xo extends n{constructor(t){super(t),this.emitter_=new m,this.controller_.valueController.value.emitter.on("change",(t=>{this.emitter_.emit("change",{event:new s(this,t.rawValue)})}))}get label(){return this.controller_.props.get("label")}set label(t){this.controller_.props.set("label",t)}get formatter(){return this.controller_.valueController.props.get("formatter")}set formatter(t){this.controller_.valueController.props.set("formatter",t)}get value(){return this.controller_.valueController.value.rawValue}set value(t){this.controller_.valueController.value.rawValue=t}on(t,e){const n=e.bind(this);return this.emitter_.on(t,(t=>{n(t.event)})),this}}const Co={id:"list",type:"blade",accept(t){const e=L,n=N(t,{options:e.required.custom(Wn),value:e.required.raw,view:e.required.constant("list"),label:e.optional.string});return n?{params:n}:null},controller(t){const e=new ye(t.document,{props:O.fromObject({options:Kn(t.params.options)}),value:M(t.params.value),viewProps:t.viewProps});return new qt(t.document,{blade:t.blade,props:O.fromObject({label:t.params.label}),valueController:e})},api:t=>t.controller instanceof qt&&t.controller.valueController instanceof ye?new yo(t.controller):null};function To(t){return t.reduce(((t,e)=>Object.assign(t,{[e.presetKey]:e.read()})),{})}function Ao(t,e){t.forEach((t=>{const n=e[t.presetKey];void 0!==n&&t.write(n)}))}class So extends Pt{constructor(t,e){super(t,e)}get element(){return this.controller_.view.element}importPreset(t){Ao(this.controller_.rackController.rack.find(xt).map((t=>t.binding.target)),t),this.refresh()}exportPreset(){return To(this.controller_.rackController.rack.find(xt).map((t=>t.binding.target)))}refresh(){this.controller_.rackController.rack.find(xt).forEach((t=>{t.binding.read()})),this.controller_.rackController.rack.find(Tt).forEach((t=>{t.binding.read()}))}}class ko extends jt{constructor(t,e){super(t,{expanded:e.expanded,blade:e.blade,props:e.props,root:!0,viewProps:e.viewProps})}}const Eo={id:"slider",type:"blade",accept(t){const e=L,n=N(t,{max:e.required.number,min:e.required.number,view:e.required.constant("slider"),format:e.optional.function,label:e.optional.string,value:e.optional.number});return n?{params:n}:null},controller(t){var e,n;const i=null!==(e=t.params.value)&&void 0!==e?e:0,s=new Un(t.document,{baseStep:1,parser:un,sliderProps:O.fromObject({maxValue:t.params.max,minValue:t.params.min}),textProps:O.fromObject({draggingScale:Jn(void 0,i),formatter:null!==(n=t.params.format)&&void 0!==n?n:pn}),value:M(i),viewProps:t.viewProps});return new qt(t.document,{blade:t.blade,props:O.fromObject({label:t.params.label}),valueController:s})},api:t=>t.controller instanceof qt&&t.controller.valueController instanceof Un?new wo(t.controller):null},Po={id:"text",type:"blade",accept(t){const e=L,n=N(t,{parse:e.required.function,value:e.required.raw,view:e.required.constant("text"),format:e.optional.function,label:e.optional.string});return n?{params:n}:null},controller(t){var e;const n=new Se(t.document,{parser:t.params.parse,props:O.fromObject({formatter:null!==(e=t.params.format)&&void 0!==e?e:t=>String(t)}),value:M(t.params.value),viewProps:t.viewProps});return new qt(t.document,{blade:t.blade,props:O.fromObject({label:t.params.label}),valueController:n})},api:t=>t.controller instanceof qt&&t.controller.valueController instanceof Se?new xo(t.controller):null};function Mo(t){const e=t.createElement("div");return e.classList.add(_("dfw")()),t.body&&t.body.appendChild(e),e}function Oo(t,e,n){if(t.querySelector(`style[data-tp-style=${e}]`))return;const i=t.createElement("style");i.dataset.tpStyle=e,i.textContent=n,t.head.appendChild(i)}class Do extends So{constructor(t){var e,n;const i=null!=t?t:{},s=null!==(e=i.document)&&void 0!==e?e:X(),r=bo();super(new ko(s,{expanded:i.expanded,blade:ut(),props:O.fromObject({title:i.title}),viewProps:Zt.create()}),r),this.pool_=r,this.containerElem_=null!==(n=i.container)&&void 0!==n?n:Mo(s),this.containerElem_.appendChild(this.element),this.doc_=s,this.usesDefaultWrapper_=!i.container,this.setUpDefaultPlugins_()}get document(){if(!this.doc_)throw p.alreadyDisposed();return this.doc_}dispose(){const t=this.containerElem_;if(!t)throw p.alreadyDisposed();if(this.usesDefaultWrapper_){const e=t.parentElement;e&&e.removeChild(t)}this.containerElem_=null,this.doc_=null,super.dispose()}registerPlugin(t){("plugin"in t?[t.plugin]:"plugins"in t?t.plugins:[]).forEach((t=>{this.pool_.register(t),this.embedPluginStyle_(t)}))}embedPluginStyle_(t){t.css&&Oo(this.document,`plugin-${t.id}`,t.css)}setUpDefaultPlugins_(){Oo(this.document,"default",'.tp-tbiv_b,.tp-coltxtv_ms,.tp-ckbv_i,.tp-rotv_b,.tp-fldv_b,.tp-mllv_i,.tp-sglv_i,.tp-grlv_g,.tp-txtv_i,.tp-p2dpv_p,.tp-colswv_sw,.tp-p2dv_b,.tp-btnv_b,.tp-lstv_s{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border-width:0;font-family:inherit;font-size:inherit;font-weight:inherit;margin:0;outline:none;padding:0}.tp-p2dv_b,.tp-btnv_b,.tp-lstv_s{background-color:var(--btn-bg);border-radius:var(--elm-br);color:var(--btn-fg);cursor:pointer;display:block;font-weight:bold;height:var(--bld-us);line-height:var(--bld-us);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.tp-p2dv_b:hover,.tp-btnv_b:hover,.tp-lstv_s:hover{background-color:var(--btn-bg-h)}.tp-p2dv_b:focus,.tp-btnv_b:focus,.tp-lstv_s:focus{background-color:var(--btn-bg-f)}.tp-p2dv_b:active,.tp-btnv_b:active,.tp-lstv_s:active{background-color:var(--btn-bg-a)}.tp-p2dv_b:disabled,.tp-btnv_b:disabled,.tp-lstv_s:disabled{opacity:.5}.tp-txtv_i,.tp-p2dpv_p,.tp-colswv_sw{background-color:var(--in-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--in-fg);font-family:inherit;height:var(--bld-us);line-height:var(--bld-us);min-width:0;width:100%}.tp-txtv_i:hover,.tp-p2dpv_p:hover,.tp-colswv_sw:hover{background-color:var(--in-bg-h)}.tp-txtv_i:focus,.tp-p2dpv_p:focus,.tp-colswv_sw:focus{background-color:var(--in-bg-f)}.tp-txtv_i:active,.tp-p2dpv_p:active,.tp-colswv_sw:active{background-color:var(--in-bg-a)}.tp-txtv_i:disabled,.tp-p2dpv_p:disabled,.tp-colswv_sw:disabled{opacity:.5}.tp-mllv_i,.tp-sglv_i,.tp-grlv_g{background-color:var(--mo-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--mo-fg);height:var(--bld-us);scrollbar-color:currentColor transparent;scrollbar-width:thin;width:100%}.tp-mllv_i::-webkit-scrollbar,.tp-sglv_i::-webkit-scrollbar,.tp-grlv_g::-webkit-scrollbar{height:8px;width:8px}.tp-mllv_i::-webkit-scrollbar-corner,.tp-sglv_i::-webkit-scrollbar-corner,.tp-grlv_g::-webkit-scrollbar-corner{background-color:transparent}.tp-mllv_i::-webkit-scrollbar-thumb,.tp-sglv_i::-webkit-scrollbar-thumb,.tp-grlv_g::-webkit-scrollbar-thumb{background-clip:padding-box;background-color:currentColor;border:transparent solid 2px;border-radius:4px}.tp-rotv{--font-family: var(--tp-font-family, Roboto Mono, Source Code Pro, Menlo, Courier, monospace);--bs-br: var(--tp-base-border-radius, 6px);--cnt-h-p: var(--tp-container-horizontal-padding, 4px);--cnt-v-p: var(--tp-container-vertical-padding, 4px);--elm-br: var(--tp-element-border-radius, 2px);--bld-s: var(--tp-blade-spacing, 4px);--bld-us: var(--tp-blade-unit-size, 20px);--bs-bg: var(--tp-base-background-color, #28292e);--bs-sh: var(--tp-base-shadow-color, rgba(0, 0, 0, 0.2));--btn-bg: var(--tp-button-background-color, #adafb8);--btn-bg-a: var(--tp-button-background-color-active, #d6d7db);--btn-bg-f: var(--tp-button-background-color-focus, #c8cad0);--btn-bg-h: var(--tp-button-background-color-hover, #bbbcc4);--btn-fg: var(--tp-button-foreground-color, #28292e);--cnt-bg: var(--tp-container-background-color, rgba(187, 188, 196, 0.1));--cnt-bg-a: var(--tp-container-background-color-active, rgba(187, 188, 196, 0.25));--cnt-bg-f: var(--tp-container-background-color-focus, rgba(187, 188, 196, 0.2));--cnt-bg-h: var(--tp-container-background-color-hover, rgba(187, 188, 196, 0.15));--cnt-fg: var(--tp-container-foreground-color, #bbbcc4);--in-bg: var(--tp-input-background-color, rgba(187, 188, 196, 0.1));--in-bg-a: var(--tp-input-background-color-active, rgba(187, 188, 196, 0.25));--in-bg-f: var(--tp-input-background-color-focus, rgba(187, 188, 196, 0.2));--in-bg-h: var(--tp-input-background-color-hover, rgba(187, 188, 196, 0.15));--in-fg: var(--tp-input-foreground-color, #bbbcc4);--lbl-fg: var(--tp-label-foreground-color, rgba(187, 188, 196, 0.7));--mo-bg: var(--tp-monitor-background-color, rgba(0, 0, 0, 0.2));--mo-fg: var(--tp-monitor-foreground-color, rgba(187, 188, 196, 0.7));--grv-fg: var(--tp-groove-foreground-color, rgba(187, 188, 196, 0.1))}.tp-rotv_c>.tp-cntv.tp-v-lst,.tp-tabv_c .tp-brkv>.tp-cntv.tp-v-lst,.tp-fldv_c>.tp-cntv.tp-v-lst{margin-bottom:calc(-1*var(--cnt-v-p))}.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-tabv_c .tp-brkv>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_c{border-bottom-left-radius:0}.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-tabv_c .tp-brkv>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_b{border-bottom-left-radius:0}.tp-rotv_c>*:not(.tp-v-fst),.tp-tabv_c .tp-brkv>*:not(.tp-v-fst),.tp-fldv_c>*:not(.tp-v-fst){margin-top:var(--bld-s)}.tp-rotv_c>.tp-sprv:not(.tp-v-fst),.tp-tabv_c .tp-brkv>.tp-sprv:not(.tp-v-fst),.tp-fldv_c>.tp-sprv:not(.tp-v-fst),.tp-rotv_c>.tp-cntv:not(.tp-v-fst),.tp-tabv_c .tp-brkv>.tp-cntv:not(.tp-v-fst),.tp-fldv_c>.tp-cntv:not(.tp-v-fst){margin-top:var(--cnt-v-p)}.tp-rotv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-tabv_c .tp-brkv>.tp-sprv+*:not(.tp-v-hidden),.tp-fldv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-rotv_c>.tp-cntv+*:not(.tp-v-hidden),.tp-tabv_c .tp-brkv>.tp-cntv+*:not(.tp-v-hidden),.tp-fldv_c>.tp-cntv+*:not(.tp-v-hidden){margin-top:var(--cnt-v-p)}.tp-rotv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-tabv_c .tp-brkv>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-fldv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-rotv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-tabv_c .tp-brkv>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-fldv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv{margin-top:0}.tp-tabv_c .tp-brkv>.tp-cntv,.tp-fldv_c>.tp-cntv{margin-left:4px}.tp-tabv_c .tp-brkv>.tp-fldv>.tp-fldv_b,.tp-fldv_c>.tp-fldv>.tp-fldv_b{border-top-left-radius:var(--elm-br);border-bottom-left-radius:var(--elm-br)}.tp-tabv_c .tp-brkv>.tp-fldv.tp-fldv-expanded>.tp-fldv_b,.tp-fldv_c>.tp-fldv.tp-fldv-expanded>.tp-fldv_b{border-bottom-left-radius:0}.tp-tabv_c .tp-brkv .tp-fldv>.tp-fldv_c,.tp-fldv_c .tp-fldv>.tp-fldv_c{border-bottom-left-radius:var(--elm-br)}.tp-tabv_c .tp-brkv>.tp-tabv>.tp-tabv_i,.tp-fldv_c>.tp-tabv>.tp-tabv_i{border-top-left-radius:var(--elm-br)}.tp-tabv_c .tp-brkv .tp-tabv>.tp-tabv_c,.tp-fldv_c .tp-tabv>.tp-tabv_c{border-bottom-left-radius:var(--elm-br)}.tp-rotv_b,.tp-fldv_b{background-color:var(--cnt-bg);color:var(--cnt-fg);cursor:pointer;display:block;height:calc(var(--bld-us) + 4px);line-height:calc(var(--bld-us) + 4px);overflow:hidden;padding-left:var(--cnt-h-p);padding-right:calc(4px + var(--bld-us) + var(--cnt-h-p));position:relative;text-align:left;text-overflow:ellipsis;white-space:nowrap;width:100%;transition:border-radius .2s ease-in-out .2s}.tp-rotv_b:hover,.tp-fldv_b:hover{background-color:var(--cnt-bg-h)}.tp-rotv_b:focus,.tp-fldv_b:focus{background-color:var(--cnt-bg-f)}.tp-rotv_b:active,.tp-fldv_b:active{background-color:var(--cnt-bg-a)}.tp-rotv_b:disabled,.tp-fldv_b:disabled{opacity:.5}.tp-rotv_m,.tp-fldv_m{background:linear-gradient(to left, var(--cnt-fg), var(--cnt-fg) 2px, transparent 2px, transparent 4px, var(--cnt-fg) 4px);border-radius:2px;bottom:0;content:"";display:block;height:6px;right:calc(var(--cnt-h-p) + (var(--bld-us) + 4px - 6px)/2 - 2px);margin:auto;opacity:.5;position:absolute;top:0;transform:rotate(90deg);transition:transform .2s ease-in-out;width:6px}.tp-rotv.tp-rotv-expanded .tp-rotv_m,.tp-fldv.tp-fldv-expanded>.tp-fldv_b>.tp-fldv_m{transform:none}.tp-rotv_c,.tp-fldv_c{box-sizing:border-box;height:0;opacity:0;overflow:hidden;padding-bottom:0;padding-top:0;position:relative;transition:height .2s ease-in-out,opacity .2s linear,padding .2s ease-in-out}.tp-rotv.tp-rotv-cpl:not(.tp-rotv-expanded) .tp-rotv_c,.tp-fldv.tp-fldv-cpl:not(.tp-fldv-expanded)>.tp-fldv_c{display:none}.tp-rotv.tp-rotv-expanded .tp-rotv_c,.tp-fldv.tp-fldv-expanded>.tp-fldv_c{opacity:1;padding-bottom:var(--cnt-v-p);padding-top:var(--cnt-v-p);transform:none;overflow:visible;transition:height .2s ease-in-out,opacity .2s linear .2s,padding .2s ease-in-out}.tp-lstv,.tp-coltxtv_m{position:relative}.tp-lstv_s{padding:0 20px 0 4px;width:100%}.tp-lstv_m,.tp-coltxtv_mm{bottom:0;margin:auto;pointer-events:none;position:absolute;right:2px;top:0}.tp-lstv_m svg,.tp-coltxtv_mm svg{bottom:0;height:16px;margin:auto;position:absolute;right:0;top:0;width:16px}.tp-lstv_m svg path,.tp-coltxtv_mm svg path{fill:currentColor}.tp-pndtxtv,.tp-coltxtv_w{display:flex}.tp-pndtxtv_a,.tp-coltxtv_c{width:100%}.tp-pndtxtv_a+.tp-pndtxtv_a,.tp-coltxtv_c+.tp-pndtxtv_a,.tp-pndtxtv_a+.tp-coltxtv_c,.tp-coltxtv_c+.tp-coltxtv_c{margin-left:2px}.tp-btnv_b{width:100%}.tp-btnv_t{text-align:center}.tp-ckbv_l{display:block;position:relative}.tp-ckbv_i{left:0;opacity:0;position:absolute;top:0}.tp-ckbv_w{background-color:var(--in-bg);border-radius:var(--elm-br);cursor:pointer;display:block;height:var(--bld-us);position:relative;width:var(--bld-us)}.tp-ckbv_w svg{bottom:0;display:block;height:16px;left:0;margin:auto;opacity:0;position:absolute;right:0;top:0;width:16px}.tp-ckbv_w svg path{fill:none;stroke:var(--in-fg);stroke-width:2}.tp-ckbv_i:hover+.tp-ckbv_w{background-color:var(--in-bg-h)}.tp-ckbv_i:focus+.tp-ckbv_w{background-color:var(--in-bg-f)}.tp-ckbv_i:active+.tp-ckbv_w{background-color:var(--in-bg-a)}.tp-ckbv_i:checked+.tp-ckbv_w svg{opacity:1}.tp-ckbv.tp-v-disabled .tp-ckbv_w{opacity:.5}.tp-colv{position:relative}.tp-colv_h{display:flex}.tp-colv_s{flex-grow:0;flex-shrink:0;width:var(--bld-us)}.tp-colv_t{flex:1;margin-left:4px}.tp-colv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-colv.tp-colv-cpl .tp-colv_p{overflow:visible}.tp-colv.tp-colv-expanded .tp-colv_p{margin-top:var(--bld-s);opacity:1}.tp-colv .tp-popv{left:calc(-1*var(--cnt-h-p));right:calc(-1*var(--cnt-h-p));top:var(--bld-us)}.tp-colpv_h,.tp-colpv_ap{margin-left:6px;margin-right:6px}.tp-colpv_h{margin-top:var(--bld-s)}.tp-colpv_rgb{display:flex;margin-top:var(--bld-s);width:100%}.tp-colpv_a{display:flex;margin-top:var(--cnt-v-p);padding-top:calc(var(--cnt-v-p) + 2px);position:relative}.tp-colpv_a:before{background-color:var(--grv-fg);content:"";height:2px;left:calc(-1*var(--cnt-h-p));position:absolute;right:calc(-1*var(--cnt-h-p));top:0}.tp-colpv_ap{align-items:center;display:flex;flex:3}.tp-colpv_at{flex:1;margin-left:4px}.tp-svpv{border-radius:var(--elm-br);outline:none;overflow:hidden;position:relative}.tp-svpv_c{cursor:crosshair;display:block;height:calc(var(--bld-us)*4);width:100%}.tp-svpv_m{border-radius:100%;border:rgba(255,255,255,.75) solid 2px;box-sizing:border-box;filter:drop-shadow(0 0 1px rgba(0, 0, 0, 0.3));height:12px;margin-left:-6px;margin-top:-6px;pointer-events:none;position:absolute;width:12px}.tp-svpv:focus .tp-svpv_m{border-color:#fff}.tp-hplv{cursor:pointer;height:var(--bld-us);outline:none;position:relative}.tp-hplv_c{background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAABCAYAAABubagXAAAAQ0lEQVQoU2P8z8Dwn0GCgQEDi2OK/RBgYHjBgIpfovFh8j8YBIgzFGQxuqEgPhaDOT5gOhPkdCxOZeBg+IDFZZiGAgCaSSMYtcRHLgAAAABJRU5ErkJggg==);background-position:left top;background-repeat:no-repeat;background-size:100% 100%;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;position:absolute;top:50%;width:100%}.tp-hplv_m{border-radius:var(--elm-br);border:rgba(255,255,255,.75) solid 2px;box-shadow:0 0 2px rgba(0,0,0,.1);box-sizing:border-box;height:12px;left:50%;margin-left:-6px;margin-top:-6px;pointer-events:none;position:absolute;top:50%;width:12px}.tp-hplv:focus .tp-hplv_m{border-color:#fff}.tp-aplv{cursor:pointer;height:var(--bld-us);outline:none;position:relative;width:100%}.tp-aplv_b{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:4px 4px;background-position:0 0,2px 2px;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;overflow:hidden;position:absolute;top:50%;width:100%}.tp-aplv_c{bottom:0;left:0;position:absolute;right:0;top:0}.tp-aplv_m{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:12px 12px;background-position:0 0,6px 6px;border-radius:var(--elm-br);box-shadow:0 0 2px rgba(0,0,0,.1);height:12px;left:50%;margin-left:-6px;margin-top:-6px;overflow:hidden;pointer-events:none;position:absolute;top:50%;width:12px}.tp-aplv_p{border-radius:var(--elm-br);border:rgba(255,255,255,.75) solid 2px;box-sizing:border-box;bottom:0;left:0;position:absolute;right:0;top:0}.tp-aplv:focus .tp-aplv_p{border-color:#fff}.tp-colswv{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:10px 10px;background-position:0 0,5px 5px;border-radius:var(--elm-br);overflow:hidden}.tp-colswv.tp-v-disabled{opacity:.5}.tp-colswv_sw{border-radius:0}.tp-colswv_b{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border-width:0;cursor:pointer;display:block;height:var(--bld-us);left:0;margin:0;outline:none;padding:0;position:absolute;top:0;width:var(--bld-us)}.tp-colswv_b:focus::after{border:rgba(255,255,255,.75) solid 2px;border-radius:var(--elm-br);bottom:0;content:"";display:block;left:0;position:absolute;right:0;top:0}.tp-coltxtv{display:flex;width:100%}.tp-coltxtv_m{margin-right:4px}.tp-coltxtv_ms{border-radius:var(--elm-br);color:var(--lbl-fg);cursor:pointer;height:var(--bld-us);line-height:var(--bld-us);padding:0 18px 0 4px}.tp-coltxtv_ms:hover{background-color:var(--in-bg-h)}.tp-coltxtv_ms:focus{background-color:var(--in-bg-f)}.tp-coltxtv_ms:active{background-color:var(--in-bg-a)}.tp-coltxtv_mm{color:var(--lbl-fg)}.tp-coltxtv_w{flex:1}.tp-dfwv{position:absolute;top:8px;right:8px;width:256px}.tp-fldv.tp-fldv-not .tp-fldv_b{display:none}.tp-fldv_t{padding-left:4px}.tp-fldv_c{border-left:var(--cnt-bg) solid 4px}.tp-fldv_b:hover+.tp-fldv_c{border-left-color:var(--cnt-bg-h)}.tp-fldv_b:focus+.tp-fldv_c{border-left-color:var(--cnt-bg-f)}.tp-fldv_b:active+.tp-fldv_c{border-left-color:var(--cnt-bg-a)}.tp-grlv{position:relative}.tp-grlv_g{display:block;height:calc(var(--bld-us)*3)}.tp-grlv_g polyline{fill:none;stroke:var(--mo-fg);stroke-linejoin:round}.tp-grlv_t{margin-top:-4px;transition:left .05s,top .05s;visibility:hidden}.tp-grlv_t.tp-grlv_t-a{visibility:visible}.tp-grlv_t.tp-grlv_t-in{transition:none}.tp-grlv.tp-v-disabled .tp-grlv_g{opacity:.5}.tp-grlv .tp-ttv{background-color:var(--mo-fg)}.tp-grlv .tp-ttv::before{border-top-color:var(--mo-fg)}.tp-lblv{align-items:center;display:flex;line-height:1.3;padding-left:var(--cnt-h-p);padding-right:var(--cnt-h-p)}.tp-lblv.tp-lblv-nol{display:block}.tp-lblv_l{color:var(--lbl-fg);flex:1;-webkit-hyphens:auto;-ms-hyphens:auto;hyphens:auto;overflow:hidden;padding-left:4px;padding-right:16px}.tp-lblv.tp-v-disabled .tp-lblv_l{opacity:.5}.tp-lblv.tp-lblv-nol .tp-lblv_l{display:none}.tp-lblv_v{align-self:flex-start;flex-grow:0;flex-shrink:0;width:160px}.tp-lblv.tp-lblv-nol .tp-lblv_v{width:100%}.tp-lstv_s{padding:0 20px 0 4px;width:100%}.tp-lstv_m{color:var(--btn-fg)}.tp-sglv_i{padding:0 4px}.tp-sglv.tp-v-disabled .tp-sglv_i{opacity:.5}.tp-mllv_i{display:block;height:calc(var(--bld-us)*3);line-height:var(--bld-us);padding:0 4px;resize:none;white-space:pre}.tp-mllv.tp-v-disabled .tp-mllv_i{opacity:.5}.tp-p2dv{position:relative}.tp-p2dv_h{display:flex}.tp-p2dv_b{height:var(--bld-us);margin-right:4px;position:relative;width:var(--bld-us)}.tp-p2dv_b svg{display:block;height:16px;left:50%;margin-left:-8px;margin-top:-8px;position:absolute;top:50%;width:16px}.tp-p2dv_b svg path{stroke:currentColor;stroke-width:2}.tp-p2dv_b svg circle{fill:currentColor}.tp-p2dv_t{flex:1}.tp-p2dv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-p2dv.tp-p2dv-expanded .tp-p2dv_p{margin-top:var(--bld-s);opacity:1}.tp-p2dv .tp-popv{left:calc(-1*var(--cnt-h-p));right:calc(-1*var(--cnt-h-p));top:var(--bld-us)}.tp-p2dpv{padding-left:calc(var(--bld-us) + 4px)}.tp-p2dpv_p{cursor:crosshair;height:0;overflow:hidden;padding-bottom:100%;position:relative}.tp-p2dpv_g{display:block;height:100%;left:0;pointer-events:none;position:absolute;top:0;width:100%}.tp-p2dpv_ax{opacity:.1;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_l{opacity:.5;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_m{border:var(--in-fg) solid 1px;border-radius:50%;box-sizing:border-box;height:4px;margin-left:-2px;margin-top:-2px;position:absolute;width:4px}.tp-p2dpv_p:focus .tp-p2dpv_m{background-color:var(--in-fg);border-width:0}.tp-popv{background-color:var(--bs-bg);border-radius:6px;box-shadow:0 2px 4px var(--bs-sh);display:none;max-width:168px;padding:var(--cnt-v-p) var(--cnt-h-p);position:absolute;visibility:hidden;z-index:1000}.tp-popv.tp-popv-v{display:block;visibility:visible}.tp-sprv_r{background-color:var(--grv-fg);border-width:0;display:block;height:2px;margin:0;width:100%}.tp-sldv.tp-v-disabled{opacity:.5}.tp-sldv_t{box-sizing:border-box;cursor:pointer;height:var(--bld-us);margin:0 6px;outline:none;position:relative}.tp-sldv_t::before{background-color:var(--in-bg);border-radius:1px;bottom:0;content:"";display:block;height:2px;left:0;margin:auto;position:absolute;right:0;top:0}.tp-sldv_k{height:100%;left:0;position:absolute;top:0}.tp-sldv_k::before{background-color:var(--in-fg);border-radius:1px;bottom:0;content:"";display:block;height:2px;left:0;margin-bottom:auto;margin-top:auto;position:absolute;right:0;top:0}.tp-sldv_k::after{background-color:var(--btn-bg);border-radius:var(--elm-br);bottom:0;content:"";display:block;height:12px;margin-bottom:auto;margin-top:auto;position:absolute;right:-6px;top:0;width:12px}.tp-sldv_t:hover .tp-sldv_k::after{background-color:var(--btn-bg-h)}.tp-sldv_t:focus .tp-sldv_k::after{background-color:var(--btn-bg-f)}.tp-sldv_t:active .tp-sldv_k::after{background-color:var(--btn-bg-a)}.tp-sldtxtv{display:flex}.tp-sldtxtv_s{flex:2}.tp-sldtxtv_t{flex:1;margin-left:4px}.tp-tabv.tp-v-disabled{opacity:.5}.tp-tabv_i{align-items:flex-end;display:flex;overflow:hidden}.tp-tabv.tp-tabv-nop .tp-tabv_i{height:calc(var(--bld-us) + 4px);position:relative}.tp-tabv.tp-tabv-nop .tp-tabv_i::before{background-color:var(--cnt-bg);bottom:0;content:"";height:2px;left:0;position:absolute;right:0}.tp-tabv_c{border-left:var(--cnt-bg) solid 4px;padding-bottom:var(--cnt-v-p);padding-top:var(--cnt-v-p)}.tp-tbiv{flex:1;min-width:0;position:relative}.tp-tbiv+.tp-tbiv{margin-left:2px}.tp-tbiv+.tp-tbiv::before{background-color:var(--cnt-bg);bottom:0;content:"";height:2px;left:-2px;position:absolute;width:2px}.tp-tbiv_b{background-color:var(--cnt-bg);display:block;padding-left:calc(var(--cnt-h-p) + 4px);padding-right:calc(var(--cnt-h-p) + 4px);width:100%}.tp-tbiv_b:hover{background-color:var(--cnt-bg-h)}.tp-tbiv_b:focus{background-color:var(--cnt-bg-f)}.tp-tbiv_b:active{background-color:var(--cnt-bg-a)}.tp-tbiv_b:disabled{opacity:.5}.tp-tbiv_t{color:var(--cnt-fg);height:calc(var(--bld-us) + 4px);line-height:calc(var(--bld-us) + 4px);opacity:.5;overflow:hidden;text-overflow:ellipsis}.tp-tbiv.tp-tbiv-sel .tp-tbiv_t{opacity:1}.tp-txtv{position:relative}.tp-txtv_i{padding:0 4px}.tp-txtv.tp-txtv-fst .tp-txtv_i{border-bottom-right-radius:0;border-top-right-radius:0}.tp-txtv.tp-txtv-mid .tp-txtv_i{border-radius:0}.tp-txtv.tp-txtv-lst .tp-txtv_i{border-bottom-left-radius:0;border-top-left-radius:0}.tp-txtv.tp-txtv-num .tp-txtv_i{text-align:right}.tp-txtv.tp-txtv-drg .tp-txtv_i{opacity:.3}.tp-txtv_k{cursor:pointer;height:100%;left:-3px;position:absolute;top:0;width:12px}.tp-txtv_k::before{background-color:var(--in-fg);border-radius:1px;bottom:0;content:"";height:calc(var(--bld-us) - 4px);left:50%;margin-bottom:auto;margin-left:-1px;margin-top:auto;opacity:.1;position:absolute;top:0;transition:border-radius .1s,height .1s,transform .1s,width .1s;width:2px}.tp-txtv_k:hover::before,.tp-txtv.tp-txtv-drg .tp-txtv_k::before{opacity:1}.tp-txtv.tp-txtv-drg .tp-txtv_k::before{border-radius:50%;height:4px;transform:translateX(-1px);width:4px}.tp-txtv_g{bottom:0;display:block;height:8px;left:50%;margin:auto;overflow:visible;pointer-events:none;position:absolute;top:0;visibility:hidden;width:100%}.tp-txtv.tp-txtv-drg .tp-txtv_g{visibility:visible}.tp-txtv_gb{fill:none;stroke:var(--in-fg);stroke-dasharray:1}.tp-txtv_gh{fill:none;stroke:var(--in-fg)}.tp-txtv .tp-ttv{margin-left:6px;visibility:hidden}.tp-txtv.tp-txtv-drg .tp-ttv{visibility:visible}.tp-ttv{background-color:var(--in-fg);border-radius:var(--elm-br);color:var(--bs-bg);padding:2px 4px;pointer-events:none;position:absolute;transform:translate(-50%, -100%)}.tp-ttv::before{border-color:var(--in-fg) transparent transparent transparent;border-style:solid;border-width:2px;box-sizing:border-box;content:"";font-size:.9em;height:4px;left:50%;margin-left:-2px;position:absolute;top:100%;width:4px}.tp-rotv{background-color:var(--bs-bg);border-radius:var(--bs-br);box-shadow:0 2px 4px var(--bs-sh);font-family:var(--font-family);font-size:11px;font-weight:500;line-height:1;text-align:left}.tp-rotv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br);border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br);padding-left:calc(4px + var(--bld-us) + var(--cnt-h-p));text-align:center}.tp-rotv.tp-rotv-expanded .tp-rotv_b{border-bottom-left-radius:0;border-bottom-right-radius:0}.tp-rotv.tp-rotv-not .tp-rotv_b{display:none}.tp-rotv_c>.tp-fldv.tp-v-lst>.tp-fldv_c,.tp-rotv_c>.tp-tabv.tp-v-lst>.tp-tabv_c{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c>.tp-fldv.tp-v-lst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c .tp-fldv.tp-v-vlst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-right-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst{margin-top:calc(-1*var(--cnt-v-p))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst>.tp-fldv_b{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst{margin-top:calc(-1*var(--cnt-v-p))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst>.tp-tabv_i{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv.tp-v-disabled,.tp-rotv .tp-v-disabled{pointer-events:none}.tp-rotv.tp-v-hidden,.tp-rotv .tp-v-hidden{display:none}'),this.pool_.getAll().forEach((t=>{this.embedPluginStyle_(t)})),this.registerPlugin({plugins:[Eo,Co,ce,Po]})}}const Io=new e("3.1.0");t.BladeApi=n,t.ButtonApi=f,t.FolderApi=Pt,t.InputBindingApi=wt,t.ListApi=yo,t.MonitorBindingApi=Ct,t.Pane=Do,t.SeparatorApi=Wt,t.SliderApi=wo,t.TabApi=ie,t.TabPageApi=ne,t.TextApi=xo,t.TpChangeEvent=s,t.VERSION=Io,Object.defineProperty(t,"__esModule",{value:!0})}(xr.exports),function(t,e,n){function i(t,e){return typeof t===e}function s(){return"function"!=typeof e.createElement?e.createElement(arguments[0]):a?e.createElementNS.call(e,"http://www.w3.org/2000/svg",arguments[0]):e.createElement.apply(e,arguments)}var r=[],o=e.documentElement,a="svg"===o.nodeName.toLowerCase(),l=[],c={_version:"3.6.0",_config:{classPrefix:"",enableClasses:!0,enableJSClass:!0,usePrefixes:!0},_q:[],on:function(t,e){var n=this;setTimeout((function(){e(n[t])}),0)},addTest:function(t,e,n){l.push({name:t,fn:e,options:n})},addAsyncTest:function(t){l.push({name:null,fn:t})}},u=function(){};u.prototype=c,u=new u;var h=c._config.usePrefixes?" -webkit- -moz- -o- -ms- ".split(" "):["",""];c._prefixes=h;var p=c.testStyles=function(t,n,i,r){var l,c,u,h,p="modernizr",d=s("div"),f=function(){var t=e.body;return t||((t=s(a?"svg":"body")).fake=!0),t}();if(parseInt(i,10))for(;i--;)(u=s("div")).id=r?r[i]:p+(i+1),d.appendChild(u);return(l=s("style")).type="text/css",l.id="s"+p,(f.fake?f:d).appendChild(l),f.appendChild(d),l.styleSheet?l.styleSheet.cssText=t:l.appendChild(e.createTextNode(t)),d.id=p,f.fake&&(f.style.background="",f.style.overflow="hidden",h=o.style.overflow,o.style.overflow="hidden",o.appendChild(f)),c=n(d,t),f.fake?(f.parentNode.removeChild(f),o.style.overflow=h,o.offsetHeight):d.parentNode.removeChild(d),!!c};u.addTest("touchevents",(function(){var n;if("ontouchstart"in t||t.DocumentTouch&&e instanceof DocumentTouch)n=!0;else{var i=["@media (",h.join("touch-enabled),("),"heartz",")","{#modernizr{top:9px;position:absolute}}"].join("");p(i,(function(t){n=9===t.offsetTop}))}return n})),function(){var t,e,n,s,o,a;for(var c in l)if(l.hasOwnProperty(c)){if(t=[],(e=l[c]).name&&(t.push(e.name.toLowerCase()),e.options&&e.options.aliases&&e.options.aliases.length))for(n=0;n<e.options.aliases.length;n++)t.push(e.options.aliases[n].toLowerCase());for(s=i(e.fn,"function")?e.fn():e.fn,o=0;o<t.length;o++)1===(a=t[o].split(".")).length?u[a[0]]=s:(!u[a[0]]||u[a[0]]instanceof Boolean||(u[a[0]]=new Boolean(u[a[0]])),u[a[0]][a[1]]=s),r.push((s?"":"no-")+a.join("-"))}}(),function(t){var e=o.className,n=u._config.classPrefix||"";if(a&&(e=e.baseVal),u._config.enableJSClass){var i=new RegExp("(^|\\s)"+n+"no-js(\\s|$)");e=e.replace(i,"$1"+n+"js$2")}u._config.enableClasses&&(e+=" "+n+t.join(" "+n),a?o.className.baseVal=e:o.className=e)}(r),delete c.addTest,delete c.addAsyncTest;for(var d=0;d<u._q.length;d++)u._q[d]();t.Modernizr=u}(window,document);const Cr=(t,e,n)=>({endTime:e,insertTime:n,type:"exponentialRampToValue",value:t}),Tr=(t,e,n)=>({endTime:e,insertTime:n,type:"linearRampToValue",value:t}),Ar=(t,e)=>({startTime:e,type:"setValue",value:t}),Sr=(t,e,n)=>({duration:n,startTime:e,type:"setValueCurve",values:t}),kr=(t,e,{startTime:n,target:i,timeConstant:s})=>i+(e-i)*Math.exp((n-t)/s),Er=t=>"exponentialRampToValue"===t.type,Pr=t=>"linearRampToValue"===t.type,Mr=t=>Er(t)||Pr(t),Or=t=>"setValue"===t.type,Dr=t=>"setValueCurve"===t.type,Ir=(t,e,n,i)=>{const s=t[e];return void 0===s?i:Mr(s)||Or(s)?s.value:Dr(s)?s.values[s.values.length-1]:kr(n,Ir(t,e-1,s.startTime,i),s)},Vr=(t,e,n,i,s)=>void 0===n?[i.insertTime,s]:Mr(n)?[n.endTime,n.value]:Or(n)?[n.startTime,n.value]:Dr(n)?[n.startTime+n.duration,n.values[n.values.length-1]]:[n.startTime,Ir(t,e-1,n.startTime,s)],Rr=t=>"cancelAndHold"===t.type,Fr=t=>"cancelScheduledValues"===t.type,Lr=t=>Rr(t)||Fr(t)?t.cancelTime:Er(t)||Pr(t)?t.endTime:t.startTime,Nr=(t,e,n,{endTime:i,value:s})=>n===s?s:0<n&&0<s||n<0&&s<0?n*(s/n)**((t-e)/(i-e)):0,Br=(t,e,n,{endTime:i,value:s})=>n+(t-e)/(i-e)*(s-n),zr=(t,{duration:e,startTime:n,values:i})=>((t,e)=>{const n=Math.floor(e),i=Math.ceil(e);return n===i?t[n]:(1-(e-n))*t[n]+(1-(i-e))*t[i]})(i,(t-n)/e*(i.length-1)),jr=t=>"setTarget"===t.type;class Ur{constructor(t){this._automationEvents=[],this._currenTime=0,this._defaultValue=t}[Symbol.iterator](){return this._automationEvents[Symbol.iterator]()}add(t){const e=Lr(t);if(Rr(t)||Fr(t)){const n=this._automationEvents.findIndex((n=>Fr(t)&&Dr(n)?n.startTime+n.duration>=e:Lr(n)>=e)),i=this._automationEvents[n];if(-1!==n&&(this._automationEvents=this._automationEvents.slice(0,n)),Rr(t)){const t=this._automationEvents[this._automationEvents.length-1];if(void 0!==i&&Mr(i)){if(jr(t))throw new Error("The internal list is malformed.");const n=Dr(t)?t.startTime+t.duration:Lr(t),s=Dr(t)?t.values[t.values.length-1]:t.value,r=Er(i)?Nr(e,n,s,i):Br(e,n,s,i),o=Er(i)?Cr(r,e,this._currenTime):Tr(r,e,this._currenTime);this._automationEvents.push(o)}void 0!==t&&jr(t)&&this._automationEvents.push(Ar(this.getValue(e),e)),void 0!==t&&Dr(t)&&t.startTime+t.duration>e&&(this._automationEvents[this._automationEvents.length-1]=Sr(new Float32Array([6,7]),t.startTime,e-t.startTime))}}else{const n=this._automationEvents.findIndex((t=>Lr(t)>e)),i=-1===n?this._automationEvents[this._automationEvents.length-1]:this._automationEvents[n-1];if(void 0!==i&&Dr(i)&&Lr(i)+i.duration>e)return!1;const s=Er(t)?Cr(t.value,t.endTime,this._currenTime):Pr(t)?Tr(t.value,e,this._currenTime):t;if(-1===n)this._automationEvents.push(s);else{if(Dr(t)&&e+t.duration>Lr(this._automationEvents[n]))return!1;this._automationEvents.splice(n,0,s)}}return!0}flush(t){const e=this._automationEvents.findIndex((e=>Lr(e)>t));if(e>1){const t=this._automationEvents.slice(e-1),n=t[0];jr(n)&&t.unshift(Ar(Ir(this._automationEvents,e-2,n.startTime,this._defaultValue),n.startTime)),this._automationEvents=t}}getValue(t){if(0===this._automationEvents.length)return this._defaultValue;const e=this._automationEvents.findIndex((e=>Lr(e)>t)),n=this._automationEvents[e],i=(-1===e?this._automationEvents.length:e)-1,s=this._automationEvents[i];if(void 0!==s&&jr(s)&&(void 0===n||!Mr(n)||n.insertTime>t))return kr(t,Ir(this._automationEvents,i-1,s.startTime,this._defaultValue),s);if(void 0!==s&&Or(s)&&(void 0===n||!Mr(n)))return s.value;if(void 0!==s&&Dr(s)&&(void 0===n||!Mr(n)||s.startTime+s.duration>t))return t<s.startTime+s.duration?zr(t,s):s.values[s.values.length-1];if(void 0!==s&&Mr(s)&&(void 0===n||!Mr(n)))return s.value;if(void 0!==n&&Er(n)){const[e,r]=Vr(this._automationEvents,i,s,n,this._defaultValue);return Nr(t,e,r,n)}if(void 0!==n&&Pr(n)){const[e,r]=Vr(this._automationEvents,i,s,n,this._defaultValue);return Br(t,e,r,n)}return this._defaultValue}}const qr=new WeakSet,Wr=new WeakMap,Hr=new WeakMap,Gr=new WeakMap,Kr=new WeakMap,Yr=new WeakMap,Xr=new WeakMap,$r=new WeakMap,Zr=new WeakMap,Qr=new WeakMap,Jr={construct:()=>Jr},to=/^import(?:(?:[\s]+[\w]+|(?:[\s]+[\w]+[\s]*,)?[\s]*\{[\s]*[\w]+(?:[\s]+as[\s]+[\w]+)?(?:[\s]*,[\s]*[\w]+(?:[\s]+as[\s]+[\w]+)?)*[\s]*}|(?:[\s]+[\w]+[\s]*,)?[\s]*\*[\s]+as[\s]+[\w]+)[\s]+from)?(?:[\s]*)("([^"\\]|\\.)+"|'([^'\\]|\\.)+')(?:[\s]*);?/,eo=(t,e)=>{const n=[];let i=t.replace(/^[\s]+/,""),s=i.match(to);for(;null!==s;){const t=s[1].slice(1,-1),r=s[0].replace(/([\s]+)?;?$/,"").replace(t,new URL(t,e).toString());n.push(r),i=i.slice(s[0].length).replace(/^[\s]+/,""),s=i.match(to)}return[n.join(";"),i]},no=t=>{if(void 0!==t&&!Array.isArray(t))throw new TypeError("The parameterDescriptors property of given value for processorCtor is not an array.")},io=t=>{if(!(t=>{try{new new Proxy(t,Jr)}catch{return!1}return!0})(t))throw new TypeError("The given value for processorCtor should be a constructor.");if(null===t.prototype||"object"!=typeof t.prototype)throw new TypeError("The given value for processorCtor should have a prototype.")},so=(t,e)=>{const n=t.get(e);if(void 0===n)throw new Error("A value with the given key could not be found.");return n},ro=(t,e)=>{const n=Array.from(t).filter(e);if(n.length>1)throw Error("More than one element was found.");if(0===n.length)throw Error("No element was found.");const[i]=n;return t.delete(i),i},oo=(t,e,n,i)=>{const s=so(t,e),r=ro(s,(t=>t[0]===n&&t[1]===i));return 0===s.size&&t.delete(e),r},ao=t=>so(Xr,t),lo=t=>{if(qr.has(t))throw new Error("The AudioNode is already stored.");qr.add(t),ao(t).forEach((t=>t(!0)))},co=t=>"port"in t,uo=t=>{if(!qr.has(t))throw new Error("The AudioNode is not stored.");qr.delete(t),ao(t).forEach((t=>t(!1)))},ho=(t,e)=>{!co(t)&&e.every((t=>0===t.size))&&uo(t)},po={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",fftSize:2048,maxDecibels:-30,minDecibels:-100,smoothingTimeConstant:.8},fo=(t,e)=>t.context===e,mo=t=>{try{t.copyToChannel(new Float32Array(1),0,-1)}catch{return!1}return!0},vo=()=>new DOMException("","IndexSizeError"),_o=t=>{var e;t.getChannelData=(e=t.getChannelData,n=>{try{return e.call(t,n)}catch(i){if(12===i.code)throw vo();throw i}})},go={numberOfChannels:1},bo=-34028234663852886e22,yo=-bo,wo=t=>qr.has(t),xo={buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1},Co=t=>so(Wr,t),To=t=>so(Gr,t),Ao=(t,e)=>{const{activeInputs:n}=Co(t);n.forEach((n=>n.forEach((([n])=>{e.includes(t)||Ao(n,[...e,t])}))));const i=(t=>"playbackRate"in t)(t)?[t.playbackRate]:co(t)?Array.from(t.parameters.values()):(t=>"frequency"in t&&"gain"in t)(t)?[t.Q,t.detune,t.frequency,t.gain]:(t=>"offset"in t)(t)?[t.offset]:(t=>!("frequency"in t)&&"gain"in t)(t)?[t.gain]:(t=>"detune"in t&&"frequency"in t)(t)?[t.detune,t.frequency]:(t=>"pan"in t)(t)?[t.pan]:[];for(const s of i){const t=To(s);void 0!==t&&t.activeInputs.forEach((([t])=>Ao(t,e)))}wo(t)&&uo(t)},So=t=>{Ao(t.destination,[])},ko=t=>"context"in t,Eo=t=>ko(t[0]),Po=(t,e,n,i)=>{for(const s of t)if(n(s)){if(i)return!1;throw Error("The set contains at least one similar element.")}return t.add(e),!0},Mo=(t,e,[n,i],s)=>{Po(t,[e,n,i],(t=>t[0]===e&&t[1]===n),s)},Oo=(t,[e,n,i],s)=>{const r=t.get(e);void 0===r?t.set(e,new Set([[n,i]])):Po(r,[n,i],(t=>t[0]===n),s)},Do=t=>"inputs"in t,Io=(t,e,n,i)=>{if(Do(e)){const s=e.inputs[i];return t.connect(s,n,0),[s,n,0]}return t.connect(e,n,i),[e,n,i]},Vo=(t,e,n)=>{for(const i of t)if(i[0]===e&&i[1]===n)return t.delete(i),i;return null},Ro=(t,e)=>{if(!ao(t).delete(e))throw new Error("Missing the expected event listener.")},Fo=(t,e,n)=>{const i=so(t,e),s=ro(i,(t=>t[0]===n));return 0===i.size&&t.delete(e),s},Lo=(t,e,n,i)=>{Do(e)?t.disconnect(e.inputs[i],n,0):t.disconnect(e,n,i)},No=t=>so(Hr,t),Bo=t=>so(Kr,t),zo=t=>$r.has(t),jo=t=>!qr.has(t),Uo=(t,e)=>new Promise((n=>{if(null!==e)n(!0);else{const e=t.createScriptProcessor(256,1,1),i=t.createGain(),s=t.createBuffer(1,2,44100),r=s.getChannelData(0);r[0]=1,r[1]=1;const o=t.createBufferSource();o.buffer=s,o.loop=!0,o.connect(e).connect(t.destination),o.connect(i),o.disconnect(i),e.onaudioprocess=i=>{const s=i.inputBuffer.getChannelData(0);Array.prototype.some.call(s,(t=>1===t))?n(!0):n(!1),o.stop(),e.onaudioprocess=null,o.disconnect(e),e.disconnect(t.destination)},o.start()}})),qo=(t,e)=>{const n=new Map;for(const i of t)for(const t of i){const e=n.get(t);n.set(t,void 0===e?1:e+1)}n.forEach(((t,n)=>e(n,t)))},Wo=t=>"context"in t,Ho=(t,e,n,i)=>{const{activeInputs:s,passiveInputs:r}=To(e),{outputs:o}=Co(t),a=ao(t),l=o=>{const a=No(t),l=Bo(e);if(o){const e=Fo(r,t,n);Mo(s,t,e,!1),i||zo(t)||a.connect(l,n)}else{const e=((t,e,n)=>ro(t,(t=>t[0]===e&&t[1]===n)))(s,t,n);Oo(r,e,!1),i||zo(t)||a.disconnect(l,n)}};return!!Po(o,[e,n],(t=>t[0]===e&&t[1]===n),!0)&&(a.add(l),wo(t)?Mo(s,t,[n,l],!0):Oo(r,[t,n,l],!0),!0)},Go=(t,e,n,i,s)=>{const[r,o]=((t,e,n,i)=>{const{activeInputs:s,passiveInputs:r}=Co(e),o=Vo(s[i],t,n);if(null===o)return[oo(r,t,n,i)[2],!1];return[o[2],!0]})(t,n,i,s);if(null!==r&&(Ro(t,r),!o||e||zo(t)||Lo(No(t),No(n),i,s)),wo(n)){const{activeInputs:t}=Co(n);ho(n,t)}},Ko=(t,e,n,i)=>{const[s,r]=((t,e,n)=>{const{activeInputs:i,passiveInputs:s}=To(e),r=Vo(i,t,n);if(null===r)return[Fo(s,t,n)[1],!1];return[r[2],!0]})(t,n,i);null!==s&&(Ro(t,s),!r||e||zo(t)||No(t).disconnect(Bo(n),i))};class Yo{constructor(t){this._map=new Map(t)}get size(){return this._map.size}entries(){return this._map.entries()}forEach(t,e=null){return this._map.forEach(((n,i)=>t.call(e,n,i,this)))}get(t){return this._map.get(t)}has(t){return this._map.has(t)}keys(){return this._map.keys()}values(){return this._map.values()}}const Xo={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:1,numberOfOutputs:1,parameterData:{},processorOptions:{}};function $o(t,e,n,i,s){if("function"==typeof t.copyFromChannel)0===e[n].byteLength&&(e[n]=new Float32Array(128)),t.copyFromChannel(e[n],i,s);else{const r=t.getChannelData(i);if(0===e[n].byteLength)e[n]=r.slice(s,s+128);else{const t=new Float32Array(r.buffer,s*Float32Array.BYTES_PER_ELEMENT,128);e[n].set(t)}}}const Zo=(t,e,n,i,s)=>{"function"==typeof t.copyToChannel?0!==e[n].byteLength&&t.copyToChannel(e[n],i,s):0!==e[n].byteLength&&t.getChannelData(i).set(e[n],s)},Qo=(t,e)=>{const n=[];for(let i=0;i<t;i+=1){const t=[],s="number"==typeof e?e:e[i];for(let e=0;e<s;e+=1)t.push(new Float32Array(128));n.push(t)}return n},Jo=async(t,e,n,i,s,r,o)=>{const a=null===e?128*Math.ceil(t.context.length/128):e.length,l=i.channelCount*i.numberOfInputs,c=s.reduce(((t,e)=>t+e),0),u=0===c?null:n.createBuffer(c,a,n.sampleRate);if(void 0===r)throw new Error("Missing the processor constructor.");const h=Co(t),p=await((t,e)=>{const n=so(Qr,t),i=No(e);return so(n,i)})(n,t),d=Qo(i.numberOfInputs,i.channelCount),f=Qo(i.numberOfOutputs,s),m=Array.from(t.parameters.keys()).reduce(((t,e)=>({...t,[e]:new Float32Array(128)})),{});for(let _=0;_<a;_+=128){if(i.numberOfInputs>0&&null!==e)for(let t=0;t<i.numberOfInputs;t+=1)for(let n=0;n<i.channelCount;n+=1)$o(e,d[t],n,n,_);void 0!==r.parameterDescriptors&&null!==e&&r.parameterDescriptors.forEach((({name:t},n)=>{$o(e,m,t,l+n,_)}));for(let t=0;t<i.numberOfInputs;t+=1)for(let e=0;e<s[t];e+=1)0===f[t][e].byteLength&&(f[t][e]=new Float32Array(128));try{const t=d.map(((t,e)=>0===h.activeInputs[e].size?[]:t)),e=o(_/n.sampleRate,n.sampleRate,(()=>p.process(t,f,m)));if(null!==u)for(let n=0,r=0;n<i.numberOfOutputs;n+=1){for(let t=0;t<s[n];t+=1)Zo(u,f[n],t,r+t,_);r+=s[n]}if(!e)break}catch(v){t.dispatchEvent(new ErrorEvent("processorerror",{colno:v.colno,filename:v.filename,lineno:v.lineno,message:v.message}));break}}return u},ta={Q:1,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",detune:0,frequency:350,gain:0,type:"lowpass"},ea={channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:6},na={channelCount:6,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:6},ia={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",offset:1},sa={buffer:null,channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",disableNormalization:!1},ra=t=>{const{port1:e,port2:n}=new MessageChannel;return new Promise((i=>{const s=()=>{n.onmessage=null,e.close(),n.close(),i()};n.onmessage=()=>s();try{e.postMessage(t,[t])}finally{s()}}))},oa={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",delayTime:0,maxDelayTime:1},aa=(t,e,n)=>{const i=e[n];if(void 0===i)throw t();return i},la={attack:.003,channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",knee:30,ratio:12,release:.25,threshold:-24},ca={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",gain:1},ua=()=>new DOMException("","InvalidStateError"),ha=()=>new DOMException("","InvalidAccessError"),pa={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers"},da=(t,e,n,i,s,r,o,a,l,c,u)=>{const h=c.length;let p=a;for(let d=0;d<h;d+=1){let a=n[0]*c[d];for(let e=1;e<s;e+=1){const i=p-e&l-1;a+=n[e]*r[i],a-=t[e]*o[i]}for(let t=s;t<i;t+=1)a+=n[t]*r[p-t&l-1];for(let n=s;n<e;n+=1)a-=t[n]*o[p-n&l-1];r[p]=c[d],o[p]=a,p=p+1&l-1,u[d]=a}return p},fa={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers"},ma=t=>{const e=new Uint32Array([1179011410,40,1163280727,544501094,16,131073,44100,176400,1048580,1635017060,4,0]);try{const n=t.decodeAudioData(e.buffer,(()=>{}));return void 0!==n&&(n.catch((()=>{})),!0)}catch{}return!1},va=(t,e,n)=>{const i=e[n];void 0!==i&&i!==t[n]&&(t[n]=i)},_a=(t,e)=>{va(t,e,"channelCount"),va(t,e,"channelCountMode"),va(t,e,"channelInterpretation")},ga=t=>"function"==typeof t.getFloatTimeDomainData,ba=(t,e,n)=>{const i=e[n];void 0!==i&&i!==t[n].value&&(t[n].value=i)},ya=t=>{var e;t.start=(e=t.start,(n=0,i=0,s)=>{if("number"==typeof s&&s<0||i<0||n<0)throw new RangeError("The parameters can't be negative.");e.call(t,n,i,s)})},wa=t=>{var e;t.stop=(e=t.stop,(n=0)=>{if(n<0)throw new RangeError("The parameter can't be negative.");e.call(t,n)})},xa=(t,e)=>null===t?512:Math.max(512,Math.min(16384,Math.pow(2,Math.round(Math.log2(t*e))))),Ca=async(t,e)=>{const n=await(t=>new Promise(((e,n)=>{const{port1:i,port2:s}=new MessageChannel;i.onmessage=({data:t})=>{i.close(),s.close(),e(t)},i.onmessageerror=({data:t})=>{i.close(),s.close(),n(t)},s.postMessage(t)})))(e);return new t(n)},Ta=(t,e)=>{const n=t.createBiquadFilter();return _a(n,e),ba(n,e,"Q"),ba(n,e,"detune"),ba(n,e,"frequency"),ba(n,e,"gain"),va(n,e,"type"),n},Aa=(t,e)=>{const n=t.createChannelSplitter(e.numberOfOutputs);return _a(n,e),(t=>{const e=t.numberOfOutputs;Object.defineProperty(t,"channelCount",{get:()=>e,set:t=>{if(t!==e)throw ua()}}),Object.defineProperty(t,"channelCountMode",{get:()=>"explicit",set:t=>{if("explicit"!==t)throw ua()}}),Object.defineProperty(t,"channelInterpretation",{get:()=>"discrete",set:t=>{if("discrete"!==t)throw ua()}})})(n),n},Sa=(t,e)=>(t.connect=e.connect.bind(e),t.disconnect=e.disconnect.bind(e),t),ka=(t,e)=>{const n=t.createDelay(e.maxDelayTime);return _a(n,e),ba(n,e,"delayTime"),n},Ea=(t,e)=>{const n=t.createGain();return _a(n,e),ba(n,e,"gain"),n};function Pa(t,e){const n=e[0]*e[0]+e[1]*e[1];return[(t[0]*e[0]+t[1]*e[1])/n,(t[1]*e[0]-t[0]*e[1])/n]}function Ma(t,e){let n=[0,0];for(let r=t.length-1;r>=0;r-=1)s=e,n=[(i=n)[0]*s[0]-i[1]*s[1],i[0]*s[1]+i[1]*s[0]],n[0]+=t[r];var i,s;return n}const Oa=(t,e,n,i)=>t.createScriptProcessor(e,n,i),Da=()=>new DOMException("","NotSupportedError"),Ia={numberOfChannels:1},Va={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",detune:0,frequency:440,periodicWave:void 0,type:"sine"},Ra={channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",coneInnerAngle:360,coneOuterAngle:360,coneOuterGain:0,distanceModel:"inverse",maxDistance:1e4,orientationX:1,orientationY:0,orientationZ:0,panningModel:"equalpower",positionX:0,positionY:0,positionZ:0,refDistance:1,rolloffFactor:1},Fa={disableNormalization:!1},La={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers",pan:0},Na={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",curve:null,oversample:"none"},Ba=(t,e,n)=>void 0===t.copyFromChannel?t.getChannelData(n)[0]:(t.copyFromChannel(e,n),e[0]),za=t=>{if(null===t)return!1;const e=t.length;return e%2!=0?0!==t[Math.floor(e/2)]:t[e/2-1]+t[e/2]!==0},ja=(t,e,n,i)=>{let s=t;for(;!s.hasOwnProperty(e);)s=Object.getPrototypeOf(s);const{get:r,set:o}=Object.getOwnPropertyDescriptor(s,e);Object.defineProperty(t,e,{get:n(r),set:i(o)})},Ua=(t,e,n)=>{try{t.setValueAtTime(e,n)}catch(i){if(9!==i.code)throw i;Ua(t,e,n+1e-7)}},qa=t=>{const e=t.createOscillator();try{e.start(-1)}catch(n){return n instanceof RangeError}return!1},Wa=t=>{const e=t.createBuffer(1,1,44100),n=t.createBufferSource();n.buffer=e,n.start(),n.stop();try{return n.stop(),!0}catch{return!1}},Ha=t=>{const e=t.createOscillator();try{e.stop(-1)}catch(n){return n instanceof RangeError}return!1},Ga=(t,e)=>{const n=e.createGain();t.connect(n);const i=(s=t.disconnect,()=>{s.call(t,n),t.removeEventListener("ended",i)});var s;t.addEventListener("ended",i),Sa(t,n),t.stop=(e=>{let i=!1;return(s=0)=>{if(i)try{e.call(t,s)}catch{n.gain.setValueAtTime(0,s)}else e.call(t,s),i=!0}})(t.stop)},Ka=(t,e)=>n=>{const i={value:t};return Object.defineProperties(n,{currentTarget:i,target:i}),"function"==typeof e?e.call(t,n):e.handleEvent.call(t,n)},Ya=(Xa=Po,(t,e,[n,i,s],r)=>{Xa(t[i],[e,n,s],(t=>t[0]===e&&t[1]===n),r)});var Xa;const $a=(t=>(e,n,[i,s,r],o)=>{const a=e.get(i);void 0===a?e.set(i,new Set([[s,n,r]])):t(a,[s,n,r],(t=>t[0]===s&&t[1]===n),o)})(Po),Za=(Qa=ro,(t,e,n,i)=>Qa(t[i],(t=>t[0]===e&&t[1]===n)));var Qa;const Ja=new WeakMap,tl=(el=Ja,t=>{var e;return null!==(e=el.get(t))&&void 0!==e?e:0});var el;const nl=(il=new Map,sl=new WeakMap,(t,e)=>{const n=sl.get(t);if(void 0!==n)return n;const i=il.get(t);if(void 0!==i)return i;try{const n=e();return n instanceof Promise?(il.set(t,n),n.catch((()=>!1)).then((e=>(il.delete(t),sl.set(t,e),e)))):(sl.set(t,n),n)}catch{return sl.set(t,!1),!1}});var il,sl;const rl="undefined"==typeof window?null:window,ol=(al=nl,ll=vo,(t,e)=>{const n=t.createAnalyser();if(_a(n,e),!(e.maxDecibels>e.minDecibels))throw ll();return va(n,e,"fftSize"),va(n,e,"maxDecibels"),va(n,e,"minDecibels"),va(n,e,"smoothingTimeConstant"),al(ga,(()=>ga(n)))||(t=>{t.getFloatTimeDomainData=e=>{const n=new Uint8Array(e.length);t.getByteTimeDomainData(n);const i=Math.max(n.length,t.fftSize);for(let t=0;t<i;t+=1)e[t]=.0078125*(n[t]-128);return e}})(n),n});var al,ll;const cl=(ul=Co,t=>{const e=ul(t);if(null===e.renderer)throw new Error("Missing the renderer of the given AudioNode in the audio graph.");return e.renderer});var ul;const hl=((t,e,n)=>async(i,s,r)=>{const o=t(i);await Promise.all(o.activeInputs.map(((t,o)=>Array.from(t).map((async([t,a])=>{const l=e(t),c=await l.render(t,s),u=i.context.destination;n(t)||i===u&&n(i)||c.connect(r,a,o)})))).reduce(((t,e)=>[...t,...e]),[]))})(Co,cl,zo),pl=(dl=ol,fl=No,ml=hl,()=>{const t=new WeakMap;return{render(e,n){const i=t.get(n);return void 0!==i?Promise.resolve(i):(async(e,n)=>{let i=fl(e);if(!fo(i,n)){const t={channelCount:i.channelCount,channelCountMode:i.channelCountMode,channelInterpretation:i.channelInterpretation,fftSize:i.fftSize,maxDecibels:i.maxDecibels,minDecibels:i.minDecibels,smoothingTimeConstant:i.smoothingTimeConstant};i=dl(n,t)}return t.set(n,i),await ml(e,n,i),i})(e,n)}}});var dl,fl,ml;const vl=(_l=Yr,t=>{const e=_l.get(t);if(void 0===e)throw ua();return e});var _l;const gl=null===(bl=rl)?null:bl.hasOwnProperty("OfflineAudioContext")?bl.OfflineAudioContext:bl.hasOwnProperty("webkitOfflineAudioContext")?bl.webkitOfflineAudioContext:null;var bl;const yl=(wl=gl,t=>null!==wl&&t instanceof wl);var wl;const xl=new WeakMap,Cl=(Tl=Ka,class{constructor(t){this._nativeEventTarget=t,this._listeners=new WeakMap}addEventListener(t,e,n){if(null!==e){let i=this._listeners.get(e);void 0===i&&(i=Tl(this,e),"function"==typeof e&&this._listeners.set(e,i)),this._nativeEventTarget.addEventListener(t,i,n)}}dispatchEvent(t){return this._nativeEventTarget.dispatchEvent(t)}removeEventListener(t,e,n){const i=null===e?void 0:this._listeners.get(e);this._nativeEventTarget.removeEventListener(t,void 0===i?null:i,n)}});var Tl;const Al=(t=>null===t?null:t.hasOwnProperty("AudioContext")?t.AudioContext:t.hasOwnProperty("webkitAudioContext")?t.webkitAudioContext:null)(rl),Sl=(kl=Al,t=>null!==kl&&t instanceof kl);var kl;const El=(t=>e=>null!==t&&"function"==typeof t.AudioNode&&e instanceof t.AudioNode)(rl),Pl=(t=>e=>null!==t&&"function"==typeof t.AudioParam&&e instanceof t.AudioParam)(rl),Ml=(t=>null===t?null:t.hasOwnProperty("AudioWorkletNode")?t.AudioWorkletNode:null)(rl),Ol=((t,e,n,i,s,r,o,a,l,c,u,h,p,d,f,m)=>class extends c{constructor(e,i,s,r){super(s),this._context=e,this._nativeAudioNode=s;const o=u(e);h(o)&&!0!==n(Uo,(()=>Uo(o,m)))&&(t=>{const e=new Map;var n,i;t.connect=(n=t.connect.bind(t),(t,i=0,s=0)=>{const r=Wo(t)?n(t,i,s):n(t,i),o=e.get(t);return void 0===o?e.set(t,[{input:s,output:i}]):o.every((t=>t.input!==s||t.output!==i))&&o.push({input:s,output:i}),r}),t.disconnect=(i=t.disconnect,(n,s,r)=>{if(i.apply(t),void 0===n)e.clear();else if("number"==typeof n)for(const[t,i]of e){const s=i.filter((t=>t.output!==n));0===s.length?e.delete(t):e.set(t,s)}else if(e.has(n))if(void 0===s)e.delete(n);else{const t=e.get(n);if(void 0!==t){const i=t.filter((t=>t.output!==s&&(t.input!==r||void 0===r)));0===i.length?e.delete(n):e.set(n,i)}}for(const[i,o]of e)o.forEach((e=>{Wo(i)?t.connect(i,e.output,e.input):t.connect(i,e.output)}))})})(s),Hr.set(this,s),Xr.set(this,new Set),"closed"!==e.state&&i&&lo(this),t(this,r,s)}get channelCount(){return this._nativeAudioNode.channelCount}set channelCount(t){this._nativeAudioNode.channelCount=t}get channelCountMode(){return this._nativeAudioNode.channelCountMode}set channelCountMode(t){this._nativeAudioNode.channelCountMode=t}get channelInterpretation(){return this._nativeAudioNode.channelInterpretation}set channelInterpretation(t){this._nativeAudioNode.channelInterpretation=t}get context(){return this._context}get numberOfInputs(){return this._nativeAudioNode.numberOfInputs}get numberOfOutputs(){return this._nativeAudioNode.numberOfOutputs}connect(t,n=0,a=0){if(n<0||n>=this._nativeAudioNode.numberOfOutputs)throw s();const c=u(this._context),h=f(c);if(p(t)||d(t))throw r();if(ko(t)){const s=No(t);try{const e=Io(this._nativeAudioNode,s,n,a),i=jo(this);(h||i)&&this._nativeAudioNode.disconnect(...e),"closed"!==this.context.state&&!i&&jo(t)&&lo(t)}catch(v){if(12===v.code)throw r();throw v}if(e(this,t,n,a,h)){const e=l([this],t);qo(e,i(h))}return t}const m=Bo(t);if("playbackRate"===m.name&&1024===m.maxValue)throw o();try{this._nativeAudioNode.connect(m,n),(h||jo(this))&&this._nativeAudioNode.disconnect(m,n)}catch(v){if(12===v.code)throw r();throw v}if(Ho(this,t,n,h)){const e=l([this],t);qo(e,i(h))}}disconnect(t,e,n){let i;const o=u(this._context),c=f(o);if(void 0===t)i=((t,e)=>{const n=Co(t),i=[];for(const s of n.outputs)Eo(s)?Go(t,e,...s):Ko(t,e,...s),i.push(s[0]);return n.outputs.clear(),i})(this,c);else if("number"==typeof t){if(t<0||t>=this.numberOfOutputs)throw s();i=((t,e,n)=>{const i=Co(t),s=[];for(const r of i.outputs)r[1]===n&&(Eo(r)?Go(t,e,...r):Ko(t,e,...r),s.push(r[0]),i.outputs.delete(r));return s})(this,c,t)}else{if(void 0!==e&&(e<0||e>=this.numberOfOutputs))throw s();if(ko(t)&&void 0!==n&&(n<0||n>=t.numberOfInputs))throw s();if(i=((t,e,n,i,s)=>{const r=Co(t);return Array.from(r.outputs).filter((t=>!(t[0]!==n||void 0!==i&&t[1]!==i||void 0!==s&&t[2]!==s))).map((n=>(Eo(n)?Go(t,e,...n):Ko(t,e,...n),r.outputs.delete(n),n[0])))})(this,c,t,e,n),0===i.length)throw r()}for(const s of i){const t=l([this],s);qo(t,a)}}})((Dl=Wr,(t,e,n)=>{const i=[];for(let s=0;s<n.numberOfInputs;s+=1)i.push(new Set);Dl.set(t,{activeInputs:i,outputs:new Set,passiveInputs:new WeakMap,renderer:e})}),((t,e,n,i,s,r,o,a,l,c,u,h,p)=>{const d=new WeakMap;return(f,m,v,_,g)=>{const{activeInputs:b,passiveInputs:y}=r(m),{outputs:w}=r(f),x=a(f),C=r=>{const a=l(m),c=l(f);if(r){const e=oo(y,f,v,_);t(b,f,e,!1),g||h(f)||n(c,a,v,_),p(m)&&lo(m)}else{const t=i(b,f,v,_);e(y,_,t,!1),g||h(f)||s(c,a,v,_);const n=o(m);if(0===n)u(m)&&ho(m,b);else{const t=d.get(m);void 0!==t&&clearTimeout(t),d.set(m,setTimeout((()=>{u(m)&&ho(m,b)}),1e3*n))}}};return!!c(w,[m,v,_],(t=>t[0]===m&&t[1]===v&&t[2]===_),!0)&&(x.add(C),u(f)?t(b,f,[v,_,C],!0):e(y,_,[f,v,C],!0),!0)}})(Ya,$a,Io,Za,Lo,Co,tl,ao,No,Po,wo,zo,jo),nl,((t,e,n,i,s,r)=>o=>(a,l)=>{const c=t.get(a);if(void 0===c){if(!o&&r(a)){const t=i(a),{outputs:r}=n(a);for(const n of r)if(Eo(n)){const s=i(n[0]);e(t,s,n[1],n[2])}else{const e=s(n[0]);t.disconnect(e,n[1])}}t.set(a,l)}else t.set(a,c+l)})($r,Lo,Co,No,Bo,wo),vo,ha,Da,((t,e,n,i,s,r,o,a)=>(l,c)=>{const u=e.get(l);if(void 0===u)throw new Error("Missing the expected cycle count.");const h=r(l.context),p=a(h);if(u===c){if(e.delete(l),!p&&o(l)){const e=i(l),{outputs:r}=n(l);for(const n of r)if(Eo(n)){const s=i(n[0]);t(e,s,n[1],n[2])}else{const t=s(n[0]);e.connect(t,n[1])}}}else e.set(l,u-c)})(Io,$r,Co,No,Bo,vl,wo,yl),((t,e,n)=>function i(s,r){const o=ko(r)?r:n(t,r);if((t=>"delayTime"in t)(o))return[];if(s[0]===o)return[s];if(s.includes(o))return[];const{outputs:a}=e(o);return Array.from(a).map((t=>i([...s,o],t[0]))).reduce(((t,e)=>t.concat(e)),[])})(xl,Co,so),Cl,vl,Sl,El,Pl,yl,Ml);var Dl;const Il=((t,e,n,i,s,r)=>class extends t{constructor(t,n){const o=s(t),a={...po,...n},l=i(o,a);super(t,!1,l,r(o)?e():null),this._nativeAnalyserNode=l}get fftSize(){return this._nativeAnalyserNode.fftSize}set fftSize(t){this._nativeAnalyserNode.fftSize=t}get frequencyBinCount(){return this._nativeAnalyserNode.frequencyBinCount}get maxDecibels(){return this._nativeAnalyserNode.maxDecibels}set maxDecibels(t){const e=this._nativeAnalyserNode.maxDecibels;if(this._nativeAnalyserNode.maxDecibels=t,!(t>this._nativeAnalyserNode.minDecibels))throw this._nativeAnalyserNode.maxDecibels=e,n()}get minDecibels(){return this._nativeAnalyserNode.minDecibels}set minDecibels(t){const e=this._nativeAnalyserNode.minDecibels;if(this._nativeAnalyserNode.minDecibels=t,!(this._nativeAnalyserNode.maxDecibels>t))throw this._nativeAnalyserNode.minDecibels=e,n()}get smoothingTimeConstant(){return this._nativeAnalyserNode.smoothingTimeConstant}set smoothingTimeConstant(t){this._nativeAnalyserNode.smoothingTimeConstant=t}getByteFrequencyData(t){this._nativeAnalyserNode.getByteFrequencyData(t)}getByteTimeDomainData(t){this._nativeAnalyserNode.getByteTimeDomainData(t)}getFloatFrequencyData(t){this._nativeAnalyserNode.getFloatFrequencyData(t)}getFloatTimeDomainData(t){this._nativeAnalyserNode.getFloatTimeDomainData(t)}})(Ol,pl,vo,ol,vl,yl),Vl=new WeakSet,Rl=(t=>null===t?null:t.hasOwnProperty("AudioBuffer")?t.AudioBuffer:null)(rl),Fl=(Ll=new Uint32Array(1),t=>(Ll[0]=t,Ll[0]));var Ll;const Nl=((t,e)=>n=>{n.copyFromChannel=(i,s,r=0)=>{const o=t(r),a=t(s);if(a>=n.numberOfChannels)throw e();const l=n.length,c=n.getChannelData(a),u=i.length;for(let t=o<0?-o:0;t+o<l&&t<u;t+=1)i[t]=c[t+o]},n.copyToChannel=(i,s,r=0)=>{const o=t(r),a=t(s);if(a>=n.numberOfChannels)throw e();const l=n.length,c=n.getChannelData(a),u=i.length;for(let t=o<0?-o:0;t+o<l&&t<u;t+=1)c[t+o]=i[t]}})(Fl,vo),Bl=(zl=Fl,t=>{var e,n;t.copyFromChannel=(e=t.copyFromChannel,(n,i,s=0)=>{const r=zl(s),o=zl(i);if(r<t.length)return e.call(t,n,o,r)}),t.copyToChannel=(n=t.copyToChannel,(e,i,s=0)=>{const r=zl(s),o=zl(i);if(r<t.length)return n.call(t,e,o,r)})});var zl;const jl=((t,e,n,i,s,r,o,a)=>{let l=null;return class c{constructor(c){if(null===s)throw new Error("Missing the native OfflineAudioContext constructor.");const{length:u,numberOfChannels:h,sampleRate:p}={...go,...c};null===l&&(l=new s(1,1,44100));const d=null!==i&&e(r,r)?new i({length:u,numberOfChannels:h,sampleRate:p}):l.createBuffer(h,u,p);if(0===d.numberOfChannels)throw n();return"function"!=typeof d.copyFromChannel?(o(d),_o(d)):e(mo,(()=>mo(d)))||a(d),t.add(d),d}static[Symbol.hasInstance](e){return null!==e&&"object"==typeof e&&Object.getPrototypeOf(e)===c.prototype||t.has(e)}}})(Vl,nl,Da,Rl,gl,(Ul=Rl,()=>{if(null===Ul)return!1;try{new Ul({length:1,sampleRate:44100})}catch{return!1}return!0}),Nl,Bl);var Ul;const ql=(Wl=Ea,(t,e)=>{const n=Wl(t,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});e.connect(n).connect(t.destination);const i=()=>{e.removeEventListener("ended",i),e.disconnect(n),n.disconnect()};e.addEventListener("ended",i)});var Wl;const Hl=(Gl=cl,Kl=To,Yl=zo,async(t,e,n)=>{const i=Kl(t);await Promise.all(Array.from(i.activeInputs).map((async([t,i])=>{const s=Gl(t),r=await s.render(t,e);Yl(t)||r.connect(n,i)})))});var Gl,Kl,Yl;const Xl=($l=Hl,(t,e,n)=>$l(e,t,n));var $l;const Zl=((t,e,n,i,s,r,o,a,l,c,u)=>(h,p)=>{const d=h.createBufferSource();return _a(d,p),ba(d,p,"playbackRate"),va(d,p,"buffer"),va(d,p,"loop"),va(d,p,"loopEnd"),va(d,p,"loopStart"),e(n,(()=>n(h)))||(t=>{t.start=(e=>{let n=!1;return(i=0,s=0,r)=>{if(n)throw ua();e.call(t,i,s,r),n=!0}})(t.start)})(d),e(i,(()=>i(h)))||l(d),e(s,(()=>s(h)))||c(d,h),e(r,(()=>r(h)))||ya(d),e(o,(()=>o(h)))||u(d,h),e(a,(()=>a(h)))||wa(d),t(h,d),d})(ql,nl,(t=>{const e=t.createBufferSource();e.start();try{e.start()}catch{return!0}return!1}),(t=>{const e=t.createBufferSource(),n=t.createBuffer(1,1,44100);e.buffer=n;try{e.start(0,1)}catch{return!1}return!0}),(t=>{const e=t.createBufferSource();e.start();try{e.stop()}catch{return!1}return!0}),qa,Wa,Ha,(t=>{var e;t.start=(e=t.start,(n=0,i=0,s)=>{const r=t.buffer,o=null===r?i:Math.min(r.duration,i);null!==r&&o>r.duration-.5/t.context.sampleRate?e.call(t,n,0,0):e.call(t,n,o,s)})}),(Ql=ja,(t,e)=>{const n=e.createBuffer(1,1,44100);null===t.buffer&&(t.buffer=n),Ql(t,"buffer",(e=>()=>{const i=e.call(t);return i===n?null:i}),(e=>i=>e.call(t,null===i?n:i)))}),Ga);var Ql;const Jl=((t,e)=>(n,i,s)=>(t(i).replay(s),e(i,n,s)))((t=>e=>{const n=t(e);if(null===n.renderer)throw new Error("Missing the renderer of the given AudioParam in the audio graph.");return n.renderer})(To),Hl),tc=((t,e,n,i,s)=>()=>{const r=new WeakMap;let o=null,a=null;return{set start(t){o=t},set stop(t){a=t},render(l,c){const u=r.get(c);return void 0!==u?Promise.resolve(u):(async(l,c)=>{let u=n(l);const h=fo(u,c);if(!h){const t={buffer:u.buffer,channelCount:u.channelCount,channelCountMode:u.channelCountMode,channelInterpretation:u.channelInterpretation,loop:u.loop,loopEnd:u.loopEnd,loopStart:u.loopStart,playbackRate:u.playbackRate.value};u=e(c,t),null!==o&&u.start(...o),null!==a&&u.stop(a)}return r.set(c,u),h?await t(c,l.playbackRate,u.playbackRate):await i(c,l.playbackRate,u.playbackRate),await s(l,c,u),u})(l,c)}}})(Xl,Zl,No,Jl,hl),ec=((t,e,n,i,s,r,o,a,l,c,u,h,p)=>(d,f,m,v=null,_=null)=>{const g=new Ur(m.defaultValue),b=f?i(g):null,y={get defaultValue(){return m.defaultValue},get maxValue(){return null===v?m.maxValue:v},get minValue(){return null===_?m.minValue:_},get value(){return m.value},set value(t){m.value=t,y.setValueAtTime(t,d.context.currentTime)},cancelAndHoldAtTime(t){if("function"==typeof m.cancelAndHoldAtTime)null===b&&g.flush(d.context.currentTime),g.add(s(t)),m.cancelAndHoldAtTime(t);else{const e=Array.from(g).pop();null===b&&g.flush(d.context.currentTime),g.add(s(t));const n=Array.from(g).pop();m.cancelScheduledValues(t),e!==n&&void 0!==n&&("exponentialRampToValue"===n.type?m.exponentialRampToValueAtTime(n.value,n.endTime):"linearRampToValue"===n.type?m.linearRampToValueAtTime(n.value,n.endTime):"setValue"===n.type?m.setValueAtTime(n.value,n.startTime):"setValueCurve"===n.type&&m.setValueCurveAtTime(n.values,n.startTime,n.duration))}return y},cancelScheduledValues:t=>(null===b&&g.flush(d.context.currentTime),g.add(r(t)),m.cancelScheduledValues(t),y),exponentialRampToValueAtTime(t,e){if(0===t)throw new RangeError;if(!Number.isFinite(e)||e<0)throw new RangeError;return null===b&&g.flush(d.context.currentTime),g.add(o(t,e)),m.exponentialRampToValueAtTime(t,e),y},linearRampToValueAtTime:(t,e)=>(null===b&&g.flush(d.context.currentTime),g.add(a(t,e)),m.linearRampToValueAtTime(t,e),y),setTargetAtTime:(t,e,n)=>(null===b&&g.flush(d.context.currentTime),g.add(l(t,e,n)),m.setTargetAtTime(t,e,n),y),setValueAtTime:(t,e)=>(null===b&&g.flush(d.context.currentTime),g.add(c(t,e)),m.setValueAtTime(t,e),y),setValueCurveAtTime(t,e,n){const i=t instanceof Float32Array?t:new Float32Array(t);if(null!==h&&"webkitAudioContext"===h.name){const t=e+n,s=d.context.sampleRate,r=Math.ceil(e*s),o=Math.floor(t*s),a=o-r,l=new Float32Array(a);for(let u=0;u<a;u+=1){const t=(i.length-1)/n*((r+u)/s-e),o=Math.floor(t),a=Math.ceil(t);l[u]=o===a?i[o]:(1-(t-o))*i[o]+(1-(a-t))*i[a]}null===b&&g.flush(d.context.currentTime),g.add(u(l,e,n)),m.setValueCurveAtTime(l,e,n);const c=o/s;c<t&&p(y,l[l.length-1],c),p(y,i[i.length-1],t)}else null===b&&g.flush(d.context.currentTime),g.add(u(i,e,n)),m.setValueCurveAtTime(i,e,n);return y}};return n.set(y,m),e.set(y,d),t(y,b),y})((nc=Gr,(t,e)=>{nc.set(t,{activeInputs:new Set,passiveInputs:new WeakMap,renderer:e})}),xl,Kr,(t=>({replay(e){for(const n of t)if("exponentialRampToValue"===n.type){const{endTime:t,value:i}=n;e.exponentialRampToValueAtTime(i,t)}else if("linearRampToValue"===n.type){const{endTime:t,value:i}=n;e.linearRampToValueAtTime(i,t)}else if("setTarget"===n.type){const{startTime:t,target:i,timeConstant:s}=n;e.setTargetAtTime(i,t,s)}else if("setValue"===n.type){const{startTime:t,value:i}=n;e.setValueAtTime(i,t)}else{if("setValueCurve"!==n.type)throw new Error("Can't apply an unknown automation.");{const{duration:t,startTime:i,values:s}=n;e.setValueCurveAtTime(s,i,t)}}}})),(t=>({cancelTime:t,type:"cancelAndHold"})),(t=>({cancelTime:t,type:"cancelScheduledValues"})),((t,e)=>({endTime:e,type:"exponentialRampToValue",value:t})),((t,e)=>({endTime:e,type:"linearRampToValue",value:t})),((t,e,n)=>({startTime:e,target:t,timeConstant:n,type:"setTarget"})),Ar,Sr,Al,Ua);var nc;const ic=((t,e,n,i,s,r,o,a)=>class extends t{constructor(t,i){const a=r(t),l={...xo,...i},c=s(a,l),u=o(a),h=u?e():null;super(t,!1,c,h),this._audioBufferSourceNodeRenderer=h,this._isBufferNullified=!1,this._isBufferSet=null!==l.buffer,this._nativeAudioBufferSourceNode=c,this._onended=null,this._playbackRate=n(this,u,c.playbackRate,yo,bo)}get buffer(){return this._isBufferNullified?null:this._nativeAudioBufferSourceNode.buffer}set buffer(t){if(this._nativeAudioBufferSourceNode.buffer=t,null!==t){if(this._isBufferSet)throw i();this._isBufferSet=!0}}get loop(){return this._nativeAudioBufferSourceNode.loop}set loop(t){this._nativeAudioBufferSourceNode.loop=t}get loopEnd(){return this._nativeAudioBufferSourceNode.loopEnd}set loopEnd(t){this._nativeAudioBufferSourceNode.loopEnd=t}get loopStart(){return this._nativeAudioBufferSourceNode.loopStart}set loopStart(t){this._nativeAudioBufferSourceNode.loopStart=t}get onended(){return this._onended}set onended(t){const e="function"==typeof t?a(this,t):null;this._nativeAudioBufferSourceNode.onended=e;const n=this._nativeAudioBufferSourceNode.onended;this._onended=null!==n&&n===e?t:n}get playbackRate(){return this._playbackRate}start(t=0,e=0,n){if(this._nativeAudioBufferSourceNode.start(t,e,n),null!==this._audioBufferSourceNodeRenderer&&(this._audioBufferSourceNodeRenderer.start=void 0===n?[t,e]:[t,e,n]),"closed"!==this.context.state){lo(this);const t=()=>{this._nativeAudioBufferSourceNode.removeEventListener("ended",t),wo(this)&&uo(this)};this._nativeAudioBufferSourceNode.addEventListener("ended",t)}}stop(t=0){this._nativeAudioBufferSourceNode.stop(t),null!==this._audioBufferSourceNodeRenderer&&(this._audioBufferSourceNodeRenderer.stop=t)}})(Ol,tc,ec,ua,Zl,vl,yl,Ka),sc=((t,e,n,i,s,r,o,a)=>class extends t{constructor(t,n){const i=r(t),l=o(i),c=s(i,n,l);super(t,!1,c,l?e(a):null),this._isNodeOfNativeOfflineAudioContext=l,this._nativeAudioDestinationNode=c}get channelCount(){return this._nativeAudioDestinationNode.channelCount}set channelCount(t){if(this._isNodeOfNativeOfflineAudioContext)throw i();if(t>this._nativeAudioDestinationNode.maxChannelCount)throw n();this._nativeAudioDestinationNode.channelCount=t}get channelCountMode(){return this._nativeAudioDestinationNode.channelCountMode}set channelCountMode(t){if(this._isNodeOfNativeOfflineAudioContext)throw i();this._nativeAudioDestinationNode.channelCountMode=t}get maxChannelCount(){return this._nativeAudioDestinationNode.maxChannelCount}})(Ol,(t=>{const e=new WeakMap;return{render(n,i){const s=e.get(i);return void 0!==s?Promise.resolve(s):(async(n,i)=>{const s=i.destination;return e.set(i,s),await t(n,i,s),s})(n,i)}}}),vo,ua,((t,e)=>(n,i,s)=>{const r=n.destination;if(r.channelCount!==i)try{r.channelCount=i}catch{}s&&"explicit"!==r.channelCountMode&&(r.channelCountMode="explicit"),0===r.maxChannelCount&&Object.defineProperty(r,"maxChannelCount",{value:i});const o=t(n,{channelCount:i,channelCountMode:r.channelCountMode,channelInterpretation:r.channelInterpretation,gain:1});return e(o,"channelCount",(t=>()=>t.call(o)),(t=>e=>{t.call(o,e);try{r.channelCount=e}catch(n){if(e>r.maxChannelCount)throw n}})),e(o,"channelCountMode",(t=>()=>t.call(o)),(t=>e=>{t.call(o,e),r.channelCountMode=e})),e(o,"channelInterpretation",(t=>()=>t.call(o)),(t=>e=>{t.call(o,e),r.channelInterpretation=e})),Object.defineProperty(o,"maxChannelCount",{get:()=>r.maxChannelCount}),o.connect(r),o})(Ea,ja),vl,yl,hl),rc=((t,e,n,i,s)=>()=>{const r=new WeakMap;return{render(o,a){const l=r.get(a);return void 0!==l?Promise.resolve(l):(async(o,a)=>{let l=n(o);const c=fo(l,a);if(!c){const t={Q:l.Q.value,channelCount:l.channelCount,channelCountMode:l.channelCountMode,channelInterpretation:l.channelInterpretation,detune:l.detune.value,frequency:l.frequency.value,gain:l.gain.value,type:l.type};l=e(a,t)}return r.set(a,l),c?(await t(a,o.Q,l.Q),await t(a,o.detune,l.detune),await t(a,o.frequency,l.frequency),await t(a,o.gain,l.gain)):(await i(a,o.Q,l.Q),await i(a,o.detune,l.detune),await i(a,o.frequency,l.frequency),await i(a,o.gain,l.gain)),await s(o,a,l),l})(o,a)}}})(Xl,Ta,No,Jl,hl),oc=(t=>(e,n)=>t.set(e,n))(Ja),ac=(lc=Ol,cc=ec,uc=rc,hc=ha,pc=Ta,dc=vl,fc=yl,mc=oc,class extends lc{constructor(t,e){const n=dc(t),i={...ta,...e},s=pc(n,i),r=fc(n);super(t,!1,s,r?uc():null),this._Q=cc(this,r,s.Q,yo,bo),this._detune=cc(this,r,s.detune,1200*Math.log2(yo),-1200*Math.log2(yo)),this._frequency=cc(this,r,s.frequency,t.sampleRate/2,0),this._gain=cc(this,r,s.gain,40*Math.log10(yo),bo),this._nativeBiquadFilterNode=s,mc(this,1)}get detune(){return this._detune}get frequency(){return this._frequency}get gain(){return this._gain}get Q(){return this._Q}get type(){return this._nativeBiquadFilterNode.type}set type(t){this._nativeBiquadFilterNode.type=t}getFrequencyResponse(t,e,n){try{this._nativeBiquadFilterNode.getFrequencyResponse(t,e,n)}catch(i){if(11===i.code)throw hc();throw i}if(t.length!==e.length||e.length!==n.length)throw hc()}});var lc,cc,uc,hc,pc,dc,fc,mc;const vc=((t,e)=>(n,i,s)=>{const r=new Set;var o,a;return n.connect=(o=n.connect,(s,a=0,l=0)=>{const c=0===r.size;if(e(s))return o.call(n,s,a,l),t(r,[s,a,l],(t=>t[0]===s&&t[1]===a&&t[2]===l),!0),c&&i(),s;o.call(n,s,a),t(r,[s,a],(t=>t[0]===s&&t[1]===a),!0),c&&i()}),n.disconnect=(a=n.disconnect,(t,i,o)=>{const l=r.size>0;if(void 0===t)a.apply(n),r.clear();else if("number"==typeof t){a.call(n,t);for(const e of r)e[1]===t&&r.delete(e)}else{e(t)?a.call(n,t,i,o):a.call(n,t,i);for(const e of r)e[0]!==t||void 0!==i&&e[1]!==i||void 0!==o&&e[2]!==o||r.delete(e)}const c=0===r.size;l&&c&&s()}),n})(Po,El);var _c,gc;const bc=((t,e)=>(n,i)=>{const s=n.createChannelMerger(i.numberOfInputs);return null!==t&&"webkitAudioContext"===t.name&&e(n,s),_a(s,i),s})(Al,(_c=ua,gc=vc,(t,e)=>{e.channelCount=1,e.channelCountMode="explicit",Object.defineProperty(e,"channelCount",{get:()=>1,set:()=>{throw _c()}}),Object.defineProperty(e,"channelCountMode",{get:()=>"explicit",set:()=>{throw _c()}});const n=t.createBufferSource();gc(e,(()=>{const t=e.numberOfInputs;for(let i=0;i<t;i+=1)n.connect(e,0,i)}),(()=>n.disconnect(e)))})),yc=((t,e,n)=>()=>{const i=new WeakMap;return{render(s,r){const o=i.get(r);return void 0!==o?Promise.resolve(o):(async(s,r)=>{let o=e(s);if(!fo(o,r)){const e={channelCount:o.channelCount,channelCountMode:o.channelCountMode,channelInterpretation:o.channelInterpretation,numberOfInputs:o.numberOfInputs};o=t(r,e)}return i.set(r,o),await n(s,r,o),o})(s,r)}}})(bc,No,hl),wc=((t,e,n,i,s)=>class extends t{constructor(t,r){const o=i(t),a={...ea,...r};super(t,!1,n(o,a),s(o)?e():null)}})(Ol,yc,bc,vl,yl),xc=((t,e,n)=>()=>{const i=new WeakMap;return{render(s,r){const o=i.get(r);return void 0!==o?Promise.resolve(o):(async(s,r)=>{let o=e(s);if(!fo(o,r)){const e={channelCount:o.channelCount,channelCountMode:o.channelCountMode,channelInterpretation:o.channelInterpretation,numberOfOutputs:o.numberOfOutputs};o=t(r,e)}return i.set(r,o),await n(s,r,o),o})(s,r)}}})(Aa,No,hl),Cc=((t,e,n,i,s,r)=>class extends t{constructor(t,o){const a=i(t),l=r({...na,...o});super(t,!1,n(a,l),s(a)?e():null)}})(Ol,xc,Aa,vl,yl,(t=>({...t,channelCount:t.numberOfOutputs}))),Tc=((t,e,n,i)=>(s,{offset:r,...o})=>{const a=s.createBuffer(1,2,44100),l=e(s,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),c=n(s,{...o,gain:r}),u=a.getChannelData(0);u[0]=1,u[1]=1,l.buffer=a,l.loop=!0;const h={get bufferSize(){},get channelCount(){return c.channelCount},set channelCount(t){c.channelCount=t},get channelCountMode(){return c.channelCountMode},set channelCountMode(t){c.channelCountMode=t},get channelInterpretation(){return c.channelInterpretation},set channelInterpretation(t){c.channelInterpretation=t},get context(){return c.context},get inputs(){return[]},get numberOfInputs(){return l.numberOfInputs},get numberOfOutputs(){return c.numberOfOutputs},get offset(){return c.gain},get onended(){return l.onended},set onended(t){l.onended=t},addEventListener:(...t)=>l.addEventListener(t[0],t[1],t[2]),dispatchEvent:(...t)=>l.dispatchEvent(t[0]),removeEventListener:(...t)=>l.removeEventListener(t[0],t[1],t[2]),start(t=0){l.start.call(l,t)},stop(t=0){l.stop.call(l,t)}};return t(s,l),i(Sa(h,c),(()=>l.connect(c)),(()=>l.disconnect(c)))})(ql,Zl,Ea,vc),Ac=((t,e,n,i,s)=>(r,o)=>{if(void 0===r.createConstantSource)return n(r,o);const a=r.createConstantSource();return _a(a,o),ba(a,o,"offset"),e(i,(()=>i(r)))||ya(a),e(s,(()=>s(r)))||wa(a),t(r,a),a})(ql,nl,Tc,qa,Ha),Sc=((t,e,n,i,s)=>()=>{const r=new WeakMap;let o=null,a=null;return{set start(t){o=t},set stop(t){a=t},render(l,c){const u=r.get(c);return void 0!==u?Promise.resolve(u):(async(l,c)=>{let u=n(l);const h=fo(u,c);if(!h){const t={channelCount:u.channelCount,channelCountMode:u.channelCountMode,channelInterpretation:u.channelInterpretation,offset:u.offset.value};u=e(c,t),null!==o&&u.start(o),null!==a&&u.stop(a)}return r.set(c,u),h?await t(c,l.offset,u.offset):await i(c,l.offset,u.offset),await s(l,c,u),u})(l,c)}}})(Xl,Ac,No,Jl,hl),kc=((t,e,n,i,s,r,o)=>class extends t{constructor(t,o){const a=s(t),l={...ia,...o},c=i(a,l),u=r(a),h=u?n():null;super(t,!1,c,h),this._constantSourceNodeRenderer=h,this._nativeConstantSourceNode=c,this._offset=e(this,u,c.offset,yo,bo),this._onended=null}get offset(){return this._offset}get onended(){return this._onended}set onended(t){const e="function"==typeof t?o(this,t):null;this._nativeConstantSourceNode.onended=e;const n=this._nativeConstantSourceNode.onended;this._onended=null!==n&&n===e?t:n}start(t=0){if(this._nativeConstantSourceNode.start(t),null!==this._constantSourceNodeRenderer&&(this._constantSourceNodeRenderer.start=t),"closed"!==this.context.state){lo(this);const t=()=>{this._nativeConstantSourceNode.removeEventListener("ended",t),wo(this)&&uo(this)};this._nativeConstantSourceNode.addEventListener("ended",t)}}stop(t=0){this._nativeConstantSourceNode.stop(t),null!==this._constantSourceNodeRenderer&&(this._constantSourceNodeRenderer.stop=t)}})(Ol,ec,Sc,Ac,vl,yl,Ka),Ec=((t,e)=>(n,i)=>{const s=n.createConvolver();if(_a(s,i),i.disableNormalization===s.normalize&&(s.normalize=!i.disableNormalization),va(s,i,"buffer"),i.channelCount>2)throw t();if(e(s,"channelCount",(t=>()=>t.call(s)),(e=>n=>{if(n>2)throw t();return e.call(s,n)})),"max"===i.channelCountMode)throw t();return e(s,"channelCountMode",(t=>()=>t.call(s)),(e=>n=>{if("max"===n)throw t();return e.call(s,n)})),s})(Da,ja),Pc=((t,e,n)=>()=>{const i=new WeakMap;return{render(s,r){const o=i.get(r);return void 0!==o?Promise.resolve(o):(async(s,r)=>{let o=e(s);if(!fo(o,r)){const e={buffer:o.buffer,channelCount:o.channelCount,channelCountMode:o.channelCountMode,channelInterpretation:o.channelInterpretation,disableNormalization:!o.normalize};o=t(r,e)}return i.set(r,o),Do(o)?await n(s,r,o.inputs[0]):await n(s,r,o),o})(s,r)}}})(Ec,No,hl),Mc=((t,e,n,i,s,r)=>class extends t{constructor(t,o){const a=i(t),l={...sa,...o},c=n(a,l);super(t,!1,c,s(a)?e():null),this._isBufferNullified=!1,this._nativeConvolverNode=c,null!==l.buffer&&r(this,l.buffer.duration)}get buffer(){return this._isBufferNullified?null:this._nativeConvolverNode.buffer}set buffer(t){if(this._nativeConvolverNode.buffer=t,null===t&&null!==this._nativeConvolverNode.buffer){const t=this._nativeConvolverNode.context;this._nativeConvolverNode.buffer=t.createBuffer(1,1,t.sampleRate),this._isBufferNullified=!0,r(this,0)}else this._isBufferNullified=!1,r(this,null===this._nativeConvolverNode.buffer?0:this._nativeConvolverNode.buffer.duration)}get normalize(){return this._nativeConvolverNode.normalize}set normalize(t){this._nativeConvolverNode.normalize=t}})(Ol,Pc,Ec,vl,yl,oc),Oc=((t,e,n,i,s)=>r=>{const o=new WeakMap;return{render(a,l){const c=o.get(l);return void 0!==c?Promise.resolve(c):(async(a,l)=>{let c=n(a);const u=fo(c,l);if(!u){const t={channelCount:c.channelCount,channelCountMode:c.channelCountMode,channelInterpretation:c.channelInterpretation,delayTime:c.delayTime.value,maxDelayTime:r};c=e(l,t)}return o.set(l,c),u?await t(l,a.delayTime,c.delayTime):await i(l,a.delayTime,c.delayTime),await s(a,l,c),c})(a,l)}}})(Xl,ka,No,Jl,hl),Dc=((t,e,n,i,s,r,o)=>class extends t{constructor(t,a){const l=s(t),c={...oa,...a},u=i(l,c),h=r(l);super(t,!1,u,h?n(c.maxDelayTime):null),this._delayTime=e(this,h,u.delayTime),o(this,c.maxDelayTime)}get delayTime(){return this._delayTime}})(Ol,ec,Oc,ka,vl,yl,oc),Ic=(Vc=Da,(t,e)=>{const n=t.createDynamicsCompressor();if(_a(n,e),e.channelCount>2)throw Vc();if("max"===e.channelCountMode)throw Vc();return ba(n,e,"attack"),ba(n,e,"knee"),ba(n,e,"ratio"),ba(n,e,"release"),ba(n,e,"threshold"),n});var Vc;const Rc=((t,e,n,i,s)=>()=>{const r=new WeakMap;return{render(o,a){const l=r.get(a);return void 0!==l?Promise.resolve(l):(async(o,a)=>{let l=n(o);const c=fo(l,a);if(!c){const t={attack:l.attack.value,channelCount:l.channelCount,channelCountMode:l.channelCountMode,channelInterpretation:l.channelInterpretation,knee:l.knee.value,ratio:l.ratio.value,release:l.release.value,threshold:l.threshold.value};l=e(a,t)}return r.set(a,l),c?(await t(a,o.attack,l.attack),await t(a,o.knee,l.knee),await t(a,o.ratio,l.ratio),await t(a,o.release,l.release),await t(a,o.threshold,l.threshold)):(await i(a,o.attack,l.attack),await i(a,o.knee,l.knee),await i(a,o.ratio,l.ratio),await i(a,o.release,l.release),await i(a,o.threshold,l.threshold)),await s(o,a,l),l})(o,a)}}})(Xl,Ic,No,Jl,hl),Fc=((t,e,n,i,s,r,o,a)=>class extends t{constructor(t,s){const l=r(t),c={...la,...s},u=i(l,c),h=o(l);super(t,!1,u,h?n():null),this._attack=e(this,h,u.attack),this._knee=e(this,h,u.knee),this._nativeDynamicsCompressorNode=u,this._ratio=e(this,h,u.ratio),this._release=e(this,h,u.release),this._threshold=e(this,h,u.threshold),a(this,.006)}get attack(){return this._attack}get channelCount(){return this._nativeDynamicsCompressorNode.channelCount}set channelCount(t){const e=this._nativeDynamicsCompressorNode.channelCount;if(this._nativeDynamicsCompressorNode.channelCount=t,t>2)throw this._nativeDynamicsCompressorNode.channelCount=e,s()}get channelCountMode(){return this._nativeDynamicsCompressorNode.channelCountMode}set channelCountMode(t){const e=this._nativeDynamicsCompressorNode.channelCountMode;if(this._nativeDynamicsCompressorNode.channelCountMode=t,"max"===t)throw this._nativeDynamicsCompressorNode.channelCountMode=e,s()}get knee(){return this._knee}get ratio(){return this._ratio}get reduction(){return"number"==typeof this._nativeDynamicsCompressorNode.reduction.value?this._nativeDynamicsCompressorNode.reduction.value:this._nativeDynamicsCompressorNode.reduction}get release(){return this._release}get threshold(){return this._threshold}})(Ol,ec,Rc,Ic,Da,vl,yl,oc),Lc=((t,e,n,i,s)=>()=>{const r=new WeakMap;return{render(o,a){const l=r.get(a);return void 0!==l?Promise.resolve(l):(async(o,a)=>{let l=n(o);const c=fo(l,a);if(!c){const t={channelCount:l.channelCount,channelCountMode:l.channelCountMode,channelInterpretation:l.channelInterpretation,gain:l.gain.value};l=e(a,t)}return r.set(a,l),c?await t(a,o.gain,l.gain):await i(a,o.gain,l.gain),await s(o,a,l),l})(o,a)}}})(Xl,Ea,No,Jl,hl),Nc=((t,e,n,i,s,r)=>class extends t{constructor(t,o){const a=s(t),l={...ca,...o},c=i(a,l),u=r(a);super(t,!1,c,u?n():null),this._gain=e(this,u,c.gain,yo,bo)}get gain(){return this._gain}})(Ol,ec,Lc,Ea,vl,yl),Bc=((t,e,n,i)=>(s,r,{channelCount:o,channelCountMode:a,channelInterpretation:l,feedback:c,feedforward:u})=>{const h=xa(r,s.sampleRate),p=c instanceof Float64Array?c:new Float64Array(c),d=u instanceof Float64Array?u:new Float64Array(u),f=p.length,m=d.length,v=Math.min(f,m);if(0===f||f>20)throw i();if(0===p[0])throw e();if(0===m||m>20)throw i();if(0===d[0])throw e();if(1!==p[0]){for(let t=0;t<m;t+=1)d[t]/=p[0];for(let t=1;t<f;t+=1)p[t]/=p[0]}const _=n(s,h,o,o);_.channelCount=o,_.channelCountMode=a,_.channelInterpretation=l;const g=[],b=[],y=[];for(let t=0;t<o;t+=1){g.push(0);const t=new Float32Array(32),e=new Float32Array(32);t.fill(0),e.fill(0),b.push(t),y.push(e)}_.onaudioprocess=t=>{const e=t.inputBuffer,n=t.outputBuffer,i=e.numberOfChannels;for(let s=0;s<i;s+=1){const t=e.getChannelData(s),i=n.getChannelData(s);g[s]=da(p,f,d,m,v,b[s],y[s],g[s],32,t,i)}};const w=s.sampleRate/2;return Sa({get bufferSize(){return h},get channelCount(){return _.channelCount},set channelCount(t){_.channelCount=t},get channelCountMode(){return _.channelCountMode},set channelCountMode(t){_.channelCountMode=t},get channelInterpretation(){return _.channelInterpretation},set channelInterpretation(t){_.channelInterpretation=t},get context(){return _.context},get inputs(){return[_]},get numberOfInputs(){return _.numberOfInputs},get numberOfOutputs(){return _.numberOfOutputs},addEventListener:(...t)=>_.addEventListener(t[0],t[1],t[2]),dispatchEvent:(...t)=>_.dispatchEvent(t[0]),getFrequencyResponse(e,n,i){if(e.length!==n.length||n.length!==i.length)throw t();const s=e.length;for(let t=0;t<s;t+=1){const s=-Math.PI*(e[t]/w),r=[Math.cos(s),Math.sin(s)],o=Pa(Ma(d,r),Ma(p,r));n[t]=Math.sqrt(o[0]*o[0]+o[1]*o[1]),i[t]=Math.atan2(o[1],o[0])}},removeEventListener:(...t)=>_.removeEventListener(t[0],t[1],t[2])},_)})(ha,ua,Oa,Da),zc=((t,e,n,i)=>s=>t(ma,(()=>ma(s)))?Promise.resolve(t(i,i)).then((t=>{if(!t){const t=n(s,512,0,1);s.oncomplete=()=>{t.onaudioprocess=null,t.disconnect()},t.onaudioprocess=()=>s.currentTime,t.connect(s.destination)}return s.startRendering()})):new Promise((t=>{const n=e(s,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});s.oncomplete=e=>{n.disconnect(),t(e.renderedBuffer)},n.connect(s.destination),s.startRendering()})))(nl,Ea,Oa,((t,e)=>()=>{if(null===e)return Promise.resolve(!1);const n=new e(1,1,44100),i=t(n,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});return new Promise((t=>{n.oncomplete=()=>{i.disconnect(),t(0!==n.currentTime)},n.startRendering()}))})(Ea,gl)),jc=((t,e,n,i,s)=>(r,o)=>{const a=new WeakMap;let l=null;const c=async(c,u)=>{let h=null,p=e(c);const d=fo(p,u);if(void 0===u.createIIRFilter?h=t(u,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}):d||(p=u.createIIRFilter(o,r)),a.set(u,null===h?p:h),null!==h){if(null===l){if(null===n)throw new Error("Missing the native OfflineAudioContext constructor.");const t=new n(c.context.destination.channelCount,c.context.length,u.sampleRate);l=(async()=>{await i(c,t,t.destination);return((t,e,n,i)=>{const s=n instanceof Float64Array?n:new Float64Array(n),r=i instanceof Float64Array?i:new Float64Array(i),o=s.length,a=r.length,l=Math.min(o,a);if(1!==s[0]){for(let t=0;t<o;t+=1)r[t]/=s[0];for(let t=1;t<a;t+=1)s[t]/=s[0]}const c=new Float32Array(32),u=new Float32Array(32),h=e.createBuffer(t.numberOfChannels,t.length,t.sampleRate),p=t.numberOfChannels;for(let d=0;d<p;d+=1){const e=t.getChannelData(d),n=h.getChannelData(d);c.fill(0),u.fill(0),da(s,o,r,a,l,c,u,0,32,e,n)}return h})(await s(t),u,r,o)})()}const t=await l;return h.buffer=t,h.start(0),h}return await i(c,u,p),p};return{render(t,e){const n=a.get(e);return void 0!==n?Promise.resolve(n):c(t,e)}}})(Zl,No,gl,hl,zc);var Uc;const qc=((t,e,n,i,s,r)=>class extends t{constructor(t,o){const a=i(t),l=s(a),c={...pa,...o},u=e(a,l?null:t.baseLatency,c);super(t,!1,u,l?n(c.feedback,c.feedforward):null),(t=>{var e;t.getFrequencyResponse=(e=t.getFrequencyResponse,(n,i,s)=>{if(n.length!==i.length||i.length!==s.length)throw ha();return e.call(t,n,i,s)})})(u),this._nativeIIRFilterNode=u,r(this,1)}getFrequencyResponse(t,e,n){return this._nativeIIRFilterNode.getFrequencyResponse(t,e,n)}})(Ol,(Uc=Bc,(t,e,n)=>{if(void 0===t.createIIRFilter)return Uc(t,e,n);const i=t.createIIRFilter(n.feedforward,n.feedback);return _a(i,n),i}),jc,vl,yl,oc),Wc=((t,e,n,i,s,r,o,a)=>(l,c)=>{const u=c.listener,{forwardX:h,forwardY:p,forwardZ:d,positionX:f,positionY:m,positionZ:v,upX:_,upY:g,upZ:b}=void 0===u.forwardX?(()=>{const h=new Float32Array(1),p=e(c,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:9}),d=o(c);let f=!1,m=[0,0,-1,0,1,0],v=[0,0,0];const _=()=>{if(f)return;f=!0;const t=i(c,256,9,0);t.onaudioprocess=({inputBuffer:t})=>{const e=[r(t,h,0),r(t,h,1),r(t,h,2),r(t,h,3),r(t,h,4),r(t,h,5)];e.some(((t,e)=>t!==m[e]))&&(u.setOrientation(...e),m=e);const n=[r(t,h,6),r(t,h,7),r(t,h,8)];n.some(((t,e)=>t!==v[e]))&&(u.setPosition(...n),v=n)},p.connect(t)},g=t=>e=>{e!==m[t]&&(m[t]=e,u.setOrientation(...m))},b=t=>e=>{e!==v[t]&&(v[t]=e,u.setPosition(...v))},y=(e,i,r)=>{const o=n(c,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:i});o.connect(p,0,e),o.start(),Object.defineProperty(o.offset,"defaultValue",{get:()=>i});const u=t({context:l},d,o.offset,yo,bo);var h,f,m,v,g,b,y;return a(u,"value",(t=>()=>t.call(u)),(t=>e=>{try{t.call(u,e)}catch(n){if(9!==n.code)throw n}_(),d&&r(e)})),u.cancelAndHoldAtTime=(h=u.cancelAndHoldAtTime,d?()=>{throw s()}:(...t)=>{const e=h.apply(u,t);return _(),e}),u.cancelScheduledValues=(f=u.cancelScheduledValues,d?()=>{throw s()}:(...t)=>{const e=f.apply(u,t);return _(),e}),u.exponentialRampToValueAtTime=(m=u.exponentialRampToValueAtTime,d?()=>{throw s()}:(...t)=>{const e=m.apply(u,t);return _(),e}),u.linearRampToValueAtTime=(v=u.linearRampToValueAtTime,d?()=>{throw s()}:(...t)=>{const e=v.apply(u,t);return _(),e}),u.setTargetAtTime=(g=u.setTargetAtTime,d?()=>{throw s()}:(...t)=>{const e=g.apply(u,t);return _(),e}),u.setValueAtTime=(b=u.setValueAtTime,d?()=>{throw s()}:(...t)=>{const e=b.apply(u,t);return _(),e}),u.setValueCurveAtTime=(y=u.setValueCurveAtTime,d?()=>{throw s()}:(...t)=>{const e=y.apply(u,t);return _(),e}),u};return{forwardX:y(0,0,g(0)),forwardY:y(1,0,g(1)),forwardZ:y(2,-1,g(2)),positionX:y(6,0,b(0)),positionY:y(7,0,b(1)),positionZ:y(8,0,b(2)),upX:y(3,0,g(3)),upY:y(4,1,g(4)),upZ:y(5,0,g(5))}})():u;return{get forwardX(){return h},get forwardY(){return p},get forwardZ(){return d},get positionX(){return f},get positionY(){return m},get positionZ(){return v},get upX(){return _},get upY(){return g},get upZ(){return b}}})(ec,bc,Ac,Oa,Da,Ba,yl,ja),Hc=new WeakMap,Gc=((t,e,n,i,s,r)=>class extends n{constructor(n,r){super(n),this._nativeContext=n,Yr.set(this,n),i(n)&&s.set(n,new Set),this._destination=new t(this,r),this._listener=e(this,n),this._onstatechange=null}get currentTime(){return this._nativeContext.currentTime}get destination(){return this._destination}get listener(){return this._listener}get onstatechange(){return this._onstatechange}set onstatechange(t){const e="function"==typeof t?r(this,t):null;this._nativeContext.onstatechange=e;const n=this._nativeContext.onstatechange;this._onstatechange=null!==n&&n===e?t:n}get sampleRate(){return this._nativeContext.sampleRate}get state(){return this._nativeContext.state}})(sc,Wc,Cl,yl,Hc,Ka),Kc=((t,e,n,i,s,r)=>(o,a)=>{const l=o.createOscillator();return _a(l,a),ba(l,a,"detune"),ba(l,a,"frequency"),void 0!==a.periodicWave?l.setPeriodicWave(a.periodicWave):va(l,a,"type"),e(n,(()=>n(o)))||ya(l),e(i,(()=>i(o)))||r(l,o),e(s,(()=>s(o)))||wa(l),t(o,l),l})(ql,nl,qa,Wa,Ha,Ga),Yc=((t,e,n,i,s)=>()=>{const r=new WeakMap;let o=null,a=null,l=null;return{set periodicWave(t){o=t},set start(t){a=t},set stop(t){l=t},render(c,u){const h=r.get(u);return void 0!==h?Promise.resolve(h):(async(c,u)=>{let h=n(c);const p=fo(h,u);if(!p){const t={channelCount:h.channelCount,channelCountMode:h.channelCountMode,channelInterpretation:h.channelInterpretation,detune:h.detune.value,frequency:h.frequency.value,periodicWave:null===o?void 0:o,type:h.type};h=e(u,t),null!==a&&h.start(a),null!==l&&h.stop(l)}return r.set(u,h),p?(await t(u,c.detune,h.detune),await t(u,c.frequency,h.frequency)):(await i(u,c.detune,h.detune),await i(u,c.frequency,h.frequency)),await s(c,u,h),h})(c,u)}}})(Xl,Kc,No,Jl,hl),Xc=((t,e,n,i,s,r,o)=>class extends t{constructor(t,o){const a=s(t),l={...Va,...o},c=n(a,l),u=r(a),h=u?i():null,p=t.sampleRate/2;super(t,!1,c,h),this._detune=e(this,u,c.detune,153600,-153600),this._frequency=e(this,u,c.frequency,p,-p),this._nativeOscillatorNode=c,this._onended=null,this._oscillatorNodeRenderer=h,null!==this._oscillatorNodeRenderer&&void 0!==l.periodicWave&&(this._oscillatorNodeRenderer.periodicWave=l.periodicWave)}get detune(){return this._detune}get frequency(){return this._frequency}get onended(){return this._onended}set onended(t){const e="function"==typeof t?o(this,t):null;this._nativeOscillatorNode.onended=e;const n=this._nativeOscillatorNode.onended;this._onended=null!==n&&n===e?t:n}get type(){return this._nativeOscillatorNode.type}set type(t){this._nativeOscillatorNode.type=t,null!==this._oscillatorNodeRenderer&&(this._oscillatorNodeRenderer.periodicWave=null)}setPeriodicWave(t){this._nativeOscillatorNode.setPeriodicWave(t),null!==this._oscillatorNodeRenderer&&(this._oscillatorNodeRenderer.periodicWave=t)}start(t=0){if(this._nativeOscillatorNode.start(t),null!==this._oscillatorNodeRenderer&&(this._oscillatorNodeRenderer.start=t),"closed"!==this.context.state){lo(this);const t=()=>{this._nativeOscillatorNode.removeEventListener("ended",t),wo(this)&&uo(this)};this._nativeOscillatorNode.addEventListener("ended",t)}}stop(t=0){this._nativeOscillatorNode.stop(t),null!==this._oscillatorNodeRenderer&&(this._oscillatorNodeRenderer.stop=t)}})(Ol,ec,Kc,Yc,vl,yl,Ka),$c=(Zc=Zl,(t,e)=>{const n=Zc(t,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),i=t.createBuffer(1,2,44100);return n.buffer=i,n.loop=!0,n.connect(e),n.start(),()=>{n.stop(),n.disconnect(e)}});var Zc;const Qc=((t,e,n,i,s)=>(r,{curve:o,oversample:a,...l})=>{const c=r.createWaveShaper(),u=r.createWaveShaper();_a(c,l),_a(u,l);const h=n(r,{...l,gain:1}),p=n(r,{...l,gain:-1}),d=n(r,{...l,gain:1}),f=n(r,{...l,gain:-1});let m=null,v=!1,_=null;const g={get bufferSize(){},get channelCount(){return c.channelCount},set channelCount(t){h.channelCount=t,p.channelCount=t,c.channelCount=t,d.channelCount=t,u.channelCount=t,f.channelCount=t},get channelCountMode(){return c.channelCountMode},set channelCountMode(t){h.channelCountMode=t,p.channelCountMode=t,c.channelCountMode=t,d.channelCountMode=t,u.channelCountMode=t,f.channelCountMode=t},get channelInterpretation(){return c.channelInterpretation},set channelInterpretation(t){h.channelInterpretation=t,p.channelInterpretation=t,c.channelInterpretation=t,d.channelInterpretation=t,u.channelInterpretation=t,f.channelInterpretation=t},get context(){return c.context},get curve(){return _},set curve(n){if(null!==n&&n.length<2)throw e();if(null===n)c.curve=n,u.curve=n;else{const t=n.length,e=new Float32Array(t+2-t%2),i=new Float32Array(t+2-t%2);e[0]=n[0],i[0]=-n[t-1];const s=Math.ceil((t+1)/2),r=(t+1)/2-1;for(let o=1;o<s;o+=1){const a=o/s*r,l=Math.floor(a),c=Math.ceil(a);e[o]=l===c?n[l]:(1-(a-l))*n[l]+(1-(c-a))*n[c],i[o]=l===c?-n[t-1-l]:-(1-(a-l))*n[t-1-l]-(1-(c-a))*n[t-1-c]}e[s]=t%2==1?n[s-1]:(n[s-2]+n[s-1])/2,c.curve=e,u.curve=i}_=n,v&&(i(_)&&null===m?m=t(r,h):null!==m&&(m(),m=null))},get inputs(){return[h]},get numberOfInputs(){return c.numberOfInputs},get numberOfOutputs(){return c.numberOfOutputs},get oversample(){return c.oversample},set oversample(t){c.oversample=t,u.oversample=t},addEventListener:(...t)=>h.addEventListener(t[0],t[1],t[2]),dispatchEvent:(...t)=>h.dispatchEvent(t[0]),removeEventListener:(...t)=>h.removeEventListener(t[0],t[1],t[2])};null!==o&&(g.curve=o instanceof Float32Array?o:new Float32Array(o)),a!==g.oversample&&(g.oversample=a);return s(Sa(g,d),(()=>{h.connect(c).connect(d),h.connect(p).connect(u).connect(f).connect(d),v=!0,i(_)&&(m=t(r,h))}),(()=>{h.disconnect(c),c.disconnect(d),h.disconnect(p),p.disconnect(u),u.disconnect(f),f.disconnect(d),v=!1,null!==m&&(m(),m=null)}))})($c,ua,Ea,za,vc),Jc=((t,e,n,i,s,r,o)=>(a,l)=>{const c=a.createWaveShaper();if(null!==r&&"webkitAudioContext"===r.name&&void 0===a.createGain().gain.automationRate)return n(a,l);_a(c,l);const u=null===l.curve||l.curve instanceof Float32Array?l.curve:new Float32Array(l.curve);if(null!==u&&u.length<2)throw e();va(c,{curve:u},"curve"),va(c,l,"oversample");let h=null,p=!1;o(c,"curve",(t=>()=>t.call(c)),(e=>n=>(e.call(c,n),p&&(i(n)&&null===h?h=t(a,c):i(n)||null===h||(h(),h=null)),n)));return s(c,(()=>{p=!0,i(c.curve)&&(h=t(a,c))}),(()=>{p=!1,null!==h&&(h(),h=null)}))})($c,ua,Qc,za,vc,Al,ja),tu=((t,e,n,i,s,r,o,a,l,c)=>(u,{coneInnerAngle:h,coneOuterAngle:p,coneOuterGain:d,distanceModel:f,maxDistance:m,orientationX:v,orientationY:_,orientationZ:g,panningModel:b,positionX:y,positionY:w,positionZ:x,refDistance:C,rolloffFactor:T,...A})=>{const S=u.createPanner();if(A.channelCount>2)throw o();if("max"===A.channelCountMode)throw o();_a(S,A);const k={channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete"},E=n(u,{...k,channelInterpretation:"speakers",numberOfInputs:6}),P=i(u,{...A,gain:1}),M=i(u,{...k,gain:1}),O=i(u,{...k,gain:0}),D=i(u,{...k,gain:0}),I=i(u,{...k,gain:0}),V=i(u,{...k,gain:0}),R=i(u,{...k,gain:0}),F=s(u,256,6,1),L=r(u,{...k,curve:new Float32Array([1,1]),oversample:"none"});let N=[v,_,g],B=[y,w,x];const z=new Float32Array(1);F.onaudioprocess=({inputBuffer:t})=>{const e=[l(t,z,0),l(t,z,1),l(t,z,2)];e.some(((t,e)=>t!==N[e]))&&(S.setOrientation(...e),N=e);const n=[l(t,z,3),l(t,z,4),l(t,z,5)];n.some(((t,e)=>t!==B[e]))&&(S.setPosition(...n),B=n)},Object.defineProperty(O.gain,"defaultValue",{get:()=>0}),Object.defineProperty(D.gain,"defaultValue",{get:()=>0}),Object.defineProperty(I.gain,"defaultValue",{get:()=>0}),Object.defineProperty(V.gain,"defaultValue",{get:()=>0}),Object.defineProperty(R.gain,"defaultValue",{get:()=>0});const j={get bufferSize(){},get channelCount(){return S.channelCount},set channelCount(t){if(t>2)throw o();P.channelCount=t,S.channelCount=t},get channelCountMode(){return S.channelCountMode},set channelCountMode(t){if("max"===t)throw o();P.channelCountMode=t,S.channelCountMode=t},get channelInterpretation(){return S.channelInterpretation},set channelInterpretation(t){P.channelInterpretation=t,S.channelInterpretation=t},get coneInnerAngle(){return S.coneInnerAngle},set coneInnerAngle(t){S.coneInnerAngle=t},get coneOuterAngle(){return S.coneOuterAngle},set coneOuterAngle(t){S.coneOuterAngle=t},get coneOuterGain(){return S.coneOuterGain},set coneOuterGain(t){if(t<0||t>1)throw e();S.coneOuterGain=t},get context(){return S.context},get distanceModel(){return S.distanceModel},set distanceModel(t){S.distanceModel=t},get inputs(){return[P]},get maxDistance(){return S.maxDistance},set maxDistance(t){if(t<0)throw new RangeError;S.maxDistance=t},get numberOfInputs(){return S.numberOfInputs},get numberOfOutputs(){return S.numberOfOutputs},get orientationX(){return M.gain},get orientationY(){return O.gain},get orientationZ(){return D.gain},get panningModel(){return S.panningModel},set panningModel(t){S.panningModel=t},get positionX(){return I.gain},get positionY(){return V.gain},get positionZ(){return R.gain},get refDistance(){return S.refDistance},set refDistance(t){if(t<0)throw new RangeError;S.refDistance=t},get rolloffFactor(){return S.rolloffFactor},set rolloffFactor(t){if(t<0)throw new RangeError;S.rolloffFactor=t},addEventListener:(...t)=>P.addEventListener(t[0],t[1],t[2]),dispatchEvent:(...t)=>P.dispatchEvent(t[0]),removeEventListener:(...t)=>P.removeEventListener(t[0],t[1],t[2])};h!==j.coneInnerAngle&&(j.coneInnerAngle=h),p!==j.coneOuterAngle&&(j.coneOuterAngle=p),d!==j.coneOuterGain&&(j.coneOuterGain=d),f!==j.distanceModel&&(j.distanceModel=f),m!==j.maxDistance&&(j.maxDistance=m),v!==j.orientationX.value&&(j.orientationX.value=v),_!==j.orientationY.value&&(j.orientationY.value=_),g!==j.orientationZ.value&&(j.orientationZ.value=g),b!==j.panningModel&&(j.panningModel=b),y!==j.positionX.value&&(j.positionX.value=y),w!==j.positionY.value&&(j.positionY.value=w),x!==j.positionZ.value&&(j.positionZ.value=x),C!==j.refDistance&&(j.refDistance=C),T!==j.rolloffFactor&&(j.rolloffFactor=T),1===N[0]&&0===N[1]&&0===N[2]||S.setOrientation(...N),0===B[0]&&0===B[1]&&0===B[2]||S.setPosition(...B);return c(Sa(j,S),(()=>{P.connect(S),t(P,L,0,0),L.connect(M).connect(E,0,0),L.connect(O).connect(E,0,1),L.connect(D).connect(E,0,2),L.connect(I).connect(E,0,3),L.connect(V).connect(E,0,4),L.connect(R).connect(E,0,5),E.connect(F).connect(u.destination)}),(()=>{P.disconnect(S),a(P,L,0,0),L.disconnect(M),M.disconnect(E),L.disconnect(O),O.disconnect(E),L.disconnect(D),D.disconnect(E),L.disconnect(I),I.disconnect(E),L.disconnect(V),V.disconnect(E),L.disconnect(R),R.disconnect(E),E.disconnect(F),F.disconnect(u.destination)}))})(Io,ua,bc,Ea,Oa,Jc,Da,Lo,Ba,vc),eu=(nu=tu,(t,e)=>{const n=t.createPanner();return void 0===n.orientationX?nu(t,e):(_a(n,e),ba(n,e,"orientationX"),ba(n,e,"orientationY"),ba(n,e,"orientationZ"),ba(n,e,"positionX"),ba(n,e,"positionY"),ba(n,e,"positionZ"),va(n,e,"coneInnerAngle"),va(n,e,"coneOuterAngle"),va(n,e,"coneOuterGain"),va(n,e,"distanceModel"),va(n,e,"maxDistance"),va(n,e,"panningModel"),va(n,e,"refDistance"),va(n,e,"rolloffFactor"),n)});var nu;const iu=((t,e,n,i,s,r,o,a,l,c)=>()=>{const u=new WeakMap;let h=null;return{render(p,d){const f=u.get(d);return void 0!==f?Promise.resolve(f):(async(p,d)=>{let f=null,m=r(p);const v={channelCount:m.channelCount,channelCountMode:m.channelCountMode,channelInterpretation:m.channelInterpretation},_={...v,coneInnerAngle:m.coneInnerAngle,coneOuterAngle:m.coneOuterAngle,coneOuterGain:m.coneOuterGain,distanceModel:m.distanceModel,maxDistance:m.maxDistance,panningModel:m.panningModel,refDistance:m.refDistance,rolloffFactor:m.rolloffFactor},g=fo(m,d);if("bufferSize"in m)f=i(d,{...v,gain:1});else if(!g){const t={..._,orientationX:m.orientationX.value,orientationY:m.orientationY.value,orientationZ:m.orientationZ.value,positionX:m.positionX.value,positionY:m.positionY.value,positionZ:m.positionZ.value};m=s(d,t)}if(u.set(d,null===f?m:f),null!==f){if(null===h){if(null===o)throw new Error("Missing the native OfflineAudioContext constructor.");const t=new o(6,p.context.length,d.sampleRate),i=e(t,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:6});i.connect(t.destination),h=(async()=>{const e=await Promise.all([p.orientationX,p.orientationY,p.orientationZ,p.positionX,p.positionY,p.positionZ].map((async(e,i)=>{const s=n(t,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:0===i?1:0});return await a(t,e,s.offset),s})));for(let t=0;t<6;t+=1)e[t].connect(i,0,t),e[t].start(0);return c(t)})()}const t=await h,r=i(d,{...v,gain:1});await l(p,d,r);const u=[];for(let e=0;e<t.numberOfChannels;e+=1)u.push(t.getChannelData(e));let m=[u[0][0],u[1][0],u[2][0]],g=[u[3][0],u[4][0],u[5][0]],b=i(d,{...v,gain:1}),y=s(d,{..._,orientationX:m[0],orientationY:m[1],orientationZ:m[2],positionX:g[0],positionY:g[1],positionZ:g[2]});r.connect(b).connect(y.inputs[0]),y.connect(f);for(let e=128;e<t.length;e+=128){const t=[u[0][e],u[1][e],u[2][e]],n=[u[3][e],u[4][e],u[5][e]];if(t.some(((t,e)=>t!==m[e]))||n.some(((t,e)=>t!==g[e]))){m=t,g=n;const o=e/d.sampleRate;b.gain.setValueAtTime(0,o),b=i(d,{...v,gain:0}),y=s(d,{..._,orientationX:m[0],orientationY:m[1],orientationZ:m[2],positionX:g[0],positionY:g[1],positionZ:g[2]}),b.gain.setValueAtTime(1,o),r.connect(b).connect(y.inputs[0]),y.connect(f)}}return f}return g?(await t(d,p.orientationX,m.orientationX),await t(d,p.orientationY,m.orientationY),await t(d,p.orientationZ,m.orientationZ),await t(d,p.positionX,m.positionX),await t(d,p.positionY,m.positionY),await t(d,p.positionZ,m.positionZ)):(await a(d,p.orientationX,m.orientationX),await a(d,p.orientationY,m.orientationY),await a(d,p.orientationZ,m.orientationZ),await a(d,p.positionX,m.positionX),await a(d,p.positionY,m.positionY),await a(d,p.positionZ,m.positionZ)),Do(m)?await l(p,d,m.inputs[0]):await l(p,d,m),m})(p,d)}}})(Xl,bc,Ac,Ea,eu,No,gl,Jl,hl,zc),su=((t,e,n,i,s,r,o)=>class extends t{constructor(t,a){const l=s(t),c={...Ra,...a},u=n(l,c),h=r(l);super(t,!1,u,h?i():null),this._nativePannerNode=u,this._orientationX=e(this,h,u.orientationX,yo,bo),this._orientationY=e(this,h,u.orientationY,yo,bo),this._orientationZ=e(this,h,u.orientationZ,yo,bo),this._positionX=e(this,h,u.positionX,yo,bo),this._positionY=e(this,h,u.positionY,yo,bo),this._positionZ=e(this,h,u.positionZ,yo,bo),o(this,1)}get coneInnerAngle(){return this._nativePannerNode.coneInnerAngle}set coneInnerAngle(t){this._nativePannerNode.coneInnerAngle=t}get coneOuterAngle(){return this._nativePannerNode.coneOuterAngle}set coneOuterAngle(t){this._nativePannerNode.coneOuterAngle=t}get coneOuterGain(){return this._nativePannerNode.coneOuterGain}set coneOuterGain(t){this._nativePannerNode.coneOuterGain=t}get distanceModel(){return this._nativePannerNode.distanceModel}set distanceModel(t){this._nativePannerNode.distanceModel=t}get maxDistance(){return this._nativePannerNode.maxDistance}set maxDistance(t){this._nativePannerNode.maxDistance=t}get orientationX(){return this._orientationX}get orientationY(){return this._orientationY}get orientationZ(){return this._orientationZ}get panningModel(){return this._nativePannerNode.panningModel}set panningModel(t){this._nativePannerNode.panningModel=t}get positionX(){return this._positionX}get positionY(){return this._positionY}get positionZ(){return this._positionZ}get refDistance(){return this._nativePannerNode.refDistance}set refDistance(t){this._nativePannerNode.refDistance=t}get rolloffFactor(){return this._nativePannerNode.rolloffFactor}set rolloffFactor(t){this._nativePannerNode.rolloffFactor=t}})(Ol,ec,eu,iu,vl,yl,oc),ru=(t=>(e,{disableNormalization:n,imag:i,real:s})=>{const r=i instanceof Float32Array?i:new Float32Array(i),o=s instanceof Float32Array?s:new Float32Array(s),a=e.createPeriodicWave(o,r,{disableNormalization:n});if(Array.from(i).length<2)throw t();return a})(vo),ou=((t,e,n,i)=>class s{constructor(s,r){const o=e(s),a=i({...Fa,...r}),l=t(o,a);return n.add(l),l}static[Symbol.hasInstance](t){return null!==t&&"object"==typeof t&&Object.getPrototypeOf(t)===s.prototype||n.has(t)}})(ru,vl,new WeakSet,(t=>{const{imag:e,real:n}=t;return void 0===e?void 0===n?{...t,imag:[0,0],real:[0,0]}:{...t,imag:Array.from(n,(()=>0)),real:n}:void 0===n?{...t,imag:e,real:Array.from(e,(()=>0))}:{...t,imag:e,real:n}})),au=((t,e,n,i,s,r)=>{const o=16385,a=new Float32Array([1,1]),l=Math.PI/2,c={channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete"},u={...c,oversample:"none"},h=(t,r,h,p,d)=>{if(1===r)return((t,e,s,r)=>{const h=new Float32Array(o),p=new Float32Array(o);for(let n=0;n<o;n+=1){const t=n/16384*l;h[n]=Math.cos(t),p[n]=Math.sin(t)}const d=n(t,{...c,gain:0}),f=i(t,{...u,curve:h}),m=i(t,{...u,curve:a}),v=n(t,{...c,gain:0}),_=i(t,{...u,curve:p});return{connectGraph(){e.connect(d),e.connect(void 0===m.inputs?m:m.inputs[0]),e.connect(v),m.connect(s),s.connect(void 0===f.inputs?f:f.inputs[0]),s.connect(void 0===_.inputs?_:_.inputs[0]),f.connect(d.gain),_.connect(v.gain),d.connect(r,0,0),v.connect(r,0,1)},disconnectGraph(){e.disconnect(d),e.disconnect(void 0===m.inputs?m:m.inputs[0]),e.disconnect(v),m.disconnect(s),s.disconnect(void 0===f.inputs?f:f.inputs[0]),s.disconnect(void 0===_.inputs?_:_.inputs[0]),f.disconnect(d.gain),_.disconnect(v.gain),d.disconnect(r,0,0),v.disconnect(r,0,1)}}})(t,h,p,d);if(2===r)return((t,s,r,h)=>{const p=new Float32Array(o),d=new Float32Array(o),f=new Float32Array(o),m=new Float32Array(o),v=Math.floor(8192.5);for(let e=0;e<o;e+=1)if(e>v){const t=(e-v)/(16384-v)*l;p[e]=Math.cos(t),d[e]=Math.sin(t),f[e]=0,m[e]=1}else{const t=e/(16384-v)*l;p[e]=1,d[e]=0,f[e]=Math.cos(t),m[e]=Math.sin(t)}const _=e(t,{channelCount:2,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:2}),g=n(t,{...c,gain:0}),b=i(t,{...u,curve:p}),y=n(t,{...c,gain:0}),w=i(t,{...u,curve:d}),x=i(t,{...u,curve:a}),C=n(t,{...c,gain:0}),T=i(t,{...u,curve:f}),A=n(t,{...c,gain:0}),S=i(t,{...u,curve:m});return{connectGraph(){s.connect(_),s.connect(void 0===x.inputs?x:x.inputs[0]),_.connect(g,0),_.connect(y,0),_.connect(C,1),_.connect(A,1),x.connect(r),r.connect(void 0===b.inputs?b:b.inputs[0]),r.connect(void 0===w.inputs?w:w.inputs[0]),r.connect(void 0===T.inputs?T:T.inputs[0]),r.connect(void 0===S.inputs?S:S.inputs[0]),b.connect(g.gain),w.connect(y.gain),T.connect(C.gain),S.connect(A.gain),g.connect(h,0,0),C.connect(h,0,0),y.connect(h,0,1),A.connect(h,0,1)},disconnectGraph(){s.disconnect(_),s.disconnect(void 0===x.inputs?x:x.inputs[0]),_.disconnect(g,0),_.disconnect(y,0),_.disconnect(C,1),_.disconnect(A,1),x.disconnect(r),r.disconnect(void 0===b.inputs?b:b.inputs[0]),r.disconnect(void 0===w.inputs?w:w.inputs[0]),r.disconnect(void 0===T.inputs?T:T.inputs[0]),r.disconnect(void 0===S.inputs?S:S.inputs[0]),b.disconnect(g.gain),w.disconnect(y.gain),T.disconnect(C.gain),S.disconnect(A.gain),g.disconnect(h,0,0),C.disconnect(h,0,0),y.disconnect(h,0,1),A.disconnect(h,0,1)}}})(t,h,p,d);throw s()};return(e,{channelCount:i,channelCountMode:o,pan:a,...l})=>{if("max"===o)throw s();const c=t(e,{...l,channelCount:1,channelCountMode:o,numberOfInputs:2}),u=n(e,{...l,channelCount:i,channelCountMode:o,gain:1}),p=n(e,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:a});let{connectGraph:d,disconnectGraph:f}=h(e,i,u,p,c);Object.defineProperty(p.gain,"defaultValue",{get:()=>0}),Object.defineProperty(p.gain,"maxValue",{get:()=>1}),Object.defineProperty(p.gain,"minValue",{get:()=>-1});const m={get bufferSize(){},get channelCount(){return u.channelCount},set channelCount(t){u.channelCount!==t&&(v&&f(),({connectGraph:d,disconnectGraph:f}=h(e,t,u,p,c)),v&&d()),u.channelCount=t},get channelCountMode(){return u.channelCountMode},set channelCountMode(t){if("clamped-max"===t||"max"===t)throw s();u.channelCountMode=t},get channelInterpretation(){return u.channelInterpretation},set channelInterpretation(t){u.channelInterpretation=t},get context(){return u.context},get inputs(){return[u]},get numberOfInputs(){return u.numberOfInputs},get numberOfOutputs(){return u.numberOfOutputs},get pan(){return p.gain},addEventListener:(...t)=>u.addEventListener(t[0],t[1],t[2]),dispatchEvent:(...t)=>u.dispatchEvent(t[0]),removeEventListener:(...t)=>u.removeEventListener(t[0],t[1],t[2])};let v=!1;return r(Sa(m,c),(()=>{d(),v=!0}),(()=>{f(),v=!1}))}})(bc,Aa,Ea,Jc,Da,vc),lu=((t,e)=>(n,i)=>{const s=i.channelCountMode;if("clamped-max"===s)throw e();if(void 0===n.createStereoPanner)return t(n,i);const r=n.createStereoPanner();return _a(r,i),ba(r,i,"pan"),Object.defineProperty(r,"channelCountMode",{get:()=>s,set:t=>{if(t!==s)throw e()}}),r})(au,Da),cu=((t,e,n,i,s)=>()=>{const r=new WeakMap;return{render(o,a){const l=r.get(a);return void 0!==l?Promise.resolve(l):(async(o,a)=>{let l=n(o);const c=fo(l,a);if(!c){const t={channelCount:l.channelCount,channelCountMode:l.channelCountMode,channelInterpretation:l.channelInterpretation,pan:l.pan.value};l=e(a,t)}return r.set(a,l),c?await t(a,o.pan,l.pan):await i(a,o.pan,l.pan),Do(l)?await s(o,a,l.inputs[0]):await s(o,a,l),l})(o,a)}}})(Xl,lu,No,Jl,hl),uu=((t,e,n,i,s,r)=>class extends t{constructor(t,o){const a=s(t),l={...La,...o},c=n(a,l),u=r(a);super(t,!1,c,u?i():null),this._pan=e(this,u,c.pan)}get pan(){return this._pan}})(Ol,ec,lu,cu,vl,yl),hu=((t,e,n)=>()=>{const i=new WeakMap;return{render(s,r){const o=i.get(r);return void 0!==o?Promise.resolve(o):(async(s,r)=>{let o=e(s);if(!fo(o,r)){const e={channelCount:o.channelCount,channelCountMode:o.channelCountMode,channelInterpretation:o.channelInterpretation,curve:o.curve,oversample:o.oversample};o=t(r,e)}return i.set(r,o),Do(o)?await n(s,r,o.inputs[0]):await n(s,r,o),o})(s,r)}}})(Jc,No,hl),pu=((t,e,n,i,s,r,o)=>class extends t{constructor(t,e){const a=s(t),l={...Na,...e},c=n(a,l);super(t,!0,c,r(a)?i():null),this._isCurveNullified=!1,this._nativeWaveShaperNode=c,o(this,1)}get curve(){return this._isCurveNullified?null:this._nativeWaveShaperNode.curve}set curve(t){if(null===t)this._isCurveNullified=!0,this._nativeWaveShaperNode.curve=new Float32Array([0,0]);else{if(t.length<2)throw e();this._isCurveNullified=!1,this._nativeWaveShaperNode.curve=t}}get oversample(){return this._nativeWaveShaperNode.oversample}set oversample(t){this._nativeWaveShaperNode.oversample=t}})(Ol,ua,Jc,hu,vl,yl,oc),du=(t=>null!==t&&t.isSecureContext)(rl),fu=(t=>(e,n,i)=>{Object.defineProperties(t,{currentFrame:{configurable:!0,get:()=>Math.round(e*n)},currentTime:{configurable:!0,get:()=>e}});try{return i()}finally{null!==t&&(delete t.currentFrame,delete t.currentTime)}})(rl),mu=new WeakMap,vu=((t,e)=>n=>{let i=t.get(n);if(void 0!==i)return i;if(null===e)throw new Error("Missing the native OfflineAudioContext constructor.");return i=new e(1,1,44100),t.set(n,i),i})(mu,gl),_u=du?((t,e,n,i,s,r,o,a,l,c,u,h,p)=>{let d=0;return(f,m,v={credentials:"omit"})=>{const _=u.get(f);if(void 0!==_&&_.has(m))return Promise.resolve();const g=c.get(f);if(void 0!==g){const t=g.get(m);if(void 0!==t)return t}const b=r(f),y=void 0===b.audioWorklet?s(m).then((([t,e])=>{const[i,s]=eo(t,e);return n(`${i};((a,b)=>{(a[b]=a[b]||[]).push((AudioWorkletProcessor,global,registerProcessor,sampleRate,self,window)=>{${s}\n})})(window,'_AWGS')`)})).then((()=>{const t=p._AWGS.pop();if(void 0===t)throw new SyntaxError;i(b.currentTime,b.sampleRate,(()=>t(class{},void 0,((t,n)=>{if(""===t.trim())throw e();const i=Zr.get(b);if(void 0!==i){if(i.has(t))throw e();io(n),no(n.parameterDescriptors),i.set(t,n)}else io(n),no(n.parameterDescriptors),Zr.set(b,new Map([[t,n]]))}),b.sampleRate,void 0,void 0)))})):Promise.all([s(m),Promise.resolve(t(h,h))]).then((([[t,e],n])=>{const i=d+1;d=i;const[s,r]=eo(t,e),c=new Blob([`${s};((AudioWorkletProcessor,registerProcessor)=>{${r}\n})(${n?"AudioWorkletProcessor":"class extends AudioWorkletProcessor {__b=new WeakSet();constructor(){super();(p=>p.postMessage=(q=>(m,t)=>q.call(p,m,t?t.filter(u=>!this.__b.has(u)):t))(p.postMessage))(this.port)}}"},(n,p)=>registerProcessor(n,class extends p{${n?"":"__c = (a) => a.forEach(e=>this.__b.add(e.buffer));"}process(i,o,p){${n?"":"i.forEach(this.__c);o.forEach(this.__c);this.__c(Object.values(p));"}return super.process(i.map(j=>j.some(k=>k.length===0)?[]:j),o,p)}}));registerProcessor('__sac${i}',class extends AudioWorkletProcessor{process(){return !1}})`],{type:"application/javascript; charset=utf-8"}),u=URL.createObjectURL(c);return b.audioWorklet.addModule(u,v).then((()=>{if(a(b))return b;const t=o(b);return t.audioWorklet.addModule(u,v).then((()=>t))})).then((t=>{if(null===l)throw new SyntaxError;try{new l(t,`__sac${i}`)}catch{throw new SyntaxError}})).finally((()=>URL.revokeObjectURL(u)))}));return void 0===g?c.set(f,new Map([[m,y]])):g.set(m,y),y.then((()=>{const t=u.get(f);void 0===t?u.set(f,new Set([m])):t.add(m)})).finally((()=>{const t=c.get(f);void 0!==t&&t.delete(m)})),y}})(nl,Da,(t=>e=>new Promise(((n,i)=>{if(null===t)return void i(new SyntaxError);const s=t.document.head;if(null===s)i(new SyntaxError);else{const r=t.document.createElement("script"),o=new Blob([e],{type:"application/javascript"}),a=URL.createObjectURL(o),l=t.onerror,c=()=>{t.onerror=l,URL.revokeObjectURL(a)};t.onerror=(e,n,s,r,o)=>n===a||n===t.location.href&&1===s&&1===r?(c(),i(o),!1):null!==l?l(e,n,s,r,o):void 0,r.onerror=()=>{c(),i(new SyntaxError)},r.onload=()=>{c(),n()},r.src=a,r.type="module",s.appendChild(r)}})))(rl),fu,(gu=()=>new DOMException("","AbortError"),async t=>{try{const e=await fetch(t);if(e.ok)return[await e.text(),e.url]}catch{}throw gu()}),vl,vu,yl,Ml,new WeakMap,new WeakMap,((t,e)=>async()=>{if(null===t)return!0;if(null===e)return!1;const n=new Blob(['class A extends AudioWorkletProcessor{process(i){this.port.postMessage(i,[i[0][0].buffer])}}registerProcessor("a",A)'],{type:"application/javascript; charset=utf-8"}),i=new e(1,128,44100),s=URL.createObjectURL(n);let r=!1,o=!1;try{await i.audioWorklet.addModule(s);const e=new t(i,"a",{numberOfOutputs:0}),n=i.createOscillator();e.port.onmessage=()=>r=!0,e.onprocessorerror=()=>o=!0,n.connect(e),n.start(0),await i.startRendering()}catch{}finally{URL.revokeObjectURL(s)}return r&&!o})(Ml,gl),rl):void 0;var gu;const bu=((t,e)=>n=>t(n)||e(n))(Sl,yl),yu=((t,e,n,i,s,r,o,a,l,c,u)=>(h,p)=>{const d=o(h)?h:r(h);if(s.has(p)){const t=n();return Promise.reject(t)}try{s.add(p)}catch{}return e(l,(()=>l(d)))?d.decodeAudioData(p).then((n=>(ra(p).catch((()=>{})),e(a,(()=>a(n)))||u(n),t.add(n),n))):new Promise(((e,n)=>{const s=async()=>{try{await ra(p)}catch{}},r=t=>{n(t),s()};try{d.decodeAudioData(p,(n=>{"function"!=typeof n.copyFromChannel&&(c(n),_o(n)),t.add(n),s().then((()=>e(n)))}),(t=>{r(null===t?i():t)}))}catch(o){r(o)}}))})(Vl,nl,(()=>new DOMException("","DataCloneError")),(()=>new DOMException("","EncodingError")),new WeakSet,vl,bu,mo,ma,Nl,Bl),wu=(xu=_u,Cu=Il,Tu=jl,Au=ic,Su=ac,ku=wc,Eu=Cc,Pu=kc,Mu=Mc,Ou=yu,Du=Dc,Iu=Fc,Vu=Nc,Ru=qc,Fu=Gc,Lu=Xc,Nu=su,Bu=ou,zu=uu,ju=pu,class extends Fu{constructor(t,e){super(t,e),this._nativeContext=t,this._audioWorklet=void 0===xu?void 0:{addModule:(t,e)=>xu(this,t,e)}}get audioWorklet(){return this._audioWorklet}createAnalyser(){return new Cu(this)}createBiquadFilter(){return new Su(this)}createBuffer(t,e,n){return new Tu({length:e,numberOfChannels:t,sampleRate:n})}createBufferSource(){return new Au(this)}createChannelMerger(t=6){return new ku(this,{numberOfInputs:t})}createChannelSplitter(t=6){return new Eu(this,{numberOfOutputs:t})}createConstantSource(){return new Pu(this)}createConvolver(){return new Mu(this)}createDelay(t=1){return new Du(this,{maxDelayTime:t})}createDynamicsCompressor(){return new Iu(this)}createGain(){return new Vu(this)}createIIRFilter(t,e){return new Ru(this,{feedback:e,feedforward:t})}createOscillator(){return new Lu(this)}createPanner(){return new Nu(this)}createPeriodicWave(t,e,n={disableNormalization:!1}){return new Bu(this,{...n,imag:e,real:t})}createStereoPanner(){return new zu(this)}createWaveShaper(){return new ju(this)}decodeAudioData(t,e,n){return Ou(this._nativeContext,t).then((t=>("function"==typeof e&&e(t),t)),(t=>{throw"function"==typeof n&&n(t),t}))}});var xu,Cu,Tu,Au,Su,ku,Eu,Pu,Mu,Ou,Du,Iu,Vu,Ru,Fu,Lu,Nu,Bu,zu,ju;const Uu=((t,e,n,i)=>class extends t{constructor(t,s){const r=n(t),o=e(r,s);if(i(r))throw TypeError();super(t,!0,o,null),this._nativeMediaElementAudioSourceNode=o}get mediaElement(){return this._nativeMediaElementAudioSourceNode.mediaElement}})(Ol,((t,e)=>t.createMediaElementSource(e.mediaElement)),vl,yl),qu=((t,e,n,i)=>class extends t{constructor(t,s){const r=n(t);if(i(r))throw new TypeError;const o={...fa,...s},a=e(r,o);super(t,!1,a,null),this._nativeMediaStreamAudioDestinationNode=a}get stream(){return this._nativeMediaStreamAudioDestinationNode.stream}})(Ol,((t,e)=>{const n=t.createMediaStreamDestination();return _a(n,e),1===n.numberOfOutputs&&Object.defineProperty(n,"numberOfOutputs",{get:()=>0}),n}),vl,yl),Wu=((t,e,n,i)=>class extends t{constructor(t,s){const r=n(t),o=e(r,s);if(i(r))throw new TypeError;super(t,!0,o,null),this._nativeMediaStreamAudioSourceNode=o}get mediaStream(){return this._nativeMediaStreamAudioSourceNode.mediaStream}})(Ol,((t,{mediaStream:e})=>{const n=e.getAudioTracks();n.sort(((t,e)=>t.id<e.id?-1:t.id>e.id?1:0));const i=n.slice(0,1),s=t.createMediaStreamSource(new MediaStream(i));return Object.defineProperty(s,"mediaStream",{value:e}),s}),vl,yl),Hu=((t,e)=>(n,{mediaStreamTrack:i})=>{if("function"==typeof n.createMediaStreamTrackSource)return n.createMediaStreamTrackSource(i);const s=new MediaStream([i]),r=n.createMediaStreamSource(s);if("audio"!==i.kind)throw t();if(e(n))throw new TypeError;return r})(ua,yl),Gu=((t,e,n)=>class extends t{constructor(t,i){const s=n(t);super(t,!0,e(s,i),null)}})(Ol,Hu,vl),Ku=((t,e,n,i,s,r,o,a,l)=>class extends t{constructor(t={}){if(null===l)throw new Error("Missing the native AudioContext constructor.");let e;try{e=new l(t)}catch(o){if(12===o.code&&"sampleRate is not in range"===o.message)throw n();throw o}if(null===e)throw i();if(!(t=>void 0===t||"number"==typeof t||"string"==typeof t&&("balanced"===t||"interactive"===t||"playback"===t))(t.latencyHint))throw new TypeError(`The provided value '${t.latencyHint}' is not a valid enum value of type AudioContextLatencyCategory.`);if(void 0!==t.sampleRate&&e.sampleRate!==t.sampleRate)throw n();super(e,2);const{latencyHint:s}=t,{sampleRate:r}=e;if(this._baseLatency="number"==typeof e.baseLatency?e.baseLatency:"balanced"===s?512/r:"interactive"===s||void 0===s?256/r:"playback"===s?1024/r:128*Math.max(2,Math.min(128,Math.round(s*r/128)))/r,this._nativeAudioContext=e,"webkitAudioContext"===l.name?(this._nativeGainNode=e.createGain(),this._nativeOscillatorNode=e.createOscillator(),this._nativeGainNode.gain.value=1e-37,this._nativeOscillatorNode.connect(this._nativeGainNode).connect(e.destination),this._nativeOscillatorNode.start()):(this._nativeGainNode=null,this._nativeOscillatorNode=null),this._state=null,"running"===e.state){this._state="suspended";const t=()=>{"suspended"===this._state&&(this._state=null),e.removeEventListener("statechange",t)};e.addEventListener("statechange",t)}}get baseLatency(){return this._baseLatency}get state(){return null!==this._state?this._state:this._nativeAudioContext.state}close(){return"closed"===this.state?this._nativeAudioContext.close().then((()=>{throw e()})):("suspended"===this._state&&(this._state=null),this._nativeAudioContext.close().then((()=>{null!==this._nativeGainNode&&null!==this._nativeOscillatorNode&&(this._nativeOscillatorNode.stop(),this._nativeGainNode.disconnect(),this._nativeOscillatorNode.disconnect()),So(this)})))}createMediaElementSource(t){return new s(this,{mediaElement:t})}createMediaStreamDestination(){return new r(this)}createMediaStreamSource(t){return new o(this,{mediaStream:t})}createMediaStreamTrackSource(t){return new a(this,{mediaStreamTrack:t})}resume(){return"suspended"===this._state?new Promise(((t,e)=>{const n=()=>{this._nativeAudioContext.removeEventListener("statechange",n),"running"===this._nativeAudioContext.state?t():this.resume().then(t,e)};this._nativeAudioContext.addEventListener("statechange",n)})):this._nativeAudioContext.resume().catch((t=>{if(void 0===t||15===t.code)throw e();throw t}))}suspend(){return this._nativeAudioContext.suspend().catch((t=>{if(void 0===t)throw e();throw t}))}})(wu,ua,Da,(()=>new DOMException("","UnknownError")),Uu,qu,Wu,Gu,Al),Yu=(Xu=Hc,t=>{const e=Xu.get(t);if(void 0===e)throw new Error("The context has no set of AudioWorkletNodes.");return e});var Xu;const $u=(Zu=Yu,(t,e)=>{Zu(t).add(e)});var Zu;const Qu=(t=>(e,n,i=0,s=0)=>{const r=e[i];if(void 0===r)throw t();return Wo(n)?r.connect(n,0,s):r.connect(n,0)})(vo),Ju=(t=>(e,n)=>{t(e).delete(n)})(Yu),th=(t=>(e,n,i,s=0)=>void 0===n?e.forEach((t=>t.disconnect())):"number"==typeof n?aa(t,e,n).disconnect():Wo(n)?void 0===i?e.forEach((t=>t.disconnect(n))):void 0===s?aa(t,e,i).disconnect(n,0):aa(t,e,i).disconnect(n,0,s):void 0===i?e.forEach((t=>t.disconnect(n))):aa(t,e,i).disconnect(n,0))(vo),eh=new WeakMap,nh=(ih=eh,sh=so,t=>sh(ih,t));var ih,sh;const rh=((t,e,n,i,s,r,o,a,l,c,u,h,p)=>(d,f,m,v)=>{if(0===v.numberOfInputs&&0===v.numberOfOutputs)throw l();const _=Array.isArray(v.outputChannelCount)?v.outputChannelCount:Array.from(v.outputChannelCount);if(_.some((t=>t<1)))throw l();if(_.length!==v.numberOfOutputs)throw e();if("explicit"!==v.channelCountMode)throw l();const g=v.channelCount*v.numberOfInputs,b=_.reduce(((t,e)=>t+e),0),y=void 0===m.parameterDescriptors?0:m.parameterDescriptors.length;if(g+y>6||b>6)throw l();const w=new MessageChannel,x=[],C=[];for(let t=0;t<v.numberOfInputs;t+=1)x.push(o(d,{channelCount:v.channelCount,channelCountMode:v.channelCountMode,channelInterpretation:v.channelInterpretation,gain:1})),C.push(s(d,{channelCount:v.channelCount,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:v.channelCount}));const T=[];if(void 0!==m.parameterDescriptors)for(const{defaultValue:t,maxValue:e,minValue:n,name:i}of m.parameterDescriptors){const s=r(d,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:void 0!==v.parameterData[i]?v.parameterData[i]:void 0===t?0:t});Object.defineProperties(s.offset,{defaultValue:{get:()=>void 0===t?0:t},maxValue:{get:()=>void 0===e?yo:e},minValue:{get:()=>void 0===n?bo:n}}),T.push(s)}const A=i(d,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:Math.max(1,g+y)}),S=xa(f,d.sampleRate),k=a(d,S,g+y,Math.max(1,b)),E=s(d,{channelCount:Math.max(1,b),channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:Math.max(1,b)}),P=[];for(let t=0;t<v.numberOfOutputs;t+=1)P.push(i(d,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:_[t]}));for(let t=0;t<v.numberOfInputs;t+=1){x[t].connect(C[t]);for(let e=0;e<v.channelCount;e+=1)C[t].connect(A,e,t*v.channelCount+e)}const M=new Yo(void 0===m.parameterDescriptors?[]:m.parameterDescriptors.map((({name:t},e)=>{const n=T[e];return n.connect(A,0,g+e),n.start(0),[t,n.offset]})));A.connect(k);let O=v.channelInterpretation,D=null;const I=0===v.numberOfOutputs?[k]:P,V={get bufferSize(){return S},get channelCount(){return v.channelCount},set channelCount(t){throw n()},get channelCountMode(){return v.channelCountMode},set channelCountMode(t){throw n()},get channelInterpretation(){return O},set channelInterpretation(t){for(const e of x)e.channelInterpretation=t;O=t},get context(){return k.context},get inputs(){return x},get numberOfInputs(){return v.numberOfInputs},get numberOfOutputs(){return v.numberOfOutputs},get onprocessorerror(){return D},set onprocessorerror(t){"function"==typeof D&&V.removeEventListener("processorerror",D),D="function"==typeof t?t:null,"function"==typeof D&&V.addEventListener("processorerror",D)},get parameters(){return M},get port(){return w.port2},addEventListener:(...t)=>k.addEventListener(t[0],t[1],t[2]),connect:t.bind(null,I),disconnect:c.bind(null,I),dispatchEvent:(...t)=>k.dispatchEvent(t[0]),removeEventListener:(...t)=>k.removeEventListener(t[0],t[1],t[2])},R=new Map;var F,L;w.port1.addEventListener=(F=w.port1.addEventListener,(...t)=>{if("message"===t[0]){const e="function"==typeof t[1]?t[1]:"object"==typeof t[1]&&null!==t[1]&&"function"==typeof t[1].handleEvent?t[1].handleEvent:null;if(null!==e){const n=R.get(t[1]);void 0!==n?t[1]=n:(t[1]=t=>{u(d.currentTime,d.sampleRate,(()=>e(t)))},R.set(e,t[1]))}}return F.call(w.port1,t[0],t[1],t[2])}),w.port1.removeEventListener=(L=w.port1.removeEventListener,(...t)=>{if("message"===t[0]){const e=R.get(t[1]);void 0!==e&&(R.delete(t[1]),t[1]=e)}return L.call(w.port1,t[0],t[1],t[2])});let N=null;Object.defineProperty(w.port1,"onmessage",{get:()=>N,set:t=>{"function"==typeof N&&w.port1.removeEventListener("message",N),N="function"==typeof t?t:null,"function"==typeof N&&(w.port1.addEventListener("message",N),w.port1.start())}}),m.prototype.port=w.port1;let B=null;const z=((t,e,n,i)=>{let s=Qr.get(t);void 0===s&&(s=new WeakMap,Qr.set(t,s));const r=Ca(n,i);return s.set(e,r),r})(d,V,m,v);z.then((t=>B=t));const j=Qo(v.numberOfInputs,v.channelCount),U=Qo(v.numberOfOutputs,_),q=void 0===m.parameterDescriptors?[]:m.parameterDescriptors.reduce(((t,{name:e})=>({...t,[e]:new Float32Array(128)})),{});let W=!0;const H=()=>{v.numberOfOutputs>0&&k.disconnect(E);for(let t=0,e=0;t<v.numberOfOutputs;t+=1){const n=P[t];for(let i=0;i<_[t];i+=1)E.disconnect(n,e+i,i);e+=_[t]}},G=new Map;k.onaudioprocess=({inputBuffer:t,outputBuffer:e})=>{if(null!==B){const i=h(V);for(let s=0;s<S;s+=128){for(let e=0;e<v.numberOfInputs;e+=1)for(let n=0;n<v.channelCount;n+=1)$o(t,j[e],n,n,s);void 0!==m.parameterDescriptors&&m.parameterDescriptors.forEach((({name:e},n)=>{$o(t,q,e,g+n,s)}));for(let t=0;t<v.numberOfInputs;t+=1)for(let e=0;e<_[t];e+=1)0===U[t][e].byteLength&&(U[t][e]=new Float32Array(128));try{const t=j.map(((t,e)=>{if(i[e].size>0)return G.set(e,S/128),t;const n=G.get(e);return void 0===n?[]:(t.every((t=>t.every((t=>0===t))))&&(1===n?G.delete(e):G.set(e,n-1)),t)})),n=u(d.currentTime+s/d.sampleRate,d.sampleRate,(()=>B.process(t,U,q)));W=n;for(let i=0,r=0;i<v.numberOfOutputs;i+=1){for(let t=0;t<_[i];t+=1)Zo(e,U[i],t,r+t,s);r+=_[i]}}catch(n){W=!1,V.dispatchEvent(new ErrorEvent("processorerror",{colno:n.colno,filename:n.filename,lineno:n.lineno,message:n.message}))}if(!W){for(let t=0;t<v.numberOfInputs;t+=1){x[t].disconnect(C[t]);for(let e=0;e<v.channelCount;e+=1)C[s].disconnect(A,e,t*v.channelCount+e)}if(void 0!==m.parameterDescriptors){const t=m.parameterDescriptors.length;for(let e=0;e<t;e+=1){const t=T[e];t.disconnect(A,0,g+e),t.stop()}}A.disconnect(k),k.onaudioprocess=null,K?H():$();break}}}};let K=!1;const Y=o(d,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0}),X=()=>k.connect(Y).connect(d.destination),$=()=>{k.disconnect(Y),Y.disconnect()};return X(),p(V,(()=>{if(W){$(),v.numberOfOutputs>0&&k.connect(E);for(let t=0,e=0;t<v.numberOfOutputs;t+=1){const n=P[t];for(let i=0;i<_[t];i+=1)E.connect(n,e+i,i);e+=_[t]}}K=!0}),(()=>{W&&(X(),H()),K=!1}))})(Qu,vo,ua,bc,Aa,Ac,Ea,Oa,Da,th,fu,nh,vc),oh=((t,e,n,i,s)=>(r,o,a,l,c,u)=>{if(null!==a)try{const e=new a(r,l,u),i=new Map;let o=null;if(Object.defineProperties(e,{channelCount:{get:()=>u.channelCount,set:()=>{throw t()}},channelCountMode:{get:()=>"explicit",set:()=>{throw t()}},onprocessorerror:{get:()=>o,set:t=>{"function"==typeof o&&e.removeEventListener("processorerror",o),o="function"==typeof t?t:null,"function"==typeof o&&e.addEventListener("processorerror",o)}}}),e.addEventListener=(p=e.addEventListener,(...t)=>{if("processorerror"===t[0]){const e="function"==typeof t[1]?t[1]:"object"==typeof t[1]&&null!==t[1]&&"function"==typeof t[1].handleEvent?t[1].handleEvent:null;if(null!==e){const n=i.get(t[1]);void 0!==n?t[1]=n:(t[1]=n=>{"error"===n.type?(Object.defineProperties(n,{type:{value:"processorerror"}}),e(n)):e(new ErrorEvent(t[0],{...n}))},i.set(e,t[1]))}}return p.call(e,"error",t[1],t[2]),p.call(e,...t)}),e.removeEventListener=(h=e.removeEventListener,(...t)=>{if("processorerror"===t[0]){const e=i.get(t[1]);void 0!==e&&(i.delete(t[1]),t[1]=e)}return h.call(e,"error",t[1],t[2]),h.call(e,t[0],t[1],t[2])}),0!==u.numberOfOutputs){const t=n(r,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});e.connect(t).connect(r.destination);return s(e,(()=>t.disconnect()),(()=>t.connect(r.destination)))}return e}catch(d){if(11===d.code)throw i();throw d}var h,p;if(void 0===c)throw i();return(t=>{const{port1:e}=new MessageChannel;try{e.postMessage(t)}finally{e.close()}})(u),e(r,o,c,u)})(ua,rh,Ea,Da,vc),ah=((t,e,n,i,s,r,o,a,l,c,u,h,p,d,f,m)=>(v,_,g)=>{const b=new WeakMap;let y=null;return{render(w,x){a(x,w);const C=b.get(x);return void 0!==C?Promise.resolve(C):(async(a,w)=>{let x=u(a),C=null;const T=fo(x,w),A=Array.isArray(_.outputChannelCount)?_.outputChannelCount:Array.from(_.outputChannelCount);if(null===h){const t=A.reduce(((t,e)=>t+e),0),n=s(w,{channelCount:Math.max(1,t),channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:Math.max(1,t)}),r=[];for(let e=0;e<a.numberOfOutputs;e+=1)r.push(i(w,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:A[e]}));const c=o(w,{channelCount:_.channelCount,channelCountMode:_.channelCountMode,channelInterpretation:_.channelInterpretation,gain:1});c.connect=e.bind(null,r),c.disconnect=l.bind(null,r),C=[n,r,c]}else T||(x=new h(w,v));if(b.set(w,null===C?x:C[2]),null!==C){if(null===y){if(void 0===g)throw new Error("Missing the processor constructor.");if(null===p)throw new Error("Missing the native OfflineAudioContext constructor.");const t=a.channelCount*a.numberOfInputs,e=void 0===g.parameterDescriptors?0:g.parameterDescriptors.length,n=t+e,l=async()=>{const l=new p(n,128*Math.ceil(a.context.length/128),w.sampleRate),c=[],u=[];for(let t=0;t<_.numberOfInputs;t+=1)c.push(o(l,{channelCount:_.channelCount,channelCountMode:_.channelCountMode,channelInterpretation:_.channelInterpretation,gain:1})),u.push(s(l,{channelCount:_.channelCount,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:_.channelCount}));const h=await Promise.all(Array.from(a.parameters.values()).map((async t=>{const e=r(l,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:t.value});return await d(l,t,e.offset),e}))),v=i(l,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:Math.max(1,t+e)});for(let t=0;t<_.numberOfInputs;t+=1){c[t].connect(u[t]);for(let e=0;e<_.channelCount;e+=1)u[t].connect(v,e,t*_.channelCount+e)}for(const[e,n]of h.entries())n.connect(v,0,t+e),n.start(0);return v.connect(l.destination),await Promise.all(c.map((t=>f(a,l,t)))),m(l)};y=Jo(a,0===n?null:await l(),w,_,A,g,c)}const t=await y,e=n(w,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),[l,u,h]=C;null!==t&&(e.buffer=t,e.start(0)),e.connect(l);for(let n=0,i=0;n<a.numberOfOutputs;n+=1){const t=u[n];for(let e=0;e<A[n];e+=1)l.connect(t,i+e,e);i+=A[n]}return h}if(T)for(const[e,n]of a.parameters.entries())await t(w,n,x.parameters.get(e));else for(const[t,e]of a.parameters.entries())await d(w,e,x.parameters.get(t));return await f(a,w,x),x})(w,x)}}})(Xl,Qu,Zl,bc,Aa,Ac,Ea,Ju,th,fu,No,Ml,gl,Jl,hl,zc),lh=(ch=mu,t=>ch.get(t));var ch;const uh=(t=>(e,n)=>{t.set(e,n)})(eh),hh=du?((t,e,n,i,s,r,o,a,l,c,u,h,p,d)=>class extends e{constructor(e,d,f){var m;const v=a(e),_=l(v),g=u({...Xo,...f});p(g);const b=Zr.get(v),y=null==b?void 0:b.get(d),w=_||"closed"!==v.state?v:null!==(m=o(v))&&void 0!==m?m:v,x=s(w,_?null:e.baseLatency,c,d,y,g);super(e,!0,x,_?i(d,g,y):null);const C=[];x.parameters.forEach(((t,e)=>{const i=n(this,_,t);C.push([e,i])})),this._nativeAudioWorkletNode=x,this._onprocessorerror=null,this._parameters=new Yo(C),_&&t(v,this);const{activeInputs:T}=r(this);h(x,T)}get onprocessorerror(){return this._onprocessorerror}set onprocessorerror(t){const e="function"==typeof t?d(this,t):null;this._nativeAudioWorkletNode.onprocessorerror=e;const n=this._nativeAudioWorkletNode.onprocessorerror;this._onprocessorerror=null!==n&&n===e?t:n}get parameters(){return null===this._parameters?this._nativeAudioWorkletNode.parameters:this._parameters}get port(){return this._nativeAudioWorkletNode.port}})($u,Ol,ec,ah,oh,Co,lh,vl,yl,Ml,(t=>({...t,outputChannelCount:void 0!==t.outputChannelCount?t.outputChannelCount:1===t.numberOfInputs&&1===t.numberOfOutputs?[t.channelCount]:Array.from({length:t.numberOfOutputs},(()=>1))})),uh,(t=>{const{port1:e,port2:n}=new MessageChannel;try{e.postMessage(t)}finally{e.close(),n.close()}}),Ka):void 0,ph=((t,e)=>(n,i,s)=>{if(null===e)throw new Error("Missing the native OfflineAudioContext constructor.");try{return new e(n,i,s)}catch(r){if("SyntaxError"===r.name)throw t();throw r}})(Da,gl),dh=((t,e,n,i,s,r,o,a)=>(l,c)=>n(l).render(l,c).then((()=>Promise.all(Array.from(i(c)).map((t=>n(t).render(t,c)))))).then((()=>s(c))).then((n=>("function"!=typeof n.copyFromChannel?(o(n),_o(n)):e(r,(()=>r(n)))||a(n),t.add(n),n))))(Vl,nl,cl,Yu,zc,mo,Nl,Bl),fh=((t,e,n,i,s)=>class extends t{constructor(t,n,s){let r;if("number"==typeof t&&void 0!==n&&void 0!==s)r={length:n,numberOfChannels:t,sampleRate:s};else{if("object"!=typeof t)throw new Error("The given parameters are not valid.");r=t}const{length:o,numberOfChannels:a,sampleRate:l}={...Ia,...r},c=i(a,o,l);e(ma,(()=>ma(c)))||c.addEventListener("statechange",(()=>{let t=0;const e=n=>{"running"===this._state&&(t>0?(c.removeEventListener("statechange",e),n.stopImmediatePropagation(),this._waitForThePromiseToSettle(n)):t+=1)};return e})()),super(c,a),this._length=o,this._nativeOfflineAudioContext=c,this._state=null}get length(){return void 0===this._nativeOfflineAudioContext.length?this._length:this._nativeOfflineAudioContext.length}get state(){return null===this._state?this._nativeOfflineAudioContext.state:this._state}startRendering(){return"running"===this._state?Promise.reject(n()):(this._state="running",s(this.destination,this._nativeOfflineAudioContext).finally((()=>{this._state=null,So(this)})))}_waitForThePromiseToSettle(t){null===this._state?this._nativeOfflineAudioContext.dispatchEvent(t):setTimeout((()=>this._waitForThePromiseToSettle(t)))}})(wu,nl,ua,ph,dh),mh=((t,e)=>n=>{const i=t.get(n);return e(i)||e(n)})(Yr,Sl),vh=(_h=Hr,gh=El,t=>_h.has(t)||gh(t));var _h,gh;const bh=(yh=Kr,wh=Pl,t=>yh.has(t)||wh(t));var yh,wh;const xh=((t,e)=>n=>{const i=t.get(n);return e(i)||e(n)})(Yr,yl);function Ch(t,e){if(!t)throw new Error(e)}function Th(t,e,n=1/0){if(!(e<=t&&t<=n))throw new RangeError(`Value must be within [${e}, ${n}], got: ${t}`)}function Ah(t){t.isOffline||"running"===t.state||kh('The AudioContext is "suspended". Invoke Tone.start() from a user action to start the audio.')}let Sh=console;function kh(...t){Sh.warn(...t)}function Eh(t){return void 0===t}function Ph(t){return!Eh(t)}function Mh(t){return"number"==typeof t}function Oh(t){return"[object Object]"===Object.prototype.toString.call(t)&&t.constructor===Object}function Dh(t){return Array.isArray(t)}function Ih(t){return"string"==typeof t}function Vh(t){return Ih(t)&&/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i.test(t)}const Rh="object"==typeof self?self:null,Fh=Rh&&(Rh.hasOwnProperty("AudioContext")||Rh.hasOwnProperty("webkitAudioContext"));class Lh{constructor(t,e,n){this._callback=t,this._type=e,this._updateInterval=n,this._createClock()}_createWorker(){const t=new Blob([`\n\t\t\t// the initial timeout time\n\t\t\tlet timeoutTime =  ${(1e3*this._updateInterval).toFixed(1)};\n\t\t\t// onmessage callback\n\t\t\tself.onmessage = function(msg){\n\t\t\t\ttimeoutTime = parseInt(msg.data);\n\t\t\t};\n\t\t\t// the tick function which posts a message\n\t\t\t// and schedules a new tick\n\t\t\tfunction tick(){\n\t\t\t\tsetTimeout(tick, timeoutTime);\n\t\t\t\tself.postMessage('tick');\n\t\t\t}\n\t\t\t// call tick initially\n\t\t\ttick();\n\t\t\t`],{type:"text/javascript"}),e=URL.createObjectURL(t),n=new Worker(e);n.onmessage=this._callback.bind(this),this._worker=n}_createTimeout(){this._timeout=setTimeout((()=>{this._createTimeout(),this._callback()}),1e3*this._updateInterval)}_createClock(){if("worker"===this._type)try{this._createWorker()}catch(t){this._type="timeout",this._createClock()}else"timeout"===this._type&&this._createTimeout()}_disposeClock(){this._timeout&&(clearTimeout(this._timeout),this._timeout=0),this._worker&&(this._worker.terminate(),this._worker.onmessage=null)}get updateInterval(){return this._updateInterval}set updateInterval(t){this._updateInterval=Math.max(t,128/44100),"worker"===this._type&&this._worker.postMessage(Math.max(1e3*t,1))}get type(){return this._type}set type(t){this._disposeClock(),this._type=t,this._createClock()}dispose(){this._disposeClock()}}function Nh(t){return bh(t)}function Bh(t){return vh(t)}function zh(t){return xh(t)}function jh(t){return mh(t)}function Uh(t){return t instanceof AudioBuffer}function qh(t,e){return"value"===t||Nh(e)||Bh(e)||Uh(e)}function Wh(t,...e){if(!e.length)return t;const n=e.shift();if(Oh(t)&&Oh(n))for(const i in n)qh(i,n[i])?t[i]=n[i]:Oh(n[i])?(t[i]||Object.assign(t,{[i]:{}}),Wh(t[i],n[i])):Object.assign(t,{[i]:n[i]});return Wh(t,...e)}function Hh(t,e,n=[],i){const s={},r=Array.from(e);if(Oh(r[0])&&i&&!Reflect.has(r[0],i)){Object.keys(r[0]).some((e=>Reflect.has(t,e)))||(Wh(s,{[i]:r[0]}),n.splice(n.indexOf(i),1),r.shift())}if(1===r.length&&Oh(r[0]))Wh(s,r[0]);else for(let o=0;o<n.length;o++)Ph(r[o])&&(s[n[o]]=r[o]);return Wh(t,s)}function Gh(t,e){return Eh(t)?e:t}function Kh(t,e){return e.forEach((e=>{Reflect.has(t,e)&&delete t[e]})),t}
/**
 * Tone.js
 * @author Yotam Mann
 * @license http://opensource.org/licenses/MIT MIT License
 * @copyright 2014-2019 Yotam Mann
 */class Yh{constructor(){this.debug=!1,this._wasDisposed=!1}static getDefaults(){return{}}log(...t){(this.debug||Rh&&this.toString()===Rh.TONE_DEBUG_CLASS)&&function(...t){Sh.log(...t)}(this,...t)}dispose(){return this._wasDisposed=!0,this}get disposed(){return this._wasDisposed}toString(){return this.name}}Yh.version="14.7.77";function Xh(t,e){return t>e+1e-6}function $h(t,e){return Xh(t,e)||Qh(t,e)}function Zh(t,e){return t+1e-6<e}function Qh(t,e){return Math.abs(t-e)<1e-6}class Jh extends Yh{constructor(){super(),this.name="Timeline",this._timeline=[];const t=Hh(Jh.getDefaults(),arguments,["memory"]);this.memory=t.memory,this.increasing=t.increasing}static getDefaults(){return{memory:1/0,increasing:!1}}get length(){return this._timeline.length}add(t){if(Ch(Reflect.has(t,"time"),"Timeline: events must have a time attribute"),t.time=t.time.valueOf(),this.increasing&&this.length){const e=this._timeline[this.length-1];Ch($h(t.time,e.time),"The time must be greater than or equal to the last scheduled time"),this._timeline.push(t)}else{const e=this._search(t.time);this._timeline.splice(e+1,0,t)}if(this.length>this.memory){const t=this.length-this.memory;this._timeline.splice(0,t)}return this}remove(t){const e=this._timeline.indexOf(t);return-1!==e&&this._timeline.splice(e,1),this}get(t,e="time"){const n=this._search(t,e);return-1!==n?this._timeline[n]:null}peek(){return this._timeline[0]}shift(){return this._timeline.shift()}getAfter(t,e="time"){const n=this._search(t,e);return n+1<this._timeline.length?this._timeline[n+1]:null}getBefore(t){const e=this._timeline.length;if(e>0&&this._timeline[e-1].time<t)return this._timeline[e-1];const n=this._search(t);return n-1>=0?this._timeline[n-1]:null}cancel(t){if(this._timeline.length>1){let e=this._search(t);if(e>=0)if(Qh(this._timeline[e].time,t)){for(let n=e;n>=0&&Qh(this._timeline[n].time,t);n--)e=n;this._timeline=this._timeline.slice(0,e)}else this._timeline=this._timeline.slice(0,e+1);else this._timeline=[]}else 1===this._timeline.length&&$h(this._timeline[0].time,t)&&(this._timeline=[]);return this}cancelBefore(t){const e=this._search(t);return e>=0&&(this._timeline=this._timeline.slice(e+1)),this}previousEvent(t){const e=this._timeline.indexOf(t);return e>0?this._timeline[e-1]:null}_search(t,e="time"){if(0===this._timeline.length)return-1;let n=0;const i=this._timeline.length;let s=i;if(i>0&&this._timeline[i-1][e]<=t)return i-1;for(;n<s;){let i=Math.floor(n+(s-n)/2);const r=this._timeline[i],o=this._timeline[i+1];if(Qh(r[e],t)){for(let n=i;n<this._timeline.length;n++){if(!Qh(this._timeline[n][e],t))break;i=n}return i}if(Zh(r[e],t)&&Xh(o[e],t))return i;Xh(r[e],t)?s=i:n=i+1}return-1}_iterate(t,e=0,n=this._timeline.length-1){this._timeline.slice(e,n+1).forEach(t)}forEach(t){return this._iterate(t),this}forEachBefore(t,e){const n=this._search(t);return-1!==n&&this._iterate(e,0,n),this}forEachAfter(t,e){const n=this._search(t);return this._iterate(e,n+1),this}forEachBetween(t,e,n){let i=this._search(t),s=this._search(e);return-1!==i&&-1!==s?(this._timeline[i].time!==t&&(i+=1),this._timeline[s].time===e&&(s-=1),this._iterate(n,i,s)):-1===i&&this._iterate(n,0,s),this}forEachFrom(t,e){let n=this._search(t);for(;n>=0&&this._timeline[n].time>=t;)n--;return this._iterate(e,n+1),this}forEachAtTime(t,e){const n=this._search(t);if(-1!==n&&Qh(this._timeline[n].time,t)){let i=n;for(let e=n;e>=0&&Qh(this._timeline[e].time,t);e--)i=e;this._iterate((t=>{e(t)}),i,n)}return this}dispose(){return super.dispose(),this._timeline=[],this}}const tp=[];function ep(t){tp.push(t)}const np=[];function ip(t){np.push(t)}class sp extends Yh{constructor(){super(...arguments),this.name="Emitter"}on(t,e){return t.split(/\W+/).forEach((t=>{Eh(this._events)&&(this._events={}),this._events.hasOwnProperty(t)||(this._events[t]=[]),this._events[t].push(e)})),this}once(t,e){const n=(...i)=>{e(...i),this.off(t,n)};return this.on(t,n),this}off(t,e){return t.split(/\W+/).forEach((n=>{if(Eh(this._events)&&(this._events={}),this._events.hasOwnProperty(t))if(Eh(e))this._events[t]=[];else{const n=this._events[t];for(let t=n.length-1;t>=0;t--)n[t]===e&&n.splice(t,1)}})),this}emit(t,...e){if(this._events&&this._events.hasOwnProperty(t)){const n=this._events[t].slice(0);for(let t=0,i=n.length;t<i;t++)n[t].apply(this,e)}return this}static mixin(t){["on","once","off","emit"].forEach((e=>{const n=Object.getOwnPropertyDescriptor(sp.prototype,e);Object.defineProperty(t.prototype,e,n)}))}dispose(){return super.dispose(),this._events=void 0,this}}class rp extends sp{constructor(){super(...arguments),this.isOffline=!1}toJSON(){return{}}}class op extends rp{constructor(){super(),this.name="Context",this._constants=new Map,this._timeouts=new Jh,this._timeoutIds=0,this._initialized=!1,this.isOffline=!1,this._workletModules=new Map;const t=Hh(op.getDefaults(),arguments,["context"]);t.context?this._context=t.context:this._context=function(t){return new Ku(t)}({latencyHint:t.latencyHint}),this._ticker=new Lh(this.emit.bind(this,"tick"),t.clockSource,t.updateInterval),this.on("tick",this._timeoutLoop.bind(this)),this._context.onstatechange=()=>{this.emit("statechange",this.state)},this._setLatencyHint(t.latencyHint),this.lookAhead=t.lookAhead}static getDefaults(){return{clockSource:"worker",latencyHint:"interactive",lookAhead:.1,updateInterval:.05}}initialize(){var t;return this._initialized||(t=this,tp.forEach((e=>e(t))),this._initialized=!0),this}createAnalyser(){return this._context.createAnalyser()}createOscillator(){return this._context.createOscillator()}createBufferSource(){return this._context.createBufferSource()}createBiquadFilter(){return this._context.createBiquadFilter()}createBuffer(t,e,n){return this._context.createBuffer(t,e,n)}createChannelMerger(t){return this._context.createChannelMerger(t)}createChannelSplitter(t){return this._context.createChannelSplitter(t)}createConstantSource(){return this._context.createConstantSource()}createConvolver(){return this._context.createConvolver()}createDelay(t){return this._context.createDelay(t)}createDynamicsCompressor(){return this._context.createDynamicsCompressor()}createGain(){return this._context.createGain()}createIIRFilter(t,e){return this._context.createIIRFilter(t,e)}createPanner(){return this._context.createPanner()}createPeriodicWave(t,e,n){return this._context.createPeriodicWave(t,e,n)}createStereoPanner(){return this._context.createStereoPanner()}createWaveShaper(){return this._context.createWaveShaper()}createMediaStreamSource(t){Ch(jh(this._context),"Not available if OfflineAudioContext");return this._context.createMediaStreamSource(t)}createMediaElementSource(t){Ch(jh(this._context),"Not available if OfflineAudioContext");return this._context.createMediaElementSource(t)}createMediaStreamDestination(){Ch(jh(this._context),"Not available if OfflineAudioContext");return this._context.createMediaStreamDestination()}decodeAudioData(t){return this._context.decodeAudioData(t)}get currentTime(){return this._context.currentTime}get state(){return this._context.state}get sampleRate(){return this._context.sampleRate}get listener(){return this.initialize(),this._listener}set listener(t){Ch(!this._initialized,"The listener cannot be set after initialization."),this._listener=t}get transport(){return this.initialize(),this._transport}set transport(t){Ch(!this._initialized,"The transport cannot be set after initialization."),this._transport=t}get draw(){return this.initialize(),this._draw}set draw(t){Ch(!this._initialized,"Draw cannot be set after initialization."),this._draw=t}get destination(){return this.initialize(),this._destination}set destination(t){Ch(!this._initialized,"The destination cannot be set after initialization."),this._destination=t}createAudioWorkletNode(t,e){return function(t,e,n){return Ch(Ph(hh),"This node only works in a secure context (https or localhost)"),new hh(t,e,n)}(this.rawContext,t,e)}addAudioWorkletModule(t,e){return W(this,void 0,void 0,(function*(){Ch(Ph(this.rawContext.audioWorklet),"AudioWorkletNode is only available in a secure context (https or localhost)"),this._workletModules.has(e)||this._workletModules.set(e,this.rawContext.audioWorklet.addModule(t)),yield this._workletModules.get(e)}))}workletsAreReady(){return W(this,void 0,void 0,(function*(){const t=[];this._workletModules.forEach((e=>t.push(e))),yield Promise.all(t)}))}get updateInterval(){return this._ticker.updateInterval}set updateInterval(t){this._ticker.updateInterval=t}get clockSource(){return this._ticker.type}set clockSource(t){this._ticker.type=t}get latencyHint(){return this._latencyHint}_setLatencyHint(t){let e=0;if(this._latencyHint=t,Ih(t))switch(t){case"interactive":e=.1;break;case"playback":e=.5;break;case"balanced":e=.25}this.lookAhead=e,this.updateInterval=e/2}get rawContext(){return this._context}now(){return this._context.currentTime+this.lookAhead}immediate(){return this._context.currentTime}resume(){return jh(this._context)?this._context.resume():Promise.resolve()}close(){return W(this,void 0,void 0,(function*(){var t;jh(this._context)&&(yield this._context.close()),this._initialized&&(t=this,np.forEach((e=>e(t))))}))}getConstant(t){if(this._constants.has(t))return this._constants.get(t);{const e=this._context.createBuffer(1,128,this._context.sampleRate),n=e.getChannelData(0);for(let s=0;s<n.length;s++)n[s]=t;const i=this._context.createBufferSource();return i.channelCount=1,i.channelCountMode="explicit",i.buffer=e,i.loop=!0,i.start(0),this._constants.set(t,i),i}}dispose(){return super.dispose(),this._ticker.dispose(),this._timeouts.dispose(),Object.keys(this._constants).map((t=>this._constants[t].disconnect())),this}_timeoutLoop(){const t=this.now();let e=this._timeouts.peek();for(;this._timeouts.length&&e&&e.time<=t;)e.callback(),this._timeouts.shift(),e=this._timeouts.peek()}setTimeout(t,e){this._timeoutIds++;const n=this.now();return this._timeouts.add({callback:t,id:this._timeoutIds,time:n+e}),this._timeoutIds}clearTimeout(t){return this._timeouts.forEach((e=>{e.id===t&&this._timeouts.remove(e)})),this}clearInterval(t){return this.clearTimeout(t)}setInterval(t,e){const n=++this._timeoutIds,i=()=>{const s=this.now();this._timeouts.add({callback:()=>{t(),i()},id:n,time:s+e})};return i(),n}}function ap(t,e){Dh(e)?e.forEach((e=>ap(t,e))):Object.defineProperty(t,e,{enumerable:!0,writable:!1})}function lp(t,e){Dh(e)?e.forEach((e=>lp(t,e))):Object.defineProperty(t,e,{writable:!0})}const cp=()=>{};class up extends Yh{constructor(){super(),this.name="ToneAudioBuffer",this.onload=cp;const t=Hh(up.getDefaults(),arguments,["url","onload","onerror"]);this.reverse=t.reverse,this.onload=t.onload,t.url&&Uh(t.url)||t.url instanceof up?this.set(t.url):Ih(t.url)&&this.load(t.url).catch(t.onerror)}static getDefaults(){return{onerror:cp,onload:cp,reverse:!1}}get sampleRate(){return this._buffer?this._buffer.sampleRate:fp().sampleRate}set(t){return t instanceof up?t.loaded?this._buffer=t.get():t.onload=()=>{this.set(t),this.onload(this)}:this._buffer=t,this._reversed&&this._reverse(),this}get(){return this._buffer}load(t){return W(this,void 0,void 0,(function*(){const e=up.load(t).then((t=>{this.set(t),this.onload(this)}));up.downloads.push(e);try{yield e}finally{const t=up.downloads.indexOf(e);up.downloads.splice(t,1)}return this}))}dispose(){return super.dispose(),this._buffer=void 0,this}fromArray(t){const e=Dh(t)&&t[0].length>0,n=e?t.length:1,i=e?t[0].length:t.length,s=fp(),r=s.createBuffer(n,i,s.sampleRate),o=e||1!==n?t:[t];for(let a=0;a<n;a++)r.copyToChannel(o[a],a);return this._buffer=r,this}toMono(t){if(Mh(t))this.fromArray(this.toArray(t));else{let t=new Float32Array(this.length);const e=this.numberOfChannels;for(let n=0;n<e;n++){const e=this.toArray(n);for(let n=0;n<e.length;n++)t[n]+=e[n]}t=t.map((t=>t/e)),this.fromArray(t)}return this}toArray(t){if(Mh(t))return this.getChannelData(t);if(1===this.numberOfChannels)return this.toArray(0);{const t=[];for(let e=0;e<this.numberOfChannels;e++)t[e]=this.getChannelData(e);return t}}getChannelData(t){return this._buffer?this._buffer.getChannelData(t):new Float32Array(0)}slice(t,e=this.duration){const n=Math.floor(t*this.sampleRate),i=Math.floor(e*this.sampleRate);Ch(n<i,"The start time must be less than the end time");const s=i-n,r=fp().createBuffer(this.numberOfChannels,s,this.sampleRate);for(let o=0;o<this.numberOfChannels;o++)r.copyToChannel(this.getChannelData(o).subarray(n,i),o);return new up(r)}_reverse(){if(this.loaded)for(let t=0;t<this.numberOfChannels;t++)this.getChannelData(t).reverse();return this}get loaded(){return this.length>0}get duration(){return this._buffer?this._buffer.duration:0}get length(){return this._buffer?this._buffer.length:0}get numberOfChannels(){return this._buffer?this._buffer.numberOfChannels:0}get reverse(){return this._reversed}set reverse(t){this._reversed!==t&&(this._reversed=t,this._reverse())}static fromArray(t){return(new up).fromArray(t)}static fromUrl(t){return W(this,void 0,void 0,(function*(){const e=new up;return yield e.load(t)}))}static load(t){return W(this,void 0,void 0,(function*(){const e=t.match(/\[([^\]\[]+\|.+)\]$/);if(e){const n=e[1].split("|");let i=n[0];for(const t of n)if(up.supportsType(t)){i=t;break}t=t.replace(e[0],i)}const n=""===up.baseUrl||up.baseUrl.endsWith("/")?up.baseUrl:up.baseUrl+"/",i=yield fetch(n+t);if(!i.ok)throw new Error(`could not load url: ${t}`);const s=yield i.arrayBuffer();return yield fp().decodeAudioData(s)}))}static supportsType(t){const e=t.split("."),n=e[e.length-1];return""!==document.createElement("audio").canPlayType("audio/"+n)}static loaded(){return W(this,void 0,void 0,(function*(){for(yield Promise.resolve();up.downloads.length;)yield up.downloads[0]}))}}up.baseUrl="",up.downloads=[];class hp extends op{constructor(){var t,e,n;super({clockSource:"offline",context:zh(arguments[0])?arguments[0]:(t=arguments[0],e=arguments[1]*arguments[2],n=arguments[2],new fh(t,e,n)),lookAhead:0,updateInterval:zh(arguments[0])?128/arguments[0].sampleRate:128/arguments[2]}),this.name="OfflineContext",this._currentTime=0,this.isOffline=!0,this._duration=zh(arguments[0])?arguments[0].length/arguments[0].sampleRate:arguments[1]}now(){return this._currentTime}get currentTime(){return this._currentTime}_renderClock(t){return W(this,void 0,void 0,(function*(){let e=0;for(;this._duration-this._currentTime>=0;){this.emit("tick"),this._currentTime+=128/this.sampleRate,e++;const n=Math.floor(this.sampleRate/128);t&&e%n==0&&(yield new Promise((t=>setTimeout(t,1))))}}))}render(t=!0){return W(this,void 0,void 0,(function*(){yield this.workletsAreReady(),yield this._renderClock(t);const e=yield this._context.startRendering();return new up(e)}))}close(){return Promise.resolve()}}const pp=new class extends rp{constructor(){super(...arguments),this.lookAhead=0,this.latencyHint=0,this.isOffline=!1}createAnalyser(){return{}}createOscillator(){return{}}createBufferSource(){return{}}createBiquadFilter(){return{}}createBuffer(t,e,n){return{}}createChannelMerger(t){return{}}createChannelSplitter(t){return{}}createConstantSource(){return{}}createConvolver(){return{}}createDelay(t){return{}}createDynamicsCompressor(){return{}}createGain(){return{}}createIIRFilter(t,e){return{}}createPanner(){return{}}createPeriodicWave(t,e,n){return{}}createStereoPanner(){return{}}createWaveShaper(){return{}}createMediaStreamSource(t){return{}}createMediaElementSource(t){return{}}createMediaStreamDestination(){return{}}decodeAudioData(t){return Promise.resolve({})}createAudioWorkletNode(t,e){return{}}get rawContext(){return{}}addAudioWorkletModule(t,e){return W(this,void 0,void 0,(function*(){return Promise.resolve()}))}resume(){return Promise.resolve()}setTimeout(t,e){return 0}clearTimeout(t){return this}setInterval(t,e){return 0}clearInterval(t){return this}getConstant(t){return{}}get currentTime(){return 0}get state(){return{}}get sampleRate(){return 0}get listener(){return{}}get transport(){return{}}get draw(){return{}}set draw(t){}get destination(){return{}}set destination(t){}now(){return 0}immediate(){return 0}};let dp=pp;function fp(){return dp===pp&&Fh&&mp(new op),dp}function mp(t){dp=jh(t)?new op(t):zh(t)?new hp(t):t}if(Rh&&!Rh.TONE_SILENCE_LOGGING){const t=` * Tone.js ${"v"}14.7.77 * `;console.log(`%c${t}`,"background: #000; color: #fff")}function vp(t){return Math.pow(2,t/12)}let _p=440;function gp(t){return Math.round(bp(t))}function bp(t){return 69+12*Math.log2(t/_p)}class yp extends Yh{constructor(t,e,n){super(),this.defaultUnits="s",this._val=e,this._units=n,this.context=t,this._expressions=this._getExpressions()}_getExpressions(){return{hz:{method:t=>this._frequencyToUnits(parseFloat(t)),regexp:/^(\d+(?:\.\d+)?)hz$/i},i:{method:t=>this._ticksToUnits(parseInt(t,10)),regexp:/^(\d+)i$/i},m:{method:t=>this._beatsToUnits(parseInt(t,10)*this._getTimeSignature()),regexp:/^(\d+)m$/i},n:{method:(t,e)=>{const n=parseInt(t,10),i="."===e?1.5:1;return 1===n?this._beatsToUnits(this._getTimeSignature())*i:this._beatsToUnits(4/n)*i},regexp:/^(\d+)n(\.?)$/i},number:{method:t=>this._expressions[this.defaultUnits].method.call(this,t),regexp:/^(\d+(?:\.\d+)?)$/},s:{method:t=>this._secondsToUnits(parseFloat(t)),regexp:/^(\d+(?:\.\d+)?)s$/},samples:{method:t=>parseInt(t,10)/this.context.sampleRate,regexp:/^(\d+)samples$/},t:{method:t=>{const e=parseInt(t,10);return this._beatsToUnits(8/(3*Math.floor(e)))},regexp:/^(\d+)t$/i},tr:{method:(t,e,n)=>{let i=0;return t&&"0"!==t&&(i+=this._beatsToUnits(this._getTimeSignature()*parseFloat(t))),e&&"0"!==e&&(i+=this._beatsToUnits(parseFloat(e))),n&&"0"!==n&&(i+=this._beatsToUnits(parseFloat(n)/4)),i},regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?$/}}}valueOf(){if(this._val instanceof yp&&this.fromType(this._val),Eh(this._val))return this._noArg();if(Ih(this._val)&&Eh(this._units)){for(const t in this._expressions)if(this._expressions[t].regexp.test(this._val.trim())){this._units=t;break}}else if(Oh(this._val)){let t=0;for(const e in this._val)if(Ph(this._val[e])){const n=this._val[e];t+=new this.constructor(this.context,e).valueOf()*n}return t}if(Ph(this._units)){const t=this._expressions[this._units],e=this._val.toString().trim().match(t.regexp);return e?t.method.apply(this,e.slice(1)):t.method.call(this,this._val)}return Ih(this._val)?parseFloat(this._val):this._val}_frequencyToUnits(t){return 1/t}_beatsToUnits(t){return 60/this._getBpm()*t}_secondsToUnits(t){return t}_ticksToUnits(t){return t*this._beatsToUnits(1)/this._getPPQ()}_noArg(){return this._now()}_getBpm(){return this.context.transport.bpm.value}_getTimeSignature(){return this.context.transport.timeSignature}_getPPQ(){return this.context.transport.PPQ}fromType(t){switch(this._units=void 0,this.defaultUnits){case"s":this._val=t.toSeconds();break;case"i":this._val=t.toTicks();break;case"hz":this._val=t.toFrequency();break;case"midi":this._val=t.toMidi()}return this}toFrequency(){return 1/this.toSeconds()}toSamples(){return this.toSeconds()*this.context.sampleRate}toMilliseconds(){return 1e3*this.toSeconds()}}class wp extends yp{constructor(){super(...arguments),this.name="TimeClass"}_getExpressions(){return Object.assign(super._getExpressions(),{now:{method:t=>this._now()+new this.constructor(this.context,t).valueOf(),regexp:/^\+(.+)/},quantize:{method:t=>{const e=new wp(this.context,t).valueOf();return this._secondsToUnits(this.context.transport.nextSubdivision(e))},regexp:/^@(.+)/}})}quantize(t,e=1){const n=new this.constructor(this.context,t).valueOf(),i=this.valueOf();return i+(Math.round(i/n)*n-i)*e}toNotation(){const t=this.toSeconds(),e=["1m"];for(let s=1;s<9;s++){const t=Math.pow(2,s);e.push(t+"n."),e.push(t+"n"),e.push(t+"t")}e.push("0");let n=e[0],i=new wp(this.context,e[0]).toSeconds();return e.forEach((e=>{const s=new wp(this.context,e).toSeconds();Math.abs(s-t)<Math.abs(i-t)&&(n=e,i=s)})),n}toBarsBeatsSixteenths(){const t=this._beatsToUnits(1);let e=this.valueOf()/t;e=parseFloat(e.toFixed(4));const n=Math.floor(e/this._getTimeSignature());let i=e%1*4;e=Math.floor(e)%this._getTimeSignature();const s=i.toString();s.length>3&&(i=parseFloat(parseFloat(s).toFixed(3)));return[n,e,i].join(":")}toTicks(){const t=this._beatsToUnits(1),e=this.valueOf()/t;return Math.round(e*this._getPPQ())}toSeconds(){return this.valueOf()}toMidi(){return gp(this.toFrequency())}_now(){return this.context.now()}}class xp extends wp{constructor(){super(...arguments),this.name="Frequency",this.defaultUnits="hz"}static get A4(){return _p}static set A4(t){!function(t){_p=t}(t)}_getExpressions(){return Object.assign({},super._getExpressions(),{midi:{regexp:/^(\d+(?:\.\d+)?midi)/,method(t){return"midi"===this.defaultUnits?t:xp.mtof(t)}},note:{regexp:/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i,method(t,e){const n=Cp[t.toLowerCase()]+12*(parseInt(e,10)+1);return"midi"===this.defaultUnits?n:xp.mtof(n)}},tr:{regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?/,method(t,e,n){let i=1;return t&&"0"!==t&&(i*=this._beatsToUnits(this._getTimeSignature()*parseFloat(t))),e&&"0"!==e&&(i*=this._beatsToUnits(parseFloat(e))),n&&"0"!==n&&(i*=this._beatsToUnits(parseFloat(n)/4)),i}}})}transpose(t){return new xp(this.context,this.valueOf()*vp(t))}harmonize(t){return t.map((t=>this.transpose(t)))}toMidi(){return gp(this.valueOf())}toNote(){const t=this.toFrequency(),e=Math.log2(t/xp.A4);let n=Math.round(12*e)+57;const i=Math.floor(n/12);i<0&&(n+=-12*i);return Tp[n%12]+i.toString()}toSeconds(){return 1/super.toSeconds()}toTicks(){const t=this._beatsToUnits(1),e=this.valueOf()/t;return Math.floor(e*this._getPPQ())}_noArg(){return 0}_frequencyToUnits(t){return t}_ticksToUnits(t){return 1/(60*t/(this._getBpm()*this._getPPQ()))}_beatsToUnits(t){return 1/super._beatsToUnits(t)}_secondsToUnits(t){return 1/t}static mtof(t){return function(t){return _p*Math.pow(2,(t-69)/12)}(t)}static ftom(t){return gp(t)}}const Cp={cbb:-2,cb:-1,c:0,"c#":1,cx:2,dbb:0,db:1,d:2,"d#":3,dx:4,ebb:2,eb:3,e:4,"e#":5,ex:6,fbb:3,fb:4,f:5,"f#":6,fx:7,gbb:5,gb:6,g:7,"g#":8,gx:9,abb:7,ab:8,a:9,"a#":10,ax:11,bbb:9,bb:10,b:11,"b#":12,bx:13},Tp=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];class Ap extends wp{constructor(){super(...arguments),this.name="TransportTime"}_now(){return this.context.transport.seconds}}class Sp extends Yh{constructor(){super();const t=Hh(Sp.getDefaults(),arguments,["context"]);this.defaultContext?this.context=this.defaultContext:this.context=t.context}static getDefaults(){return{context:fp()}}now(){return this.context.currentTime+this.context.lookAhead}immediate(){return this.context.currentTime}get sampleTime(){return 1/this.context.sampleRate}get blockTime(){return 128/this.context.sampleRate}toSeconds(t){return new wp(this.context,t).toSeconds()}toFrequency(t){return new xp(this.context,t).toFrequency()}toTicks(t){return new Ap(this.context,t).toTicks()}_getPartialProperties(t){const e=this.get();return Object.keys(e).forEach((n=>{Eh(t[n])&&delete e[n]})),e}get(){const t=this.constructor.getDefaults();return Object.keys(t).forEach((e=>{if(Reflect.has(this,e)){const n=this[e];Ph(n)&&Ph(n.value)&&Ph(n.setValueAtTime)?t[e]=n.value:n instanceof Sp?t[e]=n._getPartialProperties(t[e]):Dh(n)||Mh(n)||Ih(n)||"boolean"==typeof n?t[e]=n:delete t[e]}})),t}set(t){return Object.keys(t).forEach((e=>{Reflect.has(this,e)&&Ph(this[e])&&(this[e]&&Ph(this[e].value)&&Ph(this[e].setValueAtTime)?this[e].value!==t[e]&&(this[e].value=t[e]):this[e]instanceof Sp?this[e].set(t[e]):this[e]=t[e])})),this}}class kp extends Jh{constructor(t="stopped"){super(),this.name="StateTimeline",this._initial=t,this.setStateAtTime(this._initial,0)}getValueAtTime(t){const e=this.get(t);return null!==e?e.state:this._initial}setStateAtTime(t,e,n){return Th(e,0),this.add(Object.assign({},n,{state:t,time:e})),this}getLastState(t,e){for(let n=this._search(e);n>=0;n--){const e=this._timeline[n];if(e.state===t)return e}}getNextState(t,e){const n=this._search(e);if(-1!==n)for(let i=n;i<this._timeline.length;i++){const e=this._timeline[i];if(e.state===t)return e}}}class Ep extends Sp{constructor(){super(Hh(Ep.getDefaults(),arguments,["param","units","convert"])),this.name="Param",this.overridden=!1,this._minOutput=1e-7;const t=Hh(Ep.getDefaults(),arguments,["param","units","convert"]);for(Ch(Ph(t.param)&&(Nh(t.param)||t.param instanceof Ep),"param must be an AudioParam");!Nh(t.param);)t.param=t.param._param;this._swappable=!!Ph(t.swappable)&&t.swappable,this._swappable?(this.input=this.context.createGain(),this._param=t.param,this.input.connect(this._param)):this._param=this.input=t.param,this._events=new Jh(1e3),this._initialValue=this._param.defaultValue,this.units=t.units,this.convert=t.convert,this._minValue=t.minValue,this._maxValue=t.maxValue,Ph(t.value)&&t.value!==this._toType(this._initialValue)&&this.setValueAtTime(t.value,0)}static getDefaults(){return Object.assign(Sp.getDefaults(),{convert:!0,units:"number"})}get value(){const t=this.now();return this.getValueAtTime(t)}set value(t){this.cancelScheduledValues(this.now()),this.setValueAtTime(t,this.now())}get minValue(){return Ph(this._minValue)?this._minValue:"time"===this.units||"frequency"===this.units||"normalRange"===this.units||"positive"===this.units||"transportTime"===this.units||"ticks"===this.units||"bpm"===this.units||"hertz"===this.units||"samples"===this.units?0:"audioRange"===this.units?-1:"decibels"===this.units?-1/0:this._param.minValue}get maxValue(){return Ph(this._maxValue)?this._maxValue:"normalRange"===this.units||"audioRange"===this.units?1:this._param.maxValue}_is(t,e){return this.units===e}_assertRange(t){return Ph(this.maxValue)&&Ph(this.minValue)&&Th(t,this._fromType(this.minValue),this._fromType(this.maxValue)),t}_fromType(t){return this.convert&&!this.overridden?this._is(t,"time")?this.toSeconds(t):this._is(t,"decibels")?(e=t,Math.pow(10,e/20)):this._is(t,"frequency")?this.toFrequency(t):t:this.overridden?0:t;var e}_toType(t){return this.convert&&"decibels"===this.units?(e=t,Math.log(e)/Math.LN10*20):t;var e}setValueAtTime(t,e){const n=this.toSeconds(e),i=this._fromType(t);return Ch(isFinite(i)&&isFinite(n),`Invalid argument(s) to setValueAtTime: ${JSON.stringify(t)}, ${JSON.stringify(e)}`),this._assertRange(i),this.log(this.units,"setValueAtTime",t,n),this._events.add({time:n,type:"setValueAtTime",value:i}),this._param.setValueAtTime(i,n),this}getValueAtTime(t){const e=Math.max(this.toSeconds(t),0),n=this._events.getAfter(e),i=this._events.get(e);let s=this._initialValue;if(null===i)s=this._initialValue;else if("setTargetAtTime"!==i.type||null!==n&&"setValueAtTime"!==n.type)if(null===n)s=i.value;else if("linearRampToValueAtTime"===n.type||"exponentialRampToValueAtTime"===n.type){let t=i.value;if("setTargetAtTime"===i.type){const e=this._events.getBefore(i.time);t=null===e?this._initialValue:e.value}s="linearRampToValueAtTime"===n.type?this._linearInterpolate(i.time,t,n.time,n.value,e):this._exponentialInterpolate(i.time,t,n.time,n.value,e)}else s=i.value;else{const t=this._events.getBefore(i.time);let n;n=null===t?this._initialValue:t.value,"setTargetAtTime"===i.type&&(s=this._exponentialApproach(i.time,n,i.value,i.constant,e))}return this._toType(s)}setRampPoint(t){t=this.toSeconds(t);let e=this.getValueAtTime(t);return this.cancelAndHoldAtTime(t),0===this._fromType(e)&&(e=this._toType(this._minOutput)),this.setValueAtTime(e,t),this}linearRampToValueAtTime(t,e){const n=this._fromType(t),i=this.toSeconds(e);return Ch(isFinite(n)&&isFinite(i),`Invalid argument(s) to linearRampToValueAtTime: ${JSON.stringify(t)}, ${JSON.stringify(e)}`),this._assertRange(n),this._events.add({time:i,type:"linearRampToValueAtTime",value:n}),this.log(this.units,"linearRampToValueAtTime",t,i),this._param.linearRampToValueAtTime(n,i),this}exponentialRampToValueAtTime(t,e){let n=this._fromType(t);n=Qh(n,0)?this._minOutput:n,this._assertRange(n);const i=this.toSeconds(e);return Ch(isFinite(n)&&isFinite(i),`Invalid argument(s) to exponentialRampToValueAtTime: ${JSON.stringify(t)}, ${JSON.stringify(e)}`),this._events.add({time:i,type:"exponentialRampToValueAtTime",value:n}),this.log(this.units,"exponentialRampToValueAtTime",t,i),this._param.exponentialRampToValueAtTime(n,i),this}exponentialRampTo(t,e,n){return n=this.toSeconds(n),this.setRampPoint(n),this.exponentialRampToValueAtTime(t,n+this.toSeconds(e)),this}linearRampTo(t,e,n){return n=this.toSeconds(n),this.setRampPoint(n),this.linearRampToValueAtTime(t,n+this.toSeconds(e)),this}targetRampTo(t,e,n){return n=this.toSeconds(n),this.setRampPoint(n),this.exponentialApproachValueAtTime(t,n,e),this}exponentialApproachValueAtTime(t,e,n){e=this.toSeconds(e),n=this.toSeconds(n);const i=Math.log(n+1)/Math.log(200);return this.setTargetAtTime(t,e,i),this.cancelAndHoldAtTime(e+.9*n),this.linearRampToValueAtTime(t,e+n),this}setTargetAtTime(t,e,n){const i=this._fromType(t);Ch(isFinite(n)&&n>0,"timeConstant must be a number greater than 0");const s=this.toSeconds(e);return this._assertRange(i),Ch(isFinite(i)&&isFinite(s),`Invalid argument(s) to setTargetAtTime: ${JSON.stringify(t)}, ${JSON.stringify(e)}`),this._events.add({constant:n,time:s,type:"setTargetAtTime",value:i}),this.log(this.units,"setTargetAtTime",t,s,n),this._param.setTargetAtTime(i,s,n),this}setValueCurveAtTime(t,e,n,i=1){n=this.toSeconds(n),e=this.toSeconds(e);const s=this._fromType(t[0])*i;this.setValueAtTime(this._toType(s),e);const r=n/(t.length-1);for(let o=1;o<t.length;o++){const n=this._fromType(t[o])*i;this.linearRampToValueAtTime(this._toType(n),e+o*r)}return this}cancelScheduledValues(t){const e=this.toSeconds(t);return Ch(isFinite(e),`Invalid argument to cancelScheduledValues: ${JSON.stringify(t)}`),this._events.cancel(e),this._param.cancelScheduledValues(e),this.log(this.units,"cancelScheduledValues",e),this}cancelAndHoldAtTime(t){const e=this.toSeconds(t),n=this._fromType(this.getValueAtTime(e));Ch(isFinite(e),`Invalid argument to cancelAndHoldAtTime: ${JSON.stringify(t)}`),this.log(this.units,"cancelAndHoldAtTime",e,"value="+n);const i=this._events.get(e),s=this._events.getAfter(e);return i&&Qh(i.time,e)?s?(this._param.cancelScheduledValues(s.time),this._events.cancel(s.time)):(this._param.cancelAndHoldAtTime(e),this._events.cancel(e+this.sampleTime)):s&&(this._param.cancelScheduledValues(s.time),this._events.cancel(s.time),"linearRampToValueAtTime"===s.type?this.linearRampToValueAtTime(this._toType(n),e):"exponentialRampToValueAtTime"===s.type&&this.exponentialRampToValueAtTime(this._toType(n),e)),this._events.add({time:e,type:"setValueAtTime",value:n}),this._param.setValueAtTime(n,e),this}rampTo(t,e=.1,n){return"frequency"===this.units||"bpm"===this.units||"decibels"===this.units?this.exponentialRampTo(t,e,n):this.linearRampTo(t,e,n),this}apply(t){const e=this.context.currentTime;t.setValueAtTime(this.getValueAtTime(e),e);const n=this._events.get(e);if(n&&"setTargetAtTime"===n.type){const i=this._events.getAfter(n.time),s=i?i.time:e+2,r=(s-e)/10;for(let n=e;n<s;n+=r)t.linearRampToValueAtTime(this.getValueAtTime(n),n)}return this._events.forEachAfter(this.context.currentTime,(e=>{"cancelScheduledValues"===e.type?t.cancelScheduledValues(e.time):"setTargetAtTime"===e.type?t.setTargetAtTime(e.value,e.time,e.constant):t[e.type](e.value,e.time)})),this}setParam(t){Ch(this._swappable,"The Param must be assigned as 'swappable' in the constructor");const e=this.input;return e.disconnect(this._param),this.apply(t),this._param=t,e.connect(this._param),this}dispose(){return super.dispose(),this._events.dispose(),this}get defaultValue(){return this._toType(this._param.defaultValue)}_exponentialApproach(t,e,n,i,s){return n+(e-n)*Math.exp(-(s-t)/i)}_linearInterpolate(t,e,n,i,s){return e+(s-t)/(n-t)*(i-e)}_exponentialInterpolate(t,e,n,i,s){return e*Math.pow(i/e,(s-t)/(n-t))}}class Pp extends Sp{constructor(){super(...arguments),this.name="ToneAudioNode",this._internalChannels=[]}get numberOfInputs(){return Ph(this.input)?Nh(this.input)||this.input instanceof Ep?1:this.input.numberOfInputs:0}get numberOfOutputs(){return Ph(this.output)?this.output.numberOfOutputs:0}_isAudioNode(t){return Ph(t)&&(t instanceof Pp||Bh(t))}_getInternalNodes(){const t=this._internalChannels.slice(0);return this._isAudioNode(this.input)&&t.push(this.input),this._isAudioNode(this.output)&&this.input!==this.output&&t.push(this.output),t}_setChannelProperties(t){this._getInternalNodes().forEach((e=>{e.channelCount=t.channelCount,e.channelCountMode=t.channelCountMode,e.channelInterpretation=t.channelInterpretation}))}_getChannelProperties(){const t=this._getInternalNodes();Ch(t.length>0,"ToneAudioNode does not have any internal nodes");const e=t[0];return{channelCount:e.channelCount,channelCountMode:e.channelCountMode,channelInterpretation:e.channelInterpretation}}get channelCount(){return this._getChannelProperties().channelCount}set channelCount(t){const e=this._getChannelProperties();this._setChannelProperties(Object.assign(e,{channelCount:t}))}get channelCountMode(){return this._getChannelProperties().channelCountMode}set channelCountMode(t){const e=this._getChannelProperties();this._setChannelProperties(Object.assign(e,{channelCountMode:t}))}get channelInterpretation(){return this._getChannelProperties().channelInterpretation}set channelInterpretation(t){const e=this._getChannelProperties();this._setChannelProperties(Object.assign(e,{channelInterpretation:t}))}connect(t,e=0,n=0){return Op(this,t,e,n),this}toDestination(){return this.connect(this.context.destination),this}toMaster(){return kh("toMaster() has been renamed toDestination()"),this.toDestination()}disconnect(t,e=0,n=0){return Dp(this,t,e,n),this}chain(...t){return Mp(this,...t),this}fan(...t){return t.forEach((t=>this.connect(t))),this}dispose(){return super.dispose(),Ph(this.input)&&(this.input instanceof Pp?this.input.dispose():Bh(this.input)&&this.input.disconnect()),Ph(this.output)&&(this.output instanceof Pp?this.output.dispose():Bh(this.output)&&this.output.disconnect()),this._internalChannels=[],this}}function Mp(...t){const e=t.shift();t.reduce(((t,e)=>(t instanceof Pp?t.connect(e):Bh(t)&&Op(t,e),e)),e)}function Op(t,e,n=0,i=0){for(Ch(Ph(t),"Cannot connect from undefined node"),Ch(Ph(e),"Cannot connect to undefined node"),(e instanceof Pp||Bh(e))&&Ch(e.numberOfInputs>0,"Cannot connect to node with no inputs"),Ch(t.numberOfOutputs>0,"Cannot connect from node with no outputs");e instanceof Pp||e instanceof Ep;)Ph(e.input)&&(e=e.input);for(;t instanceof Pp;)Ph(t.output)&&(t=t.output);Nh(e)?t.connect(e,n):t.connect(e,n,i)}function Dp(t,e,n=0,i=0){if(Ph(e))for(;e instanceof Pp;)e=e.input;for(;!Bh(t);)Ph(t.output)&&(t=t.output);Nh(e)?t.disconnect(e,n):Bh(e)?t.disconnect(e,n,i):t.disconnect()}class Ip extends Pp{constructor(){super(Hh(Ip.getDefaults(),arguments,["gain","units"])),this.name="Gain",this._gainNode=this.context.createGain(),this.input=this._gainNode,this.output=this._gainNode;const t=Hh(Ip.getDefaults(),arguments,["gain","units"]);this.gain=new Ep({context:this.context,convert:t.convert,param:this._gainNode.gain,units:t.units,value:t.gain,minValue:t.minValue,maxValue:t.maxValue}),ap(this,"gain")}static getDefaults(){return Object.assign(Pp.getDefaults(),{convert:!0,gain:1,units:"gain"})}dispose(){return super.dispose(),this._gainNode.disconnect(),this.gain.dispose(),this}}class Vp extends Pp{constructor(t){super(t),this.onended=cp,this._startTime=-1,this._stopTime=-1,this._timeout=-1,this.output=new Ip({context:this.context,gain:0}),this._gainNode=this.output,this.getStateAtTime=function(t){const e=this.toSeconds(t);return-1!==this._startTime&&e>=this._startTime&&(-1===this._stopTime||e<=this._stopTime)?"started":"stopped"},this._fadeIn=t.fadeIn,this._fadeOut=t.fadeOut,this._curve=t.curve,this.onended=t.onended}static getDefaults(){return Object.assign(Pp.getDefaults(),{curve:"linear",fadeIn:0,fadeOut:0,onended:cp})}_startGain(t,e=1){Ch(-1===this._startTime,"Source cannot be started more than once");const n=this.toSeconds(this._fadeIn);return this._startTime=t+n,this._startTime=Math.max(this._startTime,this.context.currentTime),n>0?(this._gainNode.gain.setValueAtTime(0,t),"linear"===this._curve?this._gainNode.gain.linearRampToValueAtTime(e,t+n):this._gainNode.gain.exponentialApproachValueAtTime(e,t,n)):this._gainNode.gain.setValueAtTime(e,t),this}stop(t){return this.log("stop",t),this._stopGain(this.toSeconds(t)),this}_stopGain(t){Ch(-1!==this._startTime,"'start' must be called before 'stop'"),this.cancelStop();const e=this.toSeconds(this._fadeOut);return this._stopTime=this.toSeconds(t)+e,this._stopTime=Math.max(this._stopTime,this.context.currentTime),e>0?"linear"===this._curve?this._gainNode.gain.linearRampTo(0,e,t):this._gainNode.gain.targetRampTo(0,e,t):(this._gainNode.gain.cancelAndHoldAtTime(t),this._gainNode.gain.setValueAtTime(0,t)),this.context.clearTimeout(this._timeout),this._timeout=this.context.setTimeout((()=>{const t="exponential"===this._curve?2*e:0;this._stopSource(this.now()+t),this._onended()}),this._stopTime-this.context.currentTime),this}_onended(){if(this.onended!==cp&&(this.onended(this),this.onended=cp,!this.context.isOffline)){const t=()=>this.dispose();void 0!==window.requestIdleCallback?window.requestIdleCallback(t):setTimeout(t,1e3)}}get state(){return this.getStateAtTime(this.now())}cancelStop(){return this.log("cancelStop"),Ch(-1!==this._startTime,"Source is not started"),this._gainNode.gain.cancelScheduledValues(this._startTime+this.sampleTime),this.context.clearTimeout(this._timeout),this._stopTime=-1,this}dispose(){return super.dispose(),this._gainNode.disconnect(),this}}class Rp extends Vp{constructor(){super(Hh(Rp.getDefaults(),arguments,["offset"])),this.name="ToneConstantSource",this._source=this.context.createConstantSource();const t=Hh(Rp.getDefaults(),arguments,["offset"]);Op(this._source,this._gainNode),this.offset=new Ep({context:this.context,convert:t.convert,param:this._source.offset,units:t.units,value:t.offset,minValue:t.minValue,maxValue:t.maxValue})}static getDefaults(){return Object.assign(Vp.getDefaults(),{convert:!0,offset:1,units:"number"})}start(t){const e=this.toSeconds(t);return this.log("start",e),this._startGain(e),this._source.start(e),this}_stopSource(t){this._source.stop(t)}dispose(){return super.dispose(),"started"===this.state&&this.stop(),this._source.disconnect(),this.offset.dispose(),this}}class Fp extends Pp{constructor(){super(Hh(Fp.getDefaults(),arguments,["value","units"])),this.name="Signal",this.override=!0;const t=Hh(Fp.getDefaults(),arguments,["value","units"]);this.output=this._constantSource=new Rp({context:this.context,convert:t.convert,offset:t.value,units:t.units,minValue:t.minValue,maxValue:t.maxValue}),this._constantSource.start(0),this.input=this._param=this._constantSource.offset}static getDefaults(){return Object.assign(Pp.getDefaults(),{convert:!0,units:"number",value:0})}connect(t,e=0,n=0){return Lp(this,t,e,n),this}dispose(){return super.dispose(),this._param.dispose(),this._constantSource.dispose(),this}setValueAtTime(t,e){return this._param.setValueAtTime(t,e),this}getValueAtTime(t){return this._param.getValueAtTime(t)}setRampPoint(t){return this._param.setRampPoint(t),this}linearRampToValueAtTime(t,e){return this._param.linearRampToValueAtTime(t,e),this}exponentialRampToValueAtTime(t,e){return this._param.exponentialRampToValueAtTime(t,e),this}exponentialRampTo(t,e,n){return this._param.exponentialRampTo(t,e,n),this}linearRampTo(t,e,n){return this._param.linearRampTo(t,e,n),this}targetRampTo(t,e,n){return this._param.targetRampTo(t,e,n),this}exponentialApproachValueAtTime(t,e,n){return this._param.exponentialApproachValueAtTime(t,e,n),this}setTargetAtTime(t,e,n){return this._param.setTargetAtTime(t,e,n),this}setValueCurveAtTime(t,e,n,i){return this._param.setValueCurveAtTime(t,e,n,i),this}cancelScheduledValues(t){return this._param.cancelScheduledValues(t),this}cancelAndHoldAtTime(t){return this._param.cancelAndHoldAtTime(t),this}rampTo(t,e,n){return this._param.rampTo(t,e,n),this}get value(){return this._param.value}set value(t){this._param.value=t}get convert(){return this._param.convert}set convert(t){this._param.convert=t}get units(){return this._param.units}get overridden(){return this._param.overridden}set overridden(t){this._param.overridden=t}get maxValue(){return this._param.maxValue}get minValue(){return this._param.minValue}apply(t){return this._param.apply(t),this}}function Lp(t,e,n,i){(e instanceof Ep||Nh(e)||e instanceof Fp&&e.override)&&(e.cancelScheduledValues(0),e.setValueAtTime(0,0),e instanceof Fp&&(e.overridden=!0)),Op(t,e,n,i)}class Np extends Ep{constructor(){super(Hh(Np.getDefaults(),arguments,["value"])),this.name="TickParam",this._events=new Jh(1/0),this._multiplier=1;const t=Hh(Np.getDefaults(),arguments,["value"]);this._multiplier=t.multiplier,this._events.cancel(0),this._events.add({ticks:0,time:0,type:"setValueAtTime",value:this._fromType(t.value)}),this.setValueAtTime(t.value,0)}static getDefaults(){return Object.assign(Ep.getDefaults(),{multiplier:1,units:"hertz",value:1})}setTargetAtTime(t,e,n){e=this.toSeconds(e),this.setRampPoint(e);const i=this._fromType(t),s=this._events.get(e),r=Math.round(Math.max(1/n,1));for(let o=0;o<=r;o++){const t=n*o+e,r=this._exponentialApproach(s.time,s.value,i,n,t);this.linearRampToValueAtTime(this._toType(r),t)}return this}setValueAtTime(t,e){const n=this.toSeconds(e);super.setValueAtTime(t,e);const i=this._events.get(n),s=this._events.previousEvent(i),r=this._getTicksUntilEvent(s,n);return i.ticks=Math.max(r,0),this}linearRampToValueAtTime(t,e){const n=this.toSeconds(e);super.linearRampToValueAtTime(t,e);const i=this._events.get(n),s=this._events.previousEvent(i),r=this._getTicksUntilEvent(s,n);return i.ticks=Math.max(r,0),this}exponentialRampToValueAtTime(t,e){e=this.toSeconds(e);const n=this._fromType(t),i=this._events.get(e),s=Math.round(Math.max(10*(e-i.time),1)),r=(e-i.time)/s;for(let o=0;o<=s;o++){const t=r*o+i.time,s=this._exponentialInterpolate(i.time,i.value,e,n,t);this.linearRampToValueAtTime(this._toType(s),t)}return this}_getTicksUntilEvent(t,e){if(null===t)t={ticks:0,time:0,type:"setValueAtTime",value:0};else if(Eh(t.ticks)){const e=this._events.previousEvent(t);t.ticks=this._getTicksUntilEvent(e,t.time)}const n=this._fromType(this.getValueAtTime(t.time));let i=this._fromType(this.getValueAtTime(e));const s=this._events.get(e);return s&&s.time===e&&"setValueAtTime"===s.type&&(i=this._fromType(this.getValueAtTime(e-this.sampleTime))),.5*(e-t.time)*(n+i)+t.ticks}getTicksAtTime(t){const e=this.toSeconds(t),n=this._events.get(e);return Math.max(this._getTicksUntilEvent(n,e),0)}getDurationOfTicks(t,e){const n=this.toSeconds(e),i=this.getTicksAtTime(e);return this.getTimeOfTick(i+t)-n}getTimeOfTick(t){const e=this._events.get(t,"ticks"),n=this._events.getAfter(t,"ticks");if(e&&e.ticks===t)return e.time;if(e&&n&&"linearRampToValueAtTime"===n.type&&e.value!==n.value){const i=this._fromType(this.getValueAtTime(e.time)),s=(this._fromType(this.getValueAtTime(n.time))-i)/(n.time-e.time),r=Math.sqrt(Math.pow(i,2)-2*s*(e.ticks-t)),o=(-i+r)/s,a=(-i-r)/s;return(o>0?o:a)+e.time}return e?0===e.value?1/0:e.time+(t-e.ticks)/e.value:t/this._initialValue}ticksToTime(t,e){return this.getDurationOfTicks(t,e)}timeToTicks(t,e){const n=this.toSeconds(e),i=this.toSeconds(t),s=this.getTicksAtTime(n);return this.getTicksAtTime(n+i)-s}_fromType(t){return"bpm"===this.units&&this.multiplier?1/(60/t/this.multiplier):super._fromType(t)}_toType(t){return"bpm"===this.units&&this.multiplier?t/this.multiplier*60:super._toType(t)}get multiplier(){return this._multiplier}set multiplier(t){const e=this.value;this._multiplier=t,this.cancelScheduledValues(0),this.setValueAtTime(e,0)}}class Bp extends Fp{constructor(){super(Hh(Bp.getDefaults(),arguments,["value"])),this.name="TickSignal";const t=Hh(Bp.getDefaults(),arguments,["value"]);this.input=this._param=new Np({context:this.context,convert:t.convert,multiplier:t.multiplier,param:this._constantSource.offset,units:t.units,value:t.value})}static getDefaults(){return Object.assign(Fp.getDefaults(),{multiplier:1,units:"hertz",value:1})}ticksToTime(t,e){return this._param.ticksToTime(t,e)}timeToTicks(t,e){return this._param.timeToTicks(t,e)}getTimeOfTick(t){return this._param.getTimeOfTick(t)}getDurationOfTicks(t,e){return this._param.getDurationOfTicks(t,e)}getTicksAtTime(t){return this._param.getTicksAtTime(t)}get multiplier(){return this._param.multiplier}set multiplier(t){this._param.multiplier=t}dispose(){return super.dispose(),this._param.dispose(),this}}class zp extends Sp{constructor(){super(Hh(zp.getDefaults(),arguments,["frequency"])),this.name="TickSource",this._state=new kp,this._tickOffset=new Jh;const t=Hh(zp.getDefaults(),arguments,["frequency"]);this.frequency=new Bp({context:this.context,units:t.units,value:t.frequency}),ap(this,"frequency"),this._state.setStateAtTime("stopped",0),this.setTicksAtTime(0,0)}static getDefaults(){return Object.assign({frequency:1,units:"hertz"},Sp.getDefaults())}get state(){return this.getStateAtTime(this.now())}start(t,e){const n=this.toSeconds(t);return"started"!==this._state.getValueAtTime(n)&&(this._state.setStateAtTime("started",n),Ph(e)&&this.setTicksAtTime(e,n)),this}stop(t){const e=this.toSeconds(t);if("stopped"===this._state.getValueAtTime(e)){const t=this._state.get(e);t&&t.time>0&&(this._tickOffset.cancel(t.time),this._state.cancel(t.time))}return this._state.cancel(e),this._state.setStateAtTime("stopped",e),this.setTicksAtTime(0,e),this}pause(t){const e=this.toSeconds(t);return"started"===this._state.getValueAtTime(e)&&this._state.setStateAtTime("paused",e),this}cancel(t){return t=this.toSeconds(t),this._state.cancel(t),this._tickOffset.cancel(t),this}getTicksAtTime(t){const e=this.toSeconds(t),n=this._state.getLastState("stopped",e),i={state:"paused",time:e};this._state.add(i);let s=n,r=0;return this._state.forEachBetween(n.time,e+this.sampleTime,(t=>{let e=s.time;const n=this._tickOffset.get(t.time);n&&n.time>=s.time&&(r=n.ticks,e=n.time),"started"===s.state&&"started"!==t.state&&(r+=this.frequency.getTicksAtTime(t.time)-this.frequency.getTicksAtTime(e)),s=t})),this._state.remove(i),r}get ticks(){return this.getTicksAtTime(this.now())}set ticks(t){this.setTicksAtTime(t,this.now())}get seconds(){return this.getSecondsAtTime(this.now())}set seconds(t){const e=this.now(),n=this.frequency.timeToTicks(t,e);this.setTicksAtTime(n,e)}getSecondsAtTime(t){t=this.toSeconds(t);const e=this._state.getLastState("stopped",t),n={state:"paused",time:t};this._state.add(n);let i=e,s=0;return this._state.forEachBetween(e.time,t+this.sampleTime,(t=>{let e=i.time;const n=this._tickOffset.get(t.time);n&&n.time>=i.time&&(s=n.seconds,e=n.time),"started"===i.state&&"started"!==t.state&&(s+=t.time-e),i=t})),this._state.remove(n),s}setTicksAtTime(t,e){return e=this.toSeconds(e),this._tickOffset.cancel(e),this._tickOffset.add({seconds:this.frequency.getDurationOfTicks(t,e),ticks:t,time:e}),this}getStateAtTime(t){return t=this.toSeconds(t),this._state.getValueAtTime(t)}getTimeOfTick(t,e=this.now()){const n=this._tickOffset.get(e),i=this._state.get(e),s=Math.max(n.time,i.time),r=this.frequency.getTicksAtTime(s)+t-n.ticks;return this.frequency.getTimeOfTick(r)}forEachTickBetween(t,e,n){let i=this._state.get(t);this._state.forEachBetween(t,e,(e=>{i&&"started"===i.state&&"started"!==e.state&&this.forEachTickBetween(Math.max(i.time,t),e.time-this.sampleTime,n),i=e}));let s=null;if(i&&"started"===i.state){const o=Math.max(i.time,t),a=this.frequency.getTicksAtTime(o),l=a-this.frequency.getTicksAtTime(i.time);let c=Math.ceil(l)-l;c=Qh(c,1)?0:c;let u=this.frequency.getTimeOfTick(a+c);for(;u<e;){try{n(u,Math.round(this.getTicksAtTime(u)))}catch(r){s=r;break}u+=this.frequency.getDurationOfTicks(1,u)}}if(s)throw s;return this}dispose(){return super.dispose(),this._state.dispose(),this._tickOffset.dispose(),this.frequency.dispose(),this}}class jp extends Sp{constructor(){super(Hh(jp.getDefaults(),arguments,["callback","frequency"])),this.name="Clock",this.callback=cp,this._lastUpdate=0,this._state=new kp("stopped"),this._boundLoop=this._loop.bind(this);const t=Hh(jp.getDefaults(),arguments,["callback","frequency"]);this.callback=t.callback,this._tickSource=new zp({context:this.context,frequency:t.frequency,units:t.units}),this._lastUpdate=0,this.frequency=this._tickSource.frequency,ap(this,"frequency"),this._state.setStateAtTime("stopped",0),this.context.on("tick",this._boundLoop)}static getDefaults(){return Object.assign(Sp.getDefaults(),{callback:cp,frequency:1,units:"hertz"})}get state(){return this._state.getValueAtTime(this.now())}start(t,e){Ah(this.context);const n=this.toSeconds(t);return this.log("start",n),"started"!==this._state.getValueAtTime(n)&&(this._state.setStateAtTime("started",n),this._tickSource.start(n,e),n<this._lastUpdate&&this.emit("start",n,e)),this}stop(t){const e=this.toSeconds(t);return this.log("stop",e),this._state.cancel(e),this._state.setStateAtTime("stopped",e),this._tickSource.stop(e),e<this._lastUpdate&&this.emit("stop",e),this}pause(t){const e=this.toSeconds(t);return"started"===this._state.getValueAtTime(e)&&(this._state.setStateAtTime("paused",e),this._tickSource.pause(e),e<this._lastUpdate&&this.emit("pause",e)),this}get ticks(){return Math.ceil(this.getTicksAtTime(this.now()))}set ticks(t){this._tickSource.ticks=t}get seconds(){return this._tickSource.seconds}set seconds(t){this._tickSource.seconds=t}getSecondsAtTime(t){return this._tickSource.getSecondsAtTime(t)}setTicksAtTime(t,e){return this._tickSource.setTicksAtTime(t,e),this}getTimeOfTick(t,e=this.now()){return this._tickSource.getTimeOfTick(t,e)}getTicksAtTime(t){return this._tickSource.getTicksAtTime(t)}nextTickTime(t,e){const n=this.toSeconds(e),i=this.getTicksAtTime(n);return this._tickSource.getTimeOfTick(i+t,n)}_loop(){const t=this._lastUpdate,e=this.now();this._lastUpdate=e,this.log("loop",t,e),t!==e&&(this._state.forEachBetween(t,e,(t=>{switch(t.state){case"started":const e=this._tickSource.getTicksAtTime(t.time);this.emit("start",t.time,e);break;case"stopped":0!==t.time&&this.emit("stop",t.time);break;case"paused":this.emit("pause",t.time)}})),this._tickSource.forEachTickBetween(t,e,((t,e)=>{this.callback(t,e)})))}getStateAtTime(t){const e=this.toSeconds(t);return this._state.getValueAtTime(e)}dispose(){return super.dispose(),this.context.off("tick",this._boundLoop),this._tickSource.dispose(),this._state.dispose(),this}}sp.mixin(jp);class Up extends Pp{constructor(){super(Hh(Up.getDefaults(),arguments,["delayTime","maxDelay"])),this.name="Delay";const t=Hh(Up.getDefaults(),arguments,["delayTime","maxDelay"]),e=this.toSeconds(t.maxDelay);this._maxDelay=Math.max(e,this.toSeconds(t.delayTime)),this._delayNode=this.input=this.output=this.context.createDelay(e),this.delayTime=new Ep({context:this.context,param:this._delayNode.delayTime,units:"time",value:t.delayTime,minValue:0,maxValue:this.maxDelay}),ap(this,"delayTime")}static getDefaults(){return Object.assign(Pp.getDefaults(),{delayTime:0,maxDelay:1})}get maxDelay(){return this._maxDelay}dispose(){return super.dispose(),this._delayNode.disconnect(),this.delayTime.dispose(),this}}class qp extends Yh{constructor(){super(),this.name="ToneAudioBuffers",this._buffers=new Map,this._loadingCount=0;const t=Hh(qp.getDefaults(),arguments,["urls","onload","baseUrl"],"urls");this.baseUrl=t.baseUrl,Object.keys(t.urls).forEach((e=>{this._loadingCount++;const n=t.urls[e];this.add(e,n,this._bufferLoaded.bind(this,t.onload),t.onerror)}))}static getDefaults(){return{baseUrl:"",onerror:cp,onload:cp,urls:{}}}has(t){return this._buffers.has(t.toString())}get(t){return Ch(this.has(t),`ToneAudioBuffers has no buffer named: ${t}`),this._buffers.get(t.toString())}_bufferLoaded(t){this._loadingCount--,0===this._loadingCount&&t&&t()}get loaded(){return Array.from(this._buffers).every((([t,e])=>e.loaded))}add(t,e,n=cp,i=cp){return Ih(e)?this._buffers.set(t.toString(),new up(this.baseUrl+e,n,i)):this._buffers.set(t.toString(),new up(e,n,i)),this}dispose(){return super.dispose(),this._buffers.forEach((t=>t.dispose())),this._buffers.clear(),this}}class Wp extends Ap{constructor(){super(...arguments),this.name="Ticks",this.defaultUnits="i"}_now(){return this.context.transport.ticks}_beatsToUnits(t){return this._getPPQ()*t}_secondsToUnits(t){return Math.floor(t/(60/this._getBpm())*this._getPPQ())}_ticksToUnits(t){return t}toTicks(){return this.valueOf()}toSeconds(){return this.valueOf()/this._getPPQ()*(60/this._getBpm())}}class Hp extends Sp{constructor(){super(...arguments),this.name="Draw",this.expiration=.25,this.anticipation=.008,this._events=new Jh,this._boundDrawLoop=this._drawLoop.bind(this),this._animationFrame=-1}schedule(t,e){return this._events.add({callback:t,time:this.toSeconds(e)}),1===this._events.length&&(this._animationFrame=requestAnimationFrame(this._boundDrawLoop)),this}cancel(t){return this._events.cancel(this.toSeconds(t)),this}_drawLoop(){const t=this.context.currentTime;for(;this._events.length&&this._events.peek().time-this.anticipation<=t;){const e=this._events.shift();e&&t-e.time<=this.expiration&&e.callback()}this._events.length>0&&(this._animationFrame=requestAnimationFrame(this._boundDrawLoop))}dispose(){return super.dispose(),this._events.dispose(),cancelAnimationFrame(this._animationFrame),this}}ep((t=>{t.draw=new Hp({context:t})})),ip((t=>{t.draw.dispose()}));class Gp extends Yh{constructor(){super(...arguments),this.name="IntervalTimeline",this._root=null,this._length=0}add(t){Ch(Ph(t.time),"Events must have a time property"),Ch(Ph(t.duration),"Events must have a duration parameter"),t.time=t.time.valueOf();let e=new Kp(t.time,t.time+t.duration,t);for(null===this._root?this._root=e:this._root.insert(e),this._length++;null!==e;)e.updateHeight(),e.updateMax(),this._rebalance(e),e=e.parent;return this}remove(t){if(null!==this._root){const e=[];this._root.search(t.time,e);for(const n of e)if(n.event===t){this._removeNode(n),this._length--;break}}return this}get length(){return this._length}cancel(t){return this.forEachFrom(t,(t=>this.remove(t))),this}_setRoot(t){this._root=t,null!==this._root&&(this._root.parent=null)}_replaceNodeInParent(t,e){null!==t.parent?(t.isLeftChild()?t.parent.left=e:t.parent.right=e,this._rebalance(t.parent)):this._setRoot(e)}_removeNode(t){if(null===t.left&&null===t.right)this._replaceNodeInParent(t,null);else if(null===t.right)this._replaceNodeInParent(t,t.left);else if(null===t.left)this._replaceNodeInParent(t,t.right);else{let e,n=null;if(t.getBalance()>0)if(null===t.left.right)e=t.left,e.right=t.right,n=e;else{for(e=t.left.right;null!==e.right;)e=e.right;e.parent&&(e.parent.right=e.left,n=e.parent,e.left=t.left,e.right=t.right)}else if(null===t.right.left)e=t.right,e.left=t.left,n=e;else{for(e=t.right.left;null!==e.left;)e=e.left;e.parent&&(e.parent.left=e.right,n=e.parent,e.left=t.left,e.right=t.right)}null!==t.parent?t.isLeftChild()?t.parent.left=e:t.parent.right=e:this._setRoot(e),n&&this._rebalance(n)}t.dispose()}_rotateLeft(t){const e=t.parent,n=t.isLeftChild(),i=t.right;i&&(t.right=i.left,i.left=t),null!==e?n?e.left=i:e.right=i:this._setRoot(i)}_rotateRight(t){const e=t.parent,n=t.isLeftChild(),i=t.left;i&&(t.left=i.right,i.right=t),null!==e?n?e.left=i:e.right=i:this._setRoot(i)}_rebalance(t){const e=t.getBalance();e>1&&t.left?t.left.getBalance()<0?this._rotateLeft(t.left):this._rotateRight(t):e<-1&&t.right&&(t.right.getBalance()>0?this._rotateRight(t.right):this._rotateLeft(t))}get(t){if(null!==this._root){const e=[];if(this._root.search(t,e),e.length>0){let t=e[0];for(let n=1;n<e.length;n++)e[n].low>t.low&&(t=e[n]);return t.event}}return null}forEach(t){if(null!==this._root){const e=[];this._root.traverse((t=>e.push(t))),e.forEach((e=>{e.event&&t(e.event)}))}return this}forEachAtTime(t,e){if(null!==this._root){const n=[];this._root.search(t,n),n.forEach((t=>{t.event&&e(t.event)}))}return this}forEachFrom(t,e){if(null!==this._root){const n=[];this._root.searchAfter(t,n),n.forEach((t=>{t.event&&e(t.event)}))}return this}dispose(){return super.dispose(),null!==this._root&&this._root.traverse((t=>t.dispose())),this._root=null,this}}class Kp{constructor(t,e,n){this._left=null,this._right=null,this.parent=null,this.height=0,this.event=n,this.low=t,this.high=e,this.max=this.high}insert(t){t.low<=this.low?null===this.left?this.left=t:this.left.insert(t):null===this.right?this.right=t:this.right.insert(t)}search(t,e){t>this.max||(null!==this.left&&this.left.search(t,e),this.low<=t&&this.high>t&&e.push(this),this.low>t||null!==this.right&&this.right.search(t,e))}searchAfter(t,e){this.low>=t&&(e.push(this),null!==this.left&&this.left.searchAfter(t,e)),null!==this.right&&this.right.searchAfter(t,e)}traverse(t){t(this),null!==this.left&&this.left.traverse(t),null!==this.right&&this.right.traverse(t)}updateHeight(){null!==this.left&&null!==this.right?this.height=Math.max(this.left.height,this.right.height)+1:null!==this.right?this.height=this.right.height+1:null!==this.left?this.height=this.left.height+1:this.height=0}updateMax(){this.max=this.high,null!==this.left&&(this.max=Math.max(this.max,this.left.max)),null!==this.right&&(this.max=Math.max(this.max,this.right.max))}getBalance(){let t=0;return null!==this.left&&null!==this.right?t=this.left.height-this.right.height:null!==this.left?t=this.left.height+1:null!==this.right&&(t=-(this.right.height+1)),t}isLeftChild(){return null!==this.parent&&this.parent.left===this}get left(){return this._left}set left(t){this._left=t,null!==t&&(t.parent=this),this.updateHeight(),this.updateMax()}get right(){return this._right}set right(t){this._right=t,null!==t&&(t.parent=this),this.updateHeight(),this.updateMax()}dispose(){this.parent=null,this._left=null,this._right=null,this.event=null}}class Yp extends Pp{constructor(){super(Hh(Yp.getDefaults(),arguments,["volume"])),this.name="Volume";const t=Hh(Yp.getDefaults(),arguments,["volume"]);this.input=this.output=new Ip({context:this.context,gain:t.volume,units:"decibels"}),this.volume=this.output.gain,ap(this,"volume"),this._unmutedVolume=t.volume,this.mute=t.mute}static getDefaults(){return Object.assign(Pp.getDefaults(),{mute:!1,volume:0})}get mute(){return this.volume.value===-1/0}set mute(t){!this.mute&&t?(this._unmutedVolume=this.volume.value,this.volume.value=-1/0):this.mute&&!t&&(this.volume.value=this._unmutedVolume)}dispose(){return super.dispose(),this.input.dispose(),this.volume.dispose(),this}}class Xp extends Pp{constructor(){super(Hh(Xp.getDefaults(),arguments)),this.name="Destination",this.input=new Yp({context:this.context}),this.output=new Ip({context:this.context}),this.volume=this.input.volume;const t=Hh(Xp.getDefaults(),arguments);Mp(this.input,this.output,this.context.rawContext.destination),this.mute=t.mute,this._internalChannels=[this.input,this.context.rawContext.destination,this.output]}static getDefaults(){return Object.assign(Pp.getDefaults(),{mute:!1,volume:0})}get mute(){return this.input.mute}set mute(t){this.input.mute=t}chain(...t){return this.input.disconnect(),t.unshift(this.input),t.push(this.output),Mp(...t),this}get maxChannelCount(){return this.context.rawContext.destination.maxChannelCount}dispose(){return super.dispose(),this.volume.dispose(),this}}ep((t=>{t.destination=new Xp({context:t})})),ip((t=>{t.destination.dispose()}));class $p extends Yh{constructor(t){super(),this.name="TimelineValue",this._timeline=new Jh({memory:10}),this._initialValue=t}set(t,e){return this._timeline.add({value:t,time:e}),this}get(t){const e=this._timeline.get(t);return e?e.value:this._initialValue}}class Zp{constructor(t,e){this.id=Zp._eventId++;const n=Object.assign(Zp.getDefaults(),e);this.transport=t,this.callback=n.callback,this._once=n.once,this.time=n.time}static getDefaults(){return{callback:cp,once:!1,time:0}}invoke(t){this.callback&&(this.callback(t),this._once&&this.transport.clear(this.id))}dispose(){return this.callback=void 0,this}}Zp._eventId=0;class Qp extends Zp{constructor(t,e){super(t,e),this._currentId=-1,this._nextId=-1,this._nextTick=this.time,this._boundRestart=this._restart.bind(this);const n=Object.assign(Qp.getDefaults(),e);this.duration=new Wp(t.context,n.duration).valueOf(),this._interval=new Wp(t.context,n.interval).valueOf(),this._nextTick=n.time,this.transport.on("start",this._boundRestart),this.transport.on("loopStart",this._boundRestart),this.context=this.transport.context,this._restart()}static getDefaults(){return Object.assign({},Zp.getDefaults(),{duration:1/0,interval:1,once:!1})}invoke(t){this._createEvents(t),super.invoke(t)}_createEvents(t){const e=this.transport.getTicksAtTime(t);e>=this.time&&e>=this._nextTick&&this._nextTick+this._interval<this.time+this.duration&&(this._nextTick+=this._interval,this._currentId=this._nextId,this._nextId=this.transport.scheduleOnce(this.invoke.bind(this),new Wp(this.context,this._nextTick).toSeconds()))}_restart(t){this.transport.clear(this._currentId),this.transport.clear(this._nextId),this._nextTick=this.time;const e=this.transport.getTicksAtTime(t);e>this.time&&(this._nextTick=this.time+Math.ceil((e-this.time)/this._interval)*this._interval),this._currentId=this.transport.scheduleOnce(this.invoke.bind(this),new Wp(this.context,this._nextTick).toSeconds()),this._nextTick+=this._interval,this._nextId=this.transport.scheduleOnce(this.invoke.bind(this),new Wp(this.context,this._nextTick).toSeconds())}dispose(){return super.dispose(),this.transport.clear(this._currentId),this.transport.clear(this._nextId),this.transport.off("start",this._boundRestart),this.transport.off("loopStart",this._boundRestart),this}}class Jp extends Sp{constructor(){super(Hh(Jp.getDefaults(),arguments)),this.name="Transport",this._loop=new $p(!1),this._loopStart=0,this._loopEnd=0,this._scheduledEvents={},this._timeline=new Jh,this._repeatedEvents=new Gp,this._syncedSignals=[],this._swingAmount=0;const t=Hh(Jp.getDefaults(),arguments);this._ppq=t.ppq,this._clock=new jp({callback:this._processTick.bind(this),context:this.context,frequency:0,units:"bpm"}),this._bindClockEvents(),this.bpm=this._clock.frequency,this._clock.frequency.multiplier=t.ppq,this.bpm.setValueAtTime(t.bpm,0),ap(this,"bpm"),this._timeSignature=t.timeSignature,this._swingTicks=t.ppq/2}static getDefaults(){return Object.assign(Sp.getDefaults(),{bpm:120,loopEnd:"4m",loopStart:0,ppq:192,swing:0,swingSubdivision:"8n",timeSignature:4})}_processTick(t,e){if(this._loop.get(t)&&e>=this._loopEnd&&(this.emit("loopEnd",t),this._clock.setTicksAtTime(this._loopStart,t),e=this._loopStart,this.emit("loopStart",t,this._clock.getSecondsAtTime(t)),this.emit("loop",t)),this._swingAmount>0&&e%this._ppq!=0&&e%(2*this._swingTicks)!=0){const n=e%(2*this._swingTicks)/(2*this._swingTicks),i=Math.sin(n*Math.PI)*this._swingAmount;t+=new Wp(this.context,2*this._swingTicks/3).toSeconds()*i}this._timeline.forEachAtTime(e,(e=>e.invoke(t)))}schedule(t,e){const n=new Zp(this,{callback:t,time:new Ap(this.context,e).toTicks()});return this._addEvent(n,this._timeline)}scheduleRepeat(t,e,n,i=1/0){const s=new Qp(this,{callback:t,duration:new wp(this.context,i).toTicks(),interval:new wp(this.context,e).toTicks(),time:new Ap(this.context,n).toTicks()});return this._addEvent(s,this._repeatedEvents)}scheduleOnce(t,e){const n=new Zp(this,{callback:t,once:!0,time:new Ap(this.context,e).toTicks()});return this._addEvent(n,this._timeline)}clear(t){if(this._scheduledEvents.hasOwnProperty(t)){const e=this._scheduledEvents[t.toString()];e.timeline.remove(e.event),e.event.dispose(),delete this._scheduledEvents[t.toString()]}return this}_addEvent(t,e){return this._scheduledEvents[t.id.toString()]={event:t,timeline:e},e.add(t),t.id}cancel(t=0){const e=this.toTicks(t);return this._timeline.forEachFrom(e,(t=>this.clear(t.id))),this._repeatedEvents.forEachFrom(e,(t=>this.clear(t.id))),this}_bindClockEvents(){this._clock.on("start",((t,e)=>{e=new Wp(this.context,e).toSeconds(),this.emit("start",t,e)})),this._clock.on("stop",(t=>{this.emit("stop",t)})),this._clock.on("pause",(t=>{this.emit("pause",t)}))}get state(){return this._clock.getStateAtTime(this.now())}start(t,e){let n;return Ph(e)&&(n=this.toTicks(e)),this._clock.start(t,n),this}stop(t){return this._clock.stop(t),this}pause(t){return this._clock.pause(t),this}toggle(t){return t=this.toSeconds(t),"started"!==this._clock.getStateAtTime(t)?this.start(t):this.stop(t),this}get timeSignature(){return this._timeSignature}set timeSignature(t){Dh(t)&&(t=t[0]/t[1]*4),this._timeSignature=t}get loopStart(){return new wp(this.context,this._loopStart,"i").toSeconds()}set loopStart(t){this._loopStart=this.toTicks(t)}get loopEnd(){return new wp(this.context,this._loopEnd,"i").toSeconds()}set loopEnd(t){this._loopEnd=this.toTicks(t)}get loop(){return this._loop.get(this.now())}set loop(t){this._loop.set(t,this.now())}setLoopPoints(t,e){return this.loopStart=t,this.loopEnd=e,this}get swing(){return this._swingAmount}set swing(t){this._swingAmount=t}get swingSubdivision(){return new Wp(this.context,this._swingTicks).toNotation()}set swingSubdivision(t){this._swingTicks=this.toTicks(t)}get position(){const t=this.now(),e=this._clock.getTicksAtTime(t);return new Wp(this.context,e).toBarsBeatsSixteenths()}set position(t){const e=this.toTicks(t);this.ticks=e}get seconds(){return this._clock.seconds}set seconds(t){const e=this.now(),n=this._clock.frequency.timeToTicks(t,e);this.ticks=n}get progress(){if(this.loop){const t=this.now();return(this._clock.getTicksAtTime(t)-this._loopStart)/(this._loopEnd-this._loopStart)}return 0}get ticks(){return this._clock.ticks}set ticks(t){if(this._clock.ticks!==t){const e=this.now();if("started"===this.state){const n=this._clock.getTicksAtTime(e),i=e+this._clock.frequency.getDurationOfTicks(Math.ceil(n)-n,e);this.emit("stop",i),this._clock.setTicksAtTime(t,i),this.emit("start",i,this._clock.getSecondsAtTime(i))}else this._clock.setTicksAtTime(t,e)}}getTicksAtTime(t){return Math.round(this._clock.getTicksAtTime(t))}getSecondsAtTime(t){return this._clock.getSecondsAtTime(t)}get PPQ(){return this._clock.frequency.multiplier}set PPQ(t){this._clock.frequency.multiplier=t}nextSubdivision(t){if(t=this.toTicks(t),"started"!==this.state)return 0;{const e=this.now(),n=t-this.getTicksAtTime(e)%t;return this._clock.nextTickTime(n,e)}}syncSignal(t,e){if(!e){const n=this.now();if(0!==t.getValueAtTime(n)){const i=1/(60/this.bpm.getValueAtTime(n)/this.PPQ);e=t.getValueAtTime(n)/i}else e=0}const n=new Ip(e);return this.bpm.connect(n),n.connect(t._param),this._syncedSignals.push({initial:t.value,ratio:n,signal:t}),t.value=0,this}unsyncSignal(t){for(let e=this._syncedSignals.length-1;e>=0;e--){const n=this._syncedSignals[e];n.signal===t&&(n.ratio.dispose(),n.signal.value=n.initial,this._syncedSignals.splice(e,1))}return this}dispose(){return super.dispose(),this._clock.dispose(),lp(this,"bpm"),this._timeline.dispose(),this._repeatedEvents.dispose(),this}}sp.mixin(Jp),ep((t=>{t.transport=new Jp({context:t})})),ip((t=>{t.transport.dispose()}));class td extends Pp{constructor(t){super(t),this.input=void 0,this._state=new kp("stopped"),this._synced=!1,this._scheduled=[],this._syncedStart=cp,this._syncedStop=cp,this._state.memory=100,this._state.increasing=!0,this._volume=this.output=new Yp({context:this.context,mute:t.mute,volume:t.volume}),this.volume=this._volume.volume,ap(this,"volume"),this.onstop=t.onstop}static getDefaults(){return Object.assign(Pp.getDefaults(),{mute:!1,onstop:cp,volume:0})}get state(){return this._synced?"started"===this.context.transport.state?this._state.getValueAtTime(this.context.transport.seconds):"stopped":this._state.getValueAtTime(this.now())}get mute(){return this._volume.mute}set mute(t){this._volume.mute=t}_clampToCurrentTime(t){return this._synced?t:Math.max(t,this.context.currentTime)}start(t,e,n){let i=Eh(t)&&this._synced?this.context.transport.seconds:this.toSeconds(t);if(i=this._clampToCurrentTime(i),this._synced||"started"!==this._state.getValueAtTime(i))if(this.log("start",i),this._state.setStateAtTime("started",i),this._synced){const t=this._state.get(i);t&&(t.offset=this.toSeconds(Gh(e,0)),t.duration=n?this.toSeconds(n):void 0);const s=this.context.transport.schedule((t=>{this._start(t,e,n)}),i);this._scheduled.push(s),"started"===this.context.transport.state&&this.context.transport.getSecondsAtTime(this.immediate())>i&&this._syncedStart(this.now(),this.context.transport.seconds)}else Ah(this.context),this._start(i,e,n);else Ch(Xh(i,this._state.get(i).time),"Start time must be strictly greater than previous start time"),this._state.cancel(i),this._state.setStateAtTime("started",i),this.log("restart",i),this.restart(i,e,n);return this}stop(t){let e=Eh(t)&&this._synced?this.context.transport.seconds:this.toSeconds(t);if(e=this._clampToCurrentTime(e),"started"===this._state.getValueAtTime(e)||Ph(this._state.getNextState("started",e))){if(this.log("stop",e),this._synced){const t=this.context.transport.schedule(this._stop.bind(this),e);this._scheduled.push(t)}else this._stop(e);this._state.cancel(e),this._state.setStateAtTime("stopped",e)}return this}restart(t,e,n){return t=this.toSeconds(t),"started"===this._state.getValueAtTime(t)&&(this._state.cancel(t),this._restart(t,e,n)),this}sync(){return this._synced||(this._synced=!0,this._syncedStart=(t,e)=>{if(e>0){const n=this._state.get(e);if(n&&"started"===n.state&&n.time!==e){const i=e-this.toSeconds(n.time);let s;n.duration&&(s=this.toSeconds(n.duration)-i),this._start(t,this.toSeconds(n.offset)+i,s)}}},this._syncedStop=t=>{const e=this.context.transport.getSecondsAtTime(Math.max(t-this.sampleTime,0));"started"===this._state.getValueAtTime(e)&&this._stop(t)},this.context.transport.on("start",this._syncedStart),this.context.transport.on("loopStart",this._syncedStart),this.context.transport.on("stop",this._syncedStop),this.context.transport.on("pause",this._syncedStop),this.context.transport.on("loopEnd",this._syncedStop)),this}unsync(){return this._synced&&(this.context.transport.off("stop",this._syncedStop),this.context.transport.off("pause",this._syncedStop),this.context.transport.off("loopEnd",this._syncedStop),this.context.transport.off("start",this._syncedStart),this.context.transport.off("loopStart",this._syncedStart)),this._synced=!1,this._scheduled.forEach((t=>this.context.transport.clear(t))),this._scheduled=[],this._state.cancel(0),this._stop(0),this}dispose(){return super.dispose(),this.onstop=cp,this.unsync(),this._volume.dispose(),this._state.dispose(),this}}class ed extends Vp{constructor(){super(Hh(ed.getDefaults(),arguments,["url","onload"])),this.name="ToneBufferSource",this._source=this.context.createBufferSource(),this._internalChannels=[this._source],this._sourceStarted=!1,this._sourceStopped=!1;const t=Hh(ed.getDefaults(),arguments,["url","onload"]);Op(this._source,this._gainNode),this._source.onended=()=>this._stopSource(),this.playbackRate=new Ep({context:this.context,param:this._source.playbackRate,units:"positive",value:t.playbackRate}),this.loop=t.loop,this.loopStart=t.loopStart,this.loopEnd=t.loopEnd,this._buffer=new up(t.url,t.onload,t.onerror),this._internalChannels.push(this._source)}static getDefaults(){return Object.assign(Vp.getDefaults(),{url:new up,loop:!1,loopEnd:0,loopStart:0,onload:cp,onerror:cp,playbackRate:1})}get fadeIn(){return this._fadeIn}set fadeIn(t){this._fadeIn=t}get fadeOut(){return this._fadeOut}set fadeOut(t){this._fadeOut=t}get curve(){return this._curve}set curve(t){this._curve=t}start(t,e,n,i=1){Ch(this.buffer.loaded,"buffer is either not set or not loaded");const s=this.toSeconds(t);this._startGain(s,i),e=this.loop?Gh(e,this.loopStart):Gh(e,0);let r=Math.max(this.toSeconds(e),0);if(this.loop){const t=this.toSeconds(this.loopEnd)||this.buffer.duration,e=this.toSeconds(this.loopStart),n=t-e;$h(r,t)&&(r=(r-e)%n+e),Qh(r,this.buffer.duration)&&(r=0)}if(this._source.buffer=this.buffer.get(),this._source.loopEnd=this.toSeconds(this.loopEnd)||this.buffer.duration,Zh(r,this.buffer.duration)&&(this._sourceStarted=!0,this._source.start(s,r)),Ph(n)){let t=this.toSeconds(n);t=Math.max(t,0),this.stop(s+t)}return this}_stopSource(t){!this._sourceStopped&&this._sourceStarted&&(this._sourceStopped=!0,this._source.stop(this.toSeconds(t)),this._onended())}get loopStart(){return this._source.loopStart}set loopStart(t){this._source.loopStart=this.toSeconds(t)}get loopEnd(){return this._source.loopEnd}set loopEnd(t){this._source.loopEnd=this.toSeconds(t)}get buffer(){return this._buffer}set buffer(t){this._buffer.set(t)}get loop(){return this._source.loop}set loop(t){this._source.loop=t,this._sourceStarted&&this.cancelStop()}dispose(){return super.dispose(),this._source.onended=null,this._source.disconnect(),this._buffer.dispose(),this.playbackRate.dispose(),this}}class nd extends td{constructor(){super(Hh(nd.getDefaults(),arguments,["type"])),this.name="Noise",this._source=null;const t=Hh(nd.getDefaults(),arguments,["type"]);this._playbackRate=t.playbackRate,this.type=t.type,this._fadeIn=t.fadeIn,this._fadeOut=t.fadeOut}static getDefaults(){return Object.assign(td.getDefaults(),{fadeIn:0,fadeOut:0,playbackRate:1,type:"white"})}get type(){return this._type}set type(t){if(Ch(t in sd,"Noise: invalid type: "+t),this._type!==t&&(this._type=t,"started"===this.state)){const t=this.now();this._stop(t),this._start(t)}}get playbackRate(){return this._playbackRate}set playbackRate(t){this._playbackRate=t,this._source&&(this._source.playbackRate.value=t)}_start(t){const e=sd[this._type];this._source=new ed({url:e,context:this.context,fadeIn:this._fadeIn,fadeOut:this._fadeOut,loop:!0,onended:()=>this.onstop(this),playbackRate:this._playbackRate}).connect(this.output),this._source.start(this.toSeconds(t),Math.random()*(e.duration-.001))}_stop(t){this._source&&(this._source.stop(this.toSeconds(t)),this._source=null)}get fadeIn(){return this._fadeIn}set fadeIn(t){this._fadeIn=t,this._source&&(this._source.fadeIn=this._fadeIn)}get fadeOut(){return this._fadeOut}set fadeOut(t){this._fadeOut=t,this._source&&(this._source.fadeOut=this._fadeOut)}_restart(t){this._stop(t),this._start(t)}dispose(){return super.dispose(),this._source&&this._source.disconnect(),this}}const id={brown:null,pink:null,white:null},sd={get brown(){if(!id.brown){const t=[];for(let e=0;e<2;e++){const n=new Float32Array(220500);t[e]=n;let i=0;for(let t=0;t<220500;t++){const e=2*Math.random()-1;n[t]=(i+.02*e)/1.02,i=n[t],n[t]*=3.5}}id.brown=(new up).fromArray(t)}return id.brown},get pink(){if(!id.pink){const t=[];for(let e=0;e<2;e++){const n=new Float32Array(220500);let i,s,r,o,a,l,c;t[e]=n,i=s=r=o=a=l=c=0;for(let t=0;t<220500;t++){const e=2*Math.random()-1;i=.99886*i+.0555179*e,s=.99332*s+.0750759*e,r=.969*r+.153852*e,o=.8665*o+.3104856*e,a=.55*a+.5329522*e,l=-.7616*l-.016898*e,n[t]=i+s+r+o+a+l+c+.5362*e,n[t]*=.11,c=.115926*e}}id.pink=(new up).fromArray(t)}return id.pink},get white(){if(!id.white){const t=[];for(let e=0;e<2;e++){const n=new Float32Array(220500);t[e]=n;for(let t=0;t<220500;t++)n[t]=2*Math.random()-1}id.white=(new up).fromArray(t)}return id.white}};function rd(t,e){return W(this,void 0,void 0,(function*(){const n=e/t.context.sampleRate,i=new hp(1,n,t.context.sampleRate);new t.constructor(Object.assign(t.get(),{frequency:2/n,detune:0,context:i})).toDestination().start(0);return(yield i.render()).getChannelData(0)}))}class od extends Vp{constructor(){super(Hh(od.getDefaults(),arguments,["frequency","type"])),this.name="ToneOscillatorNode",this._oscillator=this.context.createOscillator(),this._internalChannels=[this._oscillator];const t=Hh(od.getDefaults(),arguments,["frequency","type"]);Op(this._oscillator,this._gainNode),this.type=t.type,this.frequency=new Ep({context:this.context,param:this._oscillator.frequency,units:"frequency",value:t.frequency}),this.detune=new Ep({context:this.context,param:this._oscillator.detune,units:"cents",value:t.detune}),ap(this,["frequency","detune"])}static getDefaults(){return Object.assign(Vp.getDefaults(),{detune:0,frequency:440,type:"sine"})}start(t){const e=this.toSeconds(t);return this.log("start",e),this._startGain(e),this._oscillator.start(e),this}_stopSource(t){this._oscillator.stop(t)}setPeriodicWave(t){return this._oscillator.setPeriodicWave(t),this}get type(){return this._oscillator.type}set type(t){this._oscillator.type=t}dispose(){return super.dispose(),"started"===this.state&&this.stop(),this._oscillator.disconnect(),this.frequency.dispose(),this.detune.dispose(),this}}class ad extends td{constructor(){super(Hh(ad.getDefaults(),arguments,["frequency","type"])),this.name="Oscillator",this._oscillator=null;const t=Hh(ad.getDefaults(),arguments,["frequency","type"]);this.frequency=new Fp({context:this.context,units:"frequency",value:t.frequency}),ap(this,"frequency"),this.detune=new Fp({context:this.context,units:"cents",value:t.detune}),ap(this,"detune"),this._partials=t.partials,this._partialCount=t.partialCount,this._type=t.type,t.partialCount&&"custom"!==t.type&&(this._type=this.baseType+t.partialCount.toString()),this.phase=t.phase}static getDefaults(){return Object.assign(td.getDefaults(),{detune:0,frequency:440,partialCount:0,partials:[],phase:0,type:"sine"})}_start(t){const e=this.toSeconds(t),n=new od({context:this.context,onended:()=>this.onstop(this)});this._oscillator=n,this._wave?this._oscillator.setPeriodicWave(this._wave):this._oscillator.type=this._type,this._oscillator.connect(this.output),this.frequency.connect(this._oscillator.frequency),this.detune.connect(this._oscillator.detune),this._oscillator.start(e)}_stop(t){const e=this.toSeconds(t);this._oscillator&&this._oscillator.stop(e)}_restart(t){const e=this.toSeconds(t);return this.log("restart",e),this._oscillator&&this._oscillator.cancelStop(),this._state.cancel(e),this}syncFrequency(){return this.context.transport.syncSignal(this.frequency),this}unsyncFrequency(){return this.context.transport.unsyncSignal(this.frequency),this}_getCachedPeriodicWave(){if("custom"===this._type){return ad._periodicWaveCache.find((t=>{return t.phase===this._phase&&(e=t.partials,n=this._partials,e.length===n.length&&e.every(((t,e)=>n[e]===t)));var e,n}))}{const t=ad._periodicWaveCache.find((t=>t.type===this._type&&t.phase===this._phase));return this._partialCount=t?t.partialCount:this._partialCount,t}}get type(){return this._type}set type(t){this._type=t;const e=-1!==["sine","square","sawtooth","triangle"].indexOf(t);if(0===this._phase&&e)this._wave=void 0,this._partialCount=0,null!==this._oscillator&&(this._oscillator.type=t);else{const e=this._getCachedPeriodicWave();if(Ph(e)){const{partials:t,wave:n}=e;this._wave=n,this._partials=t,null!==this._oscillator&&this._oscillator.setPeriodicWave(this._wave)}else{const[e,n]=this._getRealImaginary(t,this._phase),i=this.context.createPeriodicWave(e,n);this._wave=i,null!==this._oscillator&&this._oscillator.setPeriodicWave(this._wave),ad._periodicWaveCache.push({imag:n,partialCount:this._partialCount,partials:this._partials,phase:this._phase,real:e,type:this._type,wave:this._wave}),ad._periodicWaveCache.length>100&&ad._periodicWaveCache.shift()}}}get baseType(){return this._type.replace(this.partialCount.toString(),"")}set baseType(t){this.partialCount&&"custom"!==this._type&&"custom"!==t?this.type=t+this.partialCount:this.type=t}get partialCount(){return this._partialCount}set partialCount(t){Th(t,0);let e=this._type;const n=/^(sine|triangle|square|sawtooth)(\d+)$/.exec(this._type);if(n&&(e=n[1]),"custom"!==this._type)this.type=0===t?e:e+t.toString();else{const e=new Float32Array(t);this._partials.forEach(((t,n)=>e[n]=t)),this._partials=Array.from(e),this.type=this._type}}_getRealImaginary(t,e){let n=2048;const i=new Float32Array(n),s=new Float32Array(n);let r=1;if("custom"===t){if(r=this._partials.length+1,this._partialCount=this._partials.length,n=r,0===this._partials.length)return[i,s]}else{const e=/^(sine|triangle|square|sawtooth)(\d+)$/.exec(t);e?(r=parseInt(e[2],10)+1,this._partialCount=parseInt(e[2],10),t=e[1],r=Math.max(r,2),n=r):this._partialCount=0,this._partials=[]}for(let o=1;o<n;++o){const n=2/(o*Math.PI);let a;switch(t){case"sine":a=o<=r?1:0,this._partials[o-1]=a;break;case"square":a=1&o?2*n:0,this._partials[o-1]=a;break;case"sawtooth":a=n*(1&o?1:-1),this._partials[o-1]=a;break;case"triangle":a=1&o?n*n*2*(o-1>>1&1?-1:1):0,this._partials[o-1]=a;break;case"custom":a=this._partials[o-1];break;default:throw new TypeError("Oscillator: invalid type: "+t)}0!==a?(i[o]=-a*Math.sin(e*o),s[o]=a*Math.cos(e*o)):(i[o]=0,s[o]=0)}return[i,s]}_inverseFFT(t,e,n){let i=0;const s=t.length;for(let r=0;r<s;r++)i+=t[r]*Math.cos(r*n)+e[r]*Math.sin(r*n);return i}getInitialValue(){const[t,e]=this._getRealImaginary(this._type,0);let n=0;const i=2*Math.PI;for(let a=0;a<32;a++)n=Math.max(this._inverseFFT(t,e,a/32*i),n);return s=-this._inverseFFT(t,e,this._phase)/n,r=-1,o=1,Math.max(Math.min(s,o),r);var s,r,o}get partials(){return this._partials.slice(0,this.partialCount)}set partials(t){this._partials=t,this._partialCount=this._partials.length,t.length&&(this.type="custom")}get phase(){return this._phase*(180/Math.PI)}set phase(t){this._phase=t*Math.PI/180,this.type=this._type}asArray(t=1024){return W(this,void 0,void 0,(function*(){return rd(this,t)}))}dispose(){return super.dispose(),null!==this._oscillator&&this._oscillator.dispose(),this._wave=void 0,this.frequency.dispose(),this.detune.dispose(),this}}ad._periodicWaveCache=[];class ld extends Pp{constructor(){super(Object.assign(Hh(ld.getDefaults(),arguments,["context"])))}connect(t,e=0,n=0){return Lp(this,t,e,n),this}}class cd extends ld{constructor(){super(Object.assign(Hh(cd.getDefaults(),arguments,["mapping","length"]))),this.name="WaveShaper",this._shaper=this.context.createWaveShaper(),this.input=this._shaper,this.output=this._shaper;const t=Hh(cd.getDefaults(),arguments,["mapping","length"]);Dh(t.mapping)||t.mapping instanceof Float32Array?this.curve=Float32Array.from(t.mapping):"function"==typeof t.mapping&&this.setMap(t.mapping,t.length)}static getDefaults(){return Object.assign(Fp.getDefaults(),{length:1024})}setMap(t,e=1024){const n=new Float32Array(e);for(let i=0,s=e;i<s;i++){const e=i/(s-1)*2-1;n[i]=t(e,i)}return this.curve=n,this}get curve(){return this._shaper.curve}set curve(t){this._shaper.curve=t}get oversample(){return this._shaper.oversample}set oversample(t){Ch(["none","2x","4x"].some((e=>e.includes(t))),"oversampling must be either 'none', '2x', or '4x'"),this._shaper.oversample=t}dispose(){return super.dispose(),this._shaper.disconnect(),this}}class ud extends ld{constructor(){super(...arguments),this.name="AudioToGain",this._norm=new cd({context:this.context,mapping:t=>(t+1)/2}),this.input=this._norm,this.output=this._norm}dispose(){return super.dispose(),this._norm.dispose(),this}}class hd extends Fp{constructor(){super(Object.assign(Hh(hd.getDefaults(),arguments,["value"]))),this.name="Multiply",this.override=!1;const t=Hh(hd.getDefaults(),arguments,["value"]);this._mult=this.input=this.output=new Ip({context:this.context,minValue:t.minValue,maxValue:t.maxValue}),this.factor=this._param=this._mult.gain,this.factor.setValueAtTime(t.value,0)}static getDefaults(){return Object.assign(Fp.getDefaults(),{value:0})}dispose(){return super.dispose(),this._mult.dispose(),this}}class pd extends td{constructor(){super(Hh(pd.getDefaults(),arguments,["frequency","type","modulationType"])),this.name="AMOscillator",this._modulationScale=new ud({context:this.context}),this._modulationNode=new Ip({context:this.context});const t=Hh(pd.getDefaults(),arguments,["frequency","type","modulationType"]);this._carrier=new ad({context:this.context,detune:t.detune,frequency:t.frequency,onstop:()=>this.onstop(this),phase:t.phase,type:t.type}),this.frequency=this._carrier.frequency,this.detune=this._carrier.detune,this._modulator=new ad({context:this.context,phase:t.phase,type:t.modulationType}),this.harmonicity=new hd({context:this.context,units:"positive",value:t.harmonicity}),this.frequency.chain(this.harmonicity,this._modulator.frequency),this._modulator.chain(this._modulationScale,this._modulationNode.gain),this._carrier.chain(this._modulationNode,this.output),ap(this,["frequency","detune","harmonicity"])}static getDefaults(){return Object.assign(ad.getDefaults(),{harmonicity:1,modulationType:"square"})}_start(t){this._modulator.start(t),this._carrier.start(t)}_stop(t){this._modulator.stop(t),this._carrier.stop(t)}_restart(t){this._modulator.restart(t),this._carrier.restart(t)}get type(){return this._carrier.type}set type(t){this._carrier.type=t}get baseType(){return this._carrier.baseType}set baseType(t){this._carrier.baseType=t}get partialCount(){return this._carrier.partialCount}set partialCount(t){this._carrier.partialCount=t}get modulationType(){return this._modulator.type}set modulationType(t){this._modulator.type=t}get phase(){return this._carrier.phase}set phase(t){this._carrier.phase=t,this._modulator.phase=t}get partials(){return this._carrier.partials}set partials(t){this._carrier.partials=t}asArray(t=1024){return W(this,void 0,void 0,(function*(){return rd(this,t)}))}dispose(){return super.dispose(),this.frequency.dispose(),this.detune.dispose(),this.harmonicity.dispose(),this._carrier.dispose(),this._modulator.dispose(),this._modulationNode.dispose(),this._modulationScale.dispose(),this}}class dd extends td{constructor(){super(Hh(dd.getDefaults(),arguments,["frequency","type","modulationType"])),this.name="FMOscillator",this._modulationNode=new Ip({context:this.context,gain:0});const t=Hh(dd.getDefaults(),arguments,["frequency","type","modulationType"]);this._carrier=new ad({context:this.context,detune:t.detune,frequency:0,onstop:()=>this.onstop(this),phase:t.phase,type:t.type}),this.detune=this._carrier.detune,this.frequency=new Fp({context:this.context,units:"frequency",value:t.frequency}),this._modulator=new ad({context:this.context,phase:t.phase,type:t.modulationType}),this.harmonicity=new hd({context:this.context,units:"positive",value:t.harmonicity}),this.modulationIndex=new hd({context:this.context,units:"positive",value:t.modulationIndex}),this.frequency.connect(this._carrier.frequency),this.frequency.chain(this.harmonicity,this._modulator.frequency),this.frequency.chain(this.modulationIndex,this._modulationNode),this._modulator.connect(this._modulationNode.gain),this._modulationNode.connect(this._carrier.frequency),this._carrier.connect(this.output),this.detune.connect(this._modulator.detune),ap(this,["modulationIndex","frequency","detune","harmonicity"])}static getDefaults(){return Object.assign(ad.getDefaults(),{harmonicity:1,modulationIndex:2,modulationType:"square"})}_start(t){this._modulator.start(t),this._carrier.start(t)}_stop(t){this._modulator.stop(t),this._carrier.stop(t)}_restart(t){return this._modulator.restart(t),this._carrier.restart(t),this}get type(){return this._carrier.type}set type(t){this._carrier.type=t}get baseType(){return this._carrier.baseType}set baseType(t){this._carrier.baseType=t}get partialCount(){return this._carrier.partialCount}set partialCount(t){this._carrier.partialCount=t}get modulationType(){return this._modulator.type}set modulationType(t){this._modulator.type=t}get phase(){return this._carrier.phase}set phase(t){this._carrier.phase=t,this._modulator.phase=t}get partials(){return this._carrier.partials}set partials(t){this._carrier.partials=t}asArray(t=1024){return W(this,void 0,void 0,(function*(){return rd(this,t)}))}dispose(){return super.dispose(),this.frequency.dispose(),this.harmonicity.dispose(),this._carrier.dispose(),this._modulator.dispose(),this._modulationNode.dispose(),this.modulationIndex.dispose(),this}}class fd extends td{constructor(){super(Hh(fd.getDefaults(),arguments,["frequency","width"])),this.name="PulseOscillator",this._widthGate=new Ip({context:this.context,gain:0}),this._thresh=new cd({context:this.context,mapping:t=>t<=0?-1:1});const t=Hh(fd.getDefaults(),arguments,["frequency","width"]);this.width=new Fp({context:this.context,units:"audioRange",value:t.width}),this._triangle=new ad({context:this.context,detune:t.detune,frequency:t.frequency,onstop:()=>this.onstop(this),phase:t.phase,type:"triangle"}),this.frequency=this._triangle.frequency,this.detune=this._triangle.detune,this._triangle.chain(this._thresh,this.output),this.width.chain(this._widthGate,this._thresh),ap(this,["width","frequency","detune"])}static getDefaults(){return Object.assign(td.getDefaults(),{detune:0,frequency:440,phase:0,type:"pulse",width:.2})}_start(t){t=this.toSeconds(t),this._triangle.start(t),this._widthGate.gain.setValueAtTime(1,t)}_stop(t){t=this.toSeconds(t),this._triangle.stop(t),this._widthGate.gain.cancelScheduledValues(t),this._widthGate.gain.setValueAtTime(0,t)}_restart(t){this._triangle.restart(t),this._widthGate.gain.cancelScheduledValues(t),this._widthGate.gain.setValueAtTime(1,t)}get phase(){return this._triangle.phase}set phase(t){this._triangle.phase=t}get type(){return"pulse"}get baseType(){return"pulse"}get partials(){return[]}get partialCount(){return 0}set carrierType(t){this._triangle.type=t}asArray(t=1024){return W(this,void 0,void 0,(function*(){return rd(this,t)}))}dispose(){return super.dispose(),this._triangle.dispose(),this.width.dispose(),this._widthGate.dispose(),this._thresh.dispose(),this}}class md extends td{constructor(){super(Hh(md.getDefaults(),arguments,["frequency","type","spread"])),this.name="FatOscillator",this._oscillators=[];const t=Hh(md.getDefaults(),arguments,["frequency","type","spread"]);this.frequency=new Fp({context:this.context,units:"frequency",value:t.frequency}),this.detune=new Fp({context:this.context,units:"cents",value:t.detune}),this._spread=t.spread,this._type=t.type,this._phase=t.phase,this._partials=t.partials,this._partialCount=t.partialCount,this.count=t.count,ap(this,["frequency","detune"])}static getDefaults(){return Object.assign(ad.getDefaults(),{count:3,spread:20,type:"sawtooth"})}_start(t){t=this.toSeconds(t),this._forEach((e=>e.start(t)))}_stop(t){t=this.toSeconds(t),this._forEach((e=>e.stop(t)))}_restart(t){this._forEach((e=>e.restart(t)))}_forEach(t){for(let e=0;e<this._oscillators.length;e++)t(this._oscillators[e],e)}get type(){return this._type}set type(t){this._type=t,this._forEach((e=>e.type=t))}get spread(){return this._spread}set spread(t){if(this._spread=t,this._oscillators.length>1){const e=-t/2,n=t/(this._oscillators.length-1);this._forEach(((t,i)=>t.detune.value=e+n*i))}}get count(){return this._oscillators.length}set count(t){if(Th(t,1),this._oscillators.length!==t){this._forEach((t=>t.dispose())),this._oscillators=[];for(let e=0;e<t;e++){const n=new ad({context:this.context,volume:-6-1.1*t,type:this._type,phase:this._phase+e/t*360,partialCount:this._partialCount,onstop:0===e?()=>this.onstop(this):cp});"custom"===this.type&&(n.partials=this._partials),this.frequency.connect(n.frequency),this.detune.connect(n.detune),n.detune.overridden=!1,n.connect(this.output),this._oscillators[e]=n}this.spread=this._spread,"started"===this.state&&this._forEach((t=>t.start()))}}get phase(){return this._phase}set phase(t){this._phase=t,this._forEach(((t,e)=>t.phase=this._phase+e/this.count*360))}get baseType(){return this._oscillators[0].baseType}set baseType(t){this._forEach((e=>e.baseType=t)),this._type=this._oscillators[0].type}get partials(){return this._oscillators[0].partials}set partials(t){this._partials=t,this._partialCount=this._partials.length,t.length&&(this._type="custom",this._forEach((e=>e.partials=t)))}get partialCount(){return this._oscillators[0].partialCount}set partialCount(t){this._partialCount=t,this._forEach((e=>e.partialCount=t)),this._type=this._oscillators[0].type}asArray(t=1024){return W(this,void 0,void 0,(function*(){return rd(this,t)}))}dispose(){return super.dispose(),this.frequency.dispose(),this.detune.dispose(),this._forEach((t=>t.dispose())),this}}class vd extends td{constructor(){super(Hh(vd.getDefaults(),arguments,["frequency","modulationFrequency"])),this.name="PWMOscillator",this.sourceType="pwm",this._scale=new hd({context:this.context,value:2});const t=Hh(vd.getDefaults(),arguments,["frequency","modulationFrequency"]);this._pulse=new fd({context:this.context,frequency:t.modulationFrequency}),this._pulse.carrierType="sine",this.modulationFrequency=this._pulse.frequency,this._modulator=new ad({context:this.context,detune:t.detune,frequency:t.frequency,onstop:()=>this.onstop(this),phase:t.phase}),this.frequency=this._modulator.frequency,this.detune=this._modulator.detune,this._modulator.chain(this._scale,this._pulse.width),this._pulse.connect(this.output),ap(this,["modulationFrequency","frequency","detune"])}static getDefaults(){return Object.assign(td.getDefaults(),{detune:0,frequency:440,modulationFrequency:.4,phase:0,type:"pwm"})}_start(t){t=this.toSeconds(t),this._modulator.start(t),this._pulse.start(t)}_stop(t){t=this.toSeconds(t),this._modulator.stop(t),this._pulse.stop(t)}_restart(t){this._modulator.restart(t),this._pulse.restart(t)}get type(){return"pwm"}get baseType(){return"pwm"}get partials(){return[]}get partialCount(){return 0}get phase(){return this._modulator.phase}set phase(t){this._modulator.phase=t}asArray(t=1024){return W(this,void 0,void 0,(function*(){return rd(this,t)}))}dispose(){return super.dispose(),this._pulse.dispose(),this._scale.dispose(),this._modulator.dispose(),this}}const _d={am:pd,fat:md,fm:dd,oscillator:ad,pulse:fd,pwm:vd};class gd extends td{constructor(){super(Hh(gd.getDefaults(),arguments,["frequency","type"])),this.name="OmniOscillator";const t=Hh(gd.getDefaults(),arguments,["frequency","type"]);this.frequency=new Fp({context:this.context,units:"frequency",value:t.frequency}),this.detune=new Fp({context:this.context,units:"cents",value:t.detune}),ap(this,["frequency","detune"]),this.set(t)}static getDefaults(){return Object.assign(ad.getDefaults(),dd.getDefaults(),pd.getDefaults(),md.getDefaults(),fd.getDefaults(),vd.getDefaults())}_start(t){this._oscillator.start(t)}_stop(t){this._oscillator.stop(t)}_restart(t){return this._oscillator.restart(t),this}get type(){let t="";return["am","fm","fat"].some((t=>this._sourceType===t))&&(t=this._sourceType),t+this._oscillator.type}set type(t){"fm"===t.substr(0,2)?(this._createNewOscillator("fm"),this._oscillator=this._oscillator,this._oscillator.type=t.substr(2)):"am"===t.substr(0,2)?(this._createNewOscillator("am"),this._oscillator=this._oscillator,this._oscillator.type=t.substr(2)):"fat"===t.substr(0,3)?(this._createNewOscillator("fat"),this._oscillator=this._oscillator,this._oscillator.type=t.substr(3)):"pwm"===t?(this._createNewOscillator("pwm"),this._oscillator=this._oscillator):"pulse"===t?this._createNewOscillator("pulse"):(this._createNewOscillator("oscillator"),this._oscillator=this._oscillator,this._oscillator.type=t)}get partials(){return this._oscillator.partials}set partials(t){this._getOscType(this._oscillator,"pulse")||this._getOscType(this._oscillator,"pwm")||(this._oscillator.partials=t)}get partialCount(){return this._oscillator.partialCount}set partialCount(t){this._getOscType(this._oscillator,"pulse")||this._getOscType(this._oscillator,"pwm")||(this._oscillator.partialCount=t)}set(t){return Reflect.has(t,"type")&&t.type&&(this.type=t.type),super.set(t),this}_createNewOscillator(t){if(t!==this._sourceType){this._sourceType=t;const e=_d[t],n=this.now();if(this._oscillator){const t=this._oscillator;t.stop(n),this.context.setTimeout((()=>t.dispose()),this.blockTime)}this._oscillator=new e({context:this.context}),this.frequency.connect(this._oscillator.frequency),this.detune.connect(this._oscillator.detune),this._oscillator.connect(this.output),this._oscillator.onstop=()=>this.onstop(this),"started"===this.state&&this._oscillator.start(n)}}get phase(){return this._oscillator.phase}set phase(t){this._oscillator.phase=t}get sourceType(){return this._sourceType}set sourceType(t){let e="sine";"pwm"!==this._oscillator.type&&"pulse"!==this._oscillator.type&&(e=this._oscillator.type),"fm"===t?this.type="fm"+e:"am"===t?this.type="am"+e:"fat"===t?this.type="fat"+e:"oscillator"===t?this.type=e:"pulse"===t?this.type="pulse":"pwm"===t&&(this.type="pwm")}_getOscType(t,e){return t instanceof _d[e]}get baseType(){return this._oscillator.baseType}set baseType(t){this._getOscType(this._oscillator,"pulse")||this._getOscType(this._oscillator,"pwm")||"pulse"===t||"pwm"===t||(this._oscillator.baseType=t)}get width(){return this._getOscType(this._oscillator,"pulse")?this._oscillator.width:void 0}get count(){return this._getOscType(this._oscillator,"fat")?this._oscillator.count:void 0}set count(t){this._getOscType(this._oscillator,"fat")&&Mh(t)&&(this._oscillator.count=t)}get spread(){return this._getOscType(this._oscillator,"fat")?this._oscillator.spread:void 0}set spread(t){this._getOscType(this._oscillator,"fat")&&Mh(t)&&(this._oscillator.spread=t)}get modulationType(){return this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am")?this._oscillator.modulationType:void 0}set modulationType(t){(this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am"))&&Ih(t)&&(this._oscillator.modulationType=t)}get modulationIndex(){return this._getOscType(this._oscillator,"fm")?this._oscillator.modulationIndex:void 0}get harmonicity(){return this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am")?this._oscillator.harmonicity:void 0}get modulationFrequency(){return this._getOscType(this._oscillator,"pwm")?this._oscillator.modulationFrequency:void 0}asArray(t=1024){return W(this,void 0,void 0,(function*(){return rd(this,t)}))}dispose(){return super.dispose(),this.detune.dispose(),this.frequency.dispose(),this._oscillator.dispose(),this}}class bd extends Fp{constructor(){super(Object.assign(Hh(bd.getDefaults(),arguments,["value"]))),this.override=!1,this.name="Add",this._sum=new Ip({context:this.context}),this.input=this._sum,this.output=this._sum,this.addend=this._param,Mp(this._constantSource,this._sum)}static getDefaults(){return Object.assign(Fp.getDefaults(),{value:0})}dispose(){return super.dispose(),this._sum.dispose(),this}}class yd extends ld{constructor(){super(Object.assign(Hh(yd.getDefaults(),arguments,["min","max"]))),this.name="Scale";const t=Hh(yd.getDefaults(),arguments,["min","max"]);this._mult=this.input=new hd({context:this.context,value:t.max-t.min}),this._add=this.output=new bd({context:this.context,value:t.min}),this._min=t.min,this._max=t.max,this.input.connect(this.output)}static getDefaults(){return Object.assign(ld.getDefaults(),{max:1,min:0})}get min(){return this._min}set min(t){this._min=t,this._setRange()}get max(){return this._max}set max(t){this._max=t,this._setRange()}_setRange(){this._add.value=this._min,this._mult.value=this._max-this._min}dispose(){return super.dispose(),this._add.dispose(),this._mult.dispose(),this}}class wd extends ld{constructor(){super(Object.assign(Hh(wd.getDefaults(),arguments))),this.name="Zero",this._gain=new Ip({context:this.context}),this.output=this._gain,this.input=void 0,Op(this.context.getConstant(0),this._gain)}dispose(){return super.dispose(),Dp(this.context.getConstant(0),this._gain),this}}class xd extends Pp{constructor(){super(Hh(xd.getDefaults(),arguments,["frequency","min","max"])),this.name="LFO",this._stoppedValue=0,this._units="number",this.convert=!0,this._fromType=Ep.prototype._fromType,this._toType=Ep.prototype._toType,this._is=Ep.prototype._is,this._clampValue=Ep.prototype._clampValue;const t=Hh(xd.getDefaults(),arguments,["frequency","min","max"]);this._oscillator=new ad(t),this.frequency=this._oscillator.frequency,this._amplitudeGain=new Ip({context:this.context,gain:t.amplitude,units:"normalRange"}),this.amplitude=this._amplitudeGain.gain,this._stoppedSignal=new Fp({context:this.context,units:"audioRange",value:0}),this._zeros=new wd({context:this.context}),this._a2g=new ud({context:this.context}),this._scaler=this.output=new yd({context:this.context,max:t.max,min:t.min}),this.units=t.units,this.min=t.min,this.max=t.max,this._oscillator.chain(this._amplitudeGain,this._a2g,this._scaler),this._zeros.connect(this._a2g),this._stoppedSignal.connect(this._a2g),ap(this,["amplitude","frequency"]),this.phase=t.phase}static getDefaults(){return Object.assign(ad.getDefaults(),{amplitude:1,frequency:"4n",max:1,min:0,type:"sine",units:"number"})}start(t){return t=this.toSeconds(t),this._stoppedSignal.setValueAtTime(0,t),this._oscillator.start(t),this}stop(t){return t=this.toSeconds(t),this._stoppedSignal.setValueAtTime(this._stoppedValue,t),this._oscillator.stop(t),this}sync(){return this._oscillator.sync(),this._oscillator.syncFrequency(),this}unsync(){return this._oscillator.unsync(),this._oscillator.unsyncFrequency(),this}_setStoppedValue(){this._stoppedValue=this._oscillator.getInitialValue(),this._stoppedSignal.value=this._stoppedValue}get min(){return this._toType(this._scaler.min)}set min(t){t=this._fromType(t),this._scaler.min=t}get max(){return this._toType(this._scaler.max)}set max(t){t=this._fromType(t),this._scaler.max=t}get type(){return this._oscillator.type}set type(t){this._oscillator.type=t,this._setStoppedValue()}get partials(){return this._oscillator.partials}set partials(t){this._oscillator.partials=t,this._setStoppedValue()}get phase(){return this._oscillator.phase}set phase(t){this._oscillator.phase=t,this._setStoppedValue()}get units(){return this._units}set units(t){const e=this.min,n=this.max;this._units=t,this.min=e,this.max=n}get state(){return this._oscillator.state}connect(t,e,n){return(t instanceof Ep||t instanceof Fp)&&(this.convert=t.convert,this.units=t.units),Lp(this,t,e,n),this}dispose(){return super.dispose(),this._oscillator.dispose(),this._stoppedSignal.dispose(),this._zeros.dispose(),this._scaler.dispose(),this._a2g.dispose(),this._amplitudeGain.dispose(),this.amplitude.dispose(),this}}function Cd(t,e=1/0){const n=new WeakMap;return function(i,s){Reflect.defineProperty(i,s,{configurable:!0,enumerable:!0,get:function(){return n.get(this)},set:function(i){Th(i,t,e),n.set(this,i)}})}}function Td(t,e=1/0){const n=new WeakMap;return function(i,s){Reflect.defineProperty(i,s,{configurable:!0,enumerable:!0,get:function(){return n.get(this)},set:function(i){Th(this.toSeconds(i),t,e),n.set(this,i)}})}}class Ad extends td{constructor(){super(Hh(Ad.getDefaults(),arguments,["url","onload"])),this.name="Player",this._activeSources=new Set;const t=Hh(Ad.getDefaults(),arguments,["url","onload"]);this._buffer=new up({onload:this._onload.bind(this,t.onload),onerror:t.onerror,reverse:t.reverse,url:t.url}),this.autostart=t.autostart,this._loop=t.loop,this._loopStart=t.loopStart,this._loopEnd=t.loopEnd,this._playbackRate=t.playbackRate,this.fadeIn=t.fadeIn,this.fadeOut=t.fadeOut}static getDefaults(){return Object.assign(td.getDefaults(),{autostart:!1,fadeIn:0,fadeOut:0,loop:!1,loopEnd:0,loopStart:0,onload:cp,onerror:cp,playbackRate:1,reverse:!1})}load(t){return W(this,void 0,void 0,(function*(){return yield this._buffer.load(t),this._onload(),this}))}_onload(t=cp){t(),this.autostart&&this.start()}_onSourceEnd(t){this.onstop(this),this._activeSources.delete(t),0!==this._activeSources.size||this._synced||"started"!==this._state.getValueAtTime(this.now())||(this._state.cancel(this.now()),this._state.setStateAtTime("stopped",this.now()))}start(t,e,n){return super.start(t,e,n),this}_start(t,e,n){e=this._loop?Gh(e,this._loopStart):Gh(e,0);const i=this.toSeconds(e),s=n;n=Gh(n,Math.max(this._buffer.duration-i,0));let r=this.toSeconds(n);r/=this._playbackRate,t=this.toSeconds(t);const o=new ed({url:this._buffer,context:this.context,fadeIn:this.fadeIn,fadeOut:this.fadeOut,loop:this._loop,loopEnd:this._loopEnd,loopStart:this._loopStart,onended:this._onSourceEnd.bind(this),playbackRate:this._playbackRate}).connect(this.output);this._loop||this._synced||(this._state.cancel(t+r),this._state.setStateAtTime("stopped",t+r,{implicitEnd:!0})),this._activeSources.add(o),this._loop&&Eh(s)?o.start(t,i):o.start(t,i,r-this.toSeconds(this.fadeOut))}_stop(t){const e=this.toSeconds(t);this._activeSources.forEach((t=>t.stop(e)))}restart(t,e,n){return super.restart(t,e,n),this}_restart(t,e,n){this._stop(t),this._start(t,e,n)}seek(t,e){const n=this.toSeconds(e);if("started"===this._state.getValueAtTime(n)){const e=this.toSeconds(t);this._stop(n),this._start(n,e)}return this}setLoopPoints(t,e){return this.loopStart=t,this.loopEnd=e,this}get loopStart(){return this._loopStart}set loopStart(t){this._loopStart=t,this.buffer.loaded&&Th(this.toSeconds(t),0,this.buffer.duration),this._activeSources.forEach((e=>{e.loopStart=t}))}get loopEnd(){return this._loopEnd}set loopEnd(t){this._loopEnd=t,this.buffer.loaded&&Th(this.toSeconds(t),0,this.buffer.duration),this._activeSources.forEach((e=>{e.loopEnd=t}))}get buffer(){return this._buffer}set buffer(t){this._buffer.set(t)}get loop(){return this._loop}set loop(t){if(this._loop!==t&&(this._loop=t,this._activeSources.forEach((e=>{e.loop=t})),t)){const t=this._state.getNextState("stopped",this.now());t&&this._state.cancel(t.time)}}get playbackRate(){return this._playbackRate}set playbackRate(t){this._playbackRate=t;const e=this.now(),n=this._state.getNextState("stopped",e);n&&n.implicitEnd&&(this._state.cancel(n.time),this._activeSources.forEach((t=>t.cancelStop()))),this._activeSources.forEach((n=>{n.playbackRate.setValueAtTime(t,e)}))}get reverse(){return this._buffer.reverse}set reverse(t){this._buffer.reverse=t}get loaded(){return this._buffer.loaded}dispose(){return super.dispose(),this._activeSources.forEach((t=>t.dispose())),this._activeSources.clear(),this._buffer.dispose(),this}}q([Td(0)],Ad.prototype,"fadeIn",void 0),q([Td(0)],Ad.prototype,"fadeOut",void 0);class Sd extends ld{constructor(){super(...arguments),this.name="GainToAudio",this._norm=new cd({context:this.context,mapping:t=>2*Math.abs(t)-1}),this.input=this._norm,this.output=this._norm}dispose(){return super.dispose(),this._norm.dispose(),this}}class kd extends Pp{constructor(){super(Hh(kd.getDefaults(),arguments,["attack","decay","sustain","release"])),this.name="Envelope",this._sig=new Fp({context:this.context,value:0}),this.output=this._sig,this.input=void 0;const t=Hh(kd.getDefaults(),arguments,["attack","decay","sustain","release"]);this.attack=t.attack,this.decay=t.decay,this.sustain=t.sustain,this.release=t.release,this.attackCurve=t.attackCurve,this.releaseCurve=t.releaseCurve,this.decayCurve=t.decayCurve}static getDefaults(){return Object.assign(Pp.getDefaults(),{attack:.01,attackCurve:"linear",decay:.1,decayCurve:"exponential",release:1,releaseCurve:"exponential",sustain:.5})}get value(){return this.getValueAtTime(this.now())}_getCurve(t,e){if(Ih(t))return t;{let n;for(n in Ed)if(Ed[n][e]===t)return n;return t}}_setCurve(t,e,n){if(Ih(n)&&Reflect.has(Ed,n)){const i=Ed[n];Oh(i)?"_decayCurve"!==t&&(this[t]=i[e]):this[t]=i}else{if(!Dh(n)||"_decayCurve"===t)throw new Error("Envelope: invalid curve: "+n);this[t]=n}}get attackCurve(){return this._getCurve(this._attackCurve,"In")}set attackCurve(t){this._setCurve("_attackCurve","In",t)}get releaseCurve(){return this._getCurve(this._releaseCurve,"Out")}set releaseCurve(t){this._setCurve("_releaseCurve","Out",t)}get decayCurve(){return this._decayCurve}set decayCurve(t){Ch(["linear","exponential"].some((e=>e===t)),`Invalid envelope curve: ${t}`),this._decayCurve=t}triggerAttack(t,e=1){this.log("triggerAttack",t,e),t=this.toSeconds(t);let n=this.toSeconds(this.attack);const i=this.toSeconds(this.decay),s=this.getValueAtTime(t);if(s>0){n=(1-s)/(1/n)}if(n<this.sampleTime)this._sig.cancelScheduledValues(t),this._sig.setValueAtTime(e,t);else if("linear"===this._attackCurve)this._sig.linearRampTo(e,n,t);else if("exponential"===this._attackCurve)this._sig.targetRampTo(e,n,t);else{this._sig.cancelAndHoldAtTime(t);let i=this._attackCurve;for(let t=1;t<i.length;t++)if(i[t-1]<=s&&s<=i[t]){i=this._attackCurve.slice(t),i[0]=s;break}this._sig.setValueCurveAtTime(i,t,n,e)}if(i&&this.sustain<1){const s=e*this.sustain,r=t+n;this.log("decay",r),"linear"===this._decayCurve?this._sig.linearRampToValueAtTime(s,i+r):this._sig.exponentialApproachValueAtTime(s,r,i)}return this}triggerRelease(t){this.log("triggerRelease",t),t=this.toSeconds(t);const e=this.getValueAtTime(t);if(e>0){const n=this.toSeconds(this.release);n<this.sampleTime?this._sig.setValueAtTime(0,t):"linear"===this._releaseCurve?this._sig.linearRampTo(0,n,t):"exponential"===this._releaseCurve?this._sig.targetRampTo(0,n,t):(Ch(Dh(this._releaseCurve),"releaseCurve must be either 'linear', 'exponential' or an array"),this._sig.cancelAndHoldAtTime(t),this._sig.setValueCurveAtTime(this._releaseCurve,t,n,e))}return this}getValueAtTime(t){return this._sig.getValueAtTime(t)}triggerAttackRelease(t,e,n=1){return e=this.toSeconds(e),this.triggerAttack(e,n),this.triggerRelease(e+this.toSeconds(t)),this}cancel(t){return this._sig.cancelScheduledValues(this.toSeconds(t)),this}connect(t,e=0,n=0){return Lp(this,t,e,n),this}asArray(t=1024){return W(this,void 0,void 0,(function*(){const e=t/this.context.sampleRate,n=new hp(1,e,this.context.sampleRate),i=this.toSeconds(this.attack)+this.toSeconds(this.decay),s=i+this.toSeconds(this.release),r=.1*s,o=s+r,a=new this.constructor(Object.assign(this.get(),{attack:e*this.toSeconds(this.attack)/o,decay:e*this.toSeconds(this.decay)/o,release:e*this.toSeconds(this.release)/o,context:n}));a._sig.toDestination(),a.triggerAttackRelease(e*(i+r)/o,0);return(yield n.render()).getChannelData(0)}))}dispose(){return super.dispose(),this._sig.dispose(),this}}q([Td(0)],kd.prototype,"attack",void 0),q([Td(0)],kd.prototype,"decay",void 0),q([Cd(0,1)],kd.prototype,"sustain",void 0),q([Td(0)],kd.prototype,"release",void 0);const Ed=(()=>{const t=128;let e,n;const i=[];for(e=0;e<t;e++)i[e]=Math.sin(e/127*(Math.PI/2));const s=[];for(e=0;e<127;e++){n=e/127;const t=Math.sin(n*(2*Math.PI)*6.4-Math.PI/2)+1;s[e]=t/10+.83*n}s[127]=1;const r=[];for(e=0;e<t;e++)r[e]=Math.ceil(e/127*5)/5;const o=[];for(e=0;e<t;e++)n=e/127,o[e]=.5*(1-Math.cos(Math.PI*n));const a=[];for(e=0;e<t;e++){n=e/127;const t=4*Math.pow(n,3)+.2,i=Math.cos(t*Math.PI*2*n);a[e]=Math.abs(i*(1-n))}function l(t){const e=new Array(t.length);for(let n=0;n<t.length;n++)e[n]=1-t[n];return e}return{bounce:{In:l(a),Out:a},cosine:{In:i,Out:(c=i,c.slice(0).reverse())},exponential:"exponential",linear:"linear",ripple:{In:s,Out:l(s)},sine:{In:o,Out:l(o)},step:{In:r,Out:l(r)}};var c})();class Pd extends Pp{constructor(){super(Hh(Pd.getDefaults(),arguments)),this._scheduledEvents=[],this._synced=!1,this._original_triggerAttack=this.triggerAttack,this._original_triggerRelease=this.triggerRelease;const t=Hh(Pd.getDefaults(),arguments);this._volume=this.output=new Yp({context:this.context,volume:t.volume}),this.volume=this._volume.volume,ap(this,"volume")}static getDefaults(){return Object.assign(Pp.getDefaults(),{volume:0})}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",0)),this}_syncState(){let t=!1;return this._synced||(this._synced=!0,t=!0),t}_syncMethod(t,e){const n=this["_original_"+t]=this[t];this[t]=(...t)=>{const i=t[e],s=this.context.transport.schedule((i=>{t[e]=i,n.apply(this,t)}),i);this._scheduledEvents.push(s)}}unsync(){return this._scheduledEvents.forEach((t=>this.context.transport.clear(t))),this._scheduledEvents=[],this._synced&&(this._synced=!1,this.triggerAttack=this._original_triggerAttack,this.triggerRelease=this._original_triggerRelease),this}triggerAttackRelease(t,e,n,i){const s=this.toSeconds(n),r=this.toSeconds(e);return this.triggerAttack(t,s,i),this.triggerRelease(s+r),this}dispose(){return super.dispose(),this._volume.dispose(),this.unsync(),this._scheduledEvents=[],this}}class Md extends Pd{constructor(){super(Hh(Md.getDefaults(),arguments));const t=Hh(Md.getDefaults(),arguments);this.portamento=t.portamento,this.onsilence=t.onsilence}static getDefaults(){return Object.assign(Pd.getDefaults(),{detune:0,onsilence:cp,portamento:0})}triggerAttack(t,e,n=1){this.log("triggerAttack",t,e,n);const i=this.toSeconds(e);return this._triggerEnvelopeAttack(i,n),this.setNote(t,i),this}triggerRelease(t){this.log("triggerRelease",t);const e=this.toSeconds(t);return this._triggerEnvelopeRelease(e),this}setNote(t,e){const n=this.toSeconds(e),i=t instanceof xp?t.toFrequency():t;if(this.portamento>0&&this.getLevelAtTime(n)>.05){const t=this.toSeconds(this.portamento);this.frequency.exponentialRampTo(i,t,n)}else this.frequency.setValueAtTime(i,n);return this}}q([Td(0)],Md.prototype,"portamento",void 0);class Od extends kd{constructor(){super(Hh(Od.getDefaults(),arguments,["attack","decay","sustain","release"])),this.name="AmplitudeEnvelope",this._gainNode=new Ip({context:this.context,gain:0}),this.output=this._gainNode,this.input=this._gainNode,this._sig.connect(this._gainNode.gain),this.output=this._gainNode,this.input=this._gainNode}dispose(){return super.dispose(),this._gainNode.dispose(),this}}class Dd extends Md{constructor(){super(Hh(Dd.getDefaults(),arguments)),this.name="Synth";const t=Hh(Dd.getDefaults(),arguments);this.oscillator=new gd(Object.assign({context:this.context,detune:t.detune,onstop:()=>this.onsilence(this)},t.oscillator)),this.frequency=this.oscillator.frequency,this.detune=this.oscillator.detune,this.envelope=new Od(Object.assign({context:this.context},t.envelope)),this.oscillator.chain(this.envelope,this.output),ap(this,["oscillator","frequency","detune","envelope"])}static getDefaults(){return Object.assign(Md.getDefaults(),{envelope:Object.assign(Kh(kd.getDefaults(),Object.keys(Pp.getDefaults())),{attack:.005,decay:.1,release:1,sustain:.3}),oscillator:Object.assign(Kh(gd.getDefaults(),[...Object.keys(td.getDefaults()),"frequency","detune"]),{type:"triangle"})})}_triggerEnvelopeAttack(t,e){if(this.envelope.triggerAttack(t,e),this.oscillator.start(t),0===this.envelope.sustain){const e=this.toSeconds(this.envelope.attack),n=this.toSeconds(this.envelope.decay);this.oscillator.stop(t+e+n)}}_triggerEnvelopeRelease(t){this.envelope.triggerRelease(t),this.oscillator.stop(t+this.toSeconds(this.envelope.release))}getLevelAtTime(t){return t=this.toSeconds(t),this.envelope.getValueAtTime(t)}dispose(){return super.dispose(),this.oscillator.dispose(),this.envelope.dispose(),this}}class Id extends Dd{constructor(){super(Hh(Id.getDefaults(),arguments)),this.name="MembraneSynth",this.portamento=0;const t=Hh(Id.getDefaults(),arguments);this.pitchDecay=t.pitchDecay,this.octaves=t.octaves,ap(this,["oscillator","envelope"])}static getDefaults(){return Wh(Md.getDefaults(),Dd.getDefaults(),{envelope:{attack:.001,attackCurve:"exponential",decay:.4,release:1.4,sustain:.01},octaves:10,oscillator:{type:"sine"},pitchDecay:.05})}setNote(t,e){const n=this.toSeconds(e),i=this.toFrequency(t instanceof xp?t.toFrequency():t),s=i*this.octaves;return this.oscillator.frequency.setValueAtTime(s,n),this.oscillator.frequency.exponentialRampToValueAtTime(i,n+this.toSeconds(this.pitchDecay)),this}dispose(){return super.dispose(),this}}q([Cd(0)],Id.prototype,"octaves",void 0),q([Td(0)],Id.prototype,"pitchDecay",void 0);const Vd=new Set;function Rd(t){Vd.add(t)}function Fd(t,e){const n=`registerProcessor("${t}", ${e})`;Vd.add(n)}Rd('\n\t/**\n\t * The base AudioWorkletProcessor for use in Tone.js. Works with the [[ToneAudioWorklet]]. \n\t */\n\tclass ToneAudioWorkletProcessor extends AudioWorkletProcessor {\n\n\t\tconstructor(options) {\n\t\t\t\n\t\t\tsuper(options);\n\t\t\t/**\n\t\t\t * If the processor was disposed or not. Keep alive until it\'s disposed.\n\t\t\t */\n\t\t\tthis.disposed = false;\n\t\t   \t/** \n\t\t\t * The number of samples in the processing block\n\t\t\t */\n\t\t\tthis.blockSize = 128;\n\t\t\t/**\n\t\t\t * the sample rate\n\t\t\t */\n\t\t\tthis.sampleRate = sampleRate;\n\n\t\t\tthis.port.onmessage = (event) => {\n\t\t\t\t// when it receives a dispose \n\t\t\t\tif (event.data === "dispose") {\n\t\t\t\t\tthis.disposed = true;\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\t}\n');Rd("\n\t/**\n\t * Abstract class for a single input/output processor. \n\t * has a 'generate' function which processes one sample at a time\n\t */\n\tclass SingleIOProcessor extends ToneAudioWorkletProcessor {\n\n\t\tconstructor(options) {\n\t\t\tsuper(Object.assign(options, {\n\t\t\t\tnumberOfInputs: 1,\n\t\t\t\tnumberOfOutputs: 1\n\t\t\t}));\n\t\t\t/**\n\t\t\t * Holds the name of the parameter and a single value of that\n\t\t\t * parameter at the current sample\n\t\t\t * @type { [name: string]: number }\n\t\t\t */\n\t\t\tthis.params = {}\n\t\t}\n\n\t\t/**\n\t\t * Generate an output sample from the input sample and parameters\n\t\t * @abstract\n\t\t * @param input number\n\t\t * @param channel number\n\t\t * @param parameters { [name: string]: number }\n\t\t * @returns number\n\t\t */\n\t\tgenerate(){}\n\n\t\t/**\n\t\t * Update the private params object with the \n\t\t * values of the parameters at the given index\n\t\t * @param parameters { [name: string]: Float32Array },\n\t\t * @param index number\n\t\t */\n\t\tupdateParams(parameters, index) {\n\t\t\tfor (const paramName in parameters) {\n\t\t\t\tconst param = parameters[paramName];\n\t\t\t\tif (param.length > 1) {\n\t\t\t\t\tthis.params[paramName] = parameters[paramName][index];\n\t\t\t\t} else {\n\t\t\t\t\tthis.params[paramName] = parameters[paramName][0];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Process a single frame of the audio\n\t\t * @param inputs Float32Array[][]\n\t\t * @param outputs Float32Array[][]\n\t\t */\n\t\tprocess(inputs, outputs, parameters) {\n\t\t\tconst input = inputs[0];\n\t\t\tconst output = outputs[0];\n\t\t\t// get the parameter values\n\t\t\tconst channelCount = Math.max(input && input.length || 0, output.length);\n\t\t\tfor (let sample = 0; sample < this.blockSize; sample++) {\n\t\t\t\tthis.updateParams(parameters, sample);\n\t\t\t\tfor (let channel = 0; channel < channelCount; channel++) {\n\t\t\t\t\tconst inputSample = input && input.length ? input[channel][sample] : 0;\n\t\t\t\t\toutput[channel][sample] = this.generate(inputSample, channel, this.params);\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn !this.disposed;\n\t\t}\n\t};\n");Rd("\n\t/**\n\t * A multichannel buffer for use within an AudioWorkletProcessor as a delay line\n\t */\n\tclass DelayLine {\n\t\t\n\t\tconstructor(size, channels) {\n\t\t\tthis.buffer = [];\n\t\t\tthis.writeHead = []\n\t\t\tthis.size = size;\n\n\t\t\t// create the empty channels\n\t\t\tfor (let i = 0; i < channels; i++) {\n\t\t\t\tthis.buffer[i] = new Float32Array(this.size);\n\t\t\t\tthis.writeHead[i] = 0;\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Push a value onto the end\n\t\t * @param channel number\n\t\t * @param value number\n\t\t */\n\t\tpush(channel, value) {\n\t\t\tthis.writeHead[channel] += 1;\n\t\t\tif (this.writeHead[channel] > this.size) {\n\t\t\t\tthis.writeHead[channel] = 0;\n\t\t\t}\n\t\t\tthis.buffer[channel][this.writeHead[channel]] = value;\n\t\t}\n\n\t\t/**\n\t\t * Get the recorded value of the channel given the delay\n\t\t * @param channel number\n\t\t * @param delay number delay samples\n\t\t */\n\t\tget(channel, delay) {\n\t\t\tlet readHead = this.writeHead[channel] - Math.floor(delay);\n\t\t\tif (readHead < 0) {\n\t\t\t\treadHead += this.size;\n\t\t\t}\n\t\t\treturn this.buffer[channel][readHead];\n\t\t}\n\t}\n");Fd("feedback-comb-filter",'\n\tclass FeedbackCombFilterWorklet extends SingleIOProcessor {\n\n\t\tconstructor(options) {\n\t\t\tsuper(options);\n\t\t\tthis.delayLine = new DelayLine(this.sampleRate, options.channelCount || 2);\n\t\t}\n\n\t\tstatic get parameterDescriptors() {\n\t\t\treturn [{\n\t\t\t\tname: "delayTime",\n\t\t\t\tdefaultValue: 0.1,\n\t\t\t\tminValue: 0,\n\t\t\t\tmaxValue: 1,\n\t\t\t\tautomationRate: "k-rate"\n\t\t\t}, {\n\t\t\t\tname: "feedback",\n\t\t\t\tdefaultValue: 0.5,\n\t\t\t\tminValue: 0,\n\t\t\t\tmaxValue: 0.9999,\n\t\t\t\tautomationRate: "k-rate"\n\t\t\t}];\n\t\t}\n\n\t\tgenerate(input, channel, parameters) {\n\t\t\tconst delayedSample = this.delayLine.get(channel, parameters.delayTime * this.sampleRate);\n\t\t\tthis.delayLine.push(channel, input + delayedSample * parameters.feedback);\n\t\t\treturn delayedSample;\n\t\t}\n\t}\n');class Ld extends Pd{constructor(){super(Hh(Ld.getDefaults(),arguments,["urls","onload","baseUrl"],"urls")),this.name="Sampler",this._activeSources=new Map;const t=Hh(Ld.getDefaults(),arguments,["urls","onload","baseUrl"],"urls"),e={};Object.keys(t.urls).forEach((n=>{const i=parseInt(n,10);if(Ch(Vh(n)||Mh(i)&&isFinite(i),`url key is neither a note or midi pitch: ${n}`),Vh(n)){const i=new xp(this.context,n).toMidi();e[i]=t.urls[n]}else Mh(i)&&isFinite(i)&&(e[i]=t.urls[i])})),this._buffers=new qp({urls:e,onload:t.onload,baseUrl:t.baseUrl,onerror:t.onerror}),this.attack=t.attack,this.release=t.release,this.curve=t.curve,this._buffers.loaded&&Promise.resolve().then(t.onload)}static getDefaults(){return Object.assign(Pd.getDefaults(),{attack:0,baseUrl:"",curve:"exponential",onload:cp,onerror:cp,release:.1,urls:{}})}_findClosest(t){let e=0;for(;e<96;){if(this._buffers.has(t+e))return-e;if(this._buffers.has(t-e))return e;e++}throw new Error(`No available buffers for note: ${t}`)}triggerAttack(t,e,n=1){return this.log("triggerAttack",t,e,n),Array.isArray(t)||(t=[t]),t.forEach((t=>{const i=bp(new xp(this.context,t).toFrequency()),s=Math.round(i),r=i-s,o=this._findClosest(s),a=s-o,l=this._buffers.get(a),c=vp(o+r),u=new ed({url:l,context:this.context,curve:this.curve,fadeIn:this.attack,fadeOut:this.release,playbackRate:c}).connect(this.output);u.start(e,0,l.duration/c,n),Dh(this._activeSources.get(s))||this._activeSources.set(s,[]),this._activeSources.get(s).push(u),u.onended=()=>{if(this._activeSources&&this._activeSources.has(s)){const t=this._activeSources.get(s),e=t.indexOf(u);-1!==e&&t.splice(e,1)}}})),this}triggerRelease(t,e){return this.log("triggerRelease",t,e),Array.isArray(t)||(t=[t]),t.forEach((t=>{const n=new xp(this.context,t).toMidi();if(this._activeSources.has(n)&&this._activeSources.get(n).length){const t=this._activeSources.get(n);e=this.toSeconds(e),t.forEach((t=>{t.stop(e)})),this._activeSources.set(n,[])}})),this}releaseAll(t){const e=this.toSeconds(t);return this._activeSources.forEach((t=>{for(;t.length;){t.shift().stop(e)}})),this}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",1)),this}triggerAttackRelease(t,e,n,i=1){const s=this.toSeconds(n);return this.triggerAttack(t,s,i),Dh(e)?(Ch(Dh(t),"notes must be an array when duration is array"),t.forEach(((t,n)=>{const i=e[Math.min(n,e.length-1)];this.triggerRelease(t,s+this.toSeconds(i))}))):this.triggerRelease(t,s+this.toSeconds(e)),this}add(t,e,n){if(Ch(Vh(t)||isFinite(t),`note must be a pitch or midi: ${t}`),Vh(t)){const i=new xp(this.context,t).toMidi();this._buffers.add(i,e,n)}else this._buffers.add(t,e,n);return this}get loaded(){return this._buffers.loaded}dispose(){return super.dispose(),this._buffers.dispose(),this._activeSources.forEach((t=>{t.forEach((t=>t.dispose()))})),this._activeSources.clear(),this}}q([Td(0)],Ld.prototype,"attack",void 0),q([Td(0)],Ld.prototype,"release",void 0);class Nd extends Pp{constructor(){super(Object.assign(Hh(Nd.getDefaults(),arguments,["fade"]))),this.name="CrossFade",this._panner=this.context.createStereoPanner(),this._split=this.context.createChannelSplitter(2),this._g2a=new Sd({context:this.context}),this.a=new Ip({context:this.context,gain:0}),this.b=new Ip({context:this.context,gain:0}),this.output=new Ip({context:this.context}),this._internalChannels=[this.a,this.b];const t=Hh(Nd.getDefaults(),arguments,["fade"]);this.fade=new Fp({context:this.context,units:"normalRange",value:t.fade}),ap(this,"fade"),this.context.getConstant(1).connect(this._panner),this._panner.connect(this._split),this._panner.channelCount=1,this._panner.channelCountMode="explicit",Op(this._split,this.a.gain,0),Op(this._split,this.b.gain,1),this.fade.chain(this._g2a,this._panner.pan),this.a.connect(this.output),this.b.connect(this.output)}static getDefaults(){return Object.assign(Pp.getDefaults(),{fade:.5})}dispose(){return super.dispose(),this.a.dispose(),this.b.dispose(),this.output.dispose(),this.fade.dispose(),this._g2a.dispose(),this._panner.disconnect(),this._split.disconnect(),this}}class Bd extends Pp{constructor(t){super(t),this.name="Effect",this._dryWet=new Nd({context:this.context}),this.wet=this._dryWet.fade,this.effectSend=new Ip({context:this.context}),this.effectReturn=new Ip({context:this.context}),this.input=new Ip({context:this.context}),this.output=this._dryWet,this.input.fan(this._dryWet.a,this.effectSend),this.effectReturn.connect(this._dryWet.b),this.wet.setValueAtTime(t.wet,0),this._internalChannels=[this.effectReturn,this.effectSend],ap(this,"wet")}static getDefaults(){return Object.assign(Pp.getDefaults(),{wet:1})}connectEffect(t){return this._internalChannels.push(t),this.effectSend.chain(t,this.effectReturn),this}dispose(){return super.dispose(),this._dryWet.dispose(),this.effectSend.dispose(),this.effectReturn.dispose(),this.wet.dispose(),this}}class zd extends Pp{constructor(){super(Object.assign(Hh(zd.getDefaults(),arguments,["pan"]))),this.name="Panner",this._panner=this.context.createStereoPanner(),this.input=this._panner,this.output=this._panner;const t=Hh(zd.getDefaults(),arguments,["pan"]);this.pan=new Ep({context:this.context,param:this._panner.pan,value:t.pan,minValue:-1,maxValue:1}),this._panner.channelCount=t.channelCount,this._panner.channelCountMode="explicit",ap(this,"pan")}static getDefaults(){return Object.assign(Pp.getDefaults(),{pan:0,channelCount:1})}dispose(){return super.dispose(),this._panner.disconnect(),this.pan.dispose(),this}}Fd("bit-crusher","\n\tclass BitCrusherWorklet extends SingleIOProcessor {\n\n\t\tstatic get parameterDescriptors() {\n\t\t\treturn [{\n\t\t\t\tname: \"bits\",\n\t\t\t\tdefaultValue: 12,\n\t\t\t\tminValue: 1,\n\t\t\t\tmaxValue: 16,\n\t\t\t\tautomationRate: 'k-rate'\n\t\t\t}];\n\t\t}\n\n\t\tgenerate(input, _channel, parameters) {\n\t\t\tconst step = Math.pow(0.5, parameters.bits - 1);\n\t\t\tconst val = step * Math.floor(input / step + 0.5);\n\t\t\treturn val;\n\t\t}\n\t}\n");class jd extends Pp{constructor(){super(Hh(jd.getDefaults(),arguments,["channels"])),this.name="Merge";const t=Hh(jd.getDefaults(),arguments,["channels"]);this._merger=this.output=this.input=this.context.createChannelMerger(t.channels)}static getDefaults(){return Object.assign(Pp.getDefaults(),{channels:2})}dispose(){return super.dispose(),this._merger.disconnect(),this}}class Ud extends Bd{constructor(){super(Hh(Ud.getDefaults(),arguments,["distortion"])),this.name="Distortion";const t=Hh(Ud.getDefaults(),arguments,["distortion"]);this._shaper=new cd({context:this.context,length:4096}),this._distortion=t.distortion,this.connectEffect(this._shaper),this.distortion=t.distortion,this.oversample=t.oversample}static getDefaults(){return Object.assign(Bd.getDefaults(),{distortion:.4,oversample:"none"})}get distortion(){return this._distortion}set distortion(t){this._distortion=t;const e=100*t,n=Math.PI/180;this._shaper.setMap((t=>Math.abs(t)<.001?0:(3+e)*t*20*n/(Math.PI+e*Math.abs(t))))}get oversample(){return this._shaper.oversample}set oversample(t){this._shaper.oversample=t}dispose(){return super.dispose(),this._shaper.dispose(),this}}class qd extends Bd{constructor(t){super(t),this.name="FeedbackEffect",this._feedbackGain=new Ip({context:this.context,gain:t.feedback,units:"normalRange"}),this.feedback=this._feedbackGain.gain,ap(this,"feedback"),this.effectReturn.chain(this._feedbackGain,this.effectSend)}static getDefaults(){return Object.assign(Bd.getDefaults(),{feedback:.125})}dispose(){return super.dispose(),this._feedbackGain.dispose(),this.feedback.dispose(),this}}class Wd extends qd{constructor(){super(Hh(Wd.getDefaults(),arguments,["pitch"])),this.name="PitchShift";const t=Hh(Wd.getDefaults(),arguments,["pitch"]);this._frequency=new Fp({context:this.context}),this._delayA=new Up({maxDelay:1,context:this.context}),this._lfoA=new xd({context:this.context,min:0,max:.1,type:"sawtooth"}).connect(this._delayA.delayTime),this._delayB=new Up({maxDelay:1,context:this.context}),this._lfoB=new xd({context:this.context,min:0,max:.1,type:"sawtooth",phase:180}).connect(this._delayB.delayTime),this._crossFade=new Nd({context:this.context}),this._crossFadeLFO=new xd({context:this.context,min:0,max:1,type:"triangle",phase:90}).connect(this._crossFade.fade),this._feedbackDelay=new Up({delayTime:t.delayTime,context:this.context}),this.delayTime=this._feedbackDelay.delayTime,ap(this,"delayTime"),this._pitch=t.pitch,this._windowSize=t.windowSize,this._delayA.connect(this._crossFade.a),this._delayB.connect(this._crossFade.b),this._frequency.fan(this._lfoA.frequency,this._lfoB.frequency,this._crossFadeLFO.frequency),this.effectSend.fan(this._delayA,this._delayB),this._crossFade.chain(this._feedbackDelay,this.effectReturn);const e=this.now();this._lfoA.start(e),this._lfoB.start(e),this._crossFadeLFO.start(e),this.windowSize=this._windowSize}static getDefaults(){return Object.assign(qd.getDefaults(),{pitch:0,windowSize:.1,delayTime:0,feedback:0})}get pitch(){return this._pitch}set pitch(t){this._pitch=t;let e=0;t<0?(this._lfoA.min=0,this._lfoA.max=this._windowSize,this._lfoB.min=0,this._lfoB.max=this._windowSize,e=vp(t-1)+1):(this._lfoA.min=this._windowSize,this._lfoA.max=0,this._lfoB.min=this._windowSize,this._lfoB.max=0,e=vp(t)-1),this._frequency.value=e*(1.2/this._windowSize)}get windowSize(){return this._windowSize}set windowSize(t){this._windowSize=this.toSeconds(t),this.pitch=this._pitch}dispose(){return super.dispose(),this._frequency.dispose(),this._delayA.dispose(),this._delayB.dispose(),this._lfoA.dispose(),this._lfoB.dispose(),this._crossFade.dispose(),this._crossFadeLFO.dispose(),this._feedbackDelay.dispose(),this}}class Hd extends Bd{constructor(){super(Hh(Hd.getDefaults(),arguments,["decay"])),this.name="Reverb",this._convolver=this.context.createConvolver(),this.ready=Promise.resolve();const t=Hh(Hd.getDefaults(),arguments,["decay"]);this._decay=t.decay,this._preDelay=t.preDelay,this.generate(),this.connectEffect(this._convolver)}static getDefaults(){return Object.assign(Bd.getDefaults(),{decay:1.5,preDelay:.01})}get decay(){return this._decay}set decay(t){Th(t=this.toSeconds(t),.001),this._decay=t,this.generate()}get preDelay(){return this._preDelay}set preDelay(t){Th(t=this.toSeconds(t),0),this._preDelay=t,this.generate()}generate(){return W(this,void 0,void 0,(function*(){const t=this.ready,e=new hp(2,this._decay+this._preDelay,this.context.sampleRate),n=new nd({context:e}),i=new nd({context:e}),s=new jd({context:e});n.connect(s,0,0),i.connect(s,0,1);const r=new Ip({context:e}).toDestination();s.connect(r),n.start(0),i.start(0),r.gain.setValueAtTime(0,0),r.gain.setValueAtTime(1,this._preDelay),r.gain.exponentialApproachValueAtTime(0,this._preDelay,this.decay);const o=e.render();return this.ready=o.then(cp),yield t,this._convolver.buffer=(yield o).get(),this}))}dispose(){return super.dispose(),this._convolver.disconnect(),this}}class Gd extends Pp{constructor(){super(Hh(Gd.getDefaults(),arguments,["solo"])),this.name="Solo";const t=Hh(Gd.getDefaults(),arguments,["solo"]);this.input=this.output=new Ip({context:this.context}),Gd._allSolos.has(this.context)||Gd._allSolos.set(this.context,new Set),Gd._allSolos.get(this.context).add(this),this.solo=t.solo}static getDefaults(){return Object.assign(Pp.getDefaults(),{solo:!1})}get solo(){return this._isSoloed()}set solo(t){t?this._addSolo():this._removeSolo(),Gd._allSolos.get(this.context).forEach((t=>t._updateSolo()))}get muted(){return 0===this.input.gain.value}_addSolo(){Gd._soloed.has(this.context)||Gd._soloed.set(this.context,new Set),Gd._soloed.get(this.context).add(this)}_removeSolo(){Gd._soloed.has(this.context)&&Gd._soloed.get(this.context).delete(this)}_isSoloed(){return Gd._soloed.has(this.context)&&Gd._soloed.get(this.context).has(this)}_noSolos(){return!Gd._soloed.has(this.context)||Gd._soloed.has(this.context)&&0===Gd._soloed.get(this.context).size}_updateSolo(){this._isSoloed()||this._noSolos()?this.input.gain.value=1:this.input.gain.value=0}dispose(){return super.dispose(),Gd._allSolos.get(this.context).delete(this),this._removeSolo(),this}}Gd._allSolos=new Map,Gd._soloed=new Map;class Kd extends Pp{constructor(){super(Hh(Kd.getDefaults(),arguments,["pan","volume"])),this.name="PanVol";const t=Hh(Kd.getDefaults(),arguments,["pan","volume"]);this._panner=this.input=new zd({context:this.context,pan:t.pan,channelCount:t.channelCount}),this.pan=this._panner.pan,this._volume=this.output=new Yp({context:this.context,volume:t.volume}),this.volume=this._volume.volume,this._panner.connect(this._volume),this.mute=t.mute,ap(this,["pan","volume"])}static getDefaults(){return Object.assign(Pp.getDefaults(),{mute:!1,pan:0,volume:0,channelCount:1})}get mute(){return this._volume.mute}set mute(t){this._volume.mute=t}dispose(){return super.dispose(),this._panner.dispose(),this.pan.dispose(),this._volume.dispose(),this.volume.dispose(),this}}class Yd extends Pp{constructor(){super(Hh(Yd.getDefaults(),arguments,["volume","pan"])),this.name="Channel";const t=Hh(Yd.getDefaults(),arguments,["volume","pan"]);this._solo=this.input=new Gd({solo:t.solo,context:this.context}),this._panVol=this.output=new Kd({context:this.context,pan:t.pan,volume:t.volume,mute:t.mute,channelCount:t.channelCount}),this.pan=this._panVol.pan,this.volume=this._panVol.volume,this._solo.connect(this._panVol),ap(this,["pan","volume"])}static getDefaults(){return Object.assign(Pp.getDefaults(),{pan:0,volume:0,mute:!1,solo:!1,channelCount:1})}get solo(){return this._solo.solo}set solo(t){this._solo.solo=t}get muted(){return this._solo.muted||this.mute}get mute(){return this._panVol.mute}set mute(t){this._panVol.mute=t}_getBus(t){return Yd.buses.has(t)||Yd.buses.set(t,new Ip({context:this.context})),Yd.buses.get(t)}send(t,e=0){const n=this._getBus(t),i=new Ip({context:this.context,units:"decibels",gain:e});return this.connect(i),i.connect(n),i}receive(t){return this._getBus(t).connect(this),this}dispose(){return super.dispose(),this._panVol.dispose(),this.pan.dispose(),this.volume.dispose(),this._solo.dispose(),this}}Yd.buses=new Map;class Xd extends Pp{constructor(){super(...arguments),this.name="Listener",this.positionX=new Ep({context:this.context,param:this.context.rawContext.listener.positionX}),this.positionY=new Ep({context:this.context,param:this.context.rawContext.listener.positionY}),this.positionZ=new Ep({context:this.context,param:this.context.rawContext.listener.positionZ}),this.forwardX=new Ep({context:this.context,param:this.context.rawContext.listener.forwardX}),this.forwardY=new Ep({context:this.context,param:this.context.rawContext.listener.forwardY}),this.forwardZ=new Ep({context:this.context,param:this.context.rawContext.listener.forwardZ}),this.upX=new Ep({context:this.context,param:this.context.rawContext.listener.upX}),this.upY=new Ep({context:this.context,param:this.context.rawContext.listener.upY}),this.upZ=new Ep({context:this.context,param:this.context.rawContext.listener.upZ})}static getDefaults(){return Object.assign(Pp.getDefaults(),{positionX:0,positionY:0,positionZ:0,forwardX:0,forwardY:0,forwardZ:-1,upX:0,upY:1,upZ:0})}dispose(){return super.dispose(),this.positionX.dispose(),this.positionY.dispose(),this.positionZ.dispose(),this.forwardX.dispose(),this.forwardY.dispose(),this.forwardZ.dispose(),this.upX.dispose(),this.upY.dispose(),this.upZ.dispose(),this}}ep((t=>{t.listener=new Xd({context:t})})),ip((t=>{t.listener.dispose()})),fp().transport,fp().destination,fp().destination,fp().listener,fp().draw,fp();const $d=window.location.search;let Zd,Qd,Jd;new URLSearchParams($d).get("debug")&&(Jd=new xr.exports.Pane({title:"Settings",expanded:false}));const tf=()=>{document.body.style.width=`${document.documentElement.clientWidth}px`,document.body.style.height=`${document.documentElement.clientHeight}px`,Zd&&Zd.resize()};var ef,nf,sf;ae(window,"resize").pipe((ef=100,void 0===nf&&(nf=Ot),Ct((function(t,e){var n=null,i=null,s=null,r=function(){if(n){n.unsubscribe(),n=null;var t=i;i=null,e.next(t)}};function o(){var t=s+ef,i=nf.now();if(i<t)return n=this.schedule(void 0,t-i),void e.add(n);r()}t.subscribe(Tt(e,(function(t){i=t,s=nf.now(),n||(n=nf.schedule(o,ef),e.add(n))}),(function(){r(),e.complete()}),void 0,(function(){i=n=null})))})))).subscribe((()=>tf())),ae(window,"load").pipe((sf=1,sf<=0?function(){return Dt}:Ct((function(t,e){var n=0;t.subscribe(Tt(e,(function(t){++n<=sf&&(e.next(t),sf<=n&&e.complete())})))})))).subscribe((()=>tf()));const rf=document.querySelector("canvas"),of=document.querySelector("#record-button"),af=document.querySelector("#playback-button");Qd=new class{constructor(t,e,n=!1,i=null){R(this,"MAX_RECORD_LENGTH",5),R(this,"FFT_BUFFER_SIZE",256),R(this,"isRecording",!1),R(this,"isRecordingTimeoutId",null),R(this,"MIN_DB",-100),this.isDev=n,this.pane=i,this.recordBtnElm=t,this.playbackBtnElm=e,this.init()}init(){this.recordBtnElm.innerHTML="START REC",this.playbackBtnElm.innerHTML="PLAY",this.playbackBtnElm.setAttribute("disabled",!0),this.recordBtnElm.addEventListener("click",(()=>this.onRecordButtonClicked())),this.playbackBtnElm.addEventListener("click",(()=>this.onPlaybackButtonClicked()))}initAudio(){this.audioContext=new AudioContext,mp(this.audioContext),this.gain=this.audioContext.createGain(),this.analyser=this.audioContext.createAnalyser(),this.analyser.fftSize=this.FFT_BUFFER_SIZE,this.analyser.minDecibels=-90,this.bufferLength=this.analyser.frequencyBinCount,this.buffer=new Uint8Array(this.bufferLength),this.smoothedBuffer1=new Float32Array(this.bufferLength),this.smoothedBuffer2=new Float32Array(this.bufferLength),this.buffer.fill(0),this.smoothedBuffer1.fill(0),this.smoothedBuffer2.fill(0),this.freqBandwidth=this.audioContext.sampleRate/2/this.bufferLength,this.dist=new Ud(.3),this.pitchShift=new Wd(-2),this.reverb=new Hd(3),Op(this.dist,this.pitchShift),Op(this.pitchShift,this.reverb),this.reverb.toDestination()}startPlayback(){this.audio.currentTime=0,this.audio.play()}pausePlayback(){this.audio.pause()}onPlaybackButtonClicked(){this.startPlayback()}async onRecordButtonClicked(){this.audioContext||this.initAudio(),this.isRecording?this.stopRecording():await this.startRecording()}async startRecording(){if(this.audio&&this.audio.pause(),this.playbackBtnElm.setAttribute("disabled",!0),this.recordBtnElm.innerHTML="STOP REC",this.isRecording=!0,this.audioChunks=[],!this.mediaRecorder){const t=await navigator.mediaDevices.getUserMedia({audio:!0});this.mediaRecorder=new MediaRecorder(t),this.mediaRecorder.addEventListener("dataavailable",(t=>{this.audioChunks.push(t.data)})),this.mediaRecorder.addEventListener("stop",(()=>{this.audioBlob=new Blob(this.audioChunks,{type:"audio/mpeg"}),this.audioUrl=URL.createObjectURL(this.audioBlob),this.audio=new Audio(this.audioUrl),this.source=this.audioContext.createMediaElementSource(this.audio),Op(this.source,this.dist),Op(this.source,this.analyser)}))}this.mediaRecorder.start(),this.isRecordingTimeoutId=setTimeout((()=>this.stopRecording()),1e3*this.MAX_RECORD_LENGTH)}stopRecording(){this.playbackBtnElm.removeAttribute("disabled"),this.isRecording=!1,this.recordBtnElm.innerHTML="START REC",clearTimeout(this.isRecordingTimeoutId),this.mediaRecorder.stop()}getSpectrum(){if(this.audioContext&&(this.audio&&!this.audio.paused?this.analyser.getByteFrequencyData(this.buffer):this.buffer.fill(0),this.buffer))for(let t=0;t<this.buffer.length;++t){let e=this.buffer[t]/255;this.smoothedBuffer1[t]+=(e-this.smoothedBuffer1[t])/10,this.smoothedBuffer2[t]+=(this.smoothedBuffer1[t]-this.smoothedBuffer2[t])/5}return this.buffer}}(of,af,false,Jd),Zd=new class{constructor(a,c,h=null,d=!1,m=null){N(this,s),N(this,o),N(this,l),N(this,u),N(this,p),N(this,f),N(this,v),N(this,g),N(this,y),N(this,x),N(this,T),N(this,S),N(this,E),N(this,M),N(this,D),R(this,"TARGET_FRAME_DURATION",16),N(this,t,0),N(this,e,0),N(this,n,0),N(this,i,0),R(this,"NUM_PARTICLES",500),R(this,"HIGHPASS_SCALE",.25),R(this,"simulationParams",{H:1,MASS:1,REST_DENS:1.5,GAS_CONST:400,VISC:18.5,POLY6:0,HSQ:0,SPIKY_GRAD:0,VISC_LAP:0,PARTICLE_COUNT:0,DOMAIN_SCALE:Te(1,1,1,1),STEPS:0}),R(this,"pointerParams",{RADIUS:.5,STRENGTH:20}),R(this,"camera",{matrix:ue(),near:4,far:6,fov:Math.PI/3,aspect:1,position:_e(0,0,6),up:_e(0,1,0),matrices:{view:ue(),projection:ue(),inversProjection:ue(),inversViewProjection:ue()}}),R(this,"light",{matrix:ue(),position:ye(ve(),we(ve(),_e(1,1,1)),6),up:_e(0,1,0),size:2.4,near:4,far:7,textureSize:1024,matrices:{view:ue(),projection:ue(),viewProjection:ue()}}),this.canvas=a,this.onInit=h,this.isDev=d,this.pane=m,this.audioRepeater=c,z(this,s,r).call(this).then((()=>{this.onInit&&this.onInit(this)}))}run(s=0){B(this,e,Math.min(16,s-L(this,t))),B(this,t,s),B(this,i,L(this,e)/this.TARGET_FRAME_DURATION),B(this,n,L(this,n)+L(this,i)),z(this,x,C).call(this,L(this,e)),z(this,T,A).call(this),requestAnimationFrame((t=>this.run(t)))}resize(){const t=this.gl;this.viewportSize=Pe(this.viewportSize,this.canvas.clientWidth,this.canvas.clientHeight);(function(t,e){e=e||1,e=Math.max(0,e);const n=t.clientWidth*e|0,i=t.clientHeight*e|0;return(t.width!==n||t.height!==i)&&(t.width=n,t.height=i,!0)})(this.canvas)&&(t.viewport(0,0,t.drawingBufferWidth,t.drawingBufferHeight),this.highpassFBO&&Ci(t,this.highpassFBO,[{attachment:this.highpassTexture}],this.viewportSize[0]*this.HIGHPASS_SCALE,this.viewportSize[1]*this.HIGHPASS_SCALE),this.drawFBO&&Ci(t,this.drawFBO,this.drawFBOAttachements,this.viewportSize[0],this.viewportSize[1])),z(this,E,P).call(this,t)}}(rf,Qd,(t=>t.run()),false,Jd),tf();
